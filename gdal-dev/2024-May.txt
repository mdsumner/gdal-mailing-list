From even.rouault at spatialys.com  Wed May  1 04:10:42 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 1 May 2024 13:10:42 +0200
Subject: [gdal-dev] GDAL 3.9.0beta2 available for testing
In-Reply-To: <70b44dfb-2f63-43f3-9fa4-bd45f960fde8@spatialys.com>
References: <70b44dfb-2f63-43f3-9fa4-bd45f960fde8@spatialys.com>
Message-ID: <59857e8e-6a54-4e72-9691-a58881020c8e@spatialys.com>

Hi,

The Docker images are now ready. Testing of the Ubuntu-based ones would 
be appreciated due to having switched to 24.04 since beta1:

- ghcr.io/osgeo/gdal:ubuntu-full-3.9.0beta2
- ghcr.io/osgeo/gdal:ubuntu-small-3.9.0beta2
- ghcr.io/osgeo/gdal:alpine-normal-3.9.0beta2
- ghcr.io/osgeo/gdal:alpine-small-3.9.0beta2

Even

Le 29/04/2024 ? 14:26, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> I've prepared a beta2 of GDAL 3.9.0 as there have been a few 
> non-trivial changes since beta1
>
> The major ones are:
>
> * pyproject.toml: use numpy>=2.0.0rc1 for python >=3.9 (#9751)
> * Docker: update ubuntu-small and ubuntu-full to 24.04
> * TileDB: migrate away from deprecated APIs, and bump minimum version 
> to 2.15
>
> Other bugfixes:
>
> * CMake: add missing dependency to generate_gdal_version_h target when 
> building {plugin}_core targets
> * CMake: fix generated find_dependency
> * Miramon: various fixes
> * GDALSuggestedWarpOutput2(): make changes of PR #9336 honour 
> SRC_METHOD=NO_GEOTRANSFORM. Fixes failure on rasterio 
> tests/test_warpedvrt.py::test_transformer_options__width_height
> * Update p-ranav/argparse to latest master; ogrinfo and ogr2ogr: 
> update to use store_into(GIntBig&)
> * GDALOpen(): avoid double '.' in error messages related to plugin 
> drivers
> * Add OSRIsDerivedProjected() / OGRSpatialReference::IsDerivedProjected()
> * OGR_CT: use PROJJSON internally rather than in WKT:2019 (#9732)
> * GDALArgumentParser: fix dealing with positional arguments that are 
> negative numeric values
> * GDALVectorInfo(): fix 3.9.0beta1 regression regarding passing layer 
> names
> * Internal libtiff: updated to latest upstream
> * gdalinfo and ogrinfo -json: add newline character at end of JSON 
> output (qgis#57266)
> * OGRFeature::SetField(): add warnings when detecting some lossy 
> conversions (refs #9792)
> * Arrow/Parquet: fix writing empty point Z with 
> GEOMETRY_ENCODING=GEOARROW_INTERLEAVED, and test spatial filtering of 
> that encoding (qgis#57228)
> * OGRLayer::WriteArrowBatch(): add tolerance for field type mismatches 
> if int32/int64/real; Also add an option IF_FIELD_NOT_PRESERVED=ERROR 
> to error out when lossy conversion occurs. (#9792)
> * Parquet: fix ResetReading() implementation, when using the 
> ParquetDataset API and when there's a single batch
> * Parquet: fix opening single file Parquet datasets with the 
> ParquetDataset API when using PARQUET:filename.parquet
> * OGRCloneArrowArray(): add missing support for 'tss:' Arrow type
>
> Docker images with 3.9.0beta2 are currently cooking.
>
> Source snapshots at:
>
> - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta2.tar.gz
> - https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0beta2.tar.xz
> - https://download.osgeo.org/gdal/3.9.0/gdal390beta2.zip
>
> Autotest snapshots:
>
> - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta2.tar.gz
> - https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0beta2.zip
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From mdsumner at gmail.com  Wed May  1 13:01:55 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 2 May 2024 06:01:55 +1000
Subject: [gdal-dev] another problem HDF5
In-Reply-To: <5d9164ed-60fd-41e3-bffd-05423d55faa3@spatialys.com>
References: <CAAcGz99bXB460BF6Pn22+tyCi7OaUgxkFYc25+=wfGQKh-NWiQ@mail.gmail.com>
 <5d9164ed-60fd-41e3-bffd-05423d55faa3@spatialys.com>
Message-ID: <CAAcGz9_c2ce1zn7Ax7Tg58+8e2C-AkSPHVjK6XaQU6Ruw-+xAw@mail.gmail.com>

Thanks Even!    I've reported it to the providers.

(btw don't gazump me on that book)

Cheers, Mike


On Tue, Apr 30, 2024 at 11:04?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> oh well, so this i actually a HDF5 file using netCDF conventions, but
> likely created with the HDF5 API itself. Per se, this isn't the issue, as
> you've figured it, we can convince the netCDF driver to open it. The lack
> of CRS comes from the fact that the land_mask_map variable has this
> attribute:
>
>                 land_mask_map:grid_mapping = "crs: grid_x crs: grid_y" ;
>
> Which tries to point to the "crs" variable where the CRS is defined. In
> 99% of the products, the value of grid_mapping would be just "crs", and
> life would be good.
>
> Here they use the "second format" for grid_mapping, described at
> https://cfconventions.org/Data/cf-conventions/cf-conventions-1.11/cf-conventions.html#grid-mappings-and-projections
>
> "In the second format, it is a blank-separated list of words
> "<gridMappingVariable>: <coordinatesVariable> [<coordinatesVariable> ??]
> [<gridMappingVariable>: <coordinatesVariable>??]", which identifies one or
> more grid mapping variables, and with each grid mapping associates one or
> more coordinatesVariables, i.e. coordinate variables or auxiliary
> coordinate variables."
>
> That documentation isn't 100% crystal clear but the later example 5.10
> "British National Grid" gives an example:
>
> temp:grid_mapping = "crsOSGB: x y crsWGS84: lat lon" ;
>
> So you can point to several crs variables, but for each you need to define
> *all* the relevant axis. The way it is done in the product you point
> doesn't match that philosophy (if they wanted to use the second format that
> should rather set "crs: grid_x grid_y", but using the second format here is
> just asking for troubles), and GDAL doesn't manage to parse it.
>
> You could tune netCDFDataset::SetProjectionFromVar() to recognize this
> weird value for grid_mapping in netCDFDataset::SetProjectionFromVar(),
> around line 3287, but I don't feel myself personally motivated to do that,
> if that product is just an outlier, so I leave it to you as an exercise if
> you wish :-). I guess just testing against the hardcoded "crs: grid_x crs:
> grid_y" value would be good enough to handle that outlier.
>
> (Someone, super bored, should author a book about with horror stories with
> netCDF and HDF georeferencing. There's a lot of material. Although likely
> not to be a best seller)
>
> Even
> Le 30/04/2024 ? 09:45, Michael Sumner via gdal-dev a ?crit :
>
> This time, with:
>
>
> https://n5eil01u.ecs.nsidc.org/ATLAS/ATL20.004/2018.10.14/ATL20-01_20181001010615_00370101_004_01.h5
>
> NETCDF gets the geotransform (from x_grid,y_grid which report in the
> metadata) but no crs:
>
>   gdalinfo NETCDF:ATL20-02_20181001010615_00370101_004_01.h5 -sd 1 -nomd
> Driver: netCDF/Network Common Data Format
> Files: ATL20-02_20181001010615_00370101_004_01.h5
> Size is 316, 332
> Origin = (-3950000.000000000000000,4350000.000000000000000)
> Pixel Size = (25000.000000000000000,-25000.000000000000000)
> Corner Coordinates:
> Upper Left  (-3950000.000, 4350000.000)
> Lower Left  (-3950000.000,-3950000.000)
> Upper Right ( 3950000.000, 4350000.000)
> Lower Right ( 3950000.000,-3950000.000)
> Center      (       0.000,  200000.000)
> Band 1 Block=500x500 Type=Float64, ColorInterp=Undefined
>   Unit Type: degrees_north
>
>
> HDF5 doesn't get geotransform or crs:
>
> gdalinfo ATL20-02_20181001010615_00370101_004_01.h5 -sd 1 -nomd
> Driver: HDF5Image/HDF5 Dataset
> Files: ATL20-02_20181001010615_00370101_004_01.h5
> Size is 316, 332
> Corner Coordinates:
> Upper Left  (    0.0,    0.0)
> Lower Left  (    0.0,  332.0)
> Upper Right (  316.0,    0.0)
> Lower Right (  316.0,  332.0)
> Center      (  158.0,  166.0)
> Band 1 Block=500x500 Type=Float32, ColorInterp=Undefined
>   NoData Value=3.4028235e+38
>
> This is unproblematically NSIDC 25km south, there's no mix of poles in
> this one. I honestly don't know what to expect from these files generally
> though I get my hopes up sometimes haha.
>
> I'll have to keep notes and explore more deeply with native HDF5 tools.
>
> Cheers, Mike
>
>
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240502/125edc87/attachment.htm>

From liyenew at gmail.com  Fri May  3 06:29:44 2024
From: liyenew at gmail.com (Liyuneh Gebre)
Date: Fri, 3 May 2024 16:29:44 +0300
Subject: [gdal-dev] Re-post, user-defined
In-Reply-To: <CAE4zf465xasEy4aS0n7U8ads=yVrpq180sHhgLropKX+YVvKwA@mail.gmail.com>
References: <CAE4zf46tV7mfiEAYKrMjhDQVdfRPnSpzdcje3a47FE0HvMgY3A@mail.gmail.com>
 <9694b249-bf48-4e93-8485-c90086c891bb@spatialys.com>
 <CAE4zf47u06CxE4Qp5=B=WdAag1jYTvyyX0m0vf-9q894GtHTng@mail.gmail.com>
 <763f43b4-ce79-4410-9d46-49addd1b0b01@spatialys.com>
 <CAE4zf465xasEy4aS0n7U8ads=yVrpq180sHhgLropKX+YVvKwA@mail.gmail.com>
Message-ID: <CAE4zf44_0j7en6xJ1YXScz0sVvtHb49z994vEsTfoNHxb-JzDQ@mail.gmail.com>

Dear Even,
 Apologies for taking your time. I couldn?t locate the mentioned error in
arcpy. It runs smoothly . I?ve shared  the arcpy projection python script
and associated data with the link
https://u.pcloud.link/publink/show?code=kZj5wh0ZtFWXtI9UGjQiD6KXxn5A9hiWDpEX.
If you find a way using gdaltransform and gdalwarp to achieve the
re-projection, that would be appreciated.
thank you in advance

On Tue, Apr 30, 2024 at 2:55?AM Liyuneh Gebre <liyenew at gmail.com> wrote:

> Well the arcpy made transformation before re-projection. Appended the
> sample script in the shared folder as txt. Anyway how can I achieve this
> ArcPy output re-projection from gdal with the given gdalinfo on the input
> file  and by editing the PROJ.4 string (target projection )?
> PARAMETER["Latitude of natural origin",20,
> ANGLEUNIT["degree",0.0174532925199433],
> ID["EPSG",8801]],
> PARAMETER["Longitude of natural origin",6378137,
> ANGLEUNIT["degree",0.0174532925199433],
> ID["EPSG",8802]],
> PARAMETER["False easting",5,
> LENGTHUNIT["metre",1],
> ID["EPSG",8806]],
>
> On Tue, Apr 30, 2024 at 1:11?AM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> At first sight, I'd say that the ArcPy output is incorrect. The SRS
>> definition of its output doesn't match what you want since it has
>>
>> PARAMETER["Latitude of natural origin",20,
>> ANGLEUNIT["degree",0.0174532925199433],
>> ID["EPSG",8801]],
>> PARAMETER["Longitude of natural origin",6378137,
>> ANGLEUNIT["degree",0.0174532925199433],
>> ID["EPSG",8802]],
>> PARAMETER["False easting",5,
>> LENGTHUNIT["metre",1],
>> ID["EPSG",8806]],
>>
>> The "Longitude of natural origin" is completely wrong, and should be 5
>> given the PROJ.4 string you mentionned
>>
>> And the the "False easting" should be 0.
>>
>> The output of GDAL looks plausible.
>>
>>
>> Le 30/04/2024 ? 00:00, Liyuneh Gebre a ?crit :
>>
>> Hi Even,
>> thank you for your response,
>> gdal version is: GDAL 3.6.4, released 2023/04/17
>> I got the defined target projection included in the link. yes, it's
>> geocentric and for further exploration the custom project transformation
>> file .gtf extension is also included.
>>
>> https://u.pcloud.link/publink/show?code=kZj5wh0ZtFWXtI9UGjQiD6KXxn5A9hiWDpEX
>>
>> On Mon, Apr 29, 2024 at 4:23?PM Even Rouault <even.rouault at spatialys.com>
>> wrote:
>>
>>> Hi,
>>>
>>> it is difficult to help you with just the elements you've provided.
>>>
>>> What could be helpful is:
>>>
>>> - the output of gdalinfo on the input file
>>>
>>> - the output of gdalinfo on the output file generate by ArcPy
>>>
>>> - how you define the target projection in ArcPy
>>>
>>> - the output of gdalinfo on the output file generate by GDAL
>>>
>>> - links to all the above files
>>>
>>> - the GDAL version you use
>>>
>>>
>>> Totally blind guess: try to add "+towgs84=0,0,0 " in your -t_srs PROJ
>>> string, to ask PROJ to consider that your target CRS datum has the same
>>> center and axis orientation as WGS84 (and thus go to geographic <-->
>>> geocentric conversion when changing datums). Otherwise without datum
>>> shifts, PROJ will consider that longitude,latitude coordinates of the
>>> geographic CRS underlying the source and target CRS is the same.
>>>
>>> Even
>>> Le 29/04/2024 ? 14:57, Liyuneh Gebre via gdal-dev a ?crit :
>>>
>>> Dear all,
>>> I am requesting again if you kind have some responds or direction, thank
>>> you
>>> I have difficulties in accurately reprojecting a raster file to a
>>> user-defined projection.
>>> I used the following commands in gdal while the output is not similar to
>>> arcpy results.  kindly offer your guidance to achieve the same result.  The
>>> arcpy uses custom transformation and then reprojection.
>>> gdalwarp -t_srs '+proj=laea +a=6378137.0 +f=0.0 +pm=0 +x_0=0.0 +y_0=0.0
>>> +lon_0=20.0 +lat_0=5.0 +units=m +axis=enu +no_defs'  -dstalpha  -wo
>>> SOURCE_EXTRA=1000 -r nearest rain_in.bil rain_projected.bil
>>>
>>>
>>> *Liyuneh Gebre**, **Associate Researcher*
>>>
>>> *Ethiopian Institute of Agricultural Research,EIAR *
>>>
>>> *Cell Phone:+251 911858155 *
>>>
>>> *linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
>>> <https://www.linkedin.com/in/liyuneh-gebre-b842b440/> *
>>> *skype:liyenew_1*
>>> *Addis Ababa, Ethioipa*
>>>
>>> _______________________________________________
>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>> -- http://www.spatialys.com
>>> My software is free, but my time generally not.
>>>
>>>
>>
>> --
>> *Liyuneh Gebre**, **Associate Researcher*
>>
>> *Ethiopian Institute of Agricultural Research,EIAR *
>>
>> *Cell Phone:+251 911858155 *
>>
>> *linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
>> <https://www.linkedin.com/in/liyuneh-gebre-b842b440/> *
>> *skype:liyenew_1*
>> *Addis Ababa, Ethioipa*
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>>
>
> --
> *Liyuneh Gebre**, **Associate Researcher*
>
> *Ethiopian Institute of Agricultural Research,EIAR*
>
> *Cell Phone:+251 911858155*
>
> *linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
> <https://www.linkedin.com/in/liyuneh-gebre-b842b440/>*
> *skype:liyenew_1*
> *Addis Ababa, Ethioipa*
>


-- 
*Liyuneh Gebre**, **Associate Researcher*

*Ethiopian Institute of Agricultural Research,EIAR*

*Cell Phone:+251 911858155*

*linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
<https://www.linkedin.com/in/liyuneh-gebre-b842b440/>*
*skype:liyenew_1*
*Addis Ababa, Ethioipa*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240503/3444a6ca/attachment.htm>

From simon.eves at heavy.ai  Fri May  3 12:46:21 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Fri, 3 May 2024 12:46:21 -0700
Subject: [gdal-dev] Efficient raster bounding box transformation?
Message-ID: <CAJf0KTR95uz3ak6icN+pnDmDzzVRO8Y7gek6FVsDtBJnf=VOhA@mail.gmail.com>

So we are trying to optimize our raster import process, and particularly
the steps to derive the final WGS84/4326 bounding box for a raster file or
tile thereof.

Obviously in the general case, the transform is from integer pixel
coordinate through the Affine Transformation matrix and then whatever
OGRCoordinateTransformation is required to get to WGS84/4326, and perhaps a
GCP-based mesh transformation too.

Currently we are deriving the bounding box by passing all pixels of the
four edges of the file/tile through the full transform, except in the
simple Affine-only case where we just transform the four corners.

Is there any shortcut API provided by GDAL or PROJ to allow the bounding
box to be computed (or at least safely over-estimated) in the general case?
I'm assuming that even a non-GCP  OGRCT could still be non-linear such that
just transforming the corners is insufficient.

Thanks in advance,

Simon

-- 
Simon Eves
Senior Rendering Engineer
+1 (415) 902-1996
simon.eves at heavy.ai

<http://www.heavy.ai>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240503/4f942d58/attachment.htm>

From j1 at jimenezshaw.com  Fri May  3 13:09:05 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Fri, 3 May 2024 22:09:05 +0200
Subject: [gdal-dev] Efficient raster bounding box transformation?
In-Reply-To: <CAJf0KTR95uz3ak6icN+pnDmDzzVRO8Y7gek6FVsDtBJnf=VOhA@mail.gmail.com>
References: <CAJf0KTR95uz3ak6icN+pnDmDzzVRO8Y7gek6FVsDtBJnf=VOhA@mail.gmail.com>
Message-ID: <CADRrdKsy1DcHYi_OsaaJCX78RkyeppBGjSTLXvKAxekCVAUoNA@mail.gmail.com>

Maybe I don't understand your question, but in gdalinfo you have the four
corners as lat-lon

On Fri, 3 May 2024, 21:46 Simon Eves via gdal-dev, <gdal-dev at lists.osgeo.org>
wrote:

> So we are trying to optimize our raster import process, and particularly
> the steps to derive the final WGS84/4326 bounding box for a raster file or
> tile thereof.
>
> Obviously in the general case, the transform is from integer pixel
> coordinate through the Affine Transformation matrix and then whatever
> OGRCoordinateTransformation is required to get to WGS84/4326, and perhaps a
> GCP-based mesh transformation too.
>
> Currently we are deriving the bounding box by passing all pixels of the
> four edges of the file/tile through the full transform, except in the
> simple Affine-only case where we just transform the four corners.
>
> Is there any shortcut API provided by GDAL or PROJ to allow the bounding
> box to be computed (or at least safely over-estimated) in the general case?
> I'm assuming that even a non-GCP  OGRCT could still be non-linear such that
> just transforming the corners is insufficient.
>
> Thanks in advance,
>
> Simon
>
> --
> Simon Eves
> Senior Rendering Engineer
> +1 (415) 902-1996
> simon.eves at heavy.ai
>
> <http://www.heavy.ai>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240503/c19bce2c/attachment.htm>

From simon.eves at heavy.ai  Fri May  3 13:18:33 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Fri, 3 May 2024 13:18:33 -0700
Subject: [gdal-dev] Efficient raster bounding box transformation?
In-Reply-To: <CADRrdKsy1DcHYi_OsaaJCX78RkyeppBGjSTLXvKAxekCVAUoNA@mail.gmail.com>
References: <CAJf0KTR95uz3ak6icN+pnDmDzzVRO8Y7gek6FVsDtBJnf=VOhA@mail.gmail.com>
 <CADRrdKsy1DcHYi_OsaaJCX78RkyeppBGjSTLXvKAxekCVAUoNA@mail.gmail.com>
Message-ID: <CAJf0KTRWwWK=1ig8e1=H_tDLrW2egc2igSbuTNttqQeD598kZQ@mail.gmail.com>

Yes, but that's just the corners.

Consider, say, a raster that contains a satellite sweep which is not
axis-aligned but forms a "windshield wiper" shape in lon/lat space. The
bounding box of ALL the pixels is not just the bounding box of the corners.

On Fri, May 3, 2024 at 1:09?PM Javier Jimenez Shaw <j1 at jimenezshaw.com>
wrote:

> Maybe I don't understand your question, but in gdalinfo you have the four
> corners as lat-lon
>
> On Fri, 3 May 2024, 21:46 Simon Eves via gdal-dev, <
> gdal-dev at lists.osgeo.org> wrote:
>
>> So we are trying to optimize our raster import process, and particularly
>> the steps to derive the final WGS84/4326 bounding box for a raster file or
>> tile thereof.
>>
>> Obviously in the general case, the transform is from integer pixel
>> coordinate through the Affine Transformation matrix and then whatever
>> OGRCoordinateTransformation is required to get to WGS84/4326, and perhaps a
>> GCP-based mesh transformation too.
>>
>> Currently we are deriving the bounding box by passing all pixels of the
>> four edges of the file/tile through the full transform, except in the
>> simple Affine-only case where we just transform the four corners.
>>
>> Is there any shortcut API provided by GDAL or PROJ to allow the bounding
>> box to be computed (or at least safely over-estimated) in the general case?
>> I'm assuming that even a non-GCP  OGRCT could still be non-linear such that
>> just transforming the corners is insufficient.
>>
>> Thanks in advance,
>>
>> Simon
>>
>> --
>> Simon Eves
>> Senior Rendering Engineer
>> +1 (415) 902-1996
>> simon.eves at heavy.ai
>>
>> <http://www.heavy.ai>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240503/43b23e9b/attachment.htm>

From public at postholer.com  Fri May  3 13:41:43 2024
From: public at postholer.com (Scott)
Date: Fri, 3 May 2024 13:41:43 -0700
Subject: [gdal-dev] Efficient raster bounding box transformation?
In-Reply-To: <CAJf0KTRWwWK=1ig8e1=H_tDLrW2egc2igSbuTNttqQeD598kZQ@mail.gmail.com>
References: <CAJf0KTR95uz3ak6icN+pnDmDzzVRO8Y7gek6FVsDtBJnf=VOhA@mail.gmail.com>
 <CADRrdKsy1DcHYi_OsaaJCX78RkyeppBGjSTLXvKAxekCVAUoNA@mail.gmail.com>
 <CAJf0KTRWwWK=1ig8e1=H_tDLrW2egc2igSbuTNttqQeD598kZQ@mail.gmail.com>
Message-ID: <a6b10227-11be-4b82-972d-b7062a47ca27@postholer.com>

The bbox is created using the xmin,ymin,xmax,ymax found in the geometry. 
Assuming every pixel can be represented as a geometry, that's your bbox.

On 5/3/24 13:18, Simon Eves via gdal-dev wrote:
> Yes, but that's just the corners.
> 
> Consider, say, a raster that contains a satellite sweep which is not 
> axis-aligned but forms a "windshield wiper" shape in lon/lat space. The 
> bounding box of ALL the pixels is not just the bounding box of the corners.
> 
> On Fri, May 3, 2024 at 1:09?PM Javier Jimenez Shaw <j1 at jimenezshaw.com 
> <mailto:j1 at jimenezshaw.com>> wrote:
> 
>     Maybe I don't understand your question, but in gdalinfo you have the
>     four corners as lat-lon
> 
>     On Fri, 3 May 2024, 21:46 Simon Eves via gdal-dev,
>     <gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>> wrote:
> 
>         So we are trying to optimize our raster import process, and
>         particularly the steps to derive the final WGS84/4326 bounding
>         box for a raster file or tile thereof.
> 
>         Obviously in the general case, the transform is from integer
>         pixel coordinate through the Affine Transformation matrix and
>         then whatever OGRCoordinateTransformation is required to get to
>         WGS84/4326, and perhaps a GCP-based mesh transformation too.
> 
>         Currently we are deriving the bounding box by passing all pixels
>         of the four edges of the file/tile through the full transform,
>         except in the simple Affine-only case where we just transform
>         the four corners.
> 
>         Is there any shortcut API provided by GDAL or PROJ to allow the
>         bounding box to be computed (or at least safely over-estimated)
>         in the?general case? I'm assuming that even a non-GCP 
>         OGRCT?could still be non-linear such that just transforming the
>         corners is insufficient.
> 
>         Thanks in advance,
> 
>         Simon
> 
>         -- 
>         Simon Eves
>         Senior Rendering Engineer
>         +1 (415) 902-1996
>         simon.eves at heavy.ai <mailto:simon.eves at heavy.ai>
> 
>         <http://www.heavy.ai>
> 
>         _______________________________________________
>         gdal-dev mailing list
>         gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>         https://lists.osgeo.org/mailman/listinfo/gdal-dev
>         <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From simon.eves at heavy.ai  Fri May  3 14:24:33 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Fri, 3 May 2024 14:24:33 -0700
Subject: [gdal-dev] Efficient raster bounding box transformation?
In-Reply-To: <a6b10227-11be-4b82-972d-b7062a47ca27@postholer.com>
References: <CAJf0KTR95uz3ak6icN+pnDmDzzVRO8Y7gek6FVsDtBJnf=VOhA@mail.gmail.com>
 <CADRrdKsy1DcHYi_OsaaJCX78RkyeppBGjSTLXvKAxekCVAUoNA@mail.gmail.com>
 <CAJf0KTRWwWK=1ig8e1=H_tDLrW2egc2igSbuTNttqQeD598kZQ@mail.gmail.com>
 <a6b10227-11be-4b82-972d-b7062a47ca27@postholer.com>
Message-ID: <CAJf0KTS1DnRgZRuKoT6QhzVB+u2u-hE1PvbrKM61Tw3miwf+hA@mail.gmail.com>

I don't have a real example to hand, but consider satellite imagery which
has not been processed but the file just has a GCP-based transformation
which warps it to something like this in flat (lon/lat or mercator) space.

https://drive.google.com/file/d/1Yzxy3zTUiU2OIyN0EiZFMeYIDwWj4AqG/view?usp=sharing

Just transforming the four corners does NOT give the overall bounding box
for ALL the final pixels because the top edge (in this case) bulges upwards.

Right now we are transforming every pixel coordinate along each of the four
edges in order to find the true min/max, if we know the transform could be
non-linear, which you presumably MUST assume it IS in the GCP case, but are
there NON-GCP (just an OGRCT) transforms where you can still make
assumptions about the true bounding box based on just the transforms of the
corners. I doubt it, but I'm asking anyway.

Obviously we could choose to approximate by just testing say 100
equally-spaced pixels along each edge, then that's probably good enough, as
the transformation is unlikely to have any local deviations in the bits
that we skip over, but it still seems risky.

On Fri, May 3, 2024 at 1:41?PM Scott via gdal-dev <gdal-dev at lists.osgeo.org>
wrote:

> The bbox is created using the xmin,ymin,xmax,ymax found in the geometry.
> Assuming every pixel can be represented as a geometry, that's your bbox.
>
> On 5/3/24 13:18, Simon Eves via gdal-dev wrote:
> > Yes, but that's just the corners.
> >
> > Consider, say, a raster that contains a satellite sweep which is not
> > axis-aligned but forms a "windshield wiper" shape in lon/lat space. The
> > bounding box of ALL the pixels is not just the bounding box of the
> corners.
> >
> > On Fri, May 3, 2024 at 1:09?PM Javier Jimenez Shaw <j1 at jimenezshaw.com
> > <mailto:j1 at jimenezshaw.com>> wrote:
> >
> >     Maybe I don't understand your question, but in gdalinfo you have the
> >     four corners as lat-lon
> >
> >     On Fri, 3 May 2024, 21:46 Simon Eves via gdal-dev,
> >     <gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>> wrote:
> >
> >         So we are trying to optimize our raster import process, and
> >         particularly the steps to derive the final WGS84/4326 bounding
> >         box for a raster file or tile thereof.
> >
> >         Obviously in the general case, the transform is from integer
> >         pixel coordinate through the Affine Transformation matrix and
> >         then whatever OGRCoordinateTransformation is required to get to
> >         WGS84/4326, and perhaps a GCP-based mesh transformation too.
> >
> >         Currently we are deriving the bounding box by passing all pixels
> >         of the four edges of the file/tile through the full transform,
> >         except in the simple Affine-only case where we just transform
> >         the four corners.
> >
> >         Is there any shortcut API provided by GDAL or PROJ to allow the
> >         bounding box to be computed (or at least safely over-estimated)
> >         in the general case? I'm assuming that even a non-GCP
> >         OGRCT could still be non-linear such that just transforming the
> >         corners is insufficient.
> >
> >         Thanks in advance,
> >
> >         Simon
> >
> >         --
> >         Simon Eves
> >         Senior Rendering Engineer
> >         +1 (415) 902-1996
> >         simon.eves at heavy.ai <mailto:simon.eves at heavy.ai>
> >
> >         <http://www.heavy.ai>
> >
> >         _______________________________________________
> >         gdal-dev mailing list
> >         gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
> >         https://lists.osgeo.org/mailman/listinfo/gdal-dev
> >         <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
> >
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240503/585a14af/attachment-0001.htm>

From j1 at jimenezshaw.com  Fri May  3 14:24:37 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Fri, 3 May 2024 23:24:37 +0200
Subject: [gdal-dev] Efficient raster bounding box transformation?
In-Reply-To: <CAJf0KTRWwWK=1ig8e1=H_tDLrW2egc2igSbuTNttqQeD598kZQ@mail.gmail.com>
References: <CAJf0KTR95uz3ak6icN+pnDmDzzVRO8Y7gek6FVsDtBJnf=VOhA@mail.gmail.com>
 <CADRrdKsy1DcHYi_OsaaJCX78RkyeppBGjSTLXvKAxekCVAUoNA@mail.gmail.com>
 <CAJf0KTRWwWK=1ig8e1=H_tDLrW2egc2igSbuTNttqQeD598kZQ@mail.gmail.com>
Message-ID: <CADRrdKuetdyF-wAfW2VuJeuUQXtJiy4z4ztP=6b71NP7H1Aeow@mail.gmail.com>

Now I think I understand what you mean.
One effective way is to convert the four sides of the image. To avoid the
conversion of every pixel, you can start a partition process. Then compare
the difference between the transformed central point and just the mid point
between the extremes. If that different is bigger than an certain
threshold, keep subdividing each side. With that you have a good
approximation of the borders of the image transformed, and then you can
compute your bounding box.
The idea is not mine. Even Rouault mentioned it last year in FOSS4G. IIRC,
it is used by gdalwarp to not reproject every single point; once the
subdivision is enough, then it does linear interpolation.

On Fri, 3 May 2024 at 22:18, Simon Eves <simon.eves at heavy.ai> wrote:

> Yes, but that's just the corners.
>
> Consider, say, a raster that contains a satellite sweep which is not
> axis-aligned but forms a "windshield wiper" shape in lon/lat space. The
> bounding box of ALL the pixels is not just the bounding box of the corners.
>
> On Fri, May 3, 2024 at 1:09?PM Javier Jimenez Shaw <j1 at jimenezshaw.com>
> wrote:
>
>> Maybe I don't understand your question, but in gdalinfo you have the four
>> corners as lat-lon
>>
>> On Fri, 3 May 2024, 21:46 Simon Eves via gdal-dev, <
>> gdal-dev at lists.osgeo.org> wrote:
>>
>>> So we are trying to optimize our raster import process, and particularly
>>> the steps to derive the final WGS84/4326 bounding box for a raster file or
>>> tile thereof.
>>>
>>> Obviously in the general case, the transform is from integer pixel
>>> coordinate through the Affine Transformation matrix and then whatever
>>> OGRCoordinateTransformation is required to get to WGS84/4326, and perhaps a
>>> GCP-based mesh transformation too.
>>>
>>> Currently we are deriving the bounding box by passing all pixels of the
>>> four edges of the file/tile through the full transform, except in the
>>> simple Affine-only case where we just transform the four corners.
>>>
>>> Is there any shortcut API provided by GDAL or PROJ to allow the bounding
>>> box to be computed (or at least safely over-estimated) in the general case?
>>> I'm assuming that even a non-GCP  OGRCT could still be non-linear such that
>>> just transforming the corners is insufficient.
>>>
>>> Thanks in advance,
>>>
>>> Simon
>>>
>>> --
>>> Simon Eves
>>> Senior Rendering Engineer
>>> +1 (415) 902-1996
>>> simon.eves at heavy.ai
>>>
>>> <http://www.heavy.ai>
>>> _______________________________________________
>>> gdal-dev mailing list
>>> gdal-dev at lists.osgeo.org
>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240503/5904de6d/attachment.htm>

From simon.eves at heavy.ai  Fri May  3 14:25:24 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Fri, 3 May 2024 14:25:24 -0700
Subject: [gdal-dev] Efficient raster bounding box transformation?
In-Reply-To: <CADRrdKuetdyF-wAfW2VuJeuUQXtJiy4z4ztP=6b71NP7H1Aeow@mail.gmail.com>
References: <CAJf0KTR95uz3ak6icN+pnDmDzzVRO8Y7gek6FVsDtBJnf=VOhA@mail.gmail.com>
 <CADRrdKsy1DcHYi_OsaaJCX78RkyeppBGjSTLXvKAxekCVAUoNA@mail.gmail.com>
 <CAJf0KTRWwWK=1ig8e1=H_tDLrW2egc2igSbuTNttqQeD598kZQ@mail.gmail.com>
 <CADRrdKuetdyF-wAfW2VuJeuUQXtJiy4z4ztP=6b71NP7H1Aeow@mail.gmail.com>
Message-ID: <CAJf0KTSMXqM7M56qAtxB779Q9qCTiY6x+O0QP3y-t1frnBg8jg@mail.gmail.com>

I like it.

On Fri, May 3, 2024 at 2:24?PM Javier Jimenez Shaw <j1 at jimenezshaw.com>
wrote:

> Now I think I understand what you mean.
> One effective way is to convert the four sides of the image. To avoid the
> conversion of every pixel, you can start a partition process. Then compare
> the difference between the transformed central point and just the mid point
> between the extremes. If that different is bigger than an certain
> threshold, keep subdividing each side. With that you have a good
> approximation of the borders of the image transformed, and then you can
> compute your bounding box.
> The idea is not mine. Even Rouault mentioned it last year in FOSS4G. IIRC,
> it is used by gdalwarp to not reproject every single point; once the
> subdivision is enough, then it does linear interpolation.
>
> On Fri, 3 May 2024 at 22:18, Simon Eves <simon.eves at heavy.ai> wrote:
>
>> Yes, but that's just the corners.
>>
>> Consider, say, a raster that contains a satellite sweep which is not
>> axis-aligned but forms a "windshield wiper" shape in lon/lat space. The
>> bounding box of ALL the pixels is not just the bounding box of the corners.
>>
>> On Fri, May 3, 2024 at 1:09?PM Javier Jimenez Shaw <j1 at jimenezshaw.com>
>> wrote:
>>
>>> Maybe I don't understand your question, but in gdalinfo you have the
>>> four corners as lat-lon
>>>
>>> On Fri, 3 May 2024, 21:46 Simon Eves via gdal-dev, <
>>> gdal-dev at lists.osgeo.org> wrote:
>>>
>>>> So we are trying to optimize our raster import process, and
>>>> particularly the steps to derive the final WGS84/4326 bounding box for a
>>>> raster file or tile thereof.
>>>>
>>>> Obviously in the general case, the transform is from integer pixel
>>>> coordinate through the Affine Transformation matrix and then whatever
>>>> OGRCoordinateTransformation is required to get to WGS84/4326, and perhaps a
>>>> GCP-based mesh transformation too.
>>>>
>>>> Currently we are deriving the bounding box by passing all pixels of the
>>>> four edges of the file/tile through the full transform, except in the
>>>> simple Affine-only case where we just transform the four corners.
>>>>
>>>> Is there any shortcut API provided by GDAL or PROJ to allow the
>>>> bounding box to be computed (or at least safely over-estimated) in
>>>> the general case? I'm assuming that even a non-GCP  OGRCT could still be
>>>> non-linear such that just transforming the corners is insufficient.
>>>>
>>>> Thanks in advance,
>>>>
>>>> Simon
>>>>
>>>> --
>>>> Simon Eves
>>>> Senior Rendering Engineer
>>>> +1 (415) 902-1996
>>>> simon.eves at heavy.ai
>>>>
>>>> <http://www.heavy.ai>
>>>> _______________________________________________
>>>> gdal-dev mailing list
>>>> gdal-dev at lists.osgeo.org
>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240503/3a79e424/attachment.htm>

From even.rouault at spatialys.com  Fri May  3 15:03:39 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 4 May 2024 00:03:39 +0200
Subject: [gdal-dev] Efficient raster bounding box transformation?
In-Reply-To: <CAJf0KTSMXqM7M56qAtxB779Q9qCTiY6x+O0QP3y-t1frnBg8jg@mail.gmail.com>
References: <CAJf0KTR95uz3ak6icN+pnDmDzzVRO8Y7gek6FVsDtBJnf=VOhA@mail.gmail.com>
 <CADRrdKsy1DcHYi_OsaaJCX78RkyeppBGjSTLXvKAxekCVAUoNA@mail.gmail.com>
 <CAJf0KTRWwWK=1ig8e1=H_tDLrW2egc2igSbuTNttqQeD598kZQ@mail.gmail.com>
 <CADRrdKuetdyF-wAfW2VuJeuUQXtJiy4z4ztP=6b71NP7H1Aeow@mail.gmail.com>
 <CAJf0KTSMXqM7M56qAtxB779Q9qCTiY6x+O0QP3y-t1frnBg8jg@mail.gmail.com>
Message-ID: <708b5284-6ecc-45a6-acd1-0ea1b2130be6@spatialys.com>

==> GDALCreateApproxTransformer(): 
https://gdal.org/api/gdal_alg.html#_CPPv427GDALCreateApproxTransformer19GDALTransformerFuncPvd

Otherwise there's OGRCoordinateTransformation::TransformBounds(), but 
this works from a rectangle in the source CRS

Most simple would be to use GDALAutoCreateWarpedVRT() 
(https://gdal.org/api/gdalwarp_cpp.html#_CPPv423GDALAutoCreateWarpedVRT12GDALDatasetHPKcPKc15GDALResampleAlgdPK15GDALWarpOptions) 
to EPSG:4326 and just take the extent of the warped VRT.

Le 03/05/2024 ? 23:25, Simon Eves via gdal-dev a ?crit?:
> I like it.
>
> On Fri, May 3, 2024 at 2:24?PM Javier Jimenez Shaw 
> <j1 at jimenezshaw.com> wrote:
>
>     Now I think I understand what you mean.
>     One effective way is to convert the four sides of the image. To
>     avoid the conversion of every pixel, you can start a partition
>     process. Then compare the difference between the transformed
>     central point and just the mid point between the extremes. If that
>     different is bigger than an certain threshold, keep subdividing
>     each side. With that you have a good approximation of the borders
>     of the image transformed, and then you can compute your bounding box.
>     The idea is not mine. Even Rouault mentioned it last year in
>     FOSS4G. IIRC, it is used by gdalwarp to not reproject every single
>     point; once the subdivision is enough, then it does linear
>     interpolation.
>
>     On Fri, 3 May 2024 at 22:18, Simon Eves <simon.eves at heavy.ai> wrote:
>
>         Yes, but that's just the corners.
>
>         Consider, say, a raster that contains a satellite sweep which
>         is not axis-aligned but forms a "windshield wiper" shape in
>         lon/lat space. The bounding box of ALL the pixels is not just
>         the bounding box of the corners.
>
>         On Fri, May 3, 2024 at 1:09?PM Javier Jimenez Shaw
>         <j1 at jimenezshaw.com> wrote:
>
>             Maybe I don't understand your question, but in gdalinfo
>             you have the four corners as lat-lon
>
>             On Fri, 3 May 2024, 21:46 Simon Eves via gdal-dev,
>             <gdal-dev at lists.osgeo.org> wrote:
>
>                 So we are trying to optimize our raster import
>                 process, and particularly the steps to derive the
>                 final WGS84/4326 bounding box for a raster file or
>                 tile thereof.
>
>                 Obviously in the general case, the transform is from
>                 integer pixel coordinate through the Affine
>                 Transformation matrix and then whatever
>                 OGRCoordinateTransformation is required to get to
>                 WGS84/4326, and perhaps a GCP-based mesh
>                 transformation too.
>
>                 Currently we are deriving the bounding box by passing
>                 all pixels of the four edges of the file/tile through
>                 the full transform, except in the simple Affine-only
>                 case where we just transform the four corners.
>
>                 Is there any shortcut API provided by GDAL or PROJ to
>                 allow the bounding box to be computed (or at least
>                 safely over-estimated) in the?general case? I'm
>                 assuming that even a non-GCP? OGRCT?could still be
>                 non-linear such that just transforming the corners is
>                 insufficient.
>
>                 Thanks in advance,
>
>                 Simon
>
>                 -- 
>                 Simon Eves
>                 Senior Rendering Engineer
>                 +1 (415) 902-1996
>                 simon.eves at heavy.ai
>
>                 <http://www.heavy.ai>
>
>                 _______________________________________________
>                 gdal-dev mailing list
>                 gdal-dev at lists.osgeo.org
>                 https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240504/58efeffe/attachment-0001.htm>

From simon.eves at heavy.ai  Fri May  3 16:16:28 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Fri, 3 May 2024 16:16:28 -0700
Subject: [gdal-dev] Efficient raster bounding box transformation?
In-Reply-To: <708b5284-6ecc-45a6-acd1-0ea1b2130be6@spatialys.com>
References: <CAJf0KTR95uz3ak6icN+pnDmDzzVRO8Y7gek6FVsDtBJnf=VOhA@mail.gmail.com>
 <CADRrdKsy1DcHYi_OsaaJCX78RkyeppBGjSTLXvKAxekCVAUoNA@mail.gmail.com>
 <CAJf0KTRWwWK=1ig8e1=H_tDLrW2egc2igSbuTNttqQeD598kZQ@mail.gmail.com>
 <CADRrdKuetdyF-wAfW2VuJeuUQXtJiy4z4ztP=6b71NP7H1Aeow@mail.gmail.com>
 <CAJf0KTSMXqM7M56qAtxB779Q9qCTiY6x+O0QP3y-t1frnBg8jg@mail.gmail.com>
 <708b5284-6ecc-45a6-acd1-0ea1b2130be6@spatialys.com>
Message-ID: <CAJf0KTS5-z7rBD++WJWCExCjSAceKA_UJrk8R+79GBbvvdPg-Q@mail.gmail.com>

Wow. Can't believe I missed the middle one, at least. Thank you, Even, as
always!

Simon

On Fri, May 3, 2024 at 3:03?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> ==> GDALCreateApproxTransformer():
> https://gdal.org/api/gdal_alg.html#_CPPv427GDALCreateApproxTransformer19GDALTransformerFuncPvd
>
> Otherwise there's OGRCoordinateTransformation::TransformBounds(), but
> this works from a rectangle in the source CRS
>
> Most simple would be to use GDALAutoCreateWarpedVRT() (
> https://gdal.org/api/gdalwarp_cpp.html#_CPPv423GDALAutoCreateWarpedVRT12GDALDatasetHPKcPKc15GDALResampleAlgdPK15GDALWarpOptions)
> to EPSG:4326 and just take the extent of the warped VRT.
> Le 03/05/2024 ? 23:25, Simon Eves via gdal-dev a ?crit :
>
> I like it.
>
> On Fri, May 3, 2024 at 2:24?PM Javier Jimenez Shaw <j1 at jimenezshaw.com>
> wrote:
>
>> Now I think I understand what you mean.
>> One effective way is to convert the four sides of the image. To avoid the
>> conversion of every pixel, you can start a partition process. Then compare
>> the difference between the transformed central point and just the mid point
>> between the extremes. If that different is bigger than an certain
>> threshold, keep subdividing each side. With that you have a good
>> approximation of the borders of the image transformed, and then you can
>> compute your bounding box.
>> The idea is not mine. Even Rouault mentioned it last year in FOSS4G.
>> IIRC, it is used by gdalwarp to not reproject every single point; once the
>> subdivision is enough, then it does linear interpolation.
>>
>> On Fri, 3 May 2024 at 22:18, Simon Eves <simon.eves at heavy.ai> wrote:
>>
>>> Yes, but that's just the corners.
>>>
>>> Consider, say, a raster that contains a satellite sweep which is not
>>> axis-aligned but forms a "windshield wiper" shape in lon/lat space. The
>>> bounding box of ALL the pixels is not just the bounding box of the corners.
>>>
>>> On Fri, May 3, 2024 at 1:09?PM Javier Jimenez Shaw <j1 at jimenezshaw.com>
>>> wrote:
>>>
>>>> Maybe I don't understand your question, but in gdalinfo you have the
>>>> four corners as lat-lon
>>>>
>>>> On Fri, 3 May 2024, 21:46 Simon Eves via gdal-dev, <
>>>> gdal-dev at lists.osgeo.org> wrote:
>>>>
>>>>> So we are trying to optimize our raster import process, and
>>>>> particularly the steps to derive the final WGS84/4326 bounding box for a
>>>>> raster file or tile thereof.
>>>>>
>>>>> Obviously in the general case, the transform is from integer pixel
>>>>> coordinate through the Affine Transformation matrix and then whatever
>>>>> OGRCoordinateTransformation is required to get to WGS84/4326, and perhaps a
>>>>> GCP-based mesh transformation too.
>>>>>
>>>>> Currently we are deriving the bounding box by passing all pixels of
>>>>> the four edges of the file/tile through the full transform, except in the
>>>>> simple Affine-only case where we just transform the four corners.
>>>>>
>>>>> Is there any shortcut API provided by GDAL or PROJ to allow the
>>>>> bounding box to be computed (or at least safely over-estimated) in
>>>>> the general case? I'm assuming that even a non-GCP  OGRCT could still be
>>>>> non-linear such that just transforming the corners is insufficient.
>>>>>
>>>>> Thanks in advance,
>>>>>
>>>>> Simon
>>>>>
>>>>> --
>>>>> Simon Eves
>>>>> Senior Rendering Engineer
>>>>> +1 (415) 902-1996
>>>>> simon.eves at heavy.ai
>>>>>
>>>>> <http://www.heavy.ai>
>>>>> _______________________________________________
>>>>> gdal-dev mailing list
>>>>> gdal-dev at lists.osgeo.org
>>>>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>
>>>>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240503/a19f21b5/attachment.htm>

From even.rouault at spatialys.com  Mon May  6 06:43:36 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 6 May 2024 15:43:36 +0200
Subject: [gdal-dev] GDAL 3.9.0 rc1 is available
Message-ID: <d0f91535-3bcf-472d-9dc6-d5954ec34b55@spatialys.com>

Hi,

I have prepared a GDAL/OGR 3.9.0 release candidate.

NEWS at:

 ? https://github.com/OSGeo/gdal/blob/v3.9.0RC1/NEWS.md

Pick up an archive among the following ones (by ascending size):

 ? https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0rc1.tar.xz
 ? https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.9.0/gdal390rc1.zip

A snapshot of the gdalautotest suite is also available :

https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0rc1.zip

A snapshot of the documentation is at:

 ? https://download.osgeo.org/gdal/3.9.0/gdal390doc.zip

I'll call for a vote promoting it later this week if no serious problems are
reported before.

There are no major changes, impacting packaging or integration, since 
beta2, but
functional bugfixes and enhancements:
* /vsigs/: fix RmdirRecursive() on an empty directory
* /vsigs/ UnlinkBatch(): make sure that path config options are checked 
for the
 ? deleted files and not '/vsigs/batch/
* /vsiaz/ UnlinkBatch(): make sure that path config options are checked 
for the
 ? deleted files
* Various fixes in MiramonVector driver
* Warper: add a NODATA_VALUES_PCT_THRESHOLD option
* gdal2tiles: add --nodata-values-pct-threshold option
* support HDF5EOS metadata where the GROUP=GridStructure has an empty sub
 ? GROUP=Dimension
* HDF5: implement GetOffset() and GetScale() for netCDF metadata items 
add_offset
 ? and scale_factor
* TileDB: multidim: prevent infinite recursion when opening an array in 
a group
 ? where there are 2 or more 2D+ arrays
* TileDB: multidim: OpenMDArray(): fix opening an array, member of a group,
 ? which has no explicit name
* Fix scripts/gdal-bash-completion.sh

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From public at postholer.com  Mon May  6 08:16:13 2024
From: public at postholer.com (Scott)
Date: Mon, 6 May 2024 08:16:13 -0700
Subject: [gdal-dev] GDAL 3.9.0 rc1 is available
In-Reply-To: <d0f91535-3bcf-472d-9dc6-d5954ec34b55@spatialys.com>
References: <d0f91535-3bcf-472d-9dc6-d5954ec34b55@spatialys.com>
Message-ID: <dca931e1-3dca-4b25-9df3-fd11e691313c@postholer.com>

Thanks for the -E, -field_sep and -ignore_extra_input in gdallocationinfo!

It means we no longer have to pipe the input/output through paste -d or sed

On 5/6/24 06:43, Even Rouault via gdal-dev wrote:
> Hi,
> 
> I have prepared a GDAL/OGR 3.9.0 release candidate.
> 
> NEWS at:
> 
>  ? https://github.com/OSGeo/gdal/blob/v3.9.0RC1/NEWS.md
> 
> Pick up an archive among the following ones (by ascending size):
> 
>  ? https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0rc1.tar.xz
>  ? https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0rc1.tar.gz
>  ? https://download.osgeo.org/gdal/3.9.0/gdal390rc1.zip
> 
> A snapshot of the gdalautotest suite is also available :
> 
> https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0rc1.tar.gz
>  ? https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0rc1.zip
> 
> A snapshot of the documentation is at:
> 
>  ? https://download.osgeo.org/gdal/3.9.0/gdal390doc.zip
> 
> I'll call for a vote promoting it later this week if no serious problems 
> are
> reported before.
> 
> There are no major changes, impacting packaging or integration, since 
> beta2, but
> functional bugfixes and enhancements:
> * /vsigs/: fix RmdirRecursive() on an empty directory
> * /vsigs/ UnlinkBatch(): make sure that path config options are checked 
> for the
>  ? deleted files and not '/vsigs/batch/
> * /vsiaz/ UnlinkBatch(): make sure that path config options are checked 
> for the
>  ? deleted files
> * Various fixes in MiramonVector driver
> * Warper: add a NODATA_VALUES_PCT_THRESHOLD option
> * gdal2tiles: add --nodata-values-pct-threshold option
> * support HDF5EOS metadata where the GROUP=GridStructure has an empty sub
>  ? GROUP=Dimension
> * HDF5: implement GetOffset() and GetScale() for netCDF metadata items 
> add_offset
>  ? and scale_factor
> * TileDB: multidim: prevent infinite recursion when opening an array in 
> a group
>  ? where there are 2 or more 2D+ arrays
> * TileDB: multidim: OpenMDArray(): fix opening an array, member of a group,
>  ? which has no explicit name
> * Fix scripts/gdal-bash-completion.sh
> 
> Best regards,
> 
> Even
> 

From andrew.bell.ia at gmail.com  Mon May  6 11:43:25 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Mon, 6 May 2024 14:43:25 -0400
Subject: [gdal-dev] Mass operations to raster block?
Message-ID: <CACJ51z3dagQ=cPQ2OyFoJjRSUO95DmXjQBq_qFkpGKt2PhQ0Xw@mail.gmail.com>

Hi,

Is there any support in the library for applying some arithmetic operations
to all entries in a block? For example, can I optimally subtract or add
some scalar to every entry?

Thanks,

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240506/59f4c8ab/attachment.htm>

From even.rouault at spatialys.com  Mon May  6 12:18:37 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 6 May 2024 21:18:37 +0200
Subject: [gdal-dev] Mass operations to raster block?
In-Reply-To: <CACJ51z3dagQ=cPQ2OyFoJjRSUO95DmXjQBq_qFkpGKt2PhQ0Xw@mail.gmail.com>
References: <CACJ51z3dagQ=cPQ2OyFoJjRSUO95DmXjQBq_qFkpGKt2PhQ0Xw@mail.gmail.com>
Message-ID: <6cbf5bb4-3212-45e8-864f-fe7ce3445fc6@spatialys.com>

Hi Andrew,

no, there's no such support in GDAL itself. That could potentially be 
done using VRT and pixel functions, but I'm not sure that would qualify 
as "optimal", and that would require a bit of setup. You're probably 
better instantiating your for(y: ...) for (x: ...) loop manually with 
the operation you want to apply

xtensor (https://xtensor.readthedocs.io/en/latest/operator.html) (in a 
nutshell, this is similar to numpy but in C++) could potentially be used 
in combination of GDAL, but I don't think we want to drag this 
dependency in GDAL itself

Even

Le 06/05/2024 ? 20:43, Andrew Bell via gdal-dev a ?crit?:
> Hi,
>
> Is there any support in the library for applying some arithmetic 
> operations to all entries in a block? For example, can I optimally 
> subtract or add some scalar to every entry?
>
> Thanks,
>
> -- 
> Andrew Bell
> andrew.bell.ia at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240506/1d7e5890/attachment.htm>

From even.rouault at spatialys.com  Tue May  7 06:02:41 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 7 May 2024 15:02:41 +0200
Subject: [gdal-dev] GDAL 3.9.0 rc2 is available (Re: GDAL 3.9.0 rc1 is
 available)
In-Reply-To: <d0f91535-3bcf-472d-9dc6-d5954ec34b55@spatialys.com>
References: <d0f91535-3bcf-472d-9dc6-d5954ec34b55@spatialys.com>
Message-ID: <2da8bb64-2b30-4b68-aba5-c74b07f0ada8@spatialys.com>

Hi,

I've prepared a RC2 to fix a regression in ogr2ogr workflows from 
Shapefile (or other datasources with layer metadata items) to PostGIS.

 ? https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0rc2.tar.xz
 ? https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0rc2.tar.gz
 ? https://download.osgeo.org/gdal/3.9.0/gdal390rc2.zip


https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0rc2.tar.gz
 ? https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0rc2.zip

Even

Le 06/05/2024 ? 15:43, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> I have prepared a GDAL/OGR 3.9.0 release candidate.
>
> NEWS at:
>
> ? https://github.com/OSGeo/gdal/blob/v3.9.0RC1/NEWS.md
>
> Pick up an archive among the following ones (by ascending size):
>
> ? https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0rc1.tar.xz
> ? https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0rc1.tar.gz
> ? https://download.osgeo.org/gdal/3.9.0/gdal390rc1.zip
>
> A snapshot of the gdalautotest suite is also available :
>
> https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0rc1.tar.gz
> ? https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0rc1.zip
>
> A snapshot of the documentation is at:
>
> ? https://download.osgeo.org/gdal/3.9.0/gdal390doc.zip
>
> I'll call for a vote promoting it later this week if no serious 
> problems are
> reported before.
>
> There are no major changes, impacting packaging or integration, since 
> beta2, but
> functional bugfixes and enhancements:
> * /vsigs/: fix RmdirRecursive() on an empty directory
> * /vsigs/ UnlinkBatch(): make sure that path config options are 
> checked for the
> ? deleted files and not '/vsigs/batch/
> * /vsiaz/ UnlinkBatch(): make sure that path config options are 
> checked for the
> ? deleted files
> * Various fixes in MiramonVector driver
> * Warper: add a NODATA_VALUES_PCT_THRESHOLD option
> * gdal2tiles: add --nodata-values-pct-threshold option
> * support HDF5EOS metadata where the GROUP=GridStructure has an empty sub
> ? GROUP=Dimension
> * HDF5: implement GetOffset() and GetScale() for netCDF metadata items 
> add_offset
> ? and scale_factor
> * TileDB: multidim: prevent infinite recursion when opening an array 
> in a group
> ? where there are 2 or more 2D+ arrays
> * TileDB: multidim: OpenMDArray(): fix opening an array, member of a 
> group,
> ? which has no explicit name
> * Fix scripts/gdal-bash-completion.sh
>
> Best regards,
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From laasunde at hotmail.com  Tue May  7 13:10:01 2024
From: laasunde at hotmail.com (Lars Sunde)
Date: Tue, 7 May 2024 20:10:01 +0000
Subject: [gdal-dev] gdal 3.0.4 license
Message-ID: <PR3PR03MB66040F86F1EFAF3937841099CAE42@PR3PR03MB6604.eurprd03.prod.outlook.com>

Hello,



The GDAL 3.0.4 LICENSE.TXT file (attached) include references to the following sub-components with their own license.



gdal/frmts/gtiff/tif_float.c

gdal/frmts/hdf4/hdf-eos/*

gdal/frmts/pcraster/libcsf

gdal/frmts/grib/degrib/*

port/cpl_minizip*

gdal/ogr/ogrsf_frmts/dxf/intronurbs.cpp

gdal/alg/thinplatespline.cpp

gdal/alg/libqhull

gdal/frmts/pdf/pdfdataset.cpp

gdal/frmts/mrf/*



Does any of these licenses depend on which parameters used when building GDAL from source? We are only building GDAL library from source on Windows and Linux (no executables).



Kind regards, Lars


[https://res.cdn.office.net/assets/mail/file-icon/png/txt_16x16.png]LICENSE.TXT<https://1drv.ms/t/s!AhsmxXeVX4cEkSPbk2Rh6DlY1e3O>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240507/ba60fd27/attachment.htm>

From even.rouault at spatialys.com  Wed May  8 04:13:13 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 8 May 2024 13:13:13 +0200
Subject: [gdal-dev] Motion: approve GDAL 3.9.02RC2 as final release
Message-ID: <e487d0d1-fac0-4e5c-ab70-71645f8b3ff1@spatialys.com>

Hi,

Motion:

Adopt GDAL 3.9.0RC2 as final 3.9.0 release

Starting with my +1

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jukka.rahkonen at maanmittauslaitos.fi  Wed May  8 04:15:53 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 8 May 2024 11:15:53 +0000
Subject: [gdal-dev] Motion: approve GDAL 3.9.02RC2 as final release
In-Reply-To: <e487d0d1-fac0-4e5c-ab70-71645f8b3ff1@spatialys.com>
References: <e487d0d1-fac0-4e5c-ab70-71645f8b3ff1@spatialys.com>
Message-ID: <DB9PR09MB68878D14C0DFE497E8A3196DFDE52@DB9PR09MB6887.eurprd09.prod.outlook.com>

+1

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault via gdal-dev
L?hetetty: keskiviikko 8. toukokuuta 2024 14.13
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Motion: approve GDAL 3.9.02RC2 as final release

Hi,

Motion:

Adopt GDAL 3.9.0RC2 as final 3.9.0 release

Starting with my +1

Even

-- 

From j1 at jimenezshaw.com  Wed May  8 04:40:46 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Wed, 8 May 2024 13:40:46 +0200
Subject: [gdal-dev] Motion: approve GDAL 3.9.02RC2 as final release
In-Reply-To: <DB9PR09MB68878D14C0DFE497E8A3196DFDE52@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <e487d0d1-fac0-4e5c-ab70-71645f8b3ff1@spatialys.com>
 <DB9PR09MB68878D14C0DFE497E8A3196DFDE52@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <CADRrdKvLB1H78jaMNV5MFmPqcouTaV6yB1jxNyhfSK6p1hqjuw@mail.gmail.com>

+1 Javier

On Wed, 8 May 2024 at 13:15, Rahkonen Jukka via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> +1
>
> -Jukka Rahkonen-
>
> -----Alkuper?inen viesti-----
> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even
> Rouault via gdal-dev
> L?hetetty: keskiviikko 8. toukokuuta 2024 14.13
> Vastaanottaja: gdal-dev at lists.osgeo.org
> Aihe: [gdal-dev] Motion: approve GDAL 3.9.02RC2 as final release
>
> Hi,
>
> Motion:
>
> Adopt GDAL 3.9.0RC2 as final 3.9.0 release
>
> Starting with my +1
>
> Even
>
> --
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240508/ed7b5783/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Wed May  8 07:49:42 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 8 May 2024 14:49:42 +0000
Subject: [gdal-dev] FileGDB that does not open
Message-ID: <DB9PR09MB68879301394E9C52B06A9401FDE52@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

FileGDB data from https://vgin.maps.arcgis.com/home/item.html?id=29627d7c051a47dc8ce71b4484531ab3 "Virginia_Parcel_Dataset_2024Q1.gdb" does not open with GDAL 3.9.0dev.  The error is:

Warning 1: VA_Parcels layer has a Virginia_Parcel_Dataset_2024Q1.gdb\a00000009.gdbtable.cdf file whose format is unhandled

I do not need the data. I am only testing, but maybe someone wants to study what is special in the a00000009.gdbtable.cdf file.

-Jukka Rahkonen-
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240508/29ba00f7/attachment-0001.htm>

From raghav.singh at eagleview.com  Wed May  8 07:53:44 2024
From: raghav.singh at eagleview.com (Raghav Singh)
Date: Wed, 8 May 2024 14:53:44 +0000
Subject: [gdal-dev] Max Zoom level restriction
Message-ID: <SA1PR20MB6121D1181B8D0BE761D290558CE52@SA1PR20MB6121.namprd20.prod.outlook.com>

Hi,


In my application I am making request to mapserver and sending this file gdal driver file -

 <GDAL_WMS>

    <Service name="TMS">

        <ServerUrl>http://gserve-connect/v1/map/urn:v4:spatial-data:raster:visual:gWILJv1HzBdKA:0/tile?tileRow=${y}&amp;tileColumn=${x}&amp;zoomLevel=${z}&amp;minZoom=6&amp;maxZoom=20</ServerUrl>

    </Service>

    <DataWindow>

        <UpperLeftX>-20037508.34</UpperLeftX>

        <UpperLeftY>20037508.34</UpperLeftY>

        <LowerRightX>20037508.34</LowerRightX>

        <LowerRightY>-20037508.34</LowerRightY>

        <TileLevel>21</TileLevel>

        <TileCountX>1</TileCountX>

        <TileCountY>1</TileCountY>

        <YOrigin>bottom</YOrigin>

    </DataWindow>

    <Projection>EPSG:3857</Projection>

    <BlockSizeX>256</BlockSizeX>

    <BlockSizeY>256</BlockSizeY>

    <BandsCount>3</BandsCount>

    <Timeout>60</Timeout>

    <MaxConnections>4</MaxConnections>

    <ZeroBlockHttpCodes>204,404,500</ZeroBlockHttpCodes>

    <ZeroBlockOnServerException>true</ZeroBlockOnServerException>

</GDAL_WMS>


so for some request zoom Level is going beyond max Zoom this is the request - https://svc.pict.com/Image/2FD6BE87-8168-73F9-63DD-0BFD5FE63EDD/wms?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&BBOX=44.73635069554558896,-63.61617776442430028,44.73674930445441333,-63.61582223557569904&CRS=EPSG:4326&WIDTH=751&HEIGHT=843&LAYERS=PICT-NSPVSC22-OUKuEawvk2&STYLES=&FORMAT=image/png&DPI=96&MAP_RESOLUTION=96&FORMAT_OPTIONS=dpi:96&TRANSPARENT=TRUE so how could I know from this request what is the zoom level requested because when I run mapserver then only i see what zoom level request are going or do i have put a restriction in mapserver only or i have to set the tileLevel here to 20 so that it takes to that zoom level only.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240508/7f94ec2a/attachment.htm>

From jesse.r.meyer at nasa.gov  Wed May  8 10:09:17 2024
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Wed, 8 May 2024 17:09:17 +0000
Subject: [gdal-dev] SQL / gdal_get_pixel_value tips requested
Message-ID: <MN2PR09MB5932D13DD1CCACA8AD804745C9E52@MN2PR09MB5932.namprd09.prod.outlook.com>

Hi,

I?m wanting to execute a SQL query on a vector database like:
vector_mem_ds.ExecuteSQL(f"select ST_Centroid(GEOMETRY) as cnt, gdal_get_pixel_value('{raster_fp}', {ndvi_band_num}, 'georef', cnt.STX, cnt.STY) from ds", dialect="SQLITE")

In particular, I want to use the geometry?s centroid for gdal_get_pixel_value, but the latter function takes two parameters, and ST_Centroid provides 1 return value (a compound type Point), so I am hoping for some way to unpack this into the form necessary expected from get_pixel_value.  Apparently some GIS query engines do expose a STX and STY field but that?s if you trust random google results.  But as is this fails.

Is this possible largely as-is?

Thanks,
Jesse
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240508/316ef00b/attachment-0001.htm>

From even.rouault at spatialys.com  Wed May  8 10:15:02 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 8 May 2024 19:15:02 +0200
Subject: [gdal-dev] SQL / gdal_get_pixel_value tips requested
In-Reply-To: <MN2PR09MB5932D13DD1CCACA8AD804745C9E52@MN2PR09MB5932.namprd09.prod.outlook.com>
References: <MN2PR09MB5932D13DD1CCACA8AD804745C9E52@MN2PR09MB5932.namprd09.prod.outlook.com>
Message-ID: <3542acc8-c13f-4967-aa91-8111bebc4bfe@spatialys.com>

Jesse,

the answer lies in exploring available Spatialite SQL functions: 
https://www.gaia-gis.it/gaia-sins/spatialite-sql-5.1.0.html

ST_Centroid() returns a Point geometry. You may get its coordinates with 
ST_X() and ST_Y(). I suppose you'd need to use a sub-select construct to 
get things working, like

SELECT gdal_get_pixel_value(path, band_num, 'georef', ST_X(centroid), 
ST_Y(centroid)) FROM (SELECT ST_Centroid(geometry) AS centroid FROM ds) x

untested obviously!

Le 08/05/2024 ? 19:09, Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND 
APPLICATIONS INC] via gdal-dev a ?crit?:
>
> Hi,
>
> I?m wanting to execute a SQL query on a vector database like:
>
> vector_mem_ds.ExecuteSQL(/f/"select ST_Centroid(GEOMETRY) as cnt, 
> gdal_get_pixel_value('{raster_fp}', {ndvi_band_num}, 'georef', 
> cnt.STX, cnt.STY) from ds",/dialect/="SQLITE")
>
> In particular, I want to use the geometry?s centroid for 
> gdal_get_pixel_value, but the latter function takes two parameters, 
> and ST_Centroid provides 1 return value (a compound type Point), so I 
> am hoping for some way to unpack this into the form necessary expected 
> from get_pixel_value. Apparently some GIS query engines do expose a 
> STX and STY field but that?s if you trust random google results.? But 
> as is this fails.
>
> Is this possible largely as-is?
>
> Thanks,
>
> Jesse
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240508/7c91037a/attachment.htm>

From jesse.r.meyer at nasa.gov  Wed May  8 10:22:12 2024
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Wed, 8 May 2024 17:22:12 +0000
Subject: [gdal-dev] [EXTERNAL] Re: SQL / gdal_get_pixel_value tips
 requested
In-Reply-To: <3542acc8-c13f-4967-aa91-8111bebc4bfe@spatialys.com>
References: <MN2PR09MB5932D13DD1CCACA8AD804745C9E52@MN2PR09MB5932.namprd09.prod.outlook.com>
 <3542acc8-c13f-4967-aa91-8111bebc4bfe@spatialys.com>
Message-ID: <MN2PR09MB59321CD085C11867FC216DE2C9E52@MN2PR09MB5932.namprd09.prod.outlook.com>

Even,

That appears to have ?just work?!

<sounds of bowing>

Jesse

From: Even Rouault <even.rouault at spatialys.com>
Date: Wednesday, May 8, 2024 at 1:15?PM
To: Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] <jesse.r.meyer at nasa.gov>, Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev <gdal-dev at lists.osgeo.org>
Subject: [EXTERNAL] Re: [gdal-dev] SQL / gdal_get_pixel_value tips requested
CAUTION: This email originated from outside of NASA.  Please take care when clicking links or opening attachments.  Use the "Report Message" button to report suspicious messages to the NASA SOC.



Jesse,

the answer lies in exploring available Spatialite SQL functions: https://www.gaia-gis.it/gaia-sins/spatialite-sql-5.1.0.html

ST_Centroid() returns a Point geometry. You may get its coordinates with ST_X() and ST_Y(). I suppose you'd need to use a sub-select construct to get things working, like

SELECT gdal_get_pixel_value(path, band_num, 'georef', ST_X(centroid), ST_Y(centroid)) FROM (SELECT ST_Centroid(geometry) AS centroid FROM ds) x

untested obviously!
Le 08/05/2024 ? 19:09, Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev a ?crit :
Hi,

I?m wanting to execute a SQL query on a vector database like:
vector_mem_ds.ExecuteSQL(f"select ST_Centroid(GEOMETRY) as cnt, gdal_get_pixel_value('{raster_fp}', {ndvi_band_num}, 'georef', cnt.STX, cnt.STY) from ds", dialect="SQLITE")

In particular, I want to use the geometry?s centroid for gdal_get_pixel_value, but the latter function takes two parameters, and ST_Centroid provides 1 return value (a compound type Point), so I am hoping for some way to unpack this into the form necessary expected from get_pixel_value.  Apparently some GIS query engines do expose a STX and STY field but that?s if you trust random google results.  But as is this fails.

Is this possible largely as-is?

Thanks,
Jesse



_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com<http://www.spatialys.com/>

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240508/20857360/attachment-0001.htm>

From andrew.bell.ia at gmail.com  Wed May  8 12:47:46 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Wed, 8 May 2024 15:47:46 -0400
Subject: [gdal-dev] Warning/Error Update?
Message-ID: <CACJ51z1OS_=7P+_PE=xtoDsVERuzyxJh43x89+frD8Q9ttHMig@mail.gmail.com>

Hi,

I don't know the history but I'm getting failures from warnings like this:

[ 75%] Building CXX object
frmts/raw/CMakeFiles/gdal_raw.dir/dipxdataset.cpp.obj
1169In file included from ../../alg/viewshed.cpp:36:
1170../../alg/viewshed.h: In constructor 'gdal::Viewshed::Viewshed(const
Options&)':
1171../../alg/viewshed.h:106:22: error: 'gdal::Viewshed::vFirstLineVal'
should be initialized in the member initialization list [-Werror=effc++]
1172 106 | CPL_DLL explicit Viewshed(const Options &opts)
1173 | ^~~~~~~~

This complaint is about a std::vector, whose initialization is
automatically addressed by its default constructor. The same kind of thing
happens with std::string. It's tedious (and IMO error-prone) to have to
initialize things that are already initialized.  This was recognized long
ago but perhaps never addressed:

https://gcc.gnu.org/bugzilla/show_bug.cgi?id=55837

Thoughts on turning off such checks as they're not sufficiently specific?

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240508/a9cb29cc/attachment.htm>

From holger.jaekel at gmx.de  Thu May  9 01:21:21 2024
From: holger.jaekel at gmx.de (Holger Jaekel)
Date: Thu, 9 May 2024 10:21:21 +0200
Subject: [gdal-dev] FileGDB that does not open
In-Reply-To: <DB9PR09MB68879301394E9C52B06A9401FDE52@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <DB9PR09MB68879301394E9C52B06A9401FDE52@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <fc713d2b-862b-411d-b32f-751832ff8aa1@gmx.de>

Jukka

Am 08.05.24 um 16:49 schrieb Rahkonen Jukka via gdal-dev:
> Warning 1: VA_Parcels layer has a
> Virginia_Parcel_Dataset_2024Q1.gdb\a00000009.gdbtable.cdf file whose
> format is unhandled


This is not new in 3.9.0dev, I get the same warning with 3.8.5. CDF
files are not supported by the OpenFileGDB driver. You need the ESRI
FileGDB API to read those files.

 From the documentation of OpenFileGDB:

Drawbacks of the OpenFileGDB driver:
? Cannot read data from compressed data in CDF format (Compressed Data
Format).

Holger

From andrew.bell.ia at gmail.com  Thu May  9 06:20:41 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Thu, 9 May 2024 09:20:41 -0400
Subject: [gdal-dev] Doxygen Arguments
Message-ID: <CACJ51z3MJqhmQLL5xL_OQYKV1Qg24ptptXtPmcuBBpp6vRENyw@mail.gmail.com>

Hi,

I'm looking at the documentation for GDALRasterBand::RasterIO and it's
surprising that the names of the arguments aren't included in the function
prototype despite them being in the doxygen function definition. The
arguments are described well below the function prototype, making it hard
to match things up and you have to assume that the order matches.

Does some doxygen expert know how the argument names could somehow be
included in the function prototype?

Web page:
https://gdal.org/api/gdalrasterband_cpp.html#classGDALRasterBand_1a75d4af97b3436a4e79d9759eedf89af4

Source: https://fossies.org/linux/gdal/gcore/gdalrasterband.cpp (line 110)

--
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240509/076e08cd/attachment.htm>

From dbaston at gmail.com  Thu May  9 09:08:56 2024
From: dbaston at gmail.com (Daniel Baston)
Date: Thu, 9 May 2024 12:08:56 -0400
Subject: [gdal-dev] Doxygen Arguments
In-Reply-To: <CACJ51z3MJqhmQLL5xL_OQYKV1Qg24ptptXtPmcuBBpp6vRENyw@mail.gmail.com>
References: <CACJ51z3MJqhmQLL5xL_OQYKV1Qg24ptptXtPmcuBBpp6vRENyw@mail.gmail.com>
Message-ID: <CA+K_q_o5ZYt1Q5=26PMdFcMUiy0aRggupi2cqKQrneReRuEsOQ@mail.gmail.com>

It looks like Doxygen is using argument names from the function prototype
instead of the implementation:
https://github.com/OSGeo/gdal/blob/master/gcore/gdal_priv.h#L753

I did some searching but didn't come across a way to change this behavior.
It looks like many other functions include the argument names in the
prototype, so maybe RasterIO should be updated to include them too?

Dan

On Thu, May 9, 2024 at 9:20?AM Andrew Bell via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> I'm looking at the documentation for GDALRasterBand::RasterIO and it's
> surprising that the names of the arguments aren't included in the function
> prototype despite them being in the doxygen function definition. The
> arguments are described well below the function prototype, making it hard
> to match things up and you have to assume that the order matches.
>
> Does some doxygen expert know how the argument names could somehow be
> included in the function prototype?
>
> Web page:
> https://gdal.org/api/gdalrasterband_cpp.html#classGDALRasterBand_1a75d4af97b3436a4e79d9759eedf89af4
>
> Source: https://fossies.org/linux/gdal/gcore/gdalrasterband.cpp (line 110)
>
> --
> Andrew Bell
> andrew.bell.ia at gmail.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240509/33e05091/attachment.htm>

From even.rouault at spatialys.com  Thu May  9 09:11:57 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 9 May 2024 18:11:57 +0200
Subject: [gdal-dev] Doxygen Arguments
In-Reply-To: <CACJ51z3MJqhmQLL5xL_OQYKV1Qg24ptptXtPmcuBBpp6vRENyw@mail.gmail.com>
References: <CACJ51z3MJqhmQLL5xL_OQYKV1Qg24ptptXtPmcuBBpp6vRENyw@mail.gmail.com>
Message-ID: <cef24601-4a5d-4117-9f84-e63ef68453e4@spatialys.com>

Andrew,

this is now fixed per 
https://github.com/OSGeo/gdal/commit/393eee77b40ae16751e4d2c0ad3e53386b22d025 
. Doxygen apparently takes the function/method at declaration time, and 
not definition time, and we had a number of unnamed parameters in 
declarations. (I also struggled with weird things when trying to fix 
that locally due not using a too recent Doxygen version. The HTML output 
was fine, but once integrated with Sphinx/Breathe, the parameters were 
still missing. Updating to Doxygen 1.9.8 as now used by our CI fixed things)

Even

Le 09/05/2024 ? 15:20, Andrew Bell via gdal-dev a ?crit?:
> Hi,
>
> I'm looking at the documentation for GDALRasterBand::RasterIO and it's 
> surprising that the names of the arguments aren't included in the 
> function prototype despite them being in the doxygen function 
> definition. The arguments are described well below the function 
> prototype, making it hard to match things up and you have to assume 
> that the order matches.
>
> Does some doxygen expert know how the argument names could somehow be 
> included in the function prototype?
>
> Web page: 
> https://gdal.org/api/gdalrasterband_cpp.html#classGDALRasterBand_1a75d4af97b3436a4e79d9759eedf89af4
>
> Source: https://fossies.org/linux/gdal/gcore/gdalrasterband.cpp (line 110)
>
> --
> Andrew Bell
> andrew.bell.ia at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240509/0a9fc600/attachment.htm>

From andrew.bell.ia at gmail.com  Thu May  9 09:30:51 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Thu, 9 May 2024 12:30:51 -0400
Subject: [gdal-dev] Doxygen Arguments
In-Reply-To: <cef24601-4a5d-4117-9f84-e63ef68453e4@spatialys.com>
References: <CACJ51z3MJqhmQLL5xL_OQYKV1Qg24ptptXtPmcuBBpp6vRENyw@mail.gmail.com>
 <cef24601-4a5d-4117-9f84-e63ef68453e4@spatialys.com>
Message-ID: <CACJ51z2oG7iqCFycx+YC+DEv93JwKCic1RwzLj0f_k5B4yOf8A@mail.gmail.com>

Thanks to all who looked at this and Even for resolution.

On Thu, May 9, 2024 at 12:11?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Andrew,
>
> this is now fixed per
> https://github.com/OSGeo/gdal/commit/393eee77b40ae16751e4d2c0ad3e53386b22d025
> . Doxygen apparently takes the function/method at declaration time, and not
> definition time, and we had a number of unnamed parameters in declarations.
> (I also struggled with weird things when trying to fix that locally due not
> using a too recent Doxygen version. The HTML output was fine, but once
> integrated with Sphinx/Breathe, the parameters were still missing. Updating
> to Doxygen 1.9.8 as now used by our CI fixed things)
>
> Even
> Le 09/05/2024 ? 15:20, Andrew Bell via gdal-dev a ?crit :
>
> Hi,
>
> I'm looking at the documentation for GDALRasterBand::RasterIO and it's
> surprising that the names of the arguments aren't included in the function
> prototype despite them being in the doxygen function definition. The
> arguments are described well below the function prototype, making it hard
> to match things up and you have to assume that the order matches.
>
> Does some doxygen expert know how the argument names could somehow be
> included in the function prototype?
>
> Web page:
> https://gdal.org/api/gdalrasterband_cpp.html#classGDALRasterBand_1a75d4af97b3436a4e79d9759eedf89af4
>
> Source: https://fossies.org/linux/gdal/gcore/gdalrasterband.cpp (line 110)
>
> --
> Andrew Bell
> andrew.bell.ia at gmail.com
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240509/1d3541b8/attachment-0001.htm>

From even.rouault at spatialys.com  Fri May 10 06:42:32 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 10 May 2024 15:42:32 +0200
Subject: [gdal-dev] Motion: approve GDAL 3.9.02RC2 as final release
In-Reply-To: <e487d0d1-fac0-4e5c-ab70-71645f8b3ff1@spatialys.com>
References: <e487d0d1-fac0-4e5c-ab70-71645f8b3ff1@spatialys.com>
Message-ID: <1132347d-093c-4181-b7df-1c22fde34d4e@spatialys.com>

Motion passed with +1 from PSC members EvenR, JukkaR and JavierJS

Le 08/05/2024 ? 13:13, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> Motion:
>
> Adopt GDAL 3.9.0RC2 as final 3.9.0 release
>
> Starting with my +1
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Fri May 10 07:10:59 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 10 May 2024 16:10:59 +0200
Subject: [gdal-dev] GDAL 3.9.0 is released
Message-ID: <6c28a332-6b33-4bf3-af80-8899712ad759@spatialys.com>

Hi,

On behalf of the GDAL/OGR development team and community, I am pleased to
announce the release of GDAL/OGR 3.9.0. GDAL/OGR is a C++ geospatial data
access library for raster and vector file formats, databases and web 
services.
It includes bindings for several languages, and a variety of command line
tools.

http://gdal.org/

The 3.9.0 release is a new feature release with the following highlights:

* [RFC 
96](https://gdal.org/development/rfc/rfc96_deferred_plugin_loading.html): 
Deferred C++ plugin loading
* [RFC 
97](https://gdal.org/development/rfc/rfc97_feature_and_fielddefn_sealing.html): 
OGRFeatureDefn, OGRFieldDefn and OGRGeomFieldDefn "sealing"
* [RFC 
98](https://gdal.org/development/rfc/rfc98_build_requirements_gdal_3_9.html): 
Build requirements for GDAL 3.9
* [RFC 
99](https://gdal.org/development/rfc/rfc99_geometry_coordinate_precision.html): 
Geometry coordinate precision
* Add [S104](https://gdal.org/drivers/raster/s104.html) (Water Level 
Information for Surface Navigation Product) and
 ? [S111](https://gdal.org/drivers/raster/s111.html) (Surface Currents 
Product) raster read-only drivers (required libhdf5)
* Add raster [GTI](https://gdal.org/drivers/raster/gti.html) (GDAL 
Raster Tile Index) driver to support catalogs with huge number of sources.
* Add vector 
[MiraMonVector](https://gdal.org/drivers/vector/miramon.html) 
read/creation driver (#9688)
* Deprecated ARG driver has been removed (#7920)
* Bump of shared lib major version

More complete information on the new features and fixes in the 3.9.0 
release can be found at:

https://github.com/OSGeo/gdal/blob/v3.9.0/NEWS.md

The release can be downloaded from:
 ? * https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0.tar.gz - source as 
.tar.gz
 ? * https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0.tar.gz.md5 - md5sum
 ? * https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0.tar.gz.sig - signature
 ? * https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0.tar.xz - source as 
.tar.xz
 ? * https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0.tar.xz.md5 - md5sum
 ? * https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0.tar.xz.sig - signature
 ? * https://download.osgeo.org/gdal/3.9.0/gdal390.zip - source as a zip
 ? * https://download.osgeo.org/gdal/3.9.0/gdal390.zip.md5 - md5sum
 ? * https://download.osgeo.org/gdal/3.9.0/gdal390.zip.sig - signature
 ? * https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0.tar.gz - 
test suite
 ? * https://download.osgeo.org/gdal/3.9.0/gdal390doc.zip - 
documentation / website

Note to packagers: obviously GCC 14 has just been released. It breaks 
mingw64
builds. Fix in https://github.com/OSGeo/gdal/pull/9894

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From liyenew at gmail.com  Sat May 11 16:07:52 2024
From: liyenew at gmail.com (Liyuneh Gebre)
Date: Sun, 12 May 2024 02:07:52 +0300
Subject: [gdal-dev] Discrepancy in reported Spatial Reference b/n gdalinfo
 and arcpy
Message-ID: <CAE4zf45dz8scjzQb+X+OdZU_TmDk8redqBg1EceQrMH553Jy2A@mail.gmail.com>

Hi,
I've encountered a discrepancy in the outputs of GDAL and arcpy. While
using gdalinfo on an arcGrid file with a user-defined projection, the
reported latitude and longitude of natural origin and False easting seems
to be incorrect. However, when accessing the same file with arcpy and
examining its spatialReference it seems to align with the prj.adf file and
is correct. How can I resolve this discrepancy?
For your reference link to the file.
https://u.pcloud.link/publink/show?code=XZvlVj0ZWHt5AMCJnjHl4pKMmozOJh8RYVE7

best regards

-- 
*Liyuneh Gebre**, **Associate Researcher*

*Ethiopian Institute of Agricultural Research,EIAR*

*Cell Phone:+251 911858155*

*linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
<https://www.linkedin.com/in/liyuneh-gebre-b842b440/>*
*skype:liyenew_1*
*Addis Ababa, Ethioipa*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240512/58ff38b9/attachment.htm>

From j1 at jimenezshaw.com  Sun May 12 03:06:06 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Sun, 12 May 2024 12:06:06 +0200
Subject: [gdal-dev] Discrepancy in reported Spatial Reference b/n
 gdalinfo and arcpy
In-Reply-To: <CAE4zf45dz8scjzQb+X+OdZU_TmDk8redqBg1EceQrMH553Jy2A@mail.gmail.com>
References: <CAE4zf45dz8scjzQb+X+OdZU_TmDk8redqBg1EceQrMH553Jy2A@mail.gmail.com>
Message-ID: <CADRrdKtPGkEf1gPxisJ1vgTy0g0UkFJvOQG1wqx=TXKqG5U7HQ@mail.gmail.com>

Your file prj.adf is

Projection    LAMBERT_AZIMUTHAL
Units         METERS
Zunits        NO
Xshift        0.0
Yshift        0.0
Parameters    6378137.0  6378137.0
6378137.0 /* radius of the sphere of reference
  20  0  0.0 /* longitude of center of projection
   5  0  0.0 /* latitude of center of projection
0.0 /* false easting (meters)
0.0 /* false northing (meters)

Looking at the code at
https://github.com/OSGeo/gdal/blob/158e538d63458414a5348dae12ddf820f62cf30d/ogr/ogr_srs_esri.cpp#L421
it is reading the parameters in order 2, 1, 3 and 4.

That code is 13 years old, changed due to
https://trac.osgeo.org/gdal/ticket/4302

As you can see, the content of the prj.adf is different than the example in
the ticket. Yours includes an extra one at the beginning, the radius of the
sphere.

I do not know if there is any documentation from esri about that specific
format for LAMBERT_AZIMUTHAL. It would be great.
And also I am surprised that in 13 years nobody complained.

If you remove the line with "6378137.0 /* radius of the sphere of reference"
it works, but probably it is not what you need.

Cheers,
Javier.

On Sun, 12 May 2024 at 01:07, Liyuneh Gebre via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
> I've encountered a discrepancy in the outputs of GDAL and arcpy. While
> using gdalinfo on an arcGrid file with a user-defined projection, the
> reported latitude and longitude of natural origin and False easting seems
> to be incorrect. However, when accessing the same file with arcpy and
> examining its spatialReference it seems to align with the prj.adf file and
> is correct. How can I resolve this discrepancy?
> For your reference link to the file.
>
> https://u.pcloud.link/publink/show?code=XZvlVj0ZWHt5AMCJnjHl4pKMmozOJh8RYVE7
>
> best regards
>
> --
> *Liyuneh Gebre**, **Associate Researcher*
>
> *Ethiopian Institute of Agricultural Research,EIAR*
>
> *Cell Phone:+251 911858155*
>
> *linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
> <https://www.linkedin.com/in/liyuneh-gebre-b842b440/>*
> *skype:liyenew_1*
> *Addis Ababa, Ethioipa*
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240512/8dd62fdf/attachment.htm>

From even.rouault at spatialys.com  Sun May 12 06:02:48 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 12 May 2024 15:02:48 +0200
Subject: [gdal-dev] Discrepancy in reported Spatial Reference b/n
 gdalinfo and arcpy
In-Reply-To: <CADRrdKtPGkEf1gPxisJ1vgTy0g0UkFJvOQG1wqx=TXKqG5U7HQ@mail.gmail.com>
References: <CAE4zf45dz8scjzQb+X+OdZU_TmDk8redqBg1EceQrMH553Jy2A@mail.gmail.com>
 <CADRrdKtPGkEf1gPxisJ1vgTy0g0UkFJvOQG1wqx=TXKqG5U7HQ@mail.gmail.com>
Message-ID: <67c00670-08f2-4253-8410-7f6dc56e9f47@spatialys.com>

Hi,

fix in https://github.com/OSGeo/gdal/pull/9909

Le 12/05/2024 ? 12:06, Javier Jimenez Shaw via gdal-dev a ?crit?:
>
> I do not know if there is any documentation from esri about that 
> specific format for LAMBERT_AZIMUTHAL. It would be great.
> And also I am surprised that in 13 years nobody complained.

Digging a bit in the web, I found some. See code comments in the pull 
request: 
https://github.com/OSGeo/gdal/pull/9909/files#diff-ed43401b4bc3e43302f36a0502b4106a7fa0866cd5e3c6ac4ccb3823d10f3085R436

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240512/7aa06fae/attachment.htm>

From even.rouault at spatialys.com  Sun May 12 07:20:31 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 12 May 2024 16:20:31 +0200
Subject: [gdal-dev] GDAL 3.9.0 is released
In-Reply-To: <6c28a332-6b33-4bf3-af80-8899712ad759@spatialys.com>
References: <6c28a332-6b33-4bf3-af80-8899712ad759@spatialys.com>
Message-ID: <72514f5b-54df-4213-b775-239fb54d74b6@spatialys.com>

Hi,

The GDAL 3.9.0 Docker images are available:

* ghcr.io/osgeo/gdal:alpine-small-3.9.0
* ghcr.io/osgeo/gdal:alpine-normal-3.9.0
* ghcr.io/osgeo/gdal:ubuntu-small-3.9.0
* ghcr.io/osgeo/gdal:ubuntu-full-3.9.0

Even

Le 10/05/2024 ? 16:10, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> On behalf of the GDAL/OGR development team and community, I am pleased to
> announce the release of GDAL/OGR 3.9.0. GDAL/OGR is a C++ geospatial data
> access library for raster and vector file formats, databases and web 
> services.
> It includes bindings for several languages, and a variety of command line
> tools.
>
> http://gdal.org/
>
> The 3.9.0 release is a new feature release with the following highlights:
>
> * [RFC 
> 96](https://gdal.org/development/rfc/rfc96_deferred_plugin_loading.html): 
> Deferred C++ plugin loading
> * [RFC 
> 97](https://gdal.org/development/rfc/rfc97_feature_and_fielddefn_sealing.html): 
> OGRFeatureDefn, OGRFieldDefn and OGRGeomFieldDefn "sealing"
> * [RFC 
> 98](https://gdal.org/development/rfc/rfc98_build_requirements_gdal_3_9.html): 
> Build requirements for GDAL 3.9
> * [RFC 
> 99](https://gdal.org/development/rfc/rfc99_geometry_coordinate_precision.html): 
> Geometry coordinate precision
> * Add [S104](https://gdal.org/drivers/raster/s104.html) (Water Level 
> Information for Surface Navigation Product) and
> ? [S111](https://gdal.org/drivers/raster/s111.html) (Surface Currents 
> Product) raster read-only drivers (required libhdf5)
> * Add raster [GTI](https://gdal.org/drivers/raster/gti.html) (GDAL 
> Raster Tile Index) driver to support catalogs with huge number of 
> sources.
> * Add vector 
> [MiraMonVector](https://gdal.org/drivers/vector/miramon.html) 
> read/creation driver (#9688)
> * Deprecated ARG driver has been removed (#7920)
> * Bump of shared lib major version
>
> More complete information on the new features and fixes in the 3.9.0 
> release can be found at:
>
> https://github.com/OSGeo/gdal/blob/v3.9.0/NEWS.md
>
> The release can be downloaded from:
> ? * https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0.tar.gz - source 
> as .tar.gz
> ? * https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0.tar.gz.md5 - md5sum
> ? * https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0.tar.gz.sig - 
> signature
> ? * https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0.tar.xz - source 
> as .tar.xz
> ? * https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0.tar.xz.md5 - md5sum
> ? * https://download.osgeo.org/gdal/3.9.0/gdal-3.9.0.tar.xz.sig - 
> signature
> ? * https://download.osgeo.org/gdal/3.9.0/gdal390.zip - source as a zip
> ? * https://download.osgeo.org/gdal/3.9.0/gdal390.zip.md5 - md5sum
> ? * https://download.osgeo.org/gdal/3.9.0/gdal390.zip.sig - signature
> ? * https://download.osgeo.org/gdal/3.9.0/gdalautotest-3.9.0.tar.gz - 
> test suite
> ? * https://download.osgeo.org/gdal/3.9.0/gdal390doc.zip - 
> documentation / website
>
> Note to packagers: obviously GCC 14 has just been released. It breaks 
> mingw64
> builds. Fix in https://github.com/OSGeo/gdal/pull/9894
>
> Best regards,
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From matteo.ghetta at gmail.com  Tue May 14 08:30:43 2024
From: matteo.ghetta at gmail.com (Matteo Ghetta)
Date: Tue, 14 May 2024 17:30:43 +0200
Subject: [gdal-dev] GPKG to PG single transaction, different schemas
Message-ID: <6b1001f3-227f-476e-b0e0-b2518fc90c4b@gmail.com>

Hi all,

I've a geopackage with many layers (in the following example let's 
pretend just 2) that I want to import in a single transaction 
(important!) into a PG database.

GPKG and PG table names are the same, but it can happen that the tables 
are in different schemas. I couldn't find the correct flags combination 
to specify the destination schema.table_name.

With the following command features of first_table are appended to the
second_table table:

ogr2ogr --debug ON -f PostgreSQL "PG:host=localhost user=matteo 
password=my_pws dbname=test" -append /home/matteo/export_db.gpkg 
first_schema.first_layer second_schema.second_layer

same with the -nln option:

ogr2ogr --debug ON -f PostgreSQL "PG:host=localhost user=matteo 
password=my_pws dbname=test" -append /home/matteo/export_db.gpkg 
first_layer -nln first_schema.first_layer second_layer -nln 
second_schema.second_layer

Should I specify a vrt catalog or am I missing some options?

Cheers and thanks!

Matteo


From even.rouault at spatialys.com  Tue May 14 09:16:48 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 14 May 2024 18:16:48 +0200
Subject: [gdal-dev] Discrepancy in reported Spatial Reference b/n
 gdalinfo and arcpy
In-Reply-To: <CAE4zf47m0r8hh+847EdY=-7YvVqJYLdTb59abikSWxOkUJ1Fwg@mail.gmail.com>
References: <CAE4zf45dz8scjzQb+X+OdZU_TmDk8redqBg1EceQrMH553Jy2A@mail.gmail.com>
 <CADRrdKtPGkEf1gPxisJ1vgTy0g0UkFJvOQG1wqx=TXKqG5U7HQ@mail.gmail.com>
 <67c00670-08f2-4253-8410-7f6dc56e9f47@spatialys.com>
 <CAE4zf47m0r8hh+847EdY=-7YvVqJYLdTb59abikSWxOkUJ1Fwg@mail.gmail.com>
Message-ID: <fd924ddb-7ba5-45ac-9845-62e94f318327@spatialys.com>


Le 14/05/2024 ? 18:08, Liyuneh Gebre a ?crit?:
> hi,
> thanks for your kind commitment.? I tried the docker version and 
> unfortunately it shows the same result.
That's expected. The fix has been done post 3.9.0. This will be 
available in 3.9.1
>
>
> On Sun, May 12, 2024 at 4:02?PM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     Hi,
>
>     fix in https://github.com/OSGeo/gdal/pull/9909
>
>     Le 12/05/2024 ? 12:06, Javier Jimenez Shaw via gdal-dev a ?crit?:
>>
>>     I do not know if there is any documentation from esri about that
>>     specific format for LAMBERT_AZIMUTHAL. It would be great.
>>     And also I am surprised that in 13 years nobody complained.
>
>     Digging a bit in the web, I found some. See code comments in the
>     pull request:
>     https://github.com/OSGeo/gdal/pull/9909/files#diff-ed43401b4bc3e43302f36a0502b4106a7fa0866cd5e3c6ac4ccb3823d10f3085R436
>
>     Even
>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
>
>
> -- 
> /*Liyuneh Gebre*//, ////Associate Researcher///
> /Ethiopian Institute of Agricultural Research,EIAR
> /
> /Cell Phone:+251 911858155
> /
> /linkedIn: https://www.linkedin.com/in/liyuneh-gebre-b842b440/
> /
> //skype:liyenew_1//
> /Addis Ababa, Ethioipa/

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240514/64689e37/attachment.htm>

From even.rouault at spatialys.com  Tue May 14 09:22:51 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 14 May 2024 18:22:51 +0200
Subject: [gdal-dev] GPKG to PG single transaction, different schemas
In-Reply-To: <6b1001f3-227f-476e-b0e0-b2518fc90c4b@gmail.com>
References: <6b1001f3-227f-476e-b0e0-b2518fc90c4b@gmail.com>
Message-ID: <64e6bb07-56de-4dae-9117-d6226e076daa@spatialys.com>


Le 14/05/2024 ? 17:30, Matteo Ghetta via gdal-dev a ?crit?:
> Hi all,
>
> I've a geopackage with many layers (in the following example let's 
> pretend just 2) that I want to import in a single transaction 
> (important!) into a PG database.
>
> GPKG and PG table names are the same, but it can happen that the 
> tables are in different schemas. I couldn't find the correct flags 
> combination to specify the destination schema.table_name.
>
> With the following command features of first_table are appended to the
> second_table table:
>
> ogr2ogr --debug ON -f PostgreSQL "PG:host=localhost user=matteo 
> password=my_pws dbname=test" -append /home/matteo/export_db.gpkg 
> first_schema.first_layer second_schema.second_layer
>
> same with the -nln option:
>
> ogr2ogr --debug ON -f PostgreSQL "PG:host=localhost user=matteo 
> password=my_pws dbname=test" -append /home/matteo/export_db.gpkg 
> first_layer -nln first_schema.first_layer second_layer -nln 
> second_schema.second_layer

There's no formal concept of schema in GeoPackage. You can't use -nln 
multiple times. It works only when importing a single layer

Yes, you'll likely have to use ogr2vrt 
(https://github.com/OSGeo/gdal/blob/master/swig/python/gdal-utils/osgeo_utils/samples/ogr2vrt.py) 
and rename manually the layers

And add "-ds_transaction -gt unlimited" to make sure everything is 
imported in the same transaction


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From matteo.ghetta at gmail.com  Wed May 15 00:31:18 2024
From: matteo.ghetta at gmail.com (Matteo Ghetta)
Date: Wed, 15 May 2024 09:31:18 +0200
Subject: [gdal-dev] GPKG to PG single transaction, different schemas
In-Reply-To: <64e6bb07-56de-4dae-9117-d6226e076daa@spatialys.com>
References: <6b1001f3-227f-476e-b0e0-b2518fc90c4b@gmail.com>
 <64e6bb07-56de-4dae-9117-d6226e076daa@spatialys.com>
Message-ID: <099901e9-8b14-4a66-b665-dddf7f69f04b@gmail.com>

Hi Even,

thanks for the reply!

I downloaded the 
https://github.com/OSGeo/gdal/blob/master/swig/python/gdal-utils/osgeo_utils/samples/ogr2vrt.py 
file and used like:

python3 ogr2vrt.py export_db.gpkg export_db.vrt first_layer second_layer

but I get the following error:

Traceback (most recent call last):
   File "/home/matteo/import_export/ogr2vrt.py", line 353, in <module>
     sys.exit(main(sys.argv))
              ^^^^^^^^^^^^^^
   File "/home/matteo/import_export/ogr2vrt.py", line 329, in main
     if src_fd.GetComment():
        ^^^^^^^^^^^^^^^^^
AttributeError: 'FieldDefn' object has no attribute 'GetComment'

while with the ogr2vrt file in 
/usr/lib/python3/dist-packages/osgeo_utils/samples/ogr2vrt.py it works 
nice! Not sure what I'm missing.

So basically the content of the resulting file that I've adapted is:

....
<OGRVRTLayer name="first_schema.first_layer">
     <SrcDataSource relativeToVRT="1" 
shared="1">export_db.gpkg</SrcDataSource>
     <SrcLayer>first_layer</SrcLayer>
....
<OGRVRTLayer name="second_schema.second_layer ">
     <SrcDataSource relativeToVRT="1" 
shared="1">export_db.gpkg</SrcDataSource>
     <SrcLayer>second_layer </SrcLayer>
...

and with ogr2ogr it's working nice in a single transaction!

The vrt file generation is also adding layer metadata, is there a way to 
avoid them or should I remove them manually after the file creation?

Cheers and thanks again!

Matteo

From moortom at gmail.com  Wed May 15 10:48:56 2024
From: moortom at gmail.com (Tom Moore)
Date: Wed, 15 May 2024 13:48:56 -0400
Subject: [gdal-dev] Java bindings to GDAL using Foreign Function Interface
Message-ID: <CANwy9RR6dkj0mPZ25a_UwPZSgMP1WEynp-+nmRgKy9_5M3XZ2Q@mail.gmail.com>

Hello list

Has anyone considered using the recently available Java foreign
function interface to build Java bindings for GDAL?  I am interested
in trying out a Java/GDAL project and would choose to use the FFI over
JNI since this seems like a better supported option for the future.

I would like to know if anyone else is taking a look at this, and
would like some help doing so.

Cheers,

Tom

From a.pau at creaf.uab.cat  Wed May 15 22:55:58 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Thu, 16 May 2024 05:55:58 +0000
Subject: [gdal-dev] How to exclude a layer from a translation using ogr2ogr
Message-ID: <PAXPR07MB777515ADEF037B540E29BE02A2ED2@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi,
I want to convert a Geopackage into MiraMonVector format.
I use this command line:
ogr2ogr "D:\mapes\2024\044 XP Topografia territorial\topografia-territorial-v1r0-3d-2022_menys_90_modelatge_terreny" "D:\mapes\2024\044 XP Topografia territorial\topografia-territorial-v1r0-3d-2022.gpkg" -f MiraMonVector

This gpkg has several layers and I'd like to exclude the one called _90_modelatge_terreny_l

I've tried several methods but they don't work.
Anyone know how to do that?
Thanks!

Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat <mailto:a.pau at creaf.uab.cat>
Let's chat on Teams! <https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-cat-signature.png]
[https://www.creaf.cat/sites/default/files/primary_x.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/primary_linkedin.png]<https://www.linkedin.com/company/creaf/>[https://www.creaf.cat/sites/default/files/primary_youtube.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/primary_instagram.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat <http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/cap_0.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)
Abans d'imprimir aquest missatge electr?nic penseu en el medi ambient.
[https://www.creaf.cat/sites/default/files/corner_right_0.png]


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/1977756b/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/1977756b/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2478 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/1977756b/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 1449 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/1977756b/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 1274 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/1977756b/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 1237 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/1977756b/attachment-0012.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 1458 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/1977756b/attachment-0013.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.png
Type: image/png
Size: 154 bytes
Desc: image007.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/1977756b/attachment-0014.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.png
Type: image/png
Size: 640 bytes
Desc: image008.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/1977756b/attachment-0015.png>

From jukka.rahkonen at maanmittauslaitos.fi  Wed May 15 23:54:52 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 16 May 2024 06:54:52 +0000
Subject: [gdal-dev] How to exclude a layer from a translation using
 ogr2ogr
In-Reply-To: <PAXPR07MB777515ADEF037B540E29BE02A2ED2@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB777515ADEF037B540E29BE02A2ED2@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <DB9PR09MB6887B8310FF7F588B6B639B5FDED2@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

See this recent thread https://lists.osgeo.org/pipermail/gdal-dev/2024-May/058993.html. I think that authoring a vector VRT file is also the answer to your question.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Abel Pau via gdal-dev
L?hetetty: torstai 16. toukokuuta 2024 8.56
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] How to exclude a layer from a translation using ogr2ogr

Hi,
I want to convert a Geopackage into MiraMonVector format.
I use this command line:
ogr2ogr "D:\mapes\2024\044 XP Topografia territorial\topografia-territorial-v1r0-3d-2022_menys_90_modelatge_terreny" "D:\mapes\2024\044 XP Topografia territorial\topografia-territorial-v1r0-3d-2022.gpkg" -f MiraMonVector

This gpkg has several layers and I'd like to exclude the one called _90_modelatge_terreny_l

I've tried several methods but they don't work.
Anyone know how to do that?
Thanks!

Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat <mailto:a.pau at creaf.uab.cat>
Let's chat on Teams! <https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-cat-signature.png]
[https://www.creaf.cat/sites/default/files/primary_x.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/primary_linkedin.png]<https://www.linkedin.com/company/creaf/>[https://www.creaf.cat/sites/default/files/primary_youtube.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/primary_instagram.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat <http://www.creaf.cat/> | http://blog.creaf.cat <http://blog.creaf.cat/>
[https://www.creaf.cat/sites/default/files/cap_0.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)
Abans d'imprimir aquest missatge electr?nic penseu en el medi ambient.
[https://www.creaf.cat/sites/default/files/corner_right_0.png]


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/2652c732/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/2652c732/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2478 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/2652c732/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 1449 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/2652c732/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 1274 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/2652c732/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 1237 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/2652c732/attachment-0012.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 1458 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/2652c732/attachment-0013.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.png
Type: image/png
Size: 154 bytes
Desc: image007.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/2652c732/attachment-0014.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.png
Type: image/png
Size: 640 bytes
Desc: image008.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240516/2652c732/attachment-0015.png>

From andrew.bell.ia at gmail.com  Mon May 20 08:01:28 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Mon, 20 May 2024 11:01:28 -0400
Subject: [gdal-dev] Data Type Conversion
Message-ID: <CACJ51z1vOFrK8j7Xa_YMZZwQigp5N1Nt0amBCsedT=rGSdLVhw@mail.gmail.com>

Hi,

The documentation for GDALRasterBand::RasterIO says that it will convert
data from the source data type to the destination data type. I searched the
source code a bit I'm not sure I located the bit that does this conversion.
I'm trying to understand what happens in this conversion process. Is this a
numeric conversion as would be done with a C/C++ cast or is this conversion
simply add or truncate bytes in order to fit in a destination data type. Or
perhaps something else?

Thanks,

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240520/98b4654f/attachment.htm>

From even.rouault at spatialys.com  Mon May 20 08:19:42 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 20 May 2024 17:19:42 +0200
Subject: [gdal-dev] Data Type Conversion
In-Reply-To: <CACJ51z1vOFrK8j7Xa_YMZZwQigp5N1Nt0amBCsedT=rGSdLVhw@mail.gmail.com>
References: <CACJ51z1vOFrK8j7Xa_YMZZwQigp5N1Nt0amBCsedT=rGSdLVhw@mail.gmail.com>
Message-ID: <8bff3d82-ecc3-4c1a-bf7f-0d1a3fbda221@spatialys.com>

Andrew,

Data type conversion is done by GDALCopyWords[64]: 
https://gdal.org/api/raster_c_api.html#_CPPv415GDALCopyWords64PKv12GDALDataTypeiPv12GDALDataTypei10GPtrDiff_t

The doc was a bit outdated, regarding conversion from floating point 
data types to integer data types. I've just adjusted it in 
https://github.com/OSGeo/gdal/commit/139e891b9b4a7b928c66e3daef83361fa530e6ac

Website should be refreshed soon

Even

Le 20/05/2024 ? 17:01, Andrew Bell via gdal-dev a ?crit?:
> Hi,
>
> The documentation for GDALRasterBand::RasterIO says that it will 
> convert data from the source data type to the destination data type. I 
> searched the source code a bit I'm not sure I located the bit that 
> does this conversion. I'm trying to understand what happens in this 
> conversion process. Is this a numeric conversion as would be done with 
> a C/C++ cast or is this conversion simply add or truncate bytes in 
> order to fit in a destination data type. Or perhaps something else?

>
> Thanks,
>
> -- 
> Andrew Bell
> andrew.bell.ia at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240520/83509ef0/attachment.htm>

From j1 at jimenezshaw.com  Mon May 20 09:45:33 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 20 May 2024 18:45:33 +0200
Subject: [gdal-dev] Conda failure in GA
Message-ID: <CADRrdKtFOj-Bsi_HWabzCJLv2R56V=Qg-mKkzjKPdsa4OzaSHw@mail.gmail.com>

Hi

The github actions on a branch I created two days ago is failing in Conda
environment, and I do not understand the reason

https://github.com/jjimenezshaw/gdal/actions/runs/9161579309/job/25186735095#step:8:244

I think it is not related to my code.

Does anybody know what is it about?

Thanks.
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240520/be5d259c/attachment.htm>

From howard at hobu.co  Mon May 20 09:53:53 2024
From: howard at hobu.co (Howard Butler)
Date: Mon, 20 May 2024 11:53:53 -0500
Subject: [gdal-dev] Conda failure in GA
In-Reply-To: <CADRrdKtFOj-Bsi_HWabzCJLv2R56V=Qg-mKkzjKPdsa4OzaSHw@mail.gmail.com>
References: <CADRrdKtFOj-Bsi_HWabzCJLv2R56V=Qg-mKkzjKPdsa4OzaSHw@mail.gmail.com>
Message-ID: <F1BE99EB-0EC7-4A54-88D4-CC0C9D2FC11D@hobu.co>



> On May 20, 2024, at 11:45?AM, Javier Jimenez Shaw via gdal-dev <gdal-dev at lists.osgeo.org> wrote:
> 
> Hi
> 
> The github actions on a branch I created two days ago is failing in Conda environment, and I do not understand the reason
> 
> https://github.com/jjimenezshaw/gdal/actions/runs/9161579309/job/25186735095#step:8:244
> 
> I think it is not related to my code.
> 
> Does anybody know what is it about?

It looks like the numpy 2.0 update was pushed to the gdal-feedstock https://github.com/conda-forge/gdal-feedstock/pull/939 (looking like  GDAL must also build and test clean against Numpy 2.0 at this point too).

The error is the Conda builder complaining that it can't find Numpy 2.0 because our recipe doesn't use the Numpy 2.0 release candidate channel. I think something is busted by this change to the recipe but I have not had time to investigate it.

Howard

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240520/18f5be81/attachment.htm>

From even.rouault at spatialys.com  Mon May 20 10:00:46 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 20 May 2024 19:00:46 +0200
Subject: [gdal-dev] Conda failure in GA
In-Reply-To: <F1BE99EB-0EC7-4A54-88D4-CC0C9D2FC11D@hobu.co>
References: <CADRrdKtFOj-Bsi_HWabzCJLv2R56V=Qg-mKkzjKPdsa4OzaSHw@mail.gmail.com>
 <F1BE99EB-0EC7-4A54-88D4-CC0C9D2FC11D@hobu.co>
Message-ID: <b6218b27-24fd-4130-a0c0-ffa6a8d7e6a0@spatialys.com>


> It looks like the numpy 2.0 update was pushed to the gdal-feedstock 
> https://github.com/conda-forge/gdal-feedstock/pull/939?(looking like 
> ?GDAL must also build and test clean against Numpy 2.0 at this point too).
>
> The error is the Conda builder complaining that it can't find Numpy 
> 2.0 because our recipe doesn't use the Numpy 2.0 release candidate 
> channel. I think something is busted by this change to the recipe but 
> I have not had time to investigate it.

As suggested in the comment of #939, attempting 
https://github.com/rouault/gdal/commit/1000cfaa950a18bd14b0c72109439cad58c789d5

My understanding is that the addition of this channel should only be a 
build requirement, and not impose to add this channel when using the 
generated package given than building against numpy 2.0 also yields 
binaries that are compatible with the oldest supported numpy 1.x

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240520/4d95de46/attachment.htm>

From even.rouault at spatialys.com  Mon May 20 11:17:04 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 20 May 2024 20:17:04 +0200
Subject: [gdal-dev] Conda failure in GA
In-Reply-To: <b6218b27-24fd-4130-a0c0-ffa6a8d7e6a0@spatialys.com>
References: <CADRrdKtFOj-Bsi_HWabzCJLv2R56V=Qg-mKkzjKPdsa4OzaSHw@mail.gmail.com>
 <F1BE99EB-0EC7-4A54-88D4-CC0C9D2FC11D@hobu.co>
 <b6218b27-24fd-4130-a0c0-ffa6a8d7e6a0@spatialys.com>
Message-ID: <84c22f7e-5768-4c39-96ea-00edce1593d7@spatialys.com>


> As suggested in the comment of #939, attempting 
> https://github.com/rouault/gdal/commit/1000cfaa950a18bd14b0c72109439cad58c789d5
>
That fixed it. Merged into master

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240520/ca886ba0/attachment.htm>

From j1 at jimenezshaw.com  Mon May 20 15:25:49 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Tue, 21 May 2024 00:25:49 +0200
Subject: [gdal-dev] Conda failure in GA
In-Reply-To: <84c22f7e-5768-4c39-96ea-00edce1593d7@spatialys.com>
References: <CADRrdKtFOj-Bsi_HWabzCJLv2R56V=Qg-mKkzjKPdsa4OzaSHw@mail.gmail.com>
 <F1BE99EB-0EC7-4A54-88D4-CC0C9D2FC11D@hobu.co>
 <b6218b27-24fd-4130-a0c0-ffa6a8d7e6a0@spatialys.com>
 <84c22f7e-5768-4c39-96ea-00edce1593d7@spatialys.com>
Message-ID: <CADRrdKtwux1SwM+gHN0YFkJAjm4-gKcTyp7gkZ3+QLk5g4=jfg@mail.gmail.com>

Thanks!

On Mon, 20 May 2024 at 20:17, Even Rouault <even.rouault at spatialys.com>
wrote:

>
> As suggested in the comment of #939, attempting
> https://github.com/rouault/gdal/commit/1000cfaa950a18bd14b0c72109439cad58c789d5
>
> That fixed it. Merged into master
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240521/bf14890f/attachment.htm>

From j1 at jimenezshaw.com  Tue May 21 01:54:37 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Tue, 21 May 2024 10:54:37 +0200
Subject: [gdal-dev] Using vscode to develop GDAL
Message-ID: <CADRrdKspDFMGwJ2_9uk4kqe-4+KvOzDCHiz+uzfaRBDo=6kBXQ@mail.gmail.com>

Hi

I am using vscode to edit (and build and debug) gdal. So far so good.
The compilation works with a simple task that runs a shell (see code below
if you need it). Debug also works fine.

My problem is syntax highlighting. Apparently it does not realize that
"GDAL_COMPILATION" is defined, so some variables appear as errors with
something like
identifier "GUIntptr_t" is undefined
To configure it I just did
cmake .. -DBUILD_PYTHON_BINDINGS=ON  -DCMAKE_BUILD_TYPE=Debug

Does anybody uses visual studio code and had/solved this problem?
Thanks.
Javier

PS: this is my tasks.json:
{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "build",
            "type": "shell",
            "command": "cmake",
            "args": ["--build", "build", "-j", "12"],
            "problemMatcher": [
                "$gcc"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "presentation": {
                "revealProblems": "onProblem",
            }
        }
    ]
}
.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240521/c4f82429/attachment.htm>

From even.rouault at spatialys.com  Tue May 21 06:28:23 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 21 May 2024 15:28:23 +0200
Subject: [gdal-dev] libgeotiff 1.7.2 release candidate
Message-ID: <ca91c1f3-401c-4efc-8339-7f84dd3a8ee1@spatialys.com>

Hi,

I've prepared a libgeotiff 1.7.2 release candidate.

https://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.1rc2.tar.gz
https://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.1rc2.zip

I'll promote it to final later this week if nothing serious is reported 
on it before.


News is:

libgeotiff 1.7.2
----------------

* GTIFGetDatumInfoEx(): handle dynamic datums
* CMake: adopt GNUInstallDirs
* CMake: export TIFF as a public dependency
* Add XTIFFClientOpenExt() with re-entrant error callbacks
* listgeo: add a -no_corners option to avoid printing corner
 ? coordinates which might be PROJ version sensitive (refs #81)
* Fix test failures with PROJ 9.1.1 and 9.3
* Remove trailing spaces from many files.
* Localize variables and add const when possible in a number of files
* geo_normalize.c: sprintf --> snprintf
* Add missing includes
* Fix -Werror=calloc-transposed-args with gcc 14
* FindPROJ.cmake: proj_experimental;h -> proj_experimental.h
* CMake: add a BUILD_SHARED_LIBS option, and make it default to ON
* autoconf/CMake: add generation of libgeotiff.pc
* Remove INSTALL and install-sh autoconf-generated files

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Tue May 21 06:49:51 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 21 May 2024 15:49:51 +0200
Subject: [gdal-dev] [Geotiff] libgeotiff 1.7.2 release candidate
In-Reply-To: <rmi5xv7z3cv.fsf@s1.lexort.com>
References: <ca91c1f3-401c-4efc-8339-7f84dd3a8ee1@spatialys.com>
 <rmi5xv7z3cv.fsf@s1.lexort.com>
Message-ID: <5b70cff4-d28e-412a-9eca-8687cbe1cf0f@spatialys.com>

oops. Here are the corrected URLs:

https://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.2rc1.tar.gz
https://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.2rc1.zip

Le 21/05/2024 ? 15:44, Greg Troxel via Geotiff a ?crit?:
> Even Rouault via Geotiff <geotiff at lists.osgeo.org> writes:
>
>
> do you mean
>
> https://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.2rc1.tar.gz
>
> assuming yes builds and passes tests on NetBSD 10 amd64.
> _______________________________________________
> Geotiff mailing list
> Geotiff at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/geotiff

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From gdt at lexort.com  Tue May 21 10:26:48 2024
From: gdt at lexort.com (Greg Troxel)
Date: Tue, 21 May 2024 13:26:48 -0400
Subject: [gdal-dev] building just the python bindings (cmake)
Message-ID: <rmiwmnnxehz.fsf@s1.lexort.com>

I had not gotten to converting the pkgsrc package to cmake, because it
seemed like it would take a long time.  So gdal is at 3.5.3, the last
one that works with autoconf.  Yes, I know that 3.5 was about two years
ago.  It turns out that it is taking hours to do the conversion, and the
good news is that the main "gdal-lib" package is converted.

I also know 3.5 is not current, but I am trying to convert it to cmake
(which presumably works fine, given that 3.6 dropped autoconf), before
updating to newer versions.

I first  tried running cmake in swig/python (in a build dir), but the
generated makefile doesn't really build anything.

I then tried cmake at top level, and tried to run gmake in swig/python
and it seems to be building large amounts of things that are not the
python binding.  Perhaps all of gdal lib and bin.  The install target
indeed installs libgdal and bin/gdalfoo, regular non-python things, vs
the expected python tools.


The README talks about setuptools.  Should I conclude that cmake is a
red herring here, despite the presence of CMakeLists.txt?   And that the
build should just be setuptools in that dir, with no configure stage?






From even.rouault at spatialys.com  Tue May 21 10:44:21 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 21 May 2024 19:44:21 +0200
Subject: [gdal-dev] building just the python bindings (cmake)
In-Reply-To: <rmiwmnnxehz.fsf@s1.lexort.com>
References: <rmiwmnnxehz.fsf@s1.lexort.com>
Message-ID: <8ce69787-a85f-4304-9a70-7e5a65b07dcf@spatialys.com>

Greg,

If the build requirements for the Python bindings are met (python + swig 
available), then a "make && make install" cycle will build and install 
libgdal and the python bindings, like it did in autoconf era. The CMake 
build target "python_binding" has libgdal as a dependency.

The idea for packaging is similar to autoconf era: that is? you just do 
a build and separate the artifacts into separate packages. That's what 
Alpine (https://git.alpinelinux.org/aports/tree/community/gdal/APKBUILD) 
or Debian 
(https://salsa.debian.org/debian-gis-team/gdal/-/blob/master/debian/rules?ref_type=heads)

With 3.9, you could also do a more manual approach (not sure the 
python_generated_files target is available in 3.5)
cmake ..
make GDAL? # build the library
cd swig/python
make python_generated_files? # generate SWIG generated files
python setup.py build

Even

Le 21/05/2024 ? 19:26, Greg Troxel via gdal-dev a ?crit?:
> I had not gotten to converting the pkgsrc package to cmake, because it
> seemed like it would take a long time.  So gdal is at 3.5.3, the last
> one that works with autoconf.  Yes, I know that 3.5 was about two years
> ago.  It turns out that it is taking hours to do the conversion, and the
> good news is that the main "gdal-lib" package is converted.
>
> I also know 3.5 is not current, but I am trying to convert it to cmake
> (which presumably works fine, given that 3.6 dropped autoconf), before
> updating to newer versions.
>
> I first  tried running cmake in swig/python (in a build dir), but the
> generated makefile doesn't really build anything.
>
> I then tried cmake at top level, and tried to run gmake in swig/python
> and it seems to be building large amounts of things that are not the
> python binding.  Perhaps all of gdal lib and bin.  The install target
> indeed installs libgdal and bin/gdalfoo, regular non-python things, vs
> the expected python tools.
>
>
> The README talks about setuptools.  Should I conclude that cmake is a
> red herring here, despite the presence of CMakeLists.txt?   And that the
> build should just be setuptools in that dir, with no configure stage?
>
>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From gdt at lexort.com  Tue May 21 11:13:39 2024
From: gdt at lexort.com (Greg Troxel)
Date: Tue, 21 May 2024 14:13:39 -0400
Subject: [gdal-dev] building just the python bindings (cmake)
In-Reply-To: <8ce69787-a85f-4304-9a70-7e5a65b07dcf@spatialys.com> (Even
 Rouault's message of "Tue, 21 May 2024 19:44:21 +0200")
References: <rmiwmnnxehz.fsf@s1.lexort.com>
 <8ce69787-a85f-4304-9a70-7e5a65b07dcf@spatialys.com>
Message-ID: <rmiseybxcbw.fsf@s1.lexort.com>

Even Rouault <even.rouault at spatialys.com> writes:

> If the build requirements for the Python bindings are met (python +
> swig available), then a "make && make install" cycle will build and
> install libgdal and the python bindings, like it did in autoconf
> era. The CMake build target "python_binding" has libgdal as a
> dependency.

ok, but

> The idea for packaging is similar to autoconf era: that is? you just
> do a build and separate the artifacts into separate packages.

That is how some packaging systems work.  Others work differently, and
pkgsrc in particular lets you build parts separately.  Not so much in
this case, but a package that has a base program and a qt binding, or
even worse rust, would be beastly to build on a low-resource system.
Upstreams can't assume that all packaging systems build the kitchen sink
and split it up.

and, the readme in the bindings dir says that gdal libs are a
dependency.  In my case they are installed, as py-gdal depends on
gdal-lib.

> With 3.9, you could also do a more manual approach (not sure the
> python_generated_files target is available in 3.5)
> cmake ..
> make GDAL? # build the library
> cd swig/python
> make python_generated_files? # generate SWIG generated files
> python setup.py build

Turns out I was able to just ignore cmake and build a wheel in
swig/python, as if it was a separate project.  This is a great outcome.


Thanks for the hints; they are helpful to understand the bigger picture.

From bontepaarden at gmail.com  Wed May 22 07:31:12 2024
From: bontepaarden at gmail.com (Paul Meems)
Date: Wed, 22 May 2024 16:31:12 +0200
Subject: [gdal-dev] Gdal_grid produces a lot of empty cells
Message-ID: <CAHNf2YSWAO5ndfN0iLqF_0Dr9CLrcymwRdvFEAqtzO5sxbLeXw@mail.gmail.com>

Hello List,

I have a CSV-file with sensor data and GPS coordinates in WGS84.
I convert these GPS coordinates to a projected projection. Mostly a UTM
zone, depending on the location.
These X and Y values are added to the CSV-file and saved with a different
name.
Then I create a VRT-file to get the proper Z-column:
<OGRVRTDataSource>
    <OGRVRTLayer name="01 field data-EPSG32634">
        <SrcDataSource>01 field data-EPSG32634.csv</SrcDataSource>
        <GeometryType>wkbPoint</GeometryType>
        <GeometryField encoding="PointFromColumns" x="X" y="Y"
z="Countrate"/>
    </OGRVRTLayer>
</OGRVRTDataSource>

This VRT file is sent to Gdal_grid to create a tiff-file using these
arguments:
-a invdist:power=2:
   smoothing=20:
   min_points=16:
   max_points=56:
   radius1=40:
   radius2=40:
   nodata=1.701410000000000071e+38
-txe 273360 274940
-tye 5559440 5561020
-tr 12.5 12.5
-a_srs EPSG:32634
"01 field data-EPSG32634-TC.vrt" "tmpmrmq4d.tiff"

This tiff-file looks like this: https://pasteboard.co/tKP1ZJ1cAY2r.png

This process works fine and we've been using this for several years now.

Recently we added a process step to export one of the sensor data to a
PostGIS database and with the help of Geoserver and OpenLayers we've
created a very simple webpage.
In this step, things are getting weird. The WebMap is in EPSG:3857
(Pseudo/Web-Mercator).
I start with the original CSV-file with the sensor data and add the X and Y
columns again, now in EPSG:3857. Then I create a similar vrt-file:
<OGRVRTDataSource>
    <OGRVRTLayer name="01 field data-EPSG3857">
        <SrcDataSource>01 field data-EPSG3857.csv</SrcDataSource>
        <GeometryType>wkbPoint</GeometryType>
        <GeometryField encoding="PointFromColumns" x="X" y="Y"
z="Countrate"/>
    </OGRVRTLayer>
</OGRVRTDataSource>

And call gdal_grid with similar arguments:
-a invdist:power=2:
   smoothing=20:
   min_points=16:
   max_points=56:
   radius1=40:
   radius2=40:
   nodata=1.701410000000000071e+38
-txe 1984580 1987000
-tye 6471320 6473740
-tr 12.5 12.5
-a_srs EPSG:3857
"01 field data-EPSG3857-TC.vrt" "tmpun25fo.tiff"

But now the result is: https://pasteboard.co/bcMp7rP5eyff.png

A huge amount of empty cells. I don't understand this.
Both EPSG:32634 (WGS 84 / UTM zone 34N) and EPSG:3857 are in meters so I
thought the same settings should work.
But in fact only with very different settings I can get a proper grid:
 -a invdist:power=2:
   smoothing=60:
   min_points=4:
   max_points=56:
   radius1=80:
   radius2=80:
   nodata=1.701410000000000071e+38
-txe 1984580 1987000
-tye 6471320 6473740
-tr 20 20
-a_srs EPSG:3857
"01 field data-EPSG3857-TC.vrt" "tmpsvlhgy.tiff"

I got these values through trial and error.
https://pasteboard.co/7pypGsynS09K.png

But now we loose a lot of variation because the search radius and grid cell
size are much higher.

To make it even more weird. Other fields nearby don't have this problem and
I also have this problem with other projections like:

Belgium (EPSG:3857): https://pasteboard.co/ZXLTsEuvpZ3s.png
Belgium (EPSG:31370): https://pasteboard.co/yNpF6yujF3tV.png

The Netherlands (EPSG:3857): https://pasteboard.co/8PpDJrDi1Wxq.png
The Netherlands (EPSG:28992): https://pasteboard.co/38SlnHVCog4m.png

Norway (EPSG:3857): https://pasteboard.co/q69jQHRK40c6.png
Norway (EPSG: 25833): https://pasteboard.co/gs9HNAmnaxSJ.png

We do have enough data points: https://pasteboard.co/4CmBs7kgQGVO.png
https://pasteboard.co/J8ZbMHKeErZu.png

Thanks if you made it all the way here ;)

My questions are:

   - Am I using Gdal_Grid in the proper way or do I need to change one or
   more arguments?
   - What might be an explanation for the empty cells when using EPSG:3857?


Thanks,

Paul Meems
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240522/57c738fb/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Wed May 22 07:57:03 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 22 May 2024 14:57:03 +0000
Subject: [gdal-dev] Gdal_grid produces a lot of empty cells
In-Reply-To: <CAHNf2YSWAO5ndfN0iLqF_0Dr9CLrcymwRdvFEAqtzO5sxbLeXw@mail.gmail.com>
References: <CAHNf2YSWAO5ndfN0iLqF_0Dr9CLrcymwRdvFEAqtzO5sxbLeXw@mail.gmail.com>
Message-ID: <DB9PR09MB6887347C37D9E386A98F3AE1FDEB2@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

At least I cannot resolve your issue on paper. Please share some test data.

-Jukka-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Paul Meems via gdal-dev
L?hetetty: keskiviikko 22. toukokuuta 2024 17.31
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Gdal_grid produces a lot of empty cells

Hello List,

I have a CSV-file with sensor data and GPS coordinates in WGS84.
I convert these GPS coordinates to a projected projection. Mostly a UTM zone, depending on the location.
These X and Y values are added to the CSV-file and saved with a different name.
Then I create a VRT-file to get the proper Z-column:
<OGRVRTDataSource>
    <OGRVRTLayer name="01 field data-EPSG32634">
        <SrcDataSource>01 field data-EPSG32634.csv</SrcDataSource>
        <GeometryType>wkbPoint</GeometryType>
        <GeometryField encoding="PointFromColumns" x="X" y="Y" z="Countrate"/>
    </OGRVRTLayer>
</OGRVRTDataSource>

This VRT file is sent to Gdal_grid to create a tiff-file using these arguments:
-a invdist:power=2:
   smoothing=20:
   min_points=16:
   max_points=56:
   radius1=40:
   radius2=40:
   nodata=1.701410000000000071e+38
-txe 273360 274940
-tye 5559440 5561020
-tr 12.5 12.5
-a_srs EPSG:32634
"01 field data-EPSG32634-TC.vrt" "tmpmrmq4d.tiff"

This tiff-file looks like this: https://pasteboard.co/tKP1ZJ1cAY2r.png

This process works fine and we've been using this for several years now.

Recently we added a process step to export one of the sensor data to a PostGIS database and with the help of Geoserver and OpenLayers we've created a very simple webpage.
In this step, things are getting weird. The WebMap is in EPSG:3857 (Pseudo/Web-Mercator).
I start with the original CSV-file with the sensor data and add the X and Y columns again, now in EPSG:3857. Then I create a similar vrt-file:
<OGRVRTDataSource>
    <OGRVRTLayer name="01 field data-EPSG3857">
        <SrcDataSource>01 field data-EPSG3857.csv</SrcDataSource>
        <GeometryType>wkbPoint</GeometryType>
        <GeometryField encoding="PointFromColumns" x="X" y="Y" z="Countrate"/>
    </OGRVRTLayer>
</OGRVRTDataSource>

And call gdal_grid with similar arguments:
-a invdist:power=2:
   smoothing=20:
   min_points=16:
   max_points=56:
   radius1=40:
   radius2=40:
   nodata=1.701410000000000071e+38
-txe 1984580 1987000
-tye 6471320 6473740
-tr 12.5 12.5
-a_srs EPSG:3857
"01 field data-EPSG3857-TC.vrt" "tmpun25fo.tiff"

But now the result is: https://pasteboard.co/bcMp7rP5eyff.png

A huge amount of empty cells. I don't understand this.
Both EPSG:32634 (WGS 84 / UTM zone 34N) and EPSG:3857 are in meters so I thought the same settings should work.
But in fact only with very different settings I can get a proper grid:
 -a invdist:power=2:
   smoothing=60:
   min_points=4:
   max_points=56:
   radius1=80:
   radius2=80:
   nodata=1.701410000000000071e+38
-txe 1984580 1987000
-tye 6471320 6473740
-tr 20 20
-a_srs EPSG:3857
"01 field data-EPSG3857-TC.vrt" "tmpsvlhgy.tiff"

I got these values through trial and error.
https://pasteboard.co/7pypGsynS09K.png

But now we loose a lot of variation because the search radius and grid cell size are much higher.

To make it even more weird. Other fields nearby don't have this problem and I also have this problem with other projections like:

Belgium (EPSG:3857): https://pasteboard.co/ZXLTsEuvpZ3s.png
Belgium (EPSG:31370): https://pasteboard.co/yNpF6yujF3tV.png

The Netherlands (EPSG:3857): https://pasteboard.co/8PpDJrDi1Wxq.png
The Netherlands (EPSG:28992): https://pasteboard.co/38SlnHVCog4m.png

Norway (EPSG:3857): https://pasteboard.co/q69jQHRK40c6.png
Norway (EPSG: 25833): https://pasteboard.co/gs9HNAmnaxSJ.png

We do have enough data points: https://pasteboard.co/4CmBs7kgQGVO.png
https://pasteboard.co/J8ZbMHKeErZu.png

Thanks if you made it all the way here ;)

My questions are:

  *   Am I using Gdal_Grid in the proper way or do I need to change one or more arguments?
  *   What might be an explanation for the empty cells when using EPSG:3857?

Thanks,

Paul Meems











-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240522/245d24de/attachment-0001.htm>

From gdt at lexort.com  Wed May 22 07:59:31 2024
From: gdt at lexort.com (Greg Troxel)
Date: Wed, 22 May 2024 10:59:31 -0400
Subject: [gdal-dev] building just the python bindings (cmake)
In-Reply-To: <8ce69787-a85f-4304-9a70-7e5a65b07dcf@spatialys.com> (Even
 Rouault's message of "Tue, 21 May 2024 19:44:21 +0200")
References: <rmiwmnnxehz.fsf@s1.lexort.com>
 <8ce69787-a85f-4304-9a70-7e5a65b07dcf@spatialys.com>
Message-ID: <rmi5xv5x57w.fsf@s1.lexort.com>

I got 3.5 to work, so I'm focusing on the 3.9 upgrade.   It seems that
3.9, vs 3.5, has withdrawn the swig generated files from the distfile.

  With 3.9, you could also do a more manual approach (not sure the
  python_generated_files target is available in 3.5)
  cmake ..
  make GDAL? # build the library
  cd swig/python
  make python_generated_files? # generate SWIG generated files
  python setup.py build

That looks like it works.  Except that I omitted the 'make GDAL'  -- in
my case, gdal is already installed.   I don't see why one would need to
build, as long as the headers and libs are available in the system.
Does that seem reasonable, or am I missing something?

It would be great if README in swig/python explained this.  The
"installation" instructions are more pointers to packaging systems, and
not so much guidance for people trying to build from source.  I realize
that almost all people who use gdal use it from packaging and do not
have the slightest idea how to build perhaps anything, but on the other
hand I would expect that a README in the sources is only read by people
who are trying to build it.

Also in README, it talks about numpy being a depdendency but not
formally required.   I think two clarificaions would be useful:

  What is lost specifically, vs "many examples and utilities"?  If you
  use it with qgis, without numpy, are things missing there too?  I'm
  willing to believe it's a big deal, but it's hard to understand.

  I am guessing that the things that need numpy work fine if you install
  this built in an environment without numpy and then later also install
  numpy, but it is unclear if numpy is a run-time-only dependency or if
  it is needed at build time.

From even.rouault at spatialys.com  Wed May 22 08:09:27 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 22 May 2024 17:09:27 +0200
Subject: [gdal-dev] building just the python bindings (cmake)
In-Reply-To: <rmi5xv5x57w.fsf@s1.lexort.com>
References: <rmiwmnnxehz.fsf@s1.lexort.com>
 <8ce69787-a85f-4304-9a70-7e5a65b07dcf@spatialys.com>
 <rmi5xv5x57w.fsf@s1.lexort.com>
Message-ID: <75f0544b-26aa-4ac4-9b2b-db0c2aab41f7@spatialys.com>


Le 22/05/2024 ? 16:59, Greg Troxel a ?crit?:
> I got 3.5 to work, so I'm focusing on the 3.9 upgrade.   It seems that
> 3.9, vs 3.5, has withdrawn the swig generated files from the distfile.
>
>    With 3.9, you could also do a more manual approach (not sure the
>    python_generated_files target is available in 3.5)
>    cmake ..
>    make GDAL? # build the library
>    cd swig/python
>    make python_generated_files? # generate SWIG generated files
>    python setup.py build
>
> That looks like it works.  Except that I omitted the 'make GDAL'  -- in
> my case, gdal is already installed.   I don't see why one would need to
> build, as long as the headers and libs are available in the system.
> Does that seem reasonable, or am I missing something?
The? GDAL Python (or CSharp or Java) bindings, being in-tree, have a 
special status compared to other bindings in dedicated code repository, 
since they get built as one of the many components built by the build 
process, and do not rely on installed libs/headers in the default 
process. You've figured out it is still possible to build a wheel (or 
use the source pakage on pypi https://pypi.org/project/GDAL/ which are 
generated following the procedure documented in HOWTO-RELEASE) that will 
manage to find the installed libs/headers
>
> It would be great if README in swig/python explained this.  The
> "installation" instructions are more pointers to packaging systems, and
> not so much guidance for people trying to build from source.  I realize
> that almost all people who use gdal use it from packaging and do not
> have the slightest idea how to build perhaps anything, but on the other
> hand I would expect that a README in the sources is only read by people
> who are trying to build it.
Feel free to contribute documentation :-)
>
> Also in README, it talks about numpy being a depdendency but not
> formally required.   I think two clarificaions would be useful:
>
>    What is lost specifically, vs "many examples and utilities"?  If you
>    use it with qgis, without numpy, are things missing there too?  I'm
>    willing to believe it's a big deal, but it's hard to understand.
>
>    I am guessing that the things that need numpy work fine if you install
>    this built in an environment without numpy and then later also install
>    numpy, but it is unclear if numpy is a run-time-only dependency or if
>    it is needed at build time.

It is a built-time for the osgeo.gdal_array component that is for 
example used when using the osgeo.gdal.Dataset.ReadAsArray() method.

For generic purpose packages (unless you're very very tight on the 
binary footprint), I'd strongly suggest building the Python bindings 
with the numpy dependency, and make it a run-time one as well.


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From andrew.bell.ia at gmail.com  Wed May 22 09:35:54 2024
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Wed, 22 May 2024 12:35:54 -0400
Subject: [gdal-dev] Threading and Datasets
Message-ID: <CACJ51z00-kV1z3RLqZv0T9FDGE4RKa6eCPXucrWUfK-2xNm94g@mail.gmail.com>

Hi,

Are there any issues with opening the same input multiple times as distinct
datasets so that simultaneous read access can be done by threads?

Thanks,

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240522/4f76853d/attachment.htm>

From jesse.r.meyer at nasa.gov  Wed May 22 09:37:12 2024
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Wed, 22 May 2024 16:37:12 +0000
Subject: [gdal-dev] [EXTERNAL] [BULK]  Threading and Datasets
In-Reply-To: <CACJ51z00-kV1z3RLqZv0T9FDGE4RKa6eCPXucrWUfK-2xNm94g@mail.gmail.com>
References: <CACJ51z00-kV1z3RLqZv0T9FDGE4RKa6eCPXucrWUfK-2xNm94g@mail.gmail.com>
Message-ID: <MN2PR09MB5932D608B5EEB756488A4EC1C9EB2@MN2PR09MB5932.namprd09.prod.outlook.com>

That?s how I?ve always done it and so far without problems.

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Andrew Bell via gdal-dev <gdal-dev at lists.osgeo.org>
Date: Wednesday, May 22, 2024 at 12:36?PM
To: gdal dev <gdal-dev at lists.osgeo.org>
Subject: [EXTERNAL] [BULK] [gdal-dev] Threading and Datasets
CAUTION: This email originated from outside of NASA.  Please take care when clicking links or opening attachments.  Use the "Report Message" button to report suspicious messages to the NASA SOC.


Hi,

Are there any issues with opening the same input multiple times as distinct datasets so that simultaneous read access can be done by threads?

Thanks,

--
Andrew Bell
andrew.bell.ia at gmail.com<mailto:andrew.bell.ia at gmail.com>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240522/7b2be388/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Wed May 22 10:09:15 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 22 May 2024 17:09:15 +0000
Subject: [gdal-dev] Gdal_grid produces a lot of empty cells
In-Reply-To: <CAHNf2YSnvx5B-h4kVooYykySw4yPppotqvZnC0CDj46ERukAzw@mail.gmail.com>
References: <CAHNf2YSWAO5ndfN0iLqF_0Dr9CLrcymwRdvFEAqtzO5sxbLeXw@mail.gmail.com>
 <DB9PR09MB6887347C37D9E386A98F3AE1FDEB2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAHNf2YSnvx5B-h4kVooYykySw4yPppotqvZnC0CDj46ERukAzw@mail.gmail.com>
Message-ID: <DB9PR09MB68874F26CF6E7CBAF746B665FDEB2@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

I do not know what happens, but it seems that the algorithm finds rather few points within the search ellipse. The radius of the circle is 40 m and by looking at the data there are typically at least 30 points within that distance. However, for filling the whole raster I had to use "min_points=4".
I could repeat the behavior by opening the 3857 data into QGIS and running the invdist from there. And when I reprojected the point data into EPSG:32634 then QGIS created a good gridded raster. The difference in scale between EPSG:3857 and EPSG:32634 is not so big in Poland that it could be the reason IMHO.
For removing possible errors due to CSV format and VRT I materialized the datasets into OpenJUMP JML format. It could have been any other GIS format.

Unfortunately I cannot help you more. If I were a programmer I think I would try to catch how many points the algorithm finds within the search radius in EPSG:3857, compare how many points it finds from EPSG:32634 data, and finally consider if the results make sense.

-Jukka Rahkonen-



L?hett?j?: Paul Meems <bontepaarden at gmail.c
L?hetetty: keskiviikko 22. toukokuuta 2024 18.24
Vastaanottaja: gdal-dev at lists.osgeo.org
Kopio: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: Re: [gdal-dev] Gdal_grid produces a lot of empty cells

Sorry Jukka,

Forgot all about that ;)

I've attached the csv from the field in Poland with the original lon-lat values and the X and Y in EPSG:3857

Op wo 22 mei 2024 om 16:57 schreef Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>:
Hi,

At least I cannot resolve your issue on paper. Please share some test data.

-Jukka-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Paul Meems via gdal-dev
L?hetetty: keskiviikko 22. toukokuuta 2024 17.31
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] Gdal_grid produces a lot of empty cells

Hello List,

I have a CSV-file with sensor data and GPS coordinates in WGS84.
I convert these GPS coordinates to a projected projection. Mostly a UTM zone, depending on the location.
These X and Y values are added to the CSV-file and saved with a different name.
Then I create a VRT-file to get the proper Z-column:
<OGRVRTDataSource>
    <OGRVRTLayer name="01 field data-EPSG32634">
        <SrcDataSource>01 field data-EPSG32634.csv</SrcDataSource>
        <GeometryType>wkbPoint</GeometryType>
        <GeometryField encoding="PointFromColumns" x="X" y="Y" z="Countrate"/>
    </OGRVRTLayer>
</OGRVRTDataSource>

This VRT file is sent to Gdal_grid to create a tiff-file using these arguments:
-a invdist:power=2:
   smoothing=20:
   min_points=16:
   max_points=56:
   radius1=40:
   radius2=40:
   nodata=1.701410000000000071e+38
-txe 273360 274940
-tye 5559440 5561020
-tr 12.5 12.5
-a_srs EPSG:32634
"01 field data-EPSG32634-TC.vrt" "tmpmrmq4d.tiff"

This tiff-file looks like this: https://pasteboard.co/tKP1ZJ1cAY2r.png

This process works fine and we've been using this for several years now.

Recently we added a process step to export one of the sensor data to a PostGIS database and with the help of Geoserver and OpenLayers we've created a very simple webpage.
In this step, things are getting weird. The WebMap is in EPSG:3857 (Pseudo/Web-Mercator).
I start with the original CSV-file with the sensor data and add the X and Y columns again, now in EPSG:3857. Then I create a similar vrt-file:
<OGRVRTDataSource>
    <OGRVRTLayer name="01 field data-EPSG3857">
        <SrcDataSource>01 field data-EPSG3857.csv</SrcDataSource>
        <GeometryType>wkbPoint</GeometryType>
        <GeometryField encoding="PointFromColumns" x="X" y="Y" z="Countrate"/>
    </OGRVRTLayer>
</OGRVRTDataSource>

And call gdal_grid with similar arguments:
-a invdist:power=2:
   smoothing=20:
   min_points=16:
   max_points=56:
   radius1=40:
   radius2=40:
   nodata=1.701410000000000071e+38
-txe 1984580 1987000
-tye 6471320 6473740
-tr 12.5 12.5
-a_srs EPSG:3857
"01 field data-EPSG3857-TC.vrt" "tmpun25fo.tiff"

But now the result is: https://pasteboard.co/bcMp7rP5eyff.png

A huge amount of empty cells. I don't understand this.
Both EPSG:32634 (WGS 84 / UTM zone 34N) and EPSG:3857 are in meters so I thought the same settings should work.
But in fact only with very different settings I can get a proper grid:
 -a invdist:power=2:
   smoothing=60:
   min_points=4:
   max_points=56:
   radius1=80:
   radius2=80:
   nodata=1.701410000000000071e+38
-txe 1984580 1987000
-tye 6471320 6473740
-tr 20 20
-a_srs EPSG:3857
"01 field data-EPSG3857-TC.vrt" "tmpsvlhgy.tiff"

I got these values through trial and error.
https://pasteboard.co/7pypGsynS09K.png

But now we loose a lot of variation because the search radius and grid cell size are much higher.

To make it even more weird. Other fields nearby don't have this problem and I also have this problem with other projections like:

Belgium (EPSG:3857): https://pasteboard.co/ZXLTsEuvpZ3s.png
Belgium (EPSG:31370): https://pasteboard.co/yNpF6yujF3tV.png

The Netherlands (EPSG:3857): https://pasteboard.co/8PpDJrDi1Wxq.png
The Netherlands (EPSG:28992): https://pasteboard.co/38SlnHVCog4m.png

Norway (EPSG:3857): https://pasteboard.co/q69jQHRK40c6.png
Norway (EPSG: 25833): https://pasteboard.co/gs9HNAmnaxSJ.png

We do have enough data points: https://pasteboard.co/4CmBs7kgQGVO.png
https://pasteboard.co/J8ZbMHKeErZu.png

Thanks if you made it all the way here ;)

My questions are:

  *   Am I using Gdal_Grid in the proper way or do I need to change one or more arguments?
  *   What might be an explanation for the empty cells when using EPSG:3857?

Thanks,

Paul Meems











-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240522/9e1516de/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Wed May 22 11:34:41 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 22 May 2024 18:34:41 +0000
Subject: [gdal-dev] Gdal_grid produces a lot of empty cells
In-Reply-To: <CAHNf2YSnvx5B-h4kVooYykySw4yPppotqvZnC0CDj46ERukAzw@mail.gmail.com>
References: <CAHNf2YSWAO5ndfN0iLqF_0Dr9CLrcymwRdvFEAqtzO5sxbLeXw@mail.gmail.com>
 <DB9PR09MB6887347C37D9E386A98F3AE1FDEB2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAHNf2YSnvx5B-h4kVooYykySw4yPppotqvZnC0CDj46ERukAzw@mail.gmail.com>
Message-ID: <DB9PR09MB6887BD0C659AC50D6B745471FDEB2@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

I forgot to say that I think it is not a good idea to use gdal_grid with EPSG:3857 at all. The scale of Web Mercator is correct only at the equator. In your data from Poland, if the real ellipsoidal distance between two points on the ground is 10 meters, the cartesian distance in EPSG:3857 claims that the distance is 15 meters. I think it would be better to compute the grid in a CRS that has approximately correct scale, and re-project the raster into Web Mercator if needed. That said, perhaps there is a bug in the gdal_grid utility.

-Jukka Rahkonen-


L?hett?j?: Paul Meems <bontepaarden at gmail.com>
L?hetetty: keskiviikko 22. toukokuuta 2024 18.24
Vastaanottaja: gdal-dev at lists.osgeo.org
Kopio: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Aihe: Re: [gdal-dev] Gdal_grid produces a lot of empty cells

Sorry Jukka,

Forgot all about that ;)

I've attached the csv from the field in Poland with the original lon-lat values and the X and Y in EPSG:3857

Op wo 22 mei 2024 om 16:57 schreef Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>:
Hi,

At least I cannot resolve your issue on paper. Please share some test data.

-Jukka-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Paul Meems via gdal-dev
L?hetetty: keskiviikko 22. toukokuuta 2024 17.31
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] Gdal_grid produces a lot of empty cells

Hello List,

I have a CSV-file with sensor data and GPS coordinates in WGS84.
I convert these GPS coordinates to a projected projection. Mostly a UTM zone, depending on the location.
These X and Y values are added to the CSV-file and saved with a different name.
Then I create a VRT-file to get the proper Z-column:
<OGRVRTDataSource>
    <OGRVRTLayer name="01 field data-EPSG32634">
        <SrcDataSource>01 field data-EPSG32634.csv</SrcDataSource>
        <GeometryType>wkbPoint</GeometryType>
        <GeometryField encoding="PointFromColumns" x="X" y="Y" z="Countrate"/>
    </OGRVRTLayer>
</OGRVRTDataSource>

This VRT file is sent to Gdal_grid to create a tiff-file using these arguments:
-a invdist:power=2:
   smoothing=20:
   min_points=16:
   max_points=56:
   radius1=40:
   radius2=40:
   nodata=1.701410000000000071e+38
-txe 273360 274940
-tye 5559440 5561020
-tr 12.5 12.5
-a_srs EPSG:32634
"01 field data-EPSG32634-TC.vrt" "tmpmrmq4d.tiff"

This tiff-file looks like this: https://pasteboard.co/tKP1ZJ1cAY2r.png

This process works fine and we've been using this for several years now.

Recently we added a process step to export one of the sensor data to a PostGIS database and with the help of Geoserver and OpenLayers we've created a very simple webpage.
In this step, things are getting weird. The WebMap is in EPSG:3857 (Pseudo/Web-Mercator).
I start with the original CSV-file with the sensor data and add the X and Y columns again, now in EPSG:3857. Then I create a similar vrt-file:
<OGRVRTDataSource>
    <OGRVRTLayer name="01 field data-EPSG3857">
        <SrcDataSource>01 field data-EPSG3857.csv</SrcDataSource>
        <GeometryType>wkbPoint</GeometryType>
        <GeometryField encoding="PointFromColumns" x="X" y="Y" z="Countrate"/>
    </OGRVRTLayer>
</OGRVRTDataSource>

And call gdal_grid with similar arguments:
-a invdist:power=2:
   smoothing=20:
   min_points=16:
   max_points=56:
   radius1=40:
   radius2=40:
   nodata=1.701410000000000071e+38
-txe 1984580 1987000
-tye 6471320 6473740
-tr 12.5 12.5
-a_srs EPSG:3857
"01 field data-EPSG3857-TC.vrt" "tmpun25fo.tiff"

But now the result is: https://pasteboard.co/bcMp7rP5eyff.png

A huge amount of empty cells. I don't understand this.
Both EPSG:32634 (WGS 84 / UTM zone 34N) and EPSG:3857 are in meters so I thought the same settings should work.
But in fact only with very different settings I can get a proper grid:
 -a invdist:power=2:
   smoothing=60:
   min_points=4:
   max_points=56:
   radius1=80:
   radius2=80:
   nodata=1.701410000000000071e+38
-txe 1984580 1987000
-tye 6471320 6473740
-tr 20 20
-a_srs EPSG:3857
"01 field data-EPSG3857-TC.vrt" "tmpsvlhgy.tiff"

I got these values through trial and error.
https://pasteboard.co/7pypGsynS09K.png

But now we loose a lot of variation because the search radius and grid cell size are much higher.

To make it even more weird. Other fields nearby don't have this problem and I also have this problem with other projections like:

Belgium (EPSG:3857): https://pasteboard.co/ZXLTsEuvpZ3s.png
Belgium (EPSG:31370): https://pasteboard.co/yNpF6yujF3tV.png

The Netherlands (EPSG:3857): https://pasteboard.co/8PpDJrDi1Wxq.png
The Netherlands (EPSG:28992): https://pasteboard.co/38SlnHVCog4m.png

Norway (EPSG:3857): https://pasteboard.co/q69jQHRK40c6.png
Norway (EPSG: 25833): https://pasteboard.co/gs9HNAmnaxSJ.png

We do have enough data points: https://pasteboard.co/4CmBs7kgQGVO.png
https://pasteboard.co/J8ZbMHKeErZu.png

Thanks if you made it all the way here ;)

My questions are:

  *   Am I using Gdal_Grid in the proper way or do I need to change one or more arguments?
  *   What might be an explanation for the empty cells when using EPSG:3857?

Thanks,

Paul Meems











-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240522/5407685e/attachment-0001.htm>

From even.rouault at spatialys.com  Thu May 23 07:04:30 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 23 May 2024 16:04:30 +0200
Subject: [gdal-dev] libgeotiff 1.7.2 is released
Message-ID: <89360930-e792-441c-ac84-29e75b660519@spatialys.com>

Hi,

Source packages can be found at:

https://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.2.tar.gz
https://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.2.zip

News is:

* GTIFGetDatumInfoEx(): handle dynamic datums
* CMake: adopt GNUInstallDirs
* CMake: export TIFF as a public dependency
* Add XTIFFClientOpenExt() with re-entrant error callbacks
* listgeo: add a -no_corners option to avoid printing corner
 ? coordinates which might be PROJ version sensitive (refs #81)
* Fix test failures with PROJ 9.1.1 and 9.3
* Remove trailing spaces from many files.
* Localize variables and add const when possible in a number of files
* geo_normalize.c: sprintf --> snprintf
* Add missing includes
* Fix -Werror=calloc-transposed-args with gcc 14
* FindPROJ.cmake: proj_experimental;h -> proj_experimental.h
* CMake: add a BUILD_SHARED_LIBS option, and make it default to ON
* autoconf/CMake: add generation of libgeotiff.pc
* Remove INSTALL and install-sh autoconf-generated files

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From oscarc at hiltonsoftware.com  Thu May 23 14:25:22 2024
From: oscarc at hiltonsoftware.com (Oscar Calderon)
Date: Thu, 23 May 2024 21:25:22 +0000
Subject: [gdal-dev] Using simple ogr2ogr line commands from C# code or
 another language
Message-ID: <IA1P223MB05229910702F9DE97FAA5D5CADF42@IA1P223MB0522.NAMP223.PROD.OUTLOOK.COM>

Hello,
I'm trying to execute these commands from my C# code:

ogr2ogr file1.shp file2.shp

ogr2ogr -update -append filex.shp  filey.shp

ogr2ogr -f GPKG -skipfailures -dialect sqlite -nln xxx file_whatever.gpkg file_whatever.shp

ogr2ogr -sql "sql query" file1.gpkg file2.gpkg

Basically, I'm combining two shapefiles in one, converting the combined file to geo package (gpkg) and then executing some sql queries on this gpkg.

To accomplish this, I've been using Process and ProcessStartInfo (executing a command line from my code), but I want to use the API.
Could someone help me to find the proper documentation or explain how this is done?

Thank you
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240523/fe15c960/attachment.htm>

From even.rouault at spatialys.com  Fri May 24 06:46:16 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 24 May 2024 15:46:16 +0200
Subject: [gdal-dev] libgeotiff 1.7.3 is released
Message-ID: <052102f2-ae4b-40b2-ae1c-edb565fe4dd2@spatialys.com>

Hi,

Follow-up release of 1.7.2 to address a regression with CMake builds 
related to a typo in CMAKE_INSTALL_BINDIR install target that affects 
location of geotiff.dll (#117)

Source packages can be found at:

https://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.3.tar.gz
https://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.7.3.zip

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From michkowalczuk at gmail.com  Tue May 28 23:07:44 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Wed, 29 May 2024 08:07:44 +0200
Subject: [gdal-dev] GDAL WMTS get tiles no documentation
Message-ID: <CAP+FqQCGCFEbEbU1m-DHN1cDdMjBrmWTOGY_uzEqPbwZHr5wnQ@mail.gmail.com>

Hi GDAL fellows
This is my first post on this mailing list, so I'm asking for understanding.

As all we know the purpose of using WMTS over WMS, I'd like to implement
parallel downloading tiles from service using C API.
In my opinion GDAL documentation (https://gdal.org/drivers/raster/wmts.html)
says nothing on this topic.
I can get capabilities from WMTS, I can open the selected subdataset but
how to get tiles for given extent? I could not find any information how to
do it, even in the GDAL tests on github.

I am kindly asking for tips. It also can be in python. How using pure GDAL
API fetch tiles to dynamically complete the displayed map. This is my goal.

Thank you!
Michal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240529/9b227404/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Tue May 28 23:59:52 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 29 May 2024 06:59:52 +0000
Subject: [gdal-dev] GDAL WMTS get tiles no documentation
In-Reply-To: <CAP+FqQCGCFEbEbU1m-DHN1cDdMjBrmWTOGY_uzEqPbwZHr5wnQ@mail.gmail.com>
References: <CAP+FqQCGCFEbEbU1m-DHN1cDdMjBrmWTOGY_uzEqPbwZHr5wnQ@mail.gmail.com>
Message-ID: <DB9PR09MB68875076F2AE985E1A3019F4FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

When you have a RasterBand  from the WMTS data source, it is abstracted and you can read the raster data just like from any other data source and raster band https://gdal.org/tutorials/raster_api_tut.html#reading-raster-data "There are a few ways to read raster data, but the most common is via the GDALRasterBand::RasterIO() method. This method will automatically take care of data type conversion, up/down sampling and windowing." GDAL knows which tiles to read.

I do not know if the WMTS driver can do parallel tile downloads. If not, it is possible to run many RasterIO() at the same time, each reading data from a different window like in this rasterio document https://rasterio.readthedocs.io/en/latest/topics/concurrency.html.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Michal Kowalczuk via gdal-dev
L?hetetty: keskiviikko 29. toukokuuta 2024 9.08
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] GDAL WMTS get tiles no documentation

Hi GDAL fellows
This is my first post on this mailing list, so I'm asking for understanding.

As all we know the purpose of using WMTS over WMS, I'd like to implement parallel downloading tiles from service using C API.
In my opinion GDAL documentation (https://gdal.org/drivers/raster/wmts.html) says nothing on this topic.
I can get capabilities from WMTS, I can open the selected subdataset but how to get tiles for given extent? I could not find any information how to do it, even in the GDAL tests on github.

I am kindly asking for tips. It also can be in python. How using pure GDAL API fetch tiles to dynamically complete the displayed map. This is my goal.

Thank you!
Michal
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240529/809da13b/attachment.htm>

From j1 at jimenezshaw.com  Wed May 29 00:40:39 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Wed, 29 May 2024 09:40:39 +0200
Subject: [gdal-dev] GDAL WMTS get tiles no documentation
In-Reply-To: <DB9PR09MB68875076F2AE985E1A3019F4FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <CAP+FqQCGCFEbEbU1m-DHN1cDdMjBrmWTOGY_uzEqPbwZHr5wnQ@mail.gmail.com>
 <DB9PR09MB68875076F2AE985E1A3019F4FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <CADRrdKsqo4jvfbmOqRyuSuHMk3wJ9Xbp_kv01LpxVQpDmGA6BA@mail.gmail.com>

On Wed, 29 May 2024 at 08:59, Rahkonen Jukka via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
>
>
> When you have a RasterBand  from the WMTS data source, it is abstracted
> and you can read the raster data just like from any other data source and
> raster band
> https://gdal.org/tutorials/raster_api_tut.html#reading-raster-data ?There
> are a few ways to read raster data, but the most common is via the
> GDALRasterBand::RasterIO() method. This method will automatically take care
> of data type conversion, up/down sampling and windowing.? GDAL knows which
> tiles to read.
>
>
>
> I do not know if the WMTS driver can do parallel tile downloads. If not,
> it is possible to run many RasterIO() at the same time, each reading data
> from a different window like in this rasterio document
> https://rasterio.readthedocs.io/en/latest/topics/concurrency.html.
>

Jukka, are you sure you can run several RasterIO in parallel (on the same
dataset)? in GDAL GeoTIFF you cannot: the cache may be corrupted. In that
case I open several datasets over the same file. I do not know about WMTS.


>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Michal
> Kowalczuk via gdal-dev
> *L?hetetty:* keskiviikko 29. toukokuuta 2024 9.08
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] GDAL WMTS get tiles no documentation
>
>
>
> Hi GDAL fellows
>
> This is my first post on this mailing list, so I'm asking for
> understanding.
>
>
>
> As all we know the purpose of using WMTS over WMS, I'd like to implement
> parallel downloading tiles from service using C API.
>
> In my opinion GDAL documentation (
> https://gdal.org/drivers/raster/wmts.html) says nothing on this topic.
>
> I can get capabilities from WMTS, I can open the selected subdataset but
> how to get tiles for given extent? I could not find any information how to
> do it, even in the GDAL tests on github.
>
>
>
> I am kindly asking for tips. It also can be in python. How using pure GDAL
> API fetch tiles to dynamically complete the displayed map. This is my goal.
>
>
>
> Thank you!
>
> Michal
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240529/0da1c1fd/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Wed May 29 01:03:49 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Wed, 29 May 2024 08:03:49 +0000
Subject: [gdal-dev] GDAL WMTS get tiles no documentation
In-Reply-To: <CADRrdKsqo4jvfbmOqRyuSuHMk3wJ9Xbp_kv01LpxVQpDmGA6BA@mail.gmail.com>
References: <CAP+FqQCGCFEbEbU1m-DHN1cDdMjBrmWTOGY_uzEqPbwZHr5wnQ@mail.gmail.com>
 <DB9PR09MB68875076F2AE985E1A3019F4FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CADRrdKsqo4jvfbmOqRyuSuHMk3wJ9Xbp_kv01LpxVQpDmGA6BA@mail.gmail.com>
Message-ID: <DB9PR09MB6887F77517160F33E7601276FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

No, I am not sure because I do not program myself. Reading this document https://gdal.org/user/multithreading.html makes me feel that it is possible to do some things in parallel, but the programmer must know how to do it right.

-Jukka Rahkonen-

L?hett?j?: Javier Jimenez Shaw <j1 at jimenezshaw.com>
L?hetetty: keskiviikko 29. toukokuuta 2024 10.41
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: Micha? Kowalczuk <michkowalczuk at gmail.com>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] GDAL WMTS get tiles no documentation



On Wed, 29 May 2024 at 08:59, Rahkonen Jukka via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
Hi,

When you have a RasterBand  from the WMTS data source, it is abstracted and you can read the raster data just like from any other data source and raster band https://gdal.org/tutorials/raster_api_tut.html#reading-raster-data "There are a few ways to read raster data, but the most common is via the GDALRasterBand::RasterIO() method. This method will automatically take care of data type conversion, up/down sampling and windowing." GDAL knows which tiles to read.

I do not know if the WMTS driver can do parallel tile downloads. If not, it is possible to run many RasterIO() at the same time, each reading data from a different window like in this rasterio document https://rasterio.readthedocs.io/en/latest/topics/concurrency.html.

Jukka, are you sure you can run several RasterIO in parallel (on the same dataset)? in GDAL GeoTIFF you cannot: the cache may be corrupted. In that case I open several datasets over the same file. I do not know about WMTS.


-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Michal Kowalczuk via gdal-dev
L?hetetty: keskiviikko 29. toukokuuta 2024 9.08
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] GDAL WMTS get tiles no documentation

Hi GDAL fellows
This is my first post on this mailing list, so I'm asking for understanding.

As all we know the purpose of using WMTS over WMS, I'd like to implement parallel downloading tiles from service using C API.
In my opinion GDAL documentation (https://gdal.org/drivers/raster/wmts.html) says nothing on this topic.
I can get capabilities from WMTS, I can open the selected subdataset but how to get tiles for given extent? I could not find any information how to do it, even in the GDAL tests on github.

I am kindly asking for tips. It also can be in python. How using pure GDAL API fetch tiles to dynamically complete the displayed map. This is my goal.

Thank you!
Michal
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240529/2d239a62/attachment.htm>

From michkowalczuk at gmail.com  Wed May 29 01:14:14 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Wed, 29 May 2024 10:14:14 +0200
Subject: [gdal-dev] GDAL WMTS get tiles no documentation
In-Reply-To: <DB9PR09MB6887F77517160F33E7601276FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <CAP+FqQCGCFEbEbU1m-DHN1cDdMjBrmWTOGY_uzEqPbwZHr5wnQ@mail.gmail.com>
 <DB9PR09MB68875076F2AE985E1A3019F4FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CADRrdKsqo4jvfbmOqRyuSuHMk3wJ9Xbp_kv01LpxVQpDmGA6BA@mail.gmail.com>
 <DB9PR09MB6887F77517160F33E7601276FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <CAP+FqQByOka92rtC94P7+6yTLEK5aoSmcfPjxorHkx=AygPLoA@mail.gmail.com>

Because this is not clear in documentation, especially in WMTS driver docs,
my question is strictly about this issue to programmers who have already
explored this topic.

Regards
Michal

W dniu ?r., 29.05.2024 o 10:04 Rahkonen Jukka <
jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):

> Hi,
>
>
>
> No, I am not sure because I do not program myself. Reading this document
> https://gdal.org/user/multithreading.html makes me feel that it is
> possible to do some things in parallel, but the programmer must know how to
> do it right.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Javier Jimenez Shaw <j1 at jimenezshaw.com>
> *L?hetetty:* keskiviikko 29. toukokuuta 2024 10.41
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* Micha? Kowalczuk <michkowalczuk at gmail.com>;
> gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] GDAL WMTS get tiles no documentation
>
>
>
>
>
>
>
> On Wed, 29 May 2024 at 08:59, Rahkonen Jukka via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
> Hi,
>
>
>
> When you have a RasterBand  from the WMTS data source, it is abstracted
> and you can read the raster data just like from any other data source and
> raster band
> https://gdal.org/tutorials/raster_api_tut.html#reading-raster-data ?There
> are a few ways to read raster data, but the most common is via the
> GDALRasterBand::RasterIO() method. This method will automatically take care
> of data type conversion, up/down sampling and windowing.? GDAL knows which
> tiles to read.
>
>
>
> I do not know if the WMTS driver can do parallel tile downloads. If not,
> it is possible to run many RasterIO() at the same time, each reading data
> from a different window like in this rasterio document
> https://rasterio.readthedocs.io/en/latest/topics/concurrency.html.
>
>
>
> Jukka, are you sure you can run several RasterIO in parallel (on the same
> dataset)? in GDAL GeoTIFF you cannot: the cache may be corrupted. In that
> case I open several datasets over the same file. I do not know about WMTS.
>
>
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Michal
> Kowalczuk via gdal-dev
> *L?hetetty:* keskiviikko 29. toukokuuta 2024 9.08
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] GDAL WMTS get tiles no documentation
>
>
>
> Hi GDAL fellows
>
> This is my first post on this mailing list, so I'm asking for
> understanding.
>
>
>
> As all we know the purpose of using WMTS over WMS, I'd like to implement
> parallel downloading tiles from service using C API.
>
> In my opinion GDAL documentation (
> https://gdal.org/drivers/raster/wmts.html) says nothing on this topic.
>
> I can get capabilities from WMTS, I can open the selected subdataset but
> how to get tiles for given extent? I could not find any information how to
> do it, even in the GDAL tests on github.
>
>
>
> I am kindly asking for tips. It also can be in python. How using pure GDAL
> API fetch tiles to dynamically complete the displayed map. This is my goal.
>
>
>
> Thank you!
>
> Michal
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240529/9a97fc54/attachment-0001.htm>

From even.rouault at spatialys.com  Wed May 29 03:41:32 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 29 May 2024 12:41:32 +0200
Subject: [gdal-dev] GDAL WMTS get tiles no documentation
In-Reply-To: <CAP+FqQByOka92rtC94P7+6yTLEK5aoSmcfPjxorHkx=AygPLoA@mail.gmail.com>
References: <CAP+FqQCGCFEbEbU1m-DHN1cDdMjBrmWTOGY_uzEqPbwZHr5wnQ@mail.gmail.com>
 <DB9PR09MB68875076F2AE985E1A3019F4FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CADRrdKsqo4jvfbmOqRyuSuHMk3wJ9Xbp_kv01LpxVQpDmGA6BA@mail.gmail.com>
 <DB9PR09MB6887F77517160F33E7601276FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQByOka92rtC94P7+6yTLEK5aoSmcfPjxorHkx=AygPLoA@mail.gmail.com>
Message-ID: <82989a4b-d3ed-4711-b9cb-7f83b8705acf@spatialys.com>

Hi,

The WMS cache (which is used underneath by the WMTS driver) writes each 
tiles in a separate file. So if you use multi-threaded, as long as you 
read in parallel different GDALDataset* object on the WMTS filename, and 
read disjoint areas, that should be fine. There might be a slight risk 
of things going bad if you happened to read the same tile from different 
GDALDataset* object at the same time, as it could potentially read a 
partially written cached tile, or concurrently write the tile in the 
cache and corrupt it. The logic is in frmts/wms/gdalwmscache.cpp

Even

Le 29/05/2024 ? 10:14, Micha? Kowalczuk via gdal-dev a ?crit?:
> Because this is not clear in documentation, especially in WMTS driver 
> docs, my question is strictly about this issue to programmers who have 
> already explored this topic.
>
> Regards
> Michal
>
> W dniu ?r., 29.05.2024 o 10:04 Rahkonen Jukka 
> <jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
>     Hi,
>
>     No, I am not sure because I do not program myself. Reading this
>     document https://gdal.org/user/multithreading.html makes me feel
>     that it is possible to do some things in parallel, but the
>     programmer must know how to do it right.
>
>     -Jukka Rahkonen-
>
>     *L?hett?j?:*Javier Jimenez Shaw <j1 at jimenezshaw.com>
>     *L?hetetty:* keskiviikko 29. toukokuuta 2024 10.41
>     *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
>     *Kopio:* Micha? Kowalczuk <michkowalczuk at gmail.com>;
>     gdal-dev at lists.osgeo.org
>     *Aihe:* Re: [gdal-dev] GDAL WMTS get tiles no documentation
>
>     On Wed, 29 May 2024 at 08:59, Rahkonen Jukka via gdal-dev
>     <gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>> wrote:
>
>         Hi,
>
>         When you have a RasterBand ?from the WMTS data source, it is
>         abstracted and you can read the raster data just like from any
>         other data source and raster band
>         https://gdal.org/tutorials/raster_api_tut.html#reading-raster-data
>         <https://gdal.org/tutorials/raster_api_tut.html#reading-raster-data>?There
>         are a few ways to read raster data, but the most common is via
>         the GDALRasterBand::RasterIO() method. This method will
>         automatically take care of data type conversion, up/down
>         sampling and windowing.? GDAL knows which tiles to read.
>
>         I do not know if the WMTS driver can do parallel tile
>         downloads. If not, it is possible to run many RasterIO() at
>         the same time, each reading data from a different window like
>         in this rasterio document
>         https://rasterio.readthedocs.io/en/latest/topics/concurrency.html
>         <https://rasterio.readthedocs.io/en/latest/topics/concurrency.html>.
>
>     Jukka, are you sure you can run several RasterIO in parallel (on
>     the same dataset)? in GDAL GeoTIFF you cannot: the cache may be
>     corrupted. In that case I open several datasets over the same
>     file. I do not know about WMTS.
>
>         -Jukka Rahkonen-
>
>         *L?hett?j?:*gdal-dev <gdal-dev-bounces at lists.osgeo.org
>         <mailto:gdal-dev-bounces at lists.osgeo.org>> *Puolesta *Michal
>         Kowalczuk via gdal-dev
>         *L?hetetty:* keskiviikko 29. toukokuuta 2024 9.08
>         *Vastaanottaja:* gdal-dev at lists.osgeo.org
>         <mailto:gdal-dev at lists.osgeo.org>
>         *Aihe:* [gdal-dev] GDAL WMTS get tiles no documentation
>
>         Hi GDAL fellows
>
>         This is my first post on this mailing list, so I'm asking for
>         understanding.
>
>         As all we know the purpose of using WMTS over WMS, I'd like to
>         implement parallel downloading tiles from service using C API.
>
>         In my opinion GDAL documentation
>         (https://gdal.org/drivers/raster/wmts.html
>         <https://gdal.org/drivers/raster/wmts.html>) says nothing on
>         this topic.
>
>         I can get capabilities from WMTS, I can open the selected
>         subdataset but how to get tiles for given extent? I could not
>         find any information how to do it, even in the GDAL tests on
>         github.
>
>         I am kindly asking for tips. It also can be in python. How
>         using pure GDAL API fetch tiles to dynamically complete the
>         displayed map. This is my goal.
>
>         Thank you!
>
>         Michal
>
>         _______________________________________________
>         gdal-dev mailing list
>         gdal-dev at lists.osgeo.org <mailto:gdal-dev at lists.osgeo.org>
>         https://lists.osgeo.org/mailman/listinfo/gdal-dev
>         <https://lists.osgeo.org/mailman/listinfo/gdal-dev>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240529/0403cc46/attachment.htm>

From even.rouault at spatialys.com  Wed May 29 13:57:09 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 29 May 2024 22:57:09 +0200
Subject: [gdal-dev] RFC 96 adjustment: Re: Call for review and discussion on
 RFC96: Deferred in-tree C++ plugin loading
In-Reply-To: <7004463d-3e6e-4084-a87b-1d66b8fc218f@spatialys.com>
References: <7004463d-3e6e-4084-a87b-1d66b8fc218f@spatialys.com>
Message-ID: <db7aca20-4602-43d4-8f9e-3d943da29d64@spatialys.com>

Hi,

I just wanted to point that a shortcoming of RFC 96 
(https://gdal.org/development/rfc/rfc96_deferred_plugin_loading.html) 
was discovered. https://github.com/OSGeo/gdal/pull/10068 will address 
it. Please refer to it for the details.

This PR is aimed at being backported for 3.9.1. Pedantically this will 
be an ABI change (between in-tree drivers built as plugins and core), 
although I suspect that it shouldn't be noticed for most 
use&distribution scenarios. Not clear if that's worth a SONAME bump for 
3.9.1, or if that would be more an annoyance.

Even

Le 02/11/2023 ? 12:59, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> I'm seeking for feedback and review on a new RFC (RFC 96: Deferred 
> in-tree C++ plugin loading),
> detailed in https://github.com/OSGeo/gdal/pull/8648, whose summary is:
>
> This RFC adds a mechanism to defer the loading of in-tree C++ plugin 
> drivers to
> the point where their executable code is actually needed, and converts 
> a number
> of relevant drivers to use that mechanism. The aim is to allow for 
> more modular
> GDAL builds, while improving the performance of plugin loading.
>
> (This is material only for GDAL 3.9 of course)
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From mdsumner at gmail.com  Wed May 29 23:12:37 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 30 May 2024 16:12:37 +1000
Subject: [gdal-dev] clear band level metadata
Message-ID: <CAAcGz99Bn_-9M7GT_M-2f+NKwFJC6aKrrWhSTZro+sm1PkPvGA@mail.gmail.com>

Hello, I have this process to convert a URL to a MEM dataset.

It's not the target data but it's representative, a netcdf with band-level
and dataset-level metadata. We can clear the dataset level with
COPY_SRC_MDD, but I can't see how to do that for the band level. We're
hoping to keep this  without generating files, the final step uses VSI to
read into a byte array.

Can I clear the band metadata without an intermediate dataset? Opening in
update mode breaks the COG layout (or is that ok to do this with
IGNORE_COG_LAYOUT_BREAK=YES ?).


from osgeo import gdal
gdal.UseExceptions()

dsn = "vrt:///vsicurl/
https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/202405/oisst-avhrr-v02r01.20240511.nc?sd_name=sst
"

opts = gdal.TranslateOptions(format = "COG",
     creationOptions = [ "COMPRESS=ZSTD", "PREDICTOR=STANDARD",
"RESAMPLING=AVERAGE",
     "SPARSE_OK=YES", "COPY_SRC_MDD=NO"])

ds = gdal.Open(dsn)
tmp = "/vsimem/tmp1.tif"
## here we lose the dataset-level metadata as desired with COPY_SRC_MDD
gdal.Translate(tmp, ds, options = opts)

## but the band metadata is still there
lds = gdal.Open(tmp)
#{'add_offset': '0', 'long_name': 'Daily sea surface temperature',
'NETCDF_DIM_time': '16932', 'NETCDF_DIM_zlev': '0', 'NETCDF_VARNAME':
'sst', 'scale_factor': '0.0099999998', 'units': 'Celsius', 'valid_max':
'4500', 'valid_min': '-300', '_FillValue': '-999'}
lds.Close()
ds.Close()



I guess I need to open and translate to another COG dataset after breaking
the COG layout?



## now open in rw, to zap band level md (but breaks COG layout)
#lds = gdal.OpenEx(tmp, gdal.GA_Update, open_options =
 ["IGNORE_COG_LAYOUT_BREAK=YES"])
#lds.GetRasterBand(1).SetMetadata({})
#lds.Close()
#Warning 1: tmp1.tif: The IFD has been rewritten at the end of the file,
which breaks COG layout.

ds = gdal.Open(tmp)
#Warning 1: tmp1.tif: This file used to have optimizations in its layout,
but those have been, at least partly, invalidated by later changes

Cheers, Mike




--
Michael Sumner
Research Software Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240530/37e21f19/attachment.htm>

From andrew at aitchison.me.uk  Thu May 30 06:43:03 2024
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Thu, 30 May 2024 14:43:03 +0100 (BST)
Subject: [gdal-dev] clang-format variation - just for info
Message-ID: <27dff3b6-b2ad-67ff-56de-2528aa32f0e9@aitchison.me.uk>


I don't think this affects any gdal code.

If you put a comment after an #else an #endif or "}"
(eg to aide finding the start of the block)
then clang-format v15 and v18 will rearrange the
whitespace differently.

Ubuntu Noble 24-04 ships v18.

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From howard at hobu.co  Thu May 30 08:22:38 2024
From: howard at hobu.co (Howard Butler)
Date: Thu, 30 May 2024 10:22:38 -0500
Subject: [gdal-dev] GDAL Maintainers Meeting Minutes
Message-ID: <306ED335-FC9E-4110-A030-D9F3EA69F643@hobu.co>

Howard Butler, Even Rouault, Dan Baston, Alessandro Pasotti, Javier Jimenez Shaw, and Michael Sumner held the monthly GDAL Maintainers Meeting on 05/23/2024. The following items were discussed and reported upon:

Discussion Items
----------------------------

* GDAL 3.9.0 was released on May 7th, 2024. A synopsis of the additions, changes, bug fixes, and enhancements is available from https://github.com/OSGeo/gdal/blob/release/3.9/NEWS.md
* GDAL 3.10 is expected to be the release number after 3.9. A release named 4.0 is being tabled until there are enough major items to warrant it.
* A discussion about re-homing various GDAL-related documentation activities and tutorials on places such as Stack Exchange took place. No action is expected, but if people wish to move content to GDAL's docs, PRs will definitely be considered. 
* Curve support is coming to GEOS and there was some discussion about possible impacts to OGR. One consideration is moving linearization of curves in from OGR to GEOS. This brought on discussion about whether or not to make GEOS a hard dependency of GDAL, but no action or decisions were considered.

Maintenance activities update
------------------------------------------

Dan

* Light activity.
* Enhancement of documentation on how to set various config options and substitutions
* Dan expects a funding extension to support efforts past August.

Alessandro

* PR reviews
* Continued adaptation of the argparse https://github.com/p-ranav/argparse argument parser to the rest of the GDAL and OGR utilities. To model GDAL's error handling, a PR was submitted to argparse to fix a validation scenario that GDAL depends upon. 
* Alessandro's activity is expected to be less over the next 3-4 months.

Even

* Documentation building improvements
  * Added CMake targets
  * Upgraded container that builds docs
* Typical PR and mailing list activities
* libgeotiff 1.7.2 (and 1.7.3) release https://github.com/OSGeo/libgeotiff/releases/tag/1.7.2 and https://github.com/OSGeo/libgeotiff/releases/tag/1.7.3 

Michael

* gdalraster for R

Javier

* Exploring enhancements to add a C API function inspired by code in the GDAL RPC DEM interpolator that can be used by gdallocationinfo

The next GDAL Maintainers Meeting is 06/27/2024 at 13:00 UTC. Any GDAL PR contributors are welcome to join by reaching out to me for an invite.

Howard

From jidanni at jidanni.org  Thu May 30 15:32:27 2024
From: jidanni at jidanni.org (Dan Jacobson)
Date: Fri, 31 May 2024 06:32:27 +0800
Subject: [gdal-dev] OGR SQL CAST geometry example
Message-ID: <87ed9jszgk.1.fsf@jidanni.org>

Hi. I will add an example to
https://gdal.org/user/ogr_sql_dialect.html#changing-the-type-of-the-fields
showing users how to e.g., CAST LINESTRING Z to POINTS Z, e.g.,
to extract the points from:
$ ogrinfo 0.lines.kml -q -sql 'SELECT "_ogr_geometry_" FROM "0"'
Layer name: 0
OGRFeature(0):1
  LINESTRING Z (-100.790056666679 36.3802233333333 1000,-100...
Alas, there are no examples I can find of how to write it.


From even.rouault at spatialys.com  Thu May 30 16:09:43 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 31 May 2024 01:09:43 +0200
Subject: [gdal-dev] OGR SQL CAST geometry example
In-Reply-To: <87ed9jszgk.1.fsf@jidanni.org>
References: <87ed9jszgk.1.fsf@jidanni.org>
Message-ID: <2e58a7b5-1953-485a-86d9-58427507ad28@spatialys.com>

Dan,

you can't do operations on geometries with OGR SQL, but selecting it. 
You'd typically need to use the ST_PointN() from Spatialite with the 
SQLite dialect

Even

Le 31/05/2024 ? 00:32, Dan Jacobson via gdal-dev a ?crit?:
> Hi. I will add an example to
> https://gdal.org/user/ogr_sql_dialect.html#changing-the-type-of-the-fields
> showing users how to e.g., CAST LINESTRING Z to POINTS Z, e.g.,
> to extract the points from:
> $ ogrinfo 0.lines.kml -q -sql 'SELECT "_ogr_geometry_" FROM "0"'
> Layer name: 0
> OGRFeature(0):1
>    LINESTRING Z (-100.790056666679 36.3802233333333 1000,-100...
> Alas, there are no examples I can find of how to write it.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jidanni at jidanni.org  Thu May 30 16:29:58 2024
From: jidanni at jidanni.org (Dan Jacobson)
Date: Fri, 31 May 2024 07:29:58 +0800
Subject: [gdal-dev] OGR SQL CAST geometry example
References: <87ed9jszgk.1.fsf@jidanni.org>
 <2e58a7b5-1953-485a-86d9-58427507ad28@spatialys.com>
Message-ID: <87ttiec1zd.3.fsf@jidanni.org>

>>>>> "ER" == Even Rouault <even.rouault at spatialys.com> writes:
ER> you can't do operations on geometries with OGR SQL...

OK, I'll try it. Thanks.
The page should still have an example of actual use of
  Casting ... POINT[Z], LINESTRING[Z]

Without examples people will try things like POINTZ, "POINTS[Z]"

From even.rouault at spatialys.com  Thu May 30 16:43:32 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 31 May 2024 01:43:32 +0200
Subject: [gdal-dev] OGR SQL CAST geometry example
In-Reply-To: <87ttiec1zd.3.fsf@jidanni.org>
References: <87ed9jszgk.1.fsf@jidanni.org>
 <2e58a7b5-1953-485a-86d9-58427507ad28@spatialys.com>
 <87ttiec1zd.3.fsf@jidanni.org>
Message-ID: <198c0d33-cd9d-46a0-93e4-3ef72b33c280@spatialys.com>

Ah, I misunderstood and thought you wanted to extract points from 
linestrings.

Given

$ cat test.csv
id,my_wkt
1,"POINT Z (1 2 3)"

you can do:

$ ogrinfo test.csv -sql "select id, cast(my_wkt as geometry(pointz, 
4326)) from test"
INFO: Open of `test.csv'
 ????? using driver `CSV' successful.

Layer name: test
Geometry: 3D Point
Feature Count: 1
Extent: (1.000000, 2.000000) - (1.000000, 2.000000)
Layer SRS WKT:
GEOGCRS["WGS 84",
 ??? ENSEMBLE["World Geodetic System 1984 ensemble",
 ??????? MEMBER["World Geodetic System 1984 (Transit)"],
 ??????? MEMBER["World Geodetic System 1984 (G730)"],
 ??????? MEMBER["World Geodetic System 1984 (G873)"],
 ??????? MEMBER["World Geodetic System 1984 (G1150)"],
 ??????? MEMBER["World Geodetic System 1984 (G1674)"],
 ??????? MEMBER["World Geodetic System 1984 (G1762)"],
 ??????? MEMBER["World Geodetic System 1984 (G2139)"],
 ??????? MEMBER["World Geodetic System 1984 (G2296)"],
 ??????? ELLIPSOID["WGS 84",6378137,298.257223563,
 ??????????? LENGTHUNIT["metre",1]],
 ??????? ENSEMBLEACCURACY[2.0]],
 ??? PRIMEM["Greenwich",0,
 ??????? ANGLEUNIT["degree",0.0174532925199433]],
 ??? CS[ellipsoidal,2],
 ??????? AXIS["geodetic latitude (Lat)",north,
 ??????????? ORDER[1],
 ??????????? ANGLEUNIT["degree",0.0174532925199433]],
 ??????? AXIS["geodetic longitude (Lon)",east,
 ??????????? ORDER[2],
 ??????????? ANGLEUNIT["degree",0.0174532925199433]],
 ??? USAGE[
 ??????? SCOPE["Horizontal component of 3D system."],
 ??????? AREA["World."],
 ??????? BBOX[-90,-180,90,180]],
 ??? ID["EPSG",4326]]
Data axis to CRS axis mapping: 2,1
Geometry Column = my_wkt
id: String (0.0)
OGRFeature(test):1
 ? id (String) = 1
 ? POINT Z (1 2 3)

Note that probably counterintuitively, if instead of pointz, you try to 
specify point (or even linestring), that will only affect the *declared* 
geometry column type, but will have no consequence on the actual feature 
geometry, and no consistency check is done to ensure they match? 
(contrary to PostGIS that is very strict, and would not even allow 
casting that POINT Z (1 2 3) as a geometry(point), but only a 
geometry(pointz))


Le 31/05/2024 ? 01:29, Dan Jacobson a ?crit?:
>>>>>> "ER" == Even Rouault <even.rouault at spatialys.com> writes:
> ER> you can't do operations on geometries with OGR SQL...
>
> OK, I'll try it. Thanks.
> The page should still have an example of actual use of
>    Casting ... POINT[Z], LINESTRING[Z]
>
> Without examples people will try things like POINTZ, "POINTS[Z]"

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jidanni at jidanni.org  Thu May 30 17:49:31 2024
From: jidanni at jidanni.org (Dan Jacobson)
Date: Fri, 31 May 2024 08:49:31 +0800
Subject: [gdal-dev] OGR SQL CAST geometry example
References: <87ed9jszgk.1.fsf@jidanni.org>
 <2e58a7b5-1953-485a-86d9-58427507ad28@spatialys.com>
 <87ttiec1zd.3.fsf@jidanni.org>
 <198c0d33-cd9d-46a0-93e4-3ef72b33c280@spatialys.com>
Message-ID: <87ikyu24bo.3.fsf@jidanni.org>

$ ogrinfo 0.lines.kml -q -dialect SQLITE -sql \
'SELECT ST_PointN(GEOMETRY, generate_series(1, ST_NPoints(GEOMETRY))) FROM "0"'
ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(....
  no such function: generate_series

From even.rouault at spatialys.com  Thu May 30 18:06:14 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 31 May 2024 03:06:14 +0200
Subject: [gdal-dev] OGR SQL CAST geometry example
In-Reply-To: <87ikyu24bo.3.fsf@jidanni.org>
References: <87ed9jszgk.1.fsf@jidanni.org>
 <2e58a7b5-1953-485a-86d9-58427507ad28@spatialys.com>
 <87ttiec1zd.3.fsf@jidanni.org>
 <198c0d33-cd9d-46a0-93e4-3ef72b33c280@spatialys.com>
 <87ikyu24bo.3.fsf@jidanni.org>
Message-ID: <139d10a1-311c-43bc-8282-7d6397937aa3@spatialys.com>

According to http://www3.sqlite.org/series.html, generate_series() is 
only built in the sqlite3 command line utility, not in the library 
itself. That said, with some work, the source at 
https://www.sqlite.org/src/file/ext/misc/series.c could potentially be 
embedded into libgdal

Le 31/05/2024 ? 02:49, Dan Jacobson a ?crit?:
> $ ogrinfo 0.lines.kml -q -dialect SQLITE -sql \
> 'SELECT ST_PointN(GEOMETRY, generate_series(1, ST_NPoints(GEOMETRY))) FROM "0"'
> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(....
>    no such function: generate_series

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From dbaston at gmail.com  Thu May 30 18:30:51 2024
From: dbaston at gmail.com (Daniel Baston)
Date: Thu, 30 May 2024 21:30:51 -0400
Subject: [gdal-dev] OGR SQL CAST geometry example
In-Reply-To: <87ikyu24bo.3.fsf@jidanni.org>
References: <87ed9jszgk.1.fsf@jidanni.org>
 <2e58a7b5-1953-485a-86d9-58427507ad28@spatialys.com>
 <87ttiec1zd.3.fsf@jidanni.org>
 <198c0d33-cd9d-46a0-93e4-3ef72b33c280@spatialys.com>
 <87ikyu24bo.3.fsf@jidanni.org>
Message-ID: <CA+K_q_pYdRwFZb=PN7GWzV0xRC_o44ge3YZ+2kNda2F3R+-NtA@mail.gmail.com>

If a single MULTIPOINT record is OK, then you can do

ogrinfo test.shp -q -dialect SQLITE -sql 'SELECT
ST_DissolvePoints(GEOMETRY) FROM test'

Dan


On Thu, May 30, 2024 at 8:49?PM Dan Jacobson via gdal-dev
<gdal-dev at lists.osgeo.org> wrote:
>
> $ ogrinfo 0.lines.kml -q -dialect SQLITE -sql \
> 'SELECT ST_PointN(GEOMETRY, generate_series(1, ST_NPoints(GEOMETRY))) FROM "0"'
> ERROR 1: In ExecuteSQL(): sqlite3_prepare_v2(....
>   no such function: generate_series
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From jidanni at jidanni.org  Thu May 30 22:35:58 2024
From: jidanni at jidanni.org (Dan Jacobson)
Date: Fri, 31 May 2024 13:35:58 +0800
Subject: [gdal-dev] OGR SQL CAST geometry example
References: <87ed9jszgk.1.fsf@jidanni.org>
 <2e58a7b5-1953-485a-86d9-58427507ad28@spatialys.com>
 <87ttiec1zd.3.fsf@jidanni.org>
 <198c0d33-cd9d-46a0-93e4-3ef72b33c280@spatialys.com>
 <87ikyu24bo.3.fsf@jidanni.org>
 <CA+K_q_pYdRwFZb=PN7GWzV0xRC_o44ge3YZ+2kNda2F3R+-NtA@mail.gmail.com>
Message-ID: <871q5ilf0h.3.fsf@jidanni.org>

Alas, even for MULTIPOINT, as there are no facilities for extracting
from aggregates, not even ST_Dump, in the end all one can do is
$ ogrinfo 0.lines.kml -al | perl -nwle \
   'if(/LINESTRING.*\((.*)\)/){print for split /,/, $1}'
-100.790056666679 36.3802233333333 1000
-100.790080000013 36.38531 1000

From jukka.rahkonen at maanmittauslaitos.fi  Fri May 31 00:40:34 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Fri, 31 May 2024 07:40:34 +0000
Subject: [gdal-dev] OGR SQL CAST geometry example
In-Reply-To: <871q5ilf0h.3.fsf@jidanni.org>
References: <87ed9jszgk.1.fsf@jidanni.org>
 <2e58a7b5-1953-485a-86d9-58427507ad28@spatialys.com>
 <87ttiec1zd.3.fsf@jidanni.org>
 <198c0d33-cd9d-46a0-93e4-3ef72b33c280@spatialys.com>
 <87ikyu24bo.3.fsf@jidanni.org>
 <CA+K_q_pYdRwFZb=PN7GWzV0xRC_o44ge3YZ+2kNda2F3R+-NtA@mail.gmail.com>
 <871q5ilf0h.3.fsf@jidanni.org>
Message-ID: <DB9PR09MB68872D109865AC5F3E2E9CECFDFC2@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

As far I know the the Spatialite functions https://www.gaia-gis.it/gaia-sins/spatialite-sql-4.2.0.html by design work row by row and one input row returns one output row. Therefore DissolvePoints creates one row with a multipoint geometry, not several rows like ST_Dump does. You can discuss about that in the spatialite-users forum https://groups.google.com/g/spatialite-users.
It is possible to extract the points from linestrings with SpatiaLite SQL by using NumPoints and then PointN in a loop, but such SQL is not possible to execute with ogrinfo/ogr2ogr. It is possible to do amazing things with ogr2ogr and SQL but it does make it the right tool for demanding ETL processes. Typically people turn to use Python at that point.

If you have a real need to extract points from a linestring by using only GDAL command line utilities, it should be possible to do in two steps. Create an interim file by using the Spatialite function DissolvePoints, and then run ogr2ogr with the -explodecollections option.

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Dan Jacobson via gdal-dev
L?hetetty: perjantai 31. toukokuuta 2024 8.36
Vastaanottaja: Daniel Baston <dbaston at gmail.com>
Kopio: gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] OGR SQL CAST geometry example

Alas, even for MULTIPOINT, as there are no facilities for extracting from aggregates, not even ST_Dump, in the end all one can do is $ ogrinfo 0.lines.kml -al | perl -nwle \
   'if(/LINESTRING.*\((.*)\)/){print for split /,/, $1}'
-100.790056666679 36.3802233333333 1000
-100.790080000013 36.38531 1000
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

From michkowalczuk at gmail.com  Fri May 31 05:44:35 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Fri, 31 May 2024 14:44:35 +0200
Subject: [gdal-dev] GDAL WMTS get tiles no documentation
In-Reply-To: <82989a4b-d3ed-4711-b9cb-7f83b8705acf@spatialys.com>
References: <CAP+FqQCGCFEbEbU1m-DHN1cDdMjBrmWTOGY_uzEqPbwZHr5wnQ@mail.gmail.com>
 <DB9PR09MB68875076F2AE985E1A3019F4FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CADRrdKsqo4jvfbmOqRyuSuHMk3wJ9Xbp_kv01LpxVQpDmGA6BA@mail.gmail.com>
 <DB9PR09MB6887F77517160F33E7601276FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQByOka92rtC94P7+6yTLEK5aoSmcfPjxorHkx=AygPLoA@mail.gmail.com>
 <82989a4b-d3ed-4711-b9cb-7f83b8705acf@spatialys.com>
Message-ID: <CAP+FqQBW8uRzr_znKj=2nVu3iw7bXHTq56nwY0_d1kU9MeGnbA@mail.gmail.com>

Hi, thank you for your replies!
As I'm still a newbie especially with WMTS. I need to take a step back to
the basics. Let's forget about multithreading for now.

   - I'm in the stage that I can open a dataset using WMTS service path
   from data provider
   - I can list subdatasets and open the selected layer as a new dataset
   using path from *SUBDATASET_id_NAME*.
   - This dataset reports large height and width values, which is obvious.
   - The first question is how to read any fragment from this dataset using
   *GDALDatasetRasterIO*.
   Is there a similar way to *SpatialFIlter *from vector layers?
   I see in the docs there is a *<DataWindow>* tag for a local service
   descriptions which defines extents of the data. Does it mean that for each
   map extent change I need to create a new local XML file and open a new
   dataset to read demanded bbox?
   Is this the only way for doing it?
   - From other site I noticed that QGIS downloads tiles separately? But
   how it knows which row/col and zoom should be used in GET request? Does it
   use GDAL for WMTS reading at all?
   [image: image.png]

I will be grateful for any tip and trucks for a newbie ;-)

Regards,
Michal

?r., 29 maj 2024 o 12:41 Even Rouault <even.rouault at spatialys.com>
napisa?(a):

> Hi,
>
> The WMS cache (which is used underneath by the WMTS driver) writes each
> tiles in a separate file. So if you use multi-threaded, as long as you read
> in parallel different GDALDataset* object on the WMTS filename, and read
> disjoint areas, that should be fine. There might be a slight risk of things
> going bad if you happened to read the same tile from different GDALDataset*
> object at the same time, as it could potentially read a partially written
> cached tile, or concurrently write the tile in the cache and corrupt it.
> The logic is in frmts/wms/gdalwmscache.cpp
>
> Even
> Le 29/05/2024 ? 10:14, Micha? Kowalczuk via gdal-dev a ?crit :
>
> Because this is not clear in documentation, especially in WMTS driver
> docs, my question is strictly about this issue to programmers who have
> already explored this topic.
>
> Regards
> Michal
>
> W dniu ?r., 29.05.2024 o 10:04 Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
>> Hi,
>>
>>
>>
>> No, I am not sure because I do not program myself. Reading this document
>> https://gdal.org/user/multithreading.html makes me feel that it is
>> possible to do some things in parallel, but the programmer must know how to
>> do it right.
>>
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>> *L?hett?j?:* Javier Jimenez Shaw <j1 at jimenezshaw.com>
>> *L?hetetty:* keskiviikko 29. toukokuuta 2024 10.41
>> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
>> *Kopio:* Micha? Kowalczuk <michkowalczuk at gmail.com>;
>> gdal-dev at lists.osgeo.org
>> *Aihe:* Re: [gdal-dev] GDAL WMTS get tiles no documentation
>>
>>
>>
>>
>>
>>
>>
>> On Wed, 29 May 2024 at 08:59, Rahkonen Jukka via gdal-dev <
>> gdal-dev at lists.osgeo.org> wrote:
>>
>> Hi,
>>
>>
>>
>> When you have a RasterBand  from the WMTS data source, it is abstracted
>> and you can read the raster data just like from any other data source and
>> raster band
>> https://gdal.org/tutorials/raster_api_tut.html#reading-raster-data
>> ?There are a few ways to read raster data, but the most common is via the
>> GDALRasterBand::RasterIO() method. This method will automatically take care
>> of data type conversion, up/down sampling and windowing.? GDAL knows which
>> tiles to read.
>>
>>
>>
>> I do not know if the WMTS driver can do parallel tile downloads. If not,
>> it is possible to run many RasterIO() at the same time, each reading data
>> from a different window like in this rasterio document
>> https://rasterio.readthedocs.io/en/latest/topics/concurrency.html.
>>
>>
>>
>> Jukka, are you sure you can run several RasterIO in parallel (on the same
>> dataset)? in GDAL GeoTIFF you cannot: the cache may be corrupted. In that
>> case I open several datasets over the same file. I do not know about WMTS.
>>
>>
>>
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Michal
>> Kowalczuk via gdal-dev
>> *L?hetetty:* keskiviikko 29. toukokuuta 2024 9.08
>> *Vastaanottaja:* gdal-dev at lists.osgeo.org
>> *Aihe:* [gdal-dev] GDAL WMTS get tiles no documentation
>>
>>
>>
>> Hi GDAL fellows
>>
>> This is my first post on this mailing list, so I'm asking for
>> understanding.
>>
>>
>>
>> As all we know the purpose of using WMTS over WMS, I'd like to implement
>> parallel downloading tiles from service using C API.
>>
>> In my opinion GDAL documentation (
>> https://gdal.org/drivers/raster/wmts.html) says nothing on this topic.
>>
>> I can get capabilities from WMTS, I can open the selected subdataset but
>> how to get tiles for given extent? I could not find any information how to
>> do it, even in the GDAL tests on github.
>>
>>
>>
>> I am kindly asking for tips. It also can be in python. How using pure
>> GDAL API fetch tiles to dynamically complete the displayed map. This is my
>> goal.
>>
>>
>>
>> Thank you!
>>
>> Michal
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240531/3614b309/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 25778 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240531/3614b309/attachment-0001.png>

From jukka.rahkonen at maanmittauslaitos.fi  Fri May 31 06:13:30 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Fri, 31 May 2024 13:13:30 +0000
Subject: [gdal-dev] GDAL WMTS get tiles no documentation
In-Reply-To: <CAP+FqQBW8uRzr_znKj=2nVu3iw7bXHTq56nwY0_d1kU9MeGnbA@mail.gmail.com>
References: <CAP+FqQCGCFEbEbU1m-DHN1cDdMjBrmWTOGY_uzEqPbwZHr5wnQ@mail.gmail.com>
 <DB9PR09MB68875076F2AE985E1A3019F4FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CADRrdKsqo4jvfbmOqRyuSuHMk3wJ9Xbp_kv01LpxVQpDmGA6BA@mail.gmail.com>
 <DB9PR09MB6887F77517160F33E7601276FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQByOka92rtC94P7+6yTLEK5aoSmcfPjxorHkx=AygPLoA@mail.gmail.com>
 <82989a4b-d3ed-4711-b9cb-7f83b8705acf@spatialys.com>
 <CAP+FqQBW8uRzr_znKj=2nVu3iw7bXHTq56nwY0_d1kU9MeGnbA@mail.gmail.com>
Message-ID: <DB9PR09MB6887B438215B9F1839D67D68FDFC2@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

Before starting to program you can familiar yourself with the topic by using gdal_translate gdal_translate ? GDAL documentation<https://gdal.org/programs/gdal_translate.html>.
Play with the -srcwin and -projwin / -projwin_srs options and gather some trust that is is possible to select and download any part of the large WMTS layer. Add ?-- debug on? and you will see that GDAL downloads tiles separately just like QGIS. Actually, with WMTS it is the only way to download data. Maybe you have read the standard already https://portal.ogc.org/files/?artifact_id=35326. It is not necessary because GDAL knows what to do, but a review every now and then does not harm. Especially the TileMatrix and TileMatrixSet things are not self-evident, but they provide the answer to the question about how a WMTS client knows which row, col, and zoom to download.

Do not touch the DataWindow. It defines the extent of the whole WMTS layer and it is used for example if gdal_translate is run without spatial selection (-srcwin or -projwin). Touch in your future code things which are equivalent to -srcwin or -projwin of gdal_translate.

-Jukka Rahkonen-

L?hett?j?: Micha? Kowalczuk <michkowalczuk at gmail.com>
L?hetetty: perjantai 31. toukokuuta 2024 15.45
Vastaanottaja: Even Rouault <even.rouault at spatialys.com>
Kopio: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] GDAL WMTS get tiles no documentation

Hi, thank you for your replies!
As I'm still a newbie especially with WMTS. I need to take a step back to the basics. Let's forget about multithreading for now.

  *   I'm in the stage that I can open a dataset using WMTS service path from data provider
  *   I can list subdatasets and open the selected layer as a new dataset using path from SUBDATASET_id_NAME.
  *   This dataset reports large height and width values, which is obvious.
  *   The first question is how to read any fragment from this dataset using GDALDatasetRasterIO.
Is there a similar way to SpatialFIlter from vector layers?
I see in the docs there is a <DataWindow> tag for a local service descriptions which defines extents of the data. Does it mean that for each map extent change I need to create a new local XML file and open a new dataset to read demanded bbox?
Is this the only way for doing it?
  *   From other site I noticed that QGIS downloads tiles separately? But how it knows which row/col and zoom should be used in GET request? Does it use GDAL for WMTS reading at all?
[cid:image001.png at 01DAB373.3E20F850]
I will be grateful for any tip and trucks for a newbie ;-)

Regards,
Michal

?r., 29 maj 2024 o 12:41 Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>> napisa?(a):

Hi,

The WMS cache (which is used underneath by the WMTS driver) writes each tiles in a separate file. So if you use multi-threaded, as long as you read in parallel different GDALDataset* object on the WMTS filename, and read disjoint areas, that should be fine. There might be a slight risk of things going bad if you happened to read the same tile from different GDALDataset* object at the same time, as it could potentially read a partially written cached tile, or concurrently write the tile in the cache and corrupt it. The logic is in frmts/wms/gdalwmscache.cpp

Even
Le 29/05/2024 ? 10:14, Micha? Kowalczuk via gdal-dev a ?crit :
Because this is not clear in documentation, especially in WMTS driver docs, my question is strictly about this issue to programmers who have already explored this topic.

Regards
Michal

W dniu ?r., 29.05.2024 o 10:04 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> napisa?(a):
Hi,

No, I am not sure because I do not program myself. Reading this document https://gdal.org/user/multithreading.html makes me feel that it is possible to do some things in parallel, but the programmer must know how to do it right.

-Jukka Rahkonen-

L?hett?j?: Javier Jimenez Shaw <j1 at jimenezshaw.com<mailto:j1 at jimenezshaw.com>>
L?hetetty: keskiviikko 29. toukokuuta 2024 10.41
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Kopio: Micha? Kowalczuk <michkowalczuk at gmail.com<mailto:michkowalczuk at gmail.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] GDAL WMTS get tiles no documentation



On Wed, 29 May 2024 at 08:59, Rahkonen Jukka via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
Hi,

When you have a RasterBand  from the WMTS data source, it is abstracted and you can read the raster data just like from any other data source and raster band https://gdal.org/tutorials/raster_api_tut.html#reading-raster-data ?There are a few ways to read raster data, but the most common is via the GDALRasterBand::RasterIO() method. This method will automatically take care of data type conversion, up/down sampling and windowing.? GDAL knows which tiles to read.

I do not know if the WMTS driver can do parallel tile downloads. If not, it is possible to run many RasterIO() at the same time, each reading data from a different window like in this rasterio document https://rasterio.readthedocs.io/en/latest/topics/concurrency.html.

Jukka, are you sure you can run several RasterIO in parallel (on the same dataset)? in GDAL GeoTIFF you cannot: the cache may be corrupted. In that case I open several datasets over the same file. I do not know about WMTS.


-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Michal Kowalczuk via gdal-dev
L?hetetty: keskiviikko 29. toukokuuta 2024 9.08
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] GDAL WMTS get tiles no documentation

Hi GDAL fellows
This is my first post on this mailing list, so I'm asking for understanding.

As all we know the purpose of using WMTS over WMS, I'd like to implement parallel downloading tiles from service using C API.
In my opinion GDAL documentation (https://gdal.org/drivers/raster/wmts.html) says nothing on this topic.
I can get capabilities from WMTS, I can open the selected subdataset but how to get tiles for given extent? I could not find any information how to do it, even in the GDAL tests on github.

I am kindly asking for tips. It also can be in python. How using pure GDAL API fetch tiles to dynamically complete the displayed map. This is my goal.

Thank you!
Michal
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com<http://www.spatialys.com/>

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240531/17d361d4/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 25778 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240531/17d361d4/attachment-0001.png>

From michkowalczuk at gmail.com  Fri May 31 06:31:51 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Fri, 31 May 2024 15:31:51 +0200
Subject: [gdal-dev] GDAL WMTS get tiles no documentation
In-Reply-To: <DB9PR09MB6887B438215B9F1839D67D68FDFC2@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <CAP+FqQCGCFEbEbU1m-DHN1cDdMjBrmWTOGY_uzEqPbwZHr5wnQ@mail.gmail.com>
 <DB9PR09MB68875076F2AE985E1A3019F4FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CADRrdKsqo4jvfbmOqRyuSuHMk3wJ9Xbp_kv01LpxVQpDmGA6BA@mail.gmail.com>
 <DB9PR09MB6887F77517160F33E7601276FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQByOka92rtC94P7+6yTLEK5aoSmcfPjxorHkx=AygPLoA@mail.gmail.com>
 <82989a4b-d3ed-4711-b9cb-7f83b8705acf@spatialys.com>
 <CAP+FqQBW8uRzr_znKj=2nVu3iw7bXHTq56nwY0_d1kU9MeGnbA@mail.gmail.com>
 <DB9PR09MB6887B438215B9F1839D67D68FDFC2@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <CAP+FqQCs15JwU0jwexOVUWWTDhXzJG--W-0d4oFh+z-pd6wD9A@mail.gmail.com>

Thank you Rukka,
Since *-srcwin* and *-projwin* are options only for *gdal_translate*
utility, your suggestion leads me to use *GDALTranslate()* function with
these parameters.

This means that I cannot use directly created WMTS dataset to retrieve data
(using GDALDatasetRasterIO), but create a new (in-memory or file-based) for
each map extent change.

And this is the standard way of doing it?
Do I understand it correctly?

Michal

pt., 31 maj 2024 o 15:13 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
napisa?(a):

> Hi,
>
>
>
> Before starting to program you can familiar yourself with the topic by
> using gdal_translate gdal_translate ? GDAL documentation
> <https://gdal.org/programs/gdal_translate.html>.
>
> Play with the -srcwin and -projwin / -projwin_srs options and gather some
> trust that is is possible to select and download any part of the large WMTS
> layer. Add ?-- debug on? and you will see that GDAL downloads tiles
> separately just like QGIS. Actually, with WMTS it is the only way to
> download data. Maybe you have read the standard already
> https://portal.ogc.org/files/?artifact_id=35326. It is not necessary
> because GDAL knows what to do, but a review every now and then does not
> harm. Especially the TileMatrix and TileMatrixSet things are not
> self-evident, but they provide the answer to the question about how a WMTS
> client knows which row, col, and zoom to download.
>
>
>
> Do not touch the DataWindow. It defines the extent of the whole WMTS layer
> and it is used for example if gdal_translate is run without spatial
> selection (-srcwin or -projwin). Touch in your future code things which are
> equivalent to -srcwin or -projwin of gdal_translate.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Micha? Kowalczuk <michkowalczuk at gmail.com>
> *L?hetetty:* perjantai 31. toukokuuta 2024 15.45
> *Vastaanottaja:* Even Rouault <even.rouault at spatialys.com>
> *Kopio:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>;
> gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] GDAL WMTS get tiles no documentation
>
>
>
> Hi, thank you for your replies!
> As I'm still a newbie especially with WMTS. I need to take a step back to
> the basics. Let's forget about multithreading for now.
>
>    - I'm in the stage that I can open a dataset using WMTS service path
>    from data provider
>    - I can list subdatasets and open the selected layer as a new dataset
>    using path from *SUBDATASET_id_NAME*.
>    - This dataset reports large height and width values, which is obvious.
>    - The first question is how to read any fragment from this dataset
>    using *GDALDatasetRasterIO*.
>    Is there a similar way to *SpatialFIlter *from vector layers?
>    I see in the docs there is a *<DataWindow>* tag for a local service
>    descriptions which defines extents of the data. Does it mean that for each
>    map extent change I need to create a new local XML file and open a new
>    dataset to read demanded bbox?
>    Is this the only way for doing it?
>    - From other site I noticed that QGIS downloads tiles separately? But
>    how it knows which row/col and zoom should be used in GET request? Does
>    it use GDAL for WMTS reading at all?
>
> I will be grateful for any tip and trucks for a newbie ;-)
>
>
>
> Regards,
>
> Michal
>
>
>
> ?r., 29 maj 2024 o 12:41 Even Rouault <even.rouault at spatialys.com>
> napisa?(a):
>
> Hi,
>
> The WMS cache (which is used underneath by the WMTS driver) writes each
> tiles in a separate file. So if you use multi-threaded, as long as you read
> in parallel different GDALDataset* object on the WMTS filename, and read
> disjoint areas, that should be fine. There might be a slight risk of things
> going bad if you happened to read the same tile from different GDALDataset*
> object at the same time, as it could potentially read a partially written
> cached tile, or concurrently write the tile in the cache and corrupt it.
> The logic is in frmts/wms/gdalwmscache.cpp
>
> Even
>
> Le 29/05/2024 ? 10:14, Micha? Kowalczuk via gdal-dev a ?crit :
>
> Because this is not clear in documentation, especially in WMTS driver
> docs, my question is strictly about this issue to programmers who have
> already explored this topic.
>
>
>
> Regards
>
> Michal
>
>
>
> W dniu ?r., 29.05.2024 o 10:04 Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
> Hi,
>
>
>
> No, I am not sure because I do not program myself. Reading this document
> https://gdal.org/user/multithreading.html makes me feel that it is
> possible to do some things in parallel, but the programmer must know how to
> do it right.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Javier Jimenez Shaw <j1 at jimenezshaw.com>
> *L?hetetty:* keskiviikko 29. toukokuuta 2024 10.41
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* Micha? Kowalczuk <michkowalczuk at gmail.com>;
> gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] GDAL WMTS get tiles no documentation
>
>
>
>
>
>
>
> On Wed, 29 May 2024 at 08:59, Rahkonen Jukka via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
> Hi,
>
>
>
> When you have a RasterBand  from the WMTS data source, it is abstracted
> and you can read the raster data just like from any other data source and
> raster band
> https://gdal.org/tutorials/raster_api_tut.html#reading-raster-data ?There
> are a few ways to read raster data, but the most common is via the
> GDALRasterBand::RasterIO() method. This method will automatically take care
> of data type conversion, up/down sampling and windowing.? GDAL knows which
> tiles to read.
>
>
>
> I do not know if the WMTS driver can do parallel tile downloads. If not,
> it is possible to run many RasterIO() at the same time, each reading data
> from a different window like in this rasterio document
> https://rasterio.readthedocs.io/en/latest/topics/concurrency.html.
>
>
>
> Jukka, are you sure you can run several RasterIO in parallel (on the same
> dataset)? in GDAL GeoTIFF you cannot: the cache may be corrupted. In that
> case I open several datasets over the same file. I do not know about WMTS.
>
>
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Michal
> Kowalczuk via gdal-dev
> *L?hetetty:* keskiviikko 29. toukokuuta 2024 9.08
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] GDAL WMTS get tiles no documentation
>
>
>
> Hi GDAL fellows
>
> This is my first post on this mailing list, so I'm asking for
> understanding.
>
>
>
> As all we know the purpose of using WMTS over WMS, I'd like to implement
> parallel downloading tiles from service using C API.
>
> In my opinion GDAL documentation (
> https://gdal.org/drivers/raster/wmts.html) says nothing on this topic.
>
> I can get capabilities from WMTS, I can open the selected subdataset but
> how to get tiles for given extent? I could not find any information how to
> do it, even in the GDAL tests on github.
>
>
>
> I am kindly asking for tips. It also can be in python. How using pure GDAL
> API fetch tiles to dynamically complete the displayed map. This is my goal.
>
>
>
> Thank you!
>
> Michal
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
> _______________________________________________
>
> gdal-dev mailing list
>
> gdal-dev at lists.osgeo.org
>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240531/ddc25ae9/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 25778 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240531/ddc25ae9/attachment-0001.png>

From michkowalczuk at gmail.com  Fri May 31 06:57:41 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Fri, 31 May 2024 15:57:41 +0200
Subject: [gdal-dev] GDAL WMTS get tiles no documentation
In-Reply-To: <CAP+FqQCs15JwU0jwexOVUWWTDhXzJG--W-0d4oFh+z-pd6wD9A@mail.gmail.com>
References: <CAP+FqQCGCFEbEbU1m-DHN1cDdMjBrmWTOGY_uzEqPbwZHr5wnQ@mail.gmail.com>
 <DB9PR09MB68875076F2AE985E1A3019F4FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CADRrdKsqo4jvfbmOqRyuSuHMk3wJ9Xbp_kv01LpxVQpDmGA6BA@mail.gmail.com>
 <DB9PR09MB6887F77517160F33E7601276FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQByOka92rtC94P7+6yTLEK5aoSmcfPjxorHkx=AygPLoA@mail.gmail.com>
 <82989a4b-d3ed-4711-b9cb-7f83b8705acf@spatialys.com>
 <CAP+FqQBW8uRzr_znKj=2nVu3iw7bXHTq56nwY0_d1kU9MeGnbA@mail.gmail.com>
 <DB9PR09MB6887B438215B9F1839D67D68FDFC2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQCs15JwU0jwexOVUWWTDhXzJG--W-0d4oFh+z-pd6wD9A@mail.gmail.com>
Message-ID: <CAP+FqQBd29_Rqf-bUw_HwifxHY_g_nQOj1Rgs7kQeqRVif6F=g@mail.gmail.com>

As you proposed I tested *gdal_translate *utility but for the following
sample command I get an empty image (tested with jpg and png)

gdal_translate "WMTS:
http://maps.wien.gv.at/wmts/1.0.0/WMTSCapabilities.xml,layer=fmzk3dviewer"
-srcwin 1820157 6144777 512 512 tile.jpg

[image: image.png]

pt., 31 maj 2024 o 15:31 Micha? Kowalczuk <michkowalczuk at gmail.com>
napisa?(a):

> Thank you Rukka,
> Since *-srcwin* and *-projwin* are options only for *gdal_translate*
> utility, your suggestion leads me to use *GDALTranslate()* function with
> these parameters.
>
> This means that I cannot use directly created WMTS dataset to retrieve
> data (using GDALDatasetRasterIO), but create a new (in-memory or
> file-based) for each map extent change.
>
> And this is the standard way of doing it?
> Do I understand it correctly?
>
> Michal
>
> pt., 31 maj 2024 o 15:13 Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
>> Hi,
>>
>>
>>
>> Before starting to program you can familiar yourself with the topic by
>> using gdal_translate gdal_translate ? GDAL documentation
>> <https://gdal.org/programs/gdal_translate.html>.
>>
>> Play with the -srcwin and -projwin / -projwin_srs options and gather some
>> trust that is is possible to select and download any part of the large WMTS
>> layer. Add ?-- debug on? and you will see that GDAL downloads tiles
>> separately just like QGIS. Actually, with WMTS it is the only way to
>> download data. Maybe you have read the standard already
>> https://portal.ogc.org/files/?artifact_id=35326. It is not necessary
>> because GDAL knows what to do, but a review every now and then does not
>> harm. Especially the TileMatrix and TileMatrixSet things are not
>> self-evident, but they provide the answer to the question about how a WMTS
>> client knows which row, col, and zoom to download.
>>
>>
>>
>> Do not touch the DataWindow. It defines the extent of the whole WMTS
>> layer and it is used for example if gdal_translate is run without spatial
>> selection (-srcwin or -projwin). Touch in your future code things which are
>> equivalent to -srcwin or -projwin of gdal_translate.
>>
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>> *L?hett?j?:* Micha? Kowalczuk <michkowalczuk at gmail.com>
>> *L?hetetty:* perjantai 31. toukokuuta 2024 15.45
>> *Vastaanottaja:* Even Rouault <even.rouault at spatialys.com>
>> *Kopio:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>;
>> gdal-dev at lists.osgeo.org
>> *Aihe:* Re: [gdal-dev] GDAL WMTS get tiles no documentation
>>
>>
>>
>> Hi, thank you for your replies!
>> As I'm still a newbie especially with WMTS. I need to take a step back to
>> the basics. Let's forget about multithreading for now.
>>
>>    - I'm in the stage that I can open a dataset using WMTS service path
>>    from data provider
>>    - I can list subdatasets and open the selected layer as a new dataset
>>    using path from *SUBDATASET_id_NAME*.
>>    - This dataset reports large height and width values, which is
>>    obvious.
>>    - The first question is how to read any fragment from this dataset
>>    using *GDALDatasetRasterIO*.
>>    Is there a similar way to *SpatialFIlter *from vector layers?
>>    I see in the docs there is a *<DataWindow>* tag for a local service
>>    descriptions which defines extents of the data. Does it mean that for each
>>    map extent change I need to create a new local XML file and open a new
>>    dataset to read demanded bbox?
>>    Is this the only way for doing it?
>>    - From other site I noticed that QGIS downloads tiles separately? But
>>    how it knows which row/col and zoom should be used in GET request? Does
>>    it use GDAL for WMTS reading at all?
>>
>> I will be grateful for any tip and trucks for a newbie ;-)
>>
>>
>>
>> Regards,
>>
>> Michal
>>
>>
>>
>> ?r., 29 maj 2024 o 12:41 Even Rouault <even.rouault at spatialys.com>
>> napisa?(a):
>>
>> Hi,
>>
>> The WMS cache (which is used underneath by the WMTS driver) writes each
>> tiles in a separate file. So if you use multi-threaded, as long as you read
>> in parallel different GDALDataset* object on the WMTS filename, and read
>> disjoint areas, that should be fine. There might be a slight risk of things
>> going bad if you happened to read the same tile from different GDALDataset*
>> object at the same time, as it could potentially read a partially written
>> cached tile, or concurrently write the tile in the cache and corrupt it.
>> The logic is in frmts/wms/gdalwmscache.cpp
>>
>> Even
>>
>> Le 29/05/2024 ? 10:14, Micha? Kowalczuk via gdal-dev a ?crit :
>>
>> Because this is not clear in documentation, especially in WMTS driver
>> docs, my question is strictly about this issue to programmers who have
>> already explored this topic.
>>
>>
>>
>> Regards
>>
>> Michal
>>
>>
>>
>> W dniu ?r., 29.05.2024 o 10:04 Rahkonen Jukka <
>> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>>
>> Hi,
>>
>>
>>
>> No, I am not sure because I do not program myself. Reading this document
>> https://gdal.org/user/multithreading.html makes me feel that it is
>> possible to do some things in parallel, but the programmer must know how to
>> do it right.
>>
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>> *L?hett?j?:* Javier Jimenez Shaw <j1 at jimenezshaw.com>
>> *L?hetetty:* keskiviikko 29. toukokuuta 2024 10.41
>> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
>> *Kopio:* Micha? Kowalczuk <michkowalczuk at gmail.com>;
>> gdal-dev at lists.osgeo.org
>> *Aihe:* Re: [gdal-dev] GDAL WMTS get tiles no documentation
>>
>>
>>
>>
>>
>>
>>
>> On Wed, 29 May 2024 at 08:59, Rahkonen Jukka via gdal-dev <
>> gdal-dev at lists.osgeo.org> wrote:
>>
>> Hi,
>>
>>
>>
>> When you have a RasterBand  from the WMTS data source, it is abstracted
>> and you can read the raster data just like from any other data source and
>> raster band
>> https://gdal.org/tutorials/raster_api_tut.html#reading-raster-data
>> ?There are a few ways to read raster data, but the most common is via the
>> GDALRasterBand::RasterIO() method. This method will automatically take care
>> of data type conversion, up/down sampling and windowing.? GDAL knows which
>> tiles to read.
>>
>>
>>
>> I do not know if the WMTS driver can do parallel tile downloads. If not,
>> it is possible to run many RasterIO() at the same time, each reading data
>> from a different window like in this rasterio document
>> https://rasterio.readthedocs.io/en/latest/topics/concurrency.html.
>>
>>
>>
>> Jukka, are you sure you can run several RasterIO in parallel (on the same
>> dataset)? in GDAL GeoTIFF you cannot: the cache may be corrupted. In that
>> case I open several datasets over the same file. I do not know about WMTS.
>>
>>
>>
>>
>>
>> -Jukka Rahkonen-
>>
>>
>>
>> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Michal
>> Kowalczuk via gdal-dev
>> *L?hetetty:* keskiviikko 29. toukokuuta 2024 9.08
>> *Vastaanottaja:* gdal-dev at lists.osgeo.org
>> *Aihe:* [gdal-dev] GDAL WMTS get tiles no documentation
>>
>>
>>
>> Hi GDAL fellows
>>
>> This is my first post on this mailing list, so I'm asking for
>> understanding.
>>
>>
>>
>> As all we know the purpose of using WMTS over WMS, I'd like to implement
>> parallel downloading tiles from service using C API.
>>
>> In my opinion GDAL documentation (
>> https://gdal.org/drivers/raster/wmts.html) says nothing on this topic.
>>
>> I can get capabilities from WMTS, I can open the selected subdataset but
>> how to get tiles for given extent? I could not find any information how to
>> do it, even in the GDAL tests on github.
>>
>>
>>
>> I am kindly asking for tips. It also can be in python. How using pure
>> GDAL API fetch tiles to dynamically complete the displayed map. This is my
>> goal.
>>
>>
>>
>> Thank you!
>>
>> Michal
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>
>>
>> _______________________________________________
>>
>> gdal-dev mailing list
>>
>> gdal-dev at lists.osgeo.org
>>
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> --
>>
>> http://www.spatialys.com
>>
>> My software is free, but my time generally not.
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240531/b8fd5722/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 25778 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240531/b8fd5722/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 28257 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240531/b8fd5722/attachment-0003.png>

From jukka.rahkonen at maanmittauslaitos.fi  Fri May 31 07:08:43 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Fri, 31 May 2024 14:08:43 +0000
Subject: [gdal-dev] GDAL WMTS get tiles no documentation
In-Reply-To: <DB9PR09MB6887BC6C0668915B85B4399EFDFC2@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <CAP+FqQCGCFEbEbU1m-DHN1cDdMjBrmWTOGY_uzEqPbwZHr5wnQ@mail.gmail.com>
 <DB9PR09MB68875076F2AE985E1A3019F4FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CADRrdKsqo4jvfbmOqRyuSuHMk3wJ9Xbp_kv01LpxVQpDmGA6BA@mail.gmail.com>
 <DB9PR09MB6887F77517160F33E7601276FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQByOka92rtC94P7+6yTLEK5aoSmcfPjxorHkx=AygPLoA@mail.gmail.com>
 <82989a4b-d3ed-4711-b9cb-7f83b8705acf@spatialys.com>
 <CAP+FqQBW8uRzr_znKj=2nVu3iw7bXHTq56nwY0_d1kU9MeGnbA@mail.gmail.com>
 <DB9PR09MB6887B438215B9F1839D67D68FDFC2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQCs15JwU0jwexOVUWWTDhXzJG--W-0d4oFh+z-pd6wD9A@mail.gmail.com>
 <CAP+FqQBd29_Rqf-bUw_HwifxHY_g_nQOj1Rgs7kQeqRVif6F=g@mail.gmail.com>
 <DB9PR09MB6887BC6C0668915B85B4399EFDFC2@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <DB9PR09MB688753BAB781CEFBAE7CAC7AFDFC2@DB9PR09MB6887.eurprd09.prod.outlook.com>

(resending, need to cut old discussion due to too many bytes in the body)

Hi,

gdalinfo "WMTS:http://maps.wien.gv.at/wmts/1.0.0/WMTSCapabilities.xml,layer=fmzk3dviewer"
Driver: WMTS/OGC Web Map Tile Service
Files: none associated
Size is 305719, 257379

The unit of size is pixels. You used -srcwin 1820157 6144777 512 512, with offsets far outsize the layer. This returns me something greenish.

gdal_translate "WMTS:http://maps.wien.gv.at/wmts/1.0.0/WMTSCapabilities.xml,layer=fmzk3dviewer" -srcwin 100000 100000 512 512 tile.jpg

-Jukka Rahkonen-


L?hett?j?: Micha? Kowalczuk <michkowalczuk at gmail.com<mailto:michkowalczuk at gmail.com>>
L?hetetty: perjantai 31. toukokuuta 2024 16.58
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Kopio: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] GDAL WMTS get tiles no documentation

As you proposed I tested gdal_translate utility but for the following sample command I get an empty image (tested with jpg and png)

gdal_translate "WMTS:http://maps.wien.gv.at/wmts/1.0.0/WMTSCapabilities.xml,layer=fmzk3dviewer" -srcwin 1820157 6144777 512 512 tile.jpg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240531/f494a789/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Fri May 31 07:14:11 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Fri, 31 May 2024 14:14:11 +0000
Subject: [gdal-dev] GDAL WMTS get tiles no documentation
In-Reply-To: <CAP+FqQCs15JwU0jwexOVUWWTDhXzJG--W-0d4oFh+z-pd6wD9A@mail.gmail.com>
References: <CAP+FqQCGCFEbEbU1m-DHN1cDdMjBrmWTOGY_uzEqPbwZHr5wnQ@mail.gmail.com>
 <DB9PR09MB68875076F2AE985E1A3019F4FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CADRrdKsqo4jvfbmOqRyuSuHMk3wJ9Xbp_kv01LpxVQpDmGA6BA@mail.gmail.com>
 <DB9PR09MB6887F77517160F33E7601276FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQByOka92rtC94P7+6yTLEK5aoSmcfPjxorHkx=AygPLoA@mail.gmail.com>
 <82989a4b-d3ed-4711-b9cb-7f83b8705acf@spatialys.com>
 <CAP+FqQBW8uRzr_znKj=2nVu3iw7bXHTq56nwY0_d1kU9MeGnbA@mail.gmail.com>
 <DB9PR09MB6887B438215B9F1839D67D68FDFC2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQCs15JwU0jwexOVUWWTDhXzJG--W-0d4oFh+z-pd6wD9A@mail.gmail.com>
Message-ID: <DB9PR09MB6887132DFAF0E88F3919E577FDFC2@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

You do not need to use GDALTranslate even if may be convenient. In the RasterIO() function GDALRasterBand C++ API ? GDAL documentation<https://gdal.org/api/gdalrasterband_cpp.html> the region is selected by using XOff, YOff, XSize and YSize which map directly with -srcwin. But I was thinking that very soon you?ll ask about how to convert a georeferenced coordinates into pixel space, and gdal_translate supports that. So maybe you want to read the source code https://github.com/OSGeo/gdal/blob/master/apps/gdal_translate_lib.cpp. And meanwhile you can read and convert data from WMTS with gdal_translate, enjoy in seeing that it works, and be confident that you will be able to do the same and more with your own code. If programmers think that way, I do not know.

-Jukka-

L?hett?j?: Micha? Kowalczuk <michkowalczuk at gmail.com>
L?hetetty: perjantai 31. toukokuuta 2024 16.32
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
Kopio: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Aihe: Re: [gdal-dev] GDAL WMTS get tiles no documentation

Thank you Rukka,
Since -srcwin and -projwin are options only for gdal_translate utility, your suggestion leads me to use GDALTranslate() function with these parameters.

This means that I cannot use directly created WMTS dataset to retrieve data (using GDALDatasetRasterIO), but create a new (in-memory or file-based) for each map extent change.

And this is the standard way of doing it?
Do I understand it correctly?

Michal

pt., 31 maj 2024 o 15:13 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> napisa?(a):
Hi,

Before starting to program you can familiar yourself with the topic by using gdal_translate gdal_translate ? GDAL documentation<https://gdal.org/programs/gdal_translate.html>.
Play with the -srcwin and -projwin / -projwin_srs options and gather some trust that is is possible to select and download any part of the large WMTS layer. Add ?-- debug on? and you will see that GDAL downloads tiles separately just like QGIS. Actually, with WMTS it is the only way to download data. Maybe you have read the standard already https://portal.ogc.org/files/?artifact_id=35326. It is not necessary because GDAL knows what to do, but a review every now and then does not harm. Especially the TileMatrix and TileMatrixSet things are not self-evident, but they provide the answer to the question about how a WMTS client knows which row, col, and zoom to download.

Do not touch the DataWindow. It defines the extent of the whole WMTS layer and it is used for example if gdal_translate is run without spatial selection (-srcwin or -projwin). Touch in your future code things which are equivalent to -srcwin or -projwin of gdal_translate.

-Jukka Rahkonen-

L?hett?j?: Micha? Kowalczuk <michkowalczuk at gmail.com<mailto:michkowalczuk at gmail.com>>
L?hetetty: perjantai 31. toukokuuta 2024 15.45
Vastaanottaja: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Kopio: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] GDAL WMTS get tiles no documentation

Hi, thank you for your replies!
As I'm still a newbie especially with WMTS. I need to take a step back to the basics. Let's forget about multithreading for now.

  *   I'm in the stage that I can open a dataset using WMTS service path from data provider
  *   I can list subdatasets and open the selected layer as a new dataset using path from SUBDATASET_id_NAME.
  *   This dataset reports large height and width values, which is obvious.
  *   The first question is how to read any fragment from this dataset using GDALDatasetRasterIO.
Is there a similar way to SpatialFIlter from vector layers?
I see in the docs there is a <DataWindow> tag for a local service descriptions which defines extents of the data. Does it mean that for each map extent change I need to create a new local XML file and open a new dataset to read demanded bbox?
Is this the only way for doing it?
  *   From other site I noticed that QGIS downloads tiles separately? But how it knows which row/col and zoom should be used in GET request? Does it use GDAL for WMTS reading at all?
[cid:image001.png at 01DAB379.1058A2F0]
I will be grateful for any tip and trucks for a newbie ;-)

Regards,
Michal

?r., 29 maj 2024 o 12:41 Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>> napisa?(a):

Hi,

The WMS cache (which is used underneath by the WMTS driver) writes each tiles in a separate file. So if you use multi-threaded, as long as you read in parallel different GDALDataset* object on the WMTS filename, and read disjoint areas, that should be fine. There might be a slight risk of things going bad if you happened to read the same tile from different GDALDataset* object at the same time, as it could potentially read a partially written cached tile, or concurrently write the tile in the cache and corrupt it. The logic is in frmts/wms/gdalwmscache.cpp

Even
Le 29/05/2024 ? 10:14, Micha? Kowalczuk via gdal-dev a ?crit :
Because this is not clear in documentation, especially in WMTS driver docs, my question is strictly about this issue to programmers who have already explored this topic.

Regards
Michal

W dniu ?r., 29.05.2024 o 10:04 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>> napisa?(a):
Hi,

No, I am not sure because I do not program myself. Reading this document https://gdal.org/user/multithreading.html makes me feel that it is possible to do some things in parallel, but the programmer must know how to do it right.

-Jukka Rahkonen-

L?hett?j?: Javier Jimenez Shaw <j1 at jimenezshaw.com<mailto:j1 at jimenezshaw.com>>
L?hetetty: keskiviikko 29. toukokuuta 2024 10.41
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi<mailto:jukka.rahkonen at maanmittauslaitos.fi>>
Kopio: Micha? Kowalczuk <michkowalczuk at gmail.com<mailto:michkowalczuk at gmail.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] GDAL WMTS get tiles no documentation



On Wed, 29 May 2024 at 08:59, Rahkonen Jukka via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
Hi,

When you have a RasterBand  from the WMTS data source, it is abstracted and you can read the raster data just like from any other data source and raster band https://gdal.org/tutorials/raster_api_tut.html#reading-raster-data ?There are a few ways to read raster data, but the most common is via the GDALRasterBand::RasterIO() method. This method will automatically take care of data type conversion, up/down sampling and windowing.? GDAL knows which tiles to read.

I do not know if the WMTS driver can do parallel tile downloads. If not, it is possible to run many RasterIO() at the same time, each reading data from a different window like in this rasterio document https://rasterio.readthedocs.io/en/latest/topics/concurrency.html.

Jukka, are you sure you can run several RasterIO in parallel (on the same dataset)? in GDAL GeoTIFF you cannot: the cache may be corrupted. In that case I open several datasets over the same file. I do not know about WMTS.


-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> Puolesta Michal Kowalczuk via gdal-dev
L?hetetty: keskiviikko 29. toukokuuta 2024 9.08
Vastaanottaja: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] GDAL WMTS get tiles no documentation

Hi GDAL fellows
This is my first post on this mailing list, so I'm asking for understanding.

As all we know the purpose of using WMTS over WMS, I'd like to implement parallel downloading tiles from service using C API.
In my opinion GDAL documentation (https://gdal.org/drivers/raster/wmts.html) says nothing on this topic.
I can get capabilities from WMTS, I can open the selected subdataset but how to get tiles for given extent? I could not find any information how to do it, even in the GDAL tests on github.

I am kindly asking for tips. It also can be in python. How using pure GDAL API fetch tiles to dynamically complete the displayed map. This is my goal.

Thank you!
Michal
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com<http://www.spatialys.com/>

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240531/e26388f4/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 25778 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240531/e26388f4/attachment-0001.png>

From michkowalczuk at gmail.com  Fri May 31 11:40:54 2024
From: michkowalczuk at gmail.com (=?UTF-8?Q?Micha=C5=82_Kowalczuk?=)
Date: Fri, 31 May 2024 20:40:54 +0200
Subject: [gdal-dev] GDAL WMTS get tiles no documentation
In-Reply-To: <DB9PR09MB6887132DFAF0E88F3919E577FDFC2@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <CAP+FqQCGCFEbEbU1m-DHN1cDdMjBrmWTOGY_uzEqPbwZHr5wnQ@mail.gmail.com>
 <DB9PR09MB68875076F2AE985E1A3019F4FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CADRrdKsqo4jvfbmOqRyuSuHMk3wJ9Xbp_kv01LpxVQpDmGA6BA@mail.gmail.com>
 <DB9PR09MB6887F77517160F33E7601276FDF22@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQByOka92rtC94P7+6yTLEK5aoSmcfPjxorHkx=AygPLoA@mail.gmail.com>
 <82989a4b-d3ed-4711-b9cb-7f83b8705acf@spatialys.com>
 <CAP+FqQBW8uRzr_znKj=2nVu3iw7bXHTq56nwY0_d1kU9MeGnbA@mail.gmail.com>
 <DB9PR09MB6887B438215B9F1839D67D68FDFC2@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <CAP+FqQCs15JwU0jwexOVUWWTDhXzJG--W-0d4oFh+z-pd6wD9A@mail.gmail.com>
 <DB9PR09MB6887132DFAF0E88F3919E577FDFC2@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <CAP+FqQDHnCCG6gzD=tQV+PX5xSFYrBZhG6ZZJQHzEHPbG8ZpeQ@mail.gmail.com>

Thank you again.
Now I know which direction should I go.This is my goal to have a control
over this process using the low-level RasterIO.
I browse GDAL github repository a lot and it's very helpful, especially the
tests.
This time I was confused with WMTS and I needed a support at the begining.

Have a great weekend!
Michal


pt., 31 maj 2024 o 16:14 Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
napisa?(a):

> Hi,
>
>
>
> You do not need to use GDALTranslate even if may be convenient. In the
> RasterIO() function GDALRasterBand C++ API ? GDAL documentation
> <https://gdal.org/api/gdalrasterband_cpp.html> the region is selected by
> using XOff, YOff, XSize and YSize which map directly with -srcwin. But I
> was thinking that very soon you?ll ask about how to convert a georeferenced
> coordinates into pixel space, and gdal_translate supports that. So maybe
> you want to read the source code
> https://github.com/OSGeo/gdal/blob/master/apps/gdal_translate_lib.cpp.
> And meanwhile you can read and convert data from WMTS with gdal_translate,
> enjoy in seeing that it works, and be confident that you will be able to do
> the same and more with your own code. If programmers think that way, I do
> not know.
>
>
>
> -Jukka-
>
>
>
> *L?hett?j?:* Micha? Kowalczuk <michkowalczuk at gmail.com>
> *L?hetetty:* perjantai 31. toukokuuta 2024 16.32
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* Even Rouault <even.rouault at spatialys.com>;
> gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] GDAL WMTS get tiles no documentation
>
>
>
> Thank you Rukka,
>
> Since *-srcwin* and *-projwin* are options only for *gdal_translate*
> utility, your suggestion leads me to use *GDALTranslate()* function with
> these parameters.
>
>
>
> This means that I cannot use directly created WMTS dataset to retrieve
> data (using GDALDatasetRasterIO), but create a new (in-memory or
> file-based) for each map extent change.
>
>
>
> And this is the standard way of doing it?
>
> Do I understand it correctly?
>
>
>
> Michal
>
>
>
> pt., 31 maj 2024 o 15:13 Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
> Hi,
>
>
>
> Before starting to program you can familiar yourself with the topic by
> using gdal_translate gdal_translate ? GDAL documentation
> <https://gdal.org/programs/gdal_translate.html>.
>
> Play with the -srcwin and -projwin / -projwin_srs options and gather some
> trust that is is possible to select and download any part of the large WMTS
> layer. Add ?-- debug on? and you will see that GDAL downloads tiles
> separately just like QGIS. Actually, with WMTS it is the only way to
> download data. Maybe you have read the standard already
> https://portal.ogc.org/files/?artifact_id=35326. It is not necessary
> because GDAL knows what to do, but a review every now and then does not
> harm. Especially the TileMatrix and TileMatrixSet things are not
> self-evident, but they provide the answer to the question about how a WMTS
> client knows which row, col, and zoom to download.
>
>
>
> Do not touch the DataWindow. It defines the extent of the whole WMTS layer
> and it is used for example if gdal_translate is run without spatial
> selection (-srcwin or -projwin). Touch in your future code things which are
> equivalent to -srcwin or -projwin of gdal_translate.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Micha? Kowalczuk <michkowalczuk at gmail.com>
> *L?hetetty:* perjantai 31. toukokuuta 2024 15.45
> *Vastaanottaja:* Even Rouault <even.rouault at spatialys.com>
> *Kopio:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>;
> gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] GDAL WMTS get tiles no documentation
>
>
>
> Hi, thank you for your replies!
> As I'm still a newbie especially with WMTS. I need to take a step back to
> the basics. Let's forget about multithreading for now.
>
>    - I'm in the stage that I can open a dataset using WMTS service path
>    from data provider
>    - I can list subdatasets and open the selected layer as a new dataset
>    using path from *SUBDATASET_id_NAME*.
>    - This dataset reports large height and width values, which is obvious.
>    - The first question is how to read any fragment from this dataset
>    using *GDALDatasetRasterIO*.
>    Is there a similar way to *SpatialFIlter *from vector layers?
>    I see in the docs there is a *<DataWindow>* tag for a local service
>    descriptions which defines extents of the data. Does it mean that for each
>    map extent change I need to create a new local XML file and open a new
>    dataset to read demanded bbox?
>    Is this the only way for doing it?
>    - From other site I noticed that QGIS downloads tiles separately? But
>    how it knows which row/col and zoom should be used in GET request? Does
>    it use GDAL for WMTS reading at all?
>
> I will be grateful for any tip and trucks for a newbie ;-)
>
>
>
> Regards,
>
> Michal
>
>
>
> ?r., 29 maj 2024 o 12:41 Even Rouault <even.rouault at spatialys.com>
> napisa?(a):
>
> Hi,
>
> The WMS cache (which is used underneath by the WMTS driver) writes each
> tiles in a separate file. So if you use multi-threaded, as long as you read
> in parallel different GDALDataset* object on the WMTS filename, and read
> disjoint areas, that should be fine. There might be a slight risk of things
> going bad if you happened to read the same tile from different GDALDataset*
> object at the same time, as it could potentially read a partially written
> cached tile, or concurrently write the tile in the cache and corrupt it.
> The logic is in frmts/wms/gdalwmscache.cpp
>
> Even
>
> Le 29/05/2024 ? 10:14, Micha? Kowalczuk via gdal-dev a ?crit :
>
> Because this is not clear in documentation, especially in WMTS driver
> docs, my question is strictly about this issue to programmers who have
> already explored this topic.
>
>
>
> Regards
>
> Michal
>
>
>
> W dniu ?r., 29.05.2024 o 10:04 Rahkonen Jukka <
> jukka.rahkonen at maanmittauslaitos.fi> napisa?(a):
>
> Hi,
>
>
>
> No, I am not sure because I do not program myself. Reading this document
> https://gdal.org/user/multithreading.html makes me feel that it is
> possible to do some things in parallel, but the programmer must know how to
> do it right.
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* Javier Jimenez Shaw <j1 at jimenezshaw.com>
> *L?hetetty:* keskiviikko 29. toukokuuta 2024 10.41
> *Vastaanottaja:* Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>
> *Kopio:* Micha? Kowalczuk <michkowalczuk at gmail.com>;
> gdal-dev at lists.osgeo.org
> *Aihe:* Re: [gdal-dev] GDAL WMTS get tiles no documentation
>
>
>
>
>
>
>
> On Wed, 29 May 2024 at 08:59, Rahkonen Jukka via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
> Hi,
>
>
>
> When you have a RasterBand  from the WMTS data source, it is abstracted
> and you can read the raster data just like from any other data source and
> raster band
> https://gdal.org/tutorials/raster_api_tut.html#reading-raster-data ?There
> are a few ways to read raster data, but the most common is via the
> GDALRasterBand::RasterIO() method. This method will automatically take care
> of data type conversion, up/down sampling and windowing.? GDAL knows which
> tiles to read.
>
>
>
> I do not know if the WMTS driver can do parallel tile downloads. If not,
> it is possible to run many RasterIO() at the same time, each reading data
> from a different window like in this rasterio document
> https://rasterio.readthedocs.io/en/latest/topics/concurrency.html.
>
>
>
> Jukka, are you sure you can run several RasterIO in parallel (on the same
> dataset)? in GDAL GeoTIFF you cannot: the cache may be corrupted. In that
> case I open several datasets over the same file. I do not know about WMTS.
>
>
>
>
>
> -Jukka Rahkonen-
>
>
>
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Michal
> Kowalczuk via gdal-dev
> *L?hetetty:* keskiviikko 29. toukokuuta 2024 9.08
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] GDAL WMTS get tiles no documentation
>
>
>
> Hi GDAL fellows
>
> This is my first post on this mailing list, so I'm asking for
> understanding.
>
>
>
> As all we know the purpose of using WMTS over WMS, I'd like to implement
> parallel downloading tiles from service using C API.
>
> In my opinion GDAL documentation (
> https://gdal.org/drivers/raster/wmts.html) says nothing on this topic.
>
> I can get capabilities from WMTS, I can open the selected subdataset but
> how to get tiles for given extent? I could not find any information how to
> do it, even in the GDAL tests on github.
>
>
>
> I am kindly asking for tips. It also can be in python. How using pure GDAL
> API fetch tiles to dynamically complete the displayed map. This is my goal.
>
>
>
> Thank you!
>
> Michal
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
>
> _______________________________________________
>
> gdal-dev mailing list
>
> gdal-dev at lists.osgeo.org
>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240531/29b8976e/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 25778 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240531/29b8976e/attachment-0001.png>

From mdsumner at gmail.com  Fri May 31 23:19:24 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Sat, 1 Jun 2024 16:19:24 +1000
Subject: [gdal-dev] gdalwarp across the antimeridian with a source extent
 >180E
Message-ID: <CAAcGz9-F2ttdk5AT+foCfiQXAXVyrcZhdm+R4uG0MGFAf5z6KQ@mail.gmail.com>

This data source has an odd georeferencing, it's a 36000x17999 raster in
the extent -179.995 -89.995 180.005 89.995.

vrt://NETCDF:/vsicurl/
https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/MUR-JPL-L4-GLOB-v4.1/20240101090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc:analysed_sst?a_srs=EPSG:4326

(Why is it 17999: well there's one missing row - you'd expect 18000 at 0.01
resolution and that manifests as half a cell short at the top and bottom).

But also the x registration is half a cell to the east from what you would
expect.

It's correctly registered in that frame though, if we shift it west by the
half cell I've verified visually that it "looks wrong" compared to
coastlines etc.

The point of this report is, gdalwarp misses the western window of data for
a request across the antimeridian (there's no data in the output east of
180).

gdalwarp $dsn -te 173.00 -19.85 185.00 -15.00 out1.tif -co COMPRESS=LZW

If we "fix" the extent to be more longitudinally pleasing, we get the data
east of the antimeridian, the map is properly filled either side of the
antimeridian.


vrt://NETCDF:/vsicurl/
https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/MUR-JPL-L4-GLOB-v4.1/20240101090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc:analysed_sst?a_srs=EPSG:4326&a_ullr=-180,89.995,180,-89.995

gdalwarp $dsnfix -te 173.00 -19.85 185.00 -15.00 out2.tif -co COMPRESS=LZW


Which is good, but as mentioned above the workaround means we are now half
a cell out. It works fine for projected windows over the antimeridian in
either situation.

The compressed file sizes reflect the missing data in the second one, these
are 625K and 1.1Mb.

I'd like the warper to be able to correctly fill the data from the western
window in the original case, we have determined that we can't feasibly
"fix" the extent.

Or maybe something else I'm missing? I don't *think* SAMPLE_GRID or
SOURCE_EXTRA helps here. I know that I could craft a meridian-crossing
combination in VRT but I'd rather like this workflow to work as-is.
(Chasing down the weird grid referencing is another project, but it's a
really massive dataset so I'm pretty unconfident of that occurring).

Cheers, Mike

-- 
Michael Sumner
Research Software Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240601/69628397/attachment.htm>

From mdsumner at gmail.com  Fri May 31 23:27:54 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Sat, 1 Jun 2024 16:27:54 +1000
Subject: [gdal-dev] gdalwarp across the antimeridian with a source
 extent >180E
In-Reply-To: <CAAcGz9-F2ttdk5AT+foCfiQXAXVyrcZhdm+R4uG0MGFAf5z6KQ@mail.gmail.com>
References: <CAAcGz9-F2ttdk5AT+foCfiQXAXVyrcZhdm+R4uG0MGFAf5z6KQ@mail.gmail.com>
Message-ID: <CAAcGz98K7KAHupZwi31ck1CL-J+7uNdvTFX2WkKoCc+CiZ2+Og@mail.gmail.com>

I forgot to mention that it needs earthdata credentials set up, basically
your "Authorization: Bearer <token>" in GDAL_HTTP_HEADERS or similar
config.

https://urs.earthdata.nasa.gov/documentation/for_users/user_token

You can't download or stream these files without that set or logging in
(the file used is indexed here:
https://cmr.earthdata.nasa.gov/virtual-directory/collections/C1996881146-POCLOUD/temporal/2024/01/01
)

I also crafted a gist to keep the formatting easier to copy paste:

https://gist.github.com/mdsumner/4ab86d52dd981621ad508297ba1a409c

Cheers, Mike



On Sat, Jun 1, 2024 at 4:19?PM Michael Sumner <mdsumner at gmail.com> wrote:

> This data source has an odd georeferencing, it's a 36000x17999 raster in
> the extent -179.995 -89.995 180.005 89.995.
>
> vrt://NETCDF:/vsicurl/
> https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/MUR-JPL-L4-GLOB-v4.1/20240101090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc:analysed_sst?a_srs=EPSG:4326
>
> (Why is it 17999: well there's one missing row - you'd expect 18000 at
> 0.01 resolution and that manifests as half a cell short at the top and
> bottom).
>
> But also the x registration is half a cell to the east from what you would
> expect.
>
> It's correctly registered in that frame though, if we shift it west by the
> half cell I've verified visually that it "looks wrong" compared to
> coastlines etc.
>
> The point of this report is, gdalwarp misses the western window of data
> for a request across the antimeridian (there's no data in the output east
> of 180).
>
> gdalwarp $dsn -te 173.00 -19.85 185.00 -15.00 out1.tif -co COMPRESS=LZW
>
> If we "fix" the extent to be more longitudinally pleasing, we get the data
> east of the antimeridian, the map is properly filled either side of the
> antimeridian.
>
>
> vrt://NETCDF:/vsicurl/
> https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/MUR-JPL-L4-GLOB-v4.1/20240101090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc:analysed_sst?a_srs=EPSG:4326&a_ullr=-180,89.995,180,-89.995
>
> gdalwarp $dsnfix -te 173.00 -19.85 185.00 -15.00 out2.tif -co COMPRESS=LZW
>
>
> Which is good, but as mentioned above the workaround means we are now half
> a cell out. It works fine for projected windows over the antimeridian in
> either situation.
>
> The compressed file sizes reflect the missing data in the second one,
> these are 625K and 1.1Mb.
>
> I'd like the warper to be able to correctly fill the data from the western
> window in the original case, we have determined that we can't feasibly
> "fix" the extent.
>
> Or maybe something else I'm missing? I don't *think* SAMPLE_GRID or
> SOURCE_EXTRA helps here. I know that I could craft a meridian-crossing
> combination in VRT but I'd rather like this workflow to work as-is.
> (Chasing down the weird grid referencing is another project, but it's a
> really massive dataset so I'm pretty unconfident of that occurring).
>
> Cheers, Mike
>
> --
> Michael Sumner
> Research Software Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>


-- 
Michael Sumner
Research Software Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240601/fa94475b/attachment.htm>

