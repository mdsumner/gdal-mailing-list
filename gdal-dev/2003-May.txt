From warmerdam at pobox.com  Thu May  1 15:52:41 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] proj4
References: <3EB02BB0.5010402@aero.und.edu>
Message-ID: <3EB17B09.7080106@pobox.com>

Xiaodong Zhang wrote:
> Hi,
> 
> I just found out that the gdal I'm using is not linked to Proj4 and I 
> can not find any definition in the GDAL configure file. How can I link 
> them together? Thanks.

Xiaodong,

Normally GDAL isn't directly linked to PROJ.4, it loads the PROJ.4
DLL/.so at runtime.  Just build and install PROJ.4 on your system and
hopefully it should just work.

This might be a good one for the FAQ!

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From warmerdam at pobox.com  Thu May  1 16:39:41 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Gdalwarp and streaming
References: <000001c30dd4$ee2fe550$d701a8c0@matt>
Message-ID: <3EB1860D.2020105@pobox.com>

Matt Lynch wrote:
> Hi,
> 
> I am trying to figure out how I can stream files in and out of gdalwarp
> (in a DOS environment).  Any suggestions would be appreciated.

Matt,

Do you mean in the sense of using operating system pipes between commands?
There is no support for that.

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From warmerdam at pobox.com  Thu May  1 09:23:49 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] proj4
In-Reply-To: <3EB05335.8080908@aero.und.edu>
References: <3EB02BB0.5010402@aero.und.edu> <3EB17B09.7080106@pobox.com> <3EB05335.8080908@aero.und.edu>
Message-ID: <3EB11FE5.2090005@pobox.com>

Xiaodong Zhang wrote:
> Hi Frank,
> 
> The Proj.4 has been installed and its library libproj.so is in the 
> searching path defined by LD_LIBRARY_PATH. What else could be wrong.

Hi,

OK, the next most common problem is when configuring GDAL on some recent
(often RedHat) systems with gcc 3.2 problems are encountered in the configure
and support for dynamic library loading (and various other things) is disabled.

Is "#define HAVE_LIBDL 1" in your gdal/port/cpl_config.h? If not or if it is
commented out, then you have this particular problem.  Likely the quickest
way to deal with it is to download a CVS nightly snapshot of the source
instead of working from the release you currently have.  Recently configures
are fixed to deal with the issue.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From sylvain.rioux at softmaptech.com  Thu May  1 10:25:11 2003
From: sylvain.rioux at softmaptech.com (Sylvain Rioux)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] 1 and 4 bits image
In-Reply-To: <20030430181352.GA9645@ak4719.spb.edu>
Message-ID: <NEBBJBLMOMCEDMBAMIFACEFLCGAA.sylvain.rioux@softmaptech.com>

Andrey,

First of all, I'm now able to read 1 and 4 bits images. Thanks to Frank for
his quick response, as always.

Yes, I'm a child of the Microsoft generation so you're right about the
Windows BMP format. I need to be able to read all the file formats GDAL is
able to read in order to develop a free software (available at the end of
June) that will be able to georeference a file from any source and output as
GeoTIFF (eventually any other formats I'll be able to write).

Thanks!

Sylvain

-----Message d'origine-----
De : gdal-dev-admin@remotesensing.org
[mailto:gdal-dev-admin@remotesensing.org]De la part de Andrey Kiselev
Envoy? : April 30, 2003 02:14 pm
? : gdal-dev@remotesensing.org
Objet : Re: [Gdal-dev] 1 and 4 bits image


Silvain,

On Wed, Apr 30, 2003 at 10:49:07AM -0400, Sylvain Rioux wrote:
> I am having trouble with 16-colors bitmaps (4 bits) and i was wondering at
> how GDAL manages this format. I get a bitmap where the pixels values seem
to
> have been slighly shifted and the result is far from what i expected. This
> problem does also occur with monochrome bitmaps. So far i successfully
read
> 256 colors bitmaps and, gifs, jpegs, and the other raster formats
supported
> by GDAL.It seems clear to me that the fact that the pixels are defined on
1
> or 4 bits rather than a byte causes this misalignment.

What file format do you mean as a ``bitmap''? MS Windows BMP?


--
Andrey V. Kiselev
Home phone:  +7 812 5274898  ICQ# 26871517
_______________________________________________
Gdal-dev mailing list
Gdal-dev@remotesensing.org
http://remotesensing.org/mailman/listinfo/gdal-dev


From dron at ak4719.spb.edu  Thu May  1 13:43:03 2003
From: dron at ak4719.spb.edu (Andrey Kiselev)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] 1 and 4 bits image
In-Reply-To: <NEBBJBLMOMCEDMBAMIFACEFLCGAA.sylvain.rioux@softmaptech.com>
References: <20030430181352.GA9645@ak4719.spb.edu> <NEBBJBLMOMCEDMBAMIFACEFLCGAA.sylvain.rioux@softmaptech.com>
Message-ID: <20030501174303.GB18285@ak4719.spb.edu>

Sylvain,

On Thu, May 01, 2003 at 10:25:11AM -0400, Sylvain Rioux wrote:
> Yes, I'm a child of the Microsoft generation so you're right about the
> Windows BMP format.

I want to warn you that 1-,4- and 8-bit Windows BMPs has a colour table,
so you can't interpret them as grayscale or monochrome images.

Besides I have found and fixed small problem in BMP driver: colour
interpretation was incorrectly reported as a grayscale for 1-bit images.
Note, that 1-bit BMPs has two colours with indexes 0 and 255 (not 0 and
1).


-- 
Andrey V. Kiselev
Home phone:  +7 812 5274898  ICQ# 26871517

From s.perkins at lanl.gov  Thu May  1 19:00:42 2003
From: s.perkins at lanl.gov (Simon Perkins)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Filling a RasterBand with a constant value?
In-Reply-To: <3EB00887.3090506@pobox.com>
References: <3EB00887.3090506@pobox.com>
Message-ID: <1051830042.18079.59.camel@afreet.lanl.gov>

Hi Frank,

I have a need to create a dataset and to ensure that the bands are
filled with zeros. I'm guessing that GDAL in general makes no guarantees
that newly created files are zeroed, and that this varies according to
the underlying driver?

So, do you think there's any need for a GDALrasterBand::Fill() method?
Based on past embarrassment, I'd better qualify that with: "Or is there
already a suitable method that does this?"!

You could achieve the same effect I suppose with repeated calls to
WriteBlock(), but you have to set up a dummy array of values to read
from which seems tedious if you just want to write a constant.

In general you might want a fill function that takes an arbitrary
rectangular region and just fills that, but I'd settle for the whole
band version for now.

The prototype for the function would be something like:

virtual CPLErr Fill(double value);

and the default implementation in GDALRasterBand would make use of the
WriteBlock() method. Formats could optionally override it with a more
efficient version if available.

I'd be happy to go ahead and add this to CVS if you think it's a
reasonable plan. What you think?

Cheers,

Sy



From warmerdam at pobox.com  Fri May  2 01:45:23 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Filling a RasterBand with a constant value?
In-Reply-To: <1051830042.18079.59.camel@afreet.lanl.gov>
References: <3EB00887.3090506@pobox.com> <1051830042.18079.59.camel@afreet.lanl.gov>
Message-ID: <3EB205F3.7020603@pobox.com>

Simon Perkins wrote:
> Hi Frank,
> 
> I have a need to create a dataset and to ensure that the bands are
> filled with zeros. I'm guessing that GDAL in general makes no guarantees
> that newly created files are zeroed, and that this varies according to
> the underlying driver?
> 
> So, do you think there's any need for a GDALrasterBand::Fill() method?
> Based on past embarrassment, I'd better qualify that with: "Or is there
> already a suitable method that does this?"!
> 
> You could achieve the same effect I suppose with repeated calls to
> WriteBlock(), but you have to set up a dummy array of values to read
> from which seems tedious if you just want to write a constant.
> 
> In general you might want a fill function that takes an arbitrary
> rectangular region and just fills that, but I'd settle for the whole
> band version for now.
> 
> The prototype for the function would be something like:
> 
> virtual CPLErr Fill(double value);

Simon,

My first impression is that this is an unnecessary method, and wouldn't
be used for much.  However, if you wish, you can implement and commit it
as a virtual method on GDALRasterBand.  I would add that the the argument
should be "(double dfRealValue, double dfImaginaryValue = 0.0 )", and that
you might even want to provide for a rectangle to apply it over.

Drivers are not required to initialize new rasters to any particular value
though of course they normally do initialize to zeros.

I would also note that the warp algorithm includes a special option to
initialize the destination raster to a particular value.  It would not
use the Fill() method

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From s.perkins at lanl.gov  Fri May  2 02:01:29 2003
From: s.perkins at lanl.gov (Simon Perkins)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Filling a RasterBand with a constant value?
In-Reply-To: <3EB205F3.7020603@pobox.com>
References: <3EB00887.3090506@pobox.com>
	 <1051830042.18079.59.camel@afreet.lanl.gov>  <3EB205F3.7020603@pobox.com>
Message-ID: <1051855287.18079.109.camel@afreet.lanl.gov>

On Thu, 2003-05-01 at 23:45, Frank Warmerdam wrote:
> > So, do you think there's any need for a GDALrasterBand::Fill() method?
> > Based on past embarrassment, I'd better qualify that with: "Or is there
> > already a suitable method that does this?"!

> My first impression is that this is an unnecessary method, and wouldn't
> be used for much.  However, if you wish, you can implement and commit it
> as a virtual method on GDALRasterBand.  I would add that the the argument
> should be "(double dfRealValue, double dfImaginaryValue = 0.0 )", and that
> you might even want to provide for a rectangle to apply it over.
> 
> Drivers are not required to initialize new rasters to any particular value
> though of course they normally do initialize to zeros.

My motivation for doing this is ensure that an image is created filled
with the NODATA value. In this scenario, the image is initialized
completely with NODATA, and then certain sub-windows of the image are
overwritten with interesting values. The plan is then to display this
image as a semi-transparent overlay within a GIS system but have the
overlay be completely transparent in the NODATA areas.

I'll probably go ahead and add this, for this use, unless someone comes
up with a better way of achieving the above effect.

To keep things simple I'll probably just do the full band fill for now.
We can always add an optional rectangle argument later if there's a
need.

Thanks for the tips!

Cheers,

Sy



From warmerdam at pobox.com  Fri May  2 10:08:52 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Filling a RasterBand with a constant value?
In-Reply-To: <1051855287.18079.109.camel@afreet.lanl.gov>
References: <3EB00887.3090506@pobox.com>	 <1051830042.18079.59.camel@afreet.lanl.gov>  <3EB205F3.7020603@pobox.com> <1051855287.18079.109.camel@afreet.lanl.gov>
Message-ID: <3EB27BF4.4070102@pobox.com>

Simon Perkins wrote:
> To keep things simple I'll probably just do the full band fill for now.
> We can always add an optional rectangle argument later if there's a
> need.

Sy,

The caveat on this is any change to a method signature makes the C++ API
binary incompatible with previous versions.  Any change to the number of
arguments to a method with a C binding makes that C binding no longer safe
to call cross-version, though at least applications that don't call it won't
be affected since the signature in C won't have changed.

In many cases I prefer to include all options I would be interested in for
a method/function call at the beginning and mark some as unimplemented in
the docs if I don't want to do them right away.  Especially at the C level
I want applications built on old GDAL libraries to be safe to use with newer
versions of the library.  At the C++ level I have accepted that an application
pretty much has to be compiled against the exact same rev. of the library.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From marcus at keyholecorp.com  Fri May  2 13:51:44 2003
From: marcus at keyholecorp.com (Marcus Barnes)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Filling a RasterBand with a constant value?
In-Reply-To: <3EB27BF4.4070102@pobox.com>
Message-ID: <000201c310d3$7e65a3c0$aa03000a@marcuswxp>

I would like to strengthen Frank's statement. Adding a new method to a
class breaks binary and link compatibility. Therefore if a method is
added to a class it is a major revision of the software. Not a minor or
maintenance revision. 

This is a general principle of versioning that aims to avoid "DLL Hell"
among other problems. Minor and Maintenance versions of software are
required to be link compatible. So an application that compiles against
library v1.0 will run with any version v1.x.y of that library without
recompilation or relinking.

So unless you are prepared to change GDAL to 2.0.0 across the board I
would look for a compatible means to achieve this fill effect.

Regards.
---
Marcus Barnes mailto:marcus@keyholecorp.com 
Keyhole Inc. Mt View, CA http://www.earthviewer.com
 

-----Original Message-----
From: gdal-dev-admin@remotesensing.org
[mailto:gdal-dev-admin@remotesensing.org] On Behalf Of Frank Warmerdam
Sent: Friday, May 02, 2003 7:09 AM
To: gdal-dev@remotesensing.org
Subject: Re: [Gdal-dev] Filling a RasterBand with a constant value?


Simon Perkins wrote:
> To keep things simple I'll probably just do the full band fill for 
> now. We can always add an optional rectangle argument later if there's

> a need.

Sy,

The caveat on this is any change to a method signature makes the C++ API
binary incompatible with previous versions.  Any change to the number of
arguments to a method with a C binding makes that C binding no longer
safe to call cross-version, though at least applications that don't call
it won't be affected since the signature in C won't have changed.

In many cases I prefer to include all options I would be interested in
for a method/function call at the beginning and mark some as
unimplemented in the docs if I don't want to do them right away.
Especially at the C level I want applications built on old GDAL
libraries to be safe to use with newer versions of the library.  At the
C++ level I have accepted that an application pretty much has to be
compiled against the exact same rev. of the library.

Best regards,

-- 
---------------------------------------+--------------------------------
---------------------------------------+------
I set the clouds in motion - turn up   | Frank Warmerdam,
warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent


_______________________________________________
Gdal-dev mailing list
Gdal-dev@remotesensing.org
http://remotesensing.org/mailman/listinfo/gdal-dev


From warmerdam at pobox.com  Fri May  2 15:13:27 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Filling a RasterBand with a constant value?
In-Reply-To: <000201c310d3$7e65a3c0$aa03000a@marcuswxp>
References: <000201c310d3$7e65a3c0$aa03000a@marcuswxp>
Message-ID: <3EB2C357.7040300@pobox.com>

Marcus Barnes wrote:
> I would like to strengthen Frank's statement. Adding a new method to a
> class breaks binary and link compatibility. Therefore if a method is
> added to a class it is a major revision of the software. Not a minor or
> maintenance revision. 
> 
> This is a general principle of versioning that aims to avoid "DLL Hell"
> among other problems. Minor and Maintenance versions of software are
> required to be link compatible. So an application that compiles against
> library v1.0 will run with any version v1.x.y of that library without
> recompilation or relinking.
> 
> So unless you are prepared to change GDAL to 2.0.0 across the board I
> would look for a compatible means to achieve this fill effect.

Marcus,

I would like to add a few qualifications.

  o Adding a new non-virtual method does not have any significant
    ramifications on backwards compatibility.  The new version of the library
    can be used in the place of old versions without problems by C++ classes.

  o Add a new virtual method changes the organization of the vtable (the
    virtual method function table) for the class, and unless the new method
    happens to be added at the end, it will break binary compatibility.  The
    new library cannot be used in place of the old one for applications using
    the C++ API.

  o Adding new data members in class the application call create with new
    also breaks backward compatiblity.

  o Adding virtual methods or data members does not have any impact on
    applications using the C API.

In general the only thing that will break backward compatibility for C
applications is removing a C callable function or changing the argument list
of a C callable function.

I have come to accept tight coupling in GDAL C++ applications to the library.
The class data members, and virtual method tables change pretty much every
week in CVS.  The latest example of this was my addition of the GDALDataset
class level methods for RasterIO() on behalf of Keyhole I might add!  However,
I try to be very circumspect about changing the argument lists of existing
C functions, or of removing existing ones.  In some cases, like
GDALGetDriverShortName(), I actually retained the C entry point and
redirected it after the methodology of the C++ classes moved this info into
driver metadata.

I would also note that effectively the major version of GDAL is currently "1.1"
not "1".  I have used the prefix "1.1" ever since a few months after the first
GDAL release in 1998 or so.  This is really lame version naming on my part.

It is my intention to goto 1.2.x versions fairly soon, and at that time to
start including proper version information in the names of the installed
GDAL libraries with semantics matching what you describe (at the C but not
C++ level).  A move to 2.x would likely not happen unless I finally unify the
the GDAL and OGR APIs. I forsee no real other need for that degree of breakage
on backward compatibility.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From s.perkins at lanl.gov  Fri May  2 16:32:29 2003
From: s.perkins at lanl.gov (Simon Perkins)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Filling a RasterBand with a constant value?
In-Reply-To: <3EB2C357.7040300@pobox.com>
References: <000201c310d3$7e65a3c0$aa03000a@marcuswxp>
	 <3EB2C357.7040300@pobox.com>
Message-ID: <1051907549.3537.63.camel@afreet.lanl.gov>

On Fri, 2003-05-02 at 13:13, Frank Warmerdam wrote:
> I have come to accept tight coupling in GDAL C++ applications to the library.
> The class data members, and virtual method tables change pretty much every
> week in CVS.  The latest example of this was my addition of the GDALDataset
> class level methods for RasterIO() on behalf of Keyhole I might add!  However,
> I try to be very circumspect about changing the argument lists of existing
> C functions, or of removing existing ones.  In some cases, like
> GDALGetDriverShortName(), I actually retained the C entry point and
> redirected it after the methodology of the C++ classes moved this info into
> driver metadata.

In my C++ code that uses GDAL, I now always use the C API, for this
reason. I was burned once before on binary incompatibility issues, using
the C++ API, so I switched all my code to using the C API, which is only
very slightly more verbose and has almost exactly the same
functionality.

I also disliked having to include a header file called gdal_priv.h to
get access to the C++ interface. It just felt wrong...

Cheers!

Sy



From marcus at keyholecorp.com  Fri May  2 17:53:22 2003
From: marcus at keyholecorp.com (Marcus Barnes)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Filling a RasterBand with a constant value?
In-Reply-To: <3EB2C357.7040300@pobox.com>
Message-ID: <000d01c310f5$401166a0$aa03000a@marcuswxp>


> -----Original Message-----
> From: gdal-dev-admin@remotesensing.org 
> [mailto:gdal-dev-admin@remotesensing.org] On Behalf Of Frank Warmerdam
> Sent: Friday, May 02, 2003 12:13 PM
> To: gdal-dev@remotesensing.org
> Subject: Re: [Gdal-dev] Filling a RasterBand with a constant value?
> 
> Marcus,
> 
> I would like to add a few qualifications.
> 
>   o Adding a new non-virtual method does not have any significant
>     ramifications on backwards compatibility.  The new 
>     version of the library
>     can be used in the place of old versions without problems 
>     by C++ classes.

Yes that's true.

>   o Add a new virtual method changes the organization of the 
>     vtable (the
>     virtual method function table) for the class, and unless 
>     the new method
>     happens to be added at the end, it will break binary 
>     compatibility.  The
>     new library cannot be used in place of the old one for 
>     applications using
>     the C++ API.

Right this was the case I was really trying to express. I forgot to
mention the word "virtual" in my reply. Sorry about that.

On a more obscure note... Changes to access control is another
qualification that breaks C++ binary compatibility. For example,
changing a class member from public to protected. This is because the
compiler implementation may include the access level in the mangled name
that the linker sees. Application code that attempts to call (or
reference) the previously public (non virtual) class member should
(will) fail.

Regards.
---
Marcus Barnes mailto:marcus@keyholecorp.com 
Keyhole Inc. Mt View, CA http://www.earthviewer.com
 



From rogerjames99 at btinternet.com  Sat May  3 07:40:32 2003
From: rogerjames99 at btinternet.com (Roger James)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] UK OS Mastermap GML
Message-ID: <000001c31168$ce101fa0$fe0aa8c0@lancaster.beardandsandals.co.uk>

Frank,

 

I have been looking at getting ogr to read the new UK OS Mastermap GML
formats. The current gml reader cannot do this because is does not
recognise the OS derived schema. I noticed from some earlier posting you
has been doing something in the gml schema area (you mention an
XSISCHEMA schema option), however, this appears to be output only, and I
cannot find any reference to it in the current source!

 

Before I start hacking away at this, are you (or anyone else) doing
anything in this area.

 

For info here is a snippet from a Mastermap file (I hope the OS don't
sue me!).

 

<?xml version='1.0' encoding='UTF-8'?>

<osgb:FeatureCollection

xmlns:osgb='http://www.ordnancesurvey.co.uk/xml/namespaces/osgb'

xmlns:gml='http://www.opengis.net/gml'

xmlns:xlink='http://www.w3.org/1999/xlink'

xmlns:xsi='http://www.w3.org/2000/10/XMLSchema-instance'

xsi:schemaLocation='http://www.ordnancesurvey.co.uk/xml/namespaces/osgb
http://www.ordnancesurvey.co.uk/xml/schema/v2/OSDNFFeatures.xsd'

fid='GDS-2085-1'>

<gml:description>Ordnance Survey, (c) Crown Copyright. All rights
reserved, 2003-03-13</gml:description>

<gml:boundedBy><gml:null>unknown</gml:null></gml:boundedBy>

<osgb:queryTime>2003-03-13T13:22:16</osgb:queryTime>

<osgb:queryExtent>

<gml:Polygon srsName='osgb:BNG'>

<gml:outerBoundaryIs>

<gml:LinearRing>

<gml:coordinates>stuff deleted</gml:coordinates>

</gml:LinearRing>

</gml:outerBoundaryIs>

</gml:Polygon>

</osgb:queryExtent>

<osgb:topographicMember>

<osgb:TopographicPoint fid='osgb1000001116199139'>

<osgb:featureCode>10197</osgb:featureCode>

<osgb:version>1</osgb:version>

<osgb:versionDate>2001-11-09</osgb:versionDate>

<osgb:theme>Terrain And Height</osgb:theme>

<osgb:accuracyOfPosition>Unknown</osgb:accuracyOfPosition>

<osgb:changeHistory>

<osgb:changeDate>1992-06-01</osgb:changeDate>

<osgb:reasonForChange>New</osgb:reasonForChange>

</osgb:changeHistory>

<osgb:descriptiveGroup>Terrain And Height</osgb:descriptiveGroup>

<osgb:descriptiveTerm>Spot Height</osgb:descriptiveTerm>

<osgb:heightAboveDatum>

<osgb:heightAboveDatum>41.5</osgb:heightAboveDatum>

<osgb:accuracyOfHeightAboveDatum>2.5m</osgb:accuracyOfHeightAboveDatum>

</osgb:heightAboveDatum>

<osgb:physicalLevel>50</osgb:physicalLevel>

<osgb:point>

<gml:Point
srsName='osgb:BNG'><gml:coordinates>347297.300,465584.000</gml:coordinat
es></gml:Point>

</osgb:point>

</osgb:TopographicPoint>

</osgb:topographicMember>

 

I was thinking that a quick hack would be to just change some of the
built in schema strings that you scan for.  But that seems very ugly.

 

Roger

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.osgeo.org/pipermail/gdal-dev/attachments/20030503/8deb24db/attachment.html
From warmerdam at pobox.com  Mon May  5 11:38:12 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] UK OS Mastermap GML
In-Reply-To: <000001c31168$ce101fa0$fe0aa8c0@lancaster.beardandsandals.co.uk>
References: <000001c31168$ce101fa0$fe0aa8c0@lancaster.beardandsandals.co.uk>
Message-ID: <3EB68564.3050506@pobox.com>

Roger James wrote:
> Frank,
> 
>  
> 
> I have been looking at getting ogr to read the new UK OS Mastermap GML 
> formats. The current gml reader cannot do this because is does not 
> recognise the OS derived schema. I noticed from some earlier posting you 
> has been doing something in the gml schema area (you mention an 
> XSISCHEMA schema option), however, this appears to be output only, and I 
> cannot find any reference to it in the current source!

...

> 
> I was thinking that a quick hack would be to just change some of the 
> built in schema strings that you scan for.  But that seems very ugly.

Roger,

The main problem with OS Mastermap data is that OGR's GML reader looks
specifically for featureMember elements to identify features.  When I add
osgb:cartographicMember to the IsFeature() test, the Mastermap data seems
to more or less work.

The work related to XSISCHEMA was really adding a mechanism for someone
creating files with GML to add a reference to a previously created schema
file.  I have also added a bunch of logic to try and create a valid schema
on the fly in a .xsd file, though I am not sure whether the result is valid.
Neither of these will help much in reading OS Mastermap data.

I am not exactly sure how to proceed.  Currently when OGR reads a GML file
it writes out a .gfs file which contains informaton on the schema, feature
count and extents so that subsequent reads of the file can skip the extra
"exploration" pass, and so metadata will be known from the start.  My
intention was always that .gfs files could also contain various rules
for reading tricky GML files.  So in this OS MasterMap case it might
contains information on how to identify features (they are children of
<osgb:cartographicMember>), or allowing renaming and typing of otherwise
untyped properties.

The other approach is to add proper schema (.xsd) reading to the OGR GML
reader.   This would potentially make OGR much more robust as all the
information actually embedded in the .xsd files could be used to identify
features; however, it is very difficult.

What I have done for the time being is modify the code to treat any element
ending in "member" as potentially containing a feature.  This works for the
OS MasterMap data.

I would suggest you try the latest from CVS and see if it is adequate to
your needs.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From rogerjames99 at btinternet.com  Mon May  5 14:34:57 2003
From: rogerjames99 at btinternet.com (Roger James)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] UK OS Mastermap GML
In-Reply-To: <3EB68564.3050506@pobox.com>
Message-ID: <000001c31335$0dfacac0$fe0aa8c0@lancaster.beardandsandals.co.uk>

Frank,

Thanks for the quick turnaround. I have checked it against my data and
it does what I would expect it to.

I am currently working on Ben's vterrain base to update the feature
import. We both thought it would be a good idea to move to ogr as the
importer of first resort. The new OSGB gml format was one of my test
cases. In the first instance I just wanted to see if I could get OGR to
parse the file!

As you have already surmised, it looks like more work is needed to get a
robust feature import mechanism. From the vtp perspective I think it
would be better if this work was "under the hood" in ogr.

By the way, XSISCHEMA has now appeared in my source tree. I am intrigued
as to why I never saw it before ;-)

Roger

> -----Original Message-----
> From: gdal-dev-admin@remotesensing.org [mailto:gdal-dev-
> admin@remotesensing.org] On Behalf Of Frank Warmerdam
> Sent: 05 May 2003 16:38
> To: gdal-dev@remotesensing.org
> Subject: Re: [Gdal-dev] UK OS Mastermap GML
> 
> Roger James wrote:
> > Frank,
> >
> >
> >
> > I have been looking at getting ogr to read the new UK OS Mastermap
GML
> > formats. The current gml reader cannot do this because is does not
> > recognise the OS derived schema. I noticed from some earlier posting
you
> > has been doing something in the gml schema area (you mention an
> > XSISCHEMA schema option), however, this appears to be output only,
and I
> > cannot find any reference to it in the current source!
> 
> ...
> 
> >
> > I was thinking that a quick hack would be to just change some of the
> > built in schema strings that you scan for.  But that seems very
ugly.
> 
> Roger,
> 
> The main problem with OS Mastermap data is that OGR's GML reader looks
> specifically for featureMember elements to identify features.  When I
add
> osgb:cartographicMember to the IsFeature() test, the Mastermap data
seems
> to more or less work.
> 
> The work related to XSISCHEMA was really adding a mechanism for
someone
> creating files with GML to add a reference to a previously created
schema
> file.  I have also added a bunch of logic to try and create a valid
schema
> on the fly in a .xsd file, though I am not sure whether the result is
> valid.
> Neither of these will help much in reading OS Mastermap data.
> 
> I am not exactly sure how to proceed.  Currently when OGR reads a GML
file
> it writes out a .gfs file which contains informaton on the schema,
feature
> count and extents so that subsequent reads of the file can skip the
extra
> "exploration" pass, and so metadata will be known from the start.  My
> intention was always that .gfs files could also contain various rules
> for reading tricky GML files.  So in this OS MasterMap case it might
> contains information on how to identify features (they are children of
> <osgb:cartographicMember>), or allowing renaming and typing of
otherwise
> untyped properties.
> 
> The other approach is to add proper schema (.xsd) reading to the OGR
GML
> reader.   This would potentially make OGR much more robust as all the
> information actually embedded in the .xsd files could be used to
identify
> features; however, it is very difficult.
> 
> What I have done for the time being is modify the code to treat any
> element
> ending in "member" as potentially containing a feature.  This works
for
> the
> OS MasterMap data.
> 
> I would suggest you try the latest from CVS and see if it is adequate
to
> your needs.
> 
> Best regards,
> 
> --
>
---------------------------------------+--------------------------------
--
> ----
> I set the clouds in motion - turn up   | Frank Warmerdam,
> warmerdam@pobox.com
> light and sound - activate the windows | http://pobox.com/~warmerdam
> and watch the world go round - Rush    | Geospatial Programmer for
Rent
> 
> 
> _______________________________________________
> Gdal-dev mailing list
> Gdal-dev@remotesensing.org
> http://remotesensing.org/mailman/listinfo/gdal-dev


From s.perkins at lanl.gov  Mon May  5 14:57:47 2003
From: s.perkins at lanl.gov (Simon Perkins)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] FITS Metadata Change
In-Reply-To: <3EB00887.3090506@pobox.com>
References: <3EB00887.3090506@pobox.com>
Message-ID: <1052161067.13407.49.camel@afreet.lanl.gov>

Hi,

This is only of possible interest to people who use the FITS driver in
GDAL...

I want to commit a small change (AKA fixing a small design flaw) to the
way metadata is handled for the FITS driver. I don't know if anyone else
is using this driver and probably even if you are this change will have
no effect, but just in case...

The essence of the change is to with the way that GDAL metadata is
mapped onto the underlying metadata that FITS files support. Both types
of metadata consist of key/value pairs where the key is a string. In
GDAL, the value is also always a string, but in FITS, the value may be
of arbitrary type and the FITS standard specifies that these different
types should be physically stored in different ways. To try to follow
this standard, the current GDAL FITS driver inspects the GDAL value
string and then tries to guess what type of data it represents. It then
uses the appropriate method to write the metadata.

Trouble is, it can guess wrong. For instance a version number might have
significant leading zeros that would be stripped off if the value is
treated as a numeric one. So I'm proposing to revert to a simpler scheme
where all values are stored as strings. Pure GDAL users will not notice
any difference. People using the standard CFITSIO library to read GDAL
written files will also not notice a difference since that library does
automatic type conversions. People assuming that a metadata value
written under GDAL will appear in the file in a specific physical way,
might have problems. If you're in this final category, let me know!
Otherwise I'll commit the change to CVS sometime soon.

Cheers,

Sy



From Martin.Daly at cadcorp.com  Tue May  6 04:40:32 2003
From: Martin.Daly at cadcorp.com (Martin Daly)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] UK OS Mastermap GML
Message-ID: <DE8A435707FBA24392E5C67F58E294AA3FC2@dev001_pdc.Dev.cadcorp.net>

Roger, Frank,

> > The main problem with OS Mastermap data is that OGR's GML reader
looks 
> > specifically for featureMember elements to identify features.  When
I add
> > osgb:cartographicMember to the IsFeature() test, the Mastermap data
seems
> > to more or less work.

This approach will "more or less" work with one flavour of OS MasterMap,
Independent Polygons, where each feature defines its own geometry.
However, there is another flavour, Topological, where Polygons are
specified as in the following snippet:

<osgb:topographicMember>
<osgb:TopographicArea fid='osgb1000000756121907'>
<osgb:featureCode>10096</osgb:featureCode>
<osgb:version>1</osgb:version>
<osgb:versionDate>2001-11-07</osgb:versionDate>
<osgb:theme>Land</osgb:theme>
<osgb:calculatedAreaValue>50.956252</osgb:calculatedAreaValue>
<osgb:changeHistory>
<osgb:changeDate>1970-01-01</osgb:changeDate>
<osgb:reasonForChange>New</osgb:reasonForChange>
</osgb:changeHistory>
<osgb:descriptiveGroup>Landform</osgb:descriptiveGroup>
<osgb:descriptiveTerm>Slope</osgb:descriptiveTerm>
<osgb:make>Manmade</osgb:make>
<osgb:physicalLevel>50</osgb:physicalLevel>
<osgb:polygon>
<osgb:outerBoundaryIs>
<osgb:Ring orientation='anticlockwise'>
<osgb:ringMember orientation='-' xlink:href='#osgb1000000756121843'/>
<osgb:ringMember orientation='-' xlink:href='#osgb1000000756121831'/>
</osgb:Ring>
</osgb:outerBoundaryIs>
</osgb:polygon>
</osgb:TopographicArea>
</osgb:topographicMember>

Note also that the referenced osgb:ringMember-s may appear either
earlier or later in the stream, or, in the case of change-only updates,
might not appear at all.

Finally, there is a new "layer" of OS MasterMap Integrated Transport
Network (ITN) that makes even more use of topological structures, that
is unlikely to work well with Frank's short term fix.

Regards,
Martin

From shimitz at usgs.gov  Tue May  6 23:08:27 2003
From: shimitz at usgs.gov (April Shimitz)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] multiple input images to gdal_translate
Message-ID: <OFE7EB3785.ED8A65CB-ON86256D1F.001140AD-86256D1F.001140F4@cr.usgs.gov>

An HTML attachment was scrubbed...
URL: http://lists.osgeo.org/pipermail/gdal-dev/attachments/20030506/d6021332/attachment.html
From warmerdam at pobox.com  Wed May  7 23:23:25 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] multiple input images to gdal_translate
References: <OFE7EB3785.ED8A65CB-ON86256D1F.001140AD-86256D1F.001140F4@cr.usgs.gov>
Message-ID: <3EB9CDAD.3070201@pobox.com>

April Shimitz wrote:
> 
> Frank,
>  
>  From the documentation it looks like gdal_translate only takes one 
> input image. Is there any undocumented functionality of the utility to 
> allow multiple input images (mosaic them together to create the output 
> image)? Perhaps this is outside the scope of gdal_translate, but do you 
> have any plans to enhance it to provide this functionality?

April,

The method mostly used for merging multiple datasets currently is
gdal_merge.py.  As long as the inputs are all in the same coordinate system
(though they can be different resolutions).  However, due to the method of
implementation (in python loading each image as a whole) gdal_merge.py has
some sigificant limitations.

The gdalwarp and gdalwarptest can be used to mosaic, but, unlike gdal_merge.py,
they won't scan all the input images, and establish a maximum extent and
preferred resolution for you.   Instead, if you want  mosaic you need to
work out the bounds, coordinate system and resolution yourself and set
it explicitly on the first warp call.   Subsequent warps can mosaic additional
images into the same output file.

What I would do, it modify gdalwarptest (which will eventually become
gdalwarp) to support this automatically.

Subsequent warps can be done with gdalwarp or gdalwarptest into an existing
file.

You can experiment with this now with gdalwarp or gdalwarptest.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From rogerjames99 at btinternet.com  Wed May  7 09:07:23 2003
From: rogerjames99 at btinternet.com (Roger James)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Glitch with gml driver on windows
In-Reply-To: <3EB68564.3050506@pobox.com>
Message-ID: <000001c31499$9a035f90$fe0aa8c0@lancaster.beardandsandals.co.uk>

Frank,

I think the following code snippet from gmlreader.cpp (line 597) has a
problem on windows. It's the old cr/lf thing.

    if( VSIFRead( pszWholeText, nLength, 1, fp ) != 1 )
    {
        VSIFree( pszWholeText );
        VSIFClose( fp );
        CPLError( CE_Failure, CPLE_AppDefined, 
                  "Read failed on %s.", pszFile );
        return FALSE;
    }

This will always fail on windos because the file has been opened in text
mode and crlf translation is taking place. You have calculated nLength
by using the position pointers, which give the length on disk including
lf chars. VSIFRead calls fread which calculates its read length after
the lf chars have been stripped. This means this piece of code always
detects a failure and the reader goes on to create another gfs file,
which it then fails to save because one already exists.

I cannot think of an easy clean fix for this one without prescanning the
file. The dirty way is to ignore the test on windos systems.

Roger


From bfraser at geoanalytic.com  Wed May  7 14:11:25 2003
From: bfraser at geoanalytic.com (Brent Fraser)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] GDAL, JasPer, JPEG2000 memory management plans?
Message-ID: <01b501c314c4$17330130$020002c0@SHARK>

Frank, Andrey (and others),

    I've done some experimenting with GDAL's JPEG2000 capabilities on Windows 2000.

    While I got good results with a small (2mb, 929 x 986 pixels, RGB) and medium (20 mb, 2961 x 2270, RGB) size files, I noticed memory management  problems with large (100 mb, 4482 x x9011, RGB) and huge (1 gb, 18595 x 19729, RGB) files.

    During the translation of the large 100 mb file, 1.4 gb of ram was eventually allocated (90% of it by the JasPer code), but it did successfully finish after about 20 min.

    With the huge 1 gb tif file, GDAL_translate appears to allocate about 1 gb during the reading of the original tif file and attemps to allocate another 1 gb (in the Jasper code) just before starting to compress.  The second memory allocation fails on my computer (Windows 2000) even though I've got my virtual memory set to the maximum of 4 gb.

    Are there any enhancements that could be done to GDAL to reduce the amount of memory used?  I realize that wavelet compression (or at least the implementation in JasPer) may not lend itself to efficient memory use, and that GDAL's integration of JasPer is fairly new, but I thought I would get my request in early!

FYI, here's an example of my command line for the translation: 
    gdal_translate -of JPEG2000 -co "FORMAT=JP2" -co "rate=0.05" small.tif small.jp2

Thanks and keep up the good work!

Brent Fraser
GeoAnalytic Inc.
Tel:(403) 213-2700
bfraser@geoanalytic.com
www.geoanalytic.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.osgeo.org/pipermail/gdal-dev/attachments/20030507/a6dc9c84/attachment.html
From warmerdam at pobox.com  Wed May  7 14:34:05 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] GDAL, JasPer, JPEG2000 memory management plans?
In-Reply-To: <01b501c314c4$17330130$020002c0@SHARK>
References: <01b501c314c4$17330130$020002c0@SHARK>
Message-ID: <3EB9519D.9070400@pobox.com>

>     Are there any enhancements that could be done to GDAL to reduce the 
> amount of memory used?  I realize that wavelet compression (or at least 
> the implementation in JasPer) may not lend itself to efficient memory 
> use, and that GDAL's integration of JasPer is fairly new, but I thought 
> I would get my request in early!

Brent,

The fact that JasPer as it currently exists always decompresses the entire
image in one pass is the reason that the JasPer driver is not very appropriate
for sizable jpeg2000 files.  If you can, use the JP2KAK driver which uses
the Kakadu library.   If you can't ... well ... don't use jpeg2000?

We have hopes that someday Andrey might be able to work with the JasPer
developer to refactor for windowed access, but I don't know how far away that
is.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From Carl.Anderson at co.fulton.ga.us  Wed May  7 14:42:26 2003
From: Carl.Anderson at co.fulton.ga.us (Anderson, Carl)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] GDAL, JasPer, JPEG2000 memory management plans?
Message-ID: <73EE6720ADE81140A05137BDE0B0FB0A45A91E@fcgctex03.co.fulton.ga.us>

 
 
I have been having problems encoding 13001x13001 JEPG2000 images on a
Linux 2.4.20 machine and a Solaris 2.7 machine using gdal_translate and
jasper
 
on each machine unless I use tiling, encoding  dies inside jasper at
    jpc_t1enc.c on line 349   (  assert(0)  )
 
When I do use tiling the result is ok.
 
 
RE memory management:
 
what about an implementation of a "Row-based wavelet transform" as
described in
ITU-T Rec T.800 (2000 FCDV1.0) page 163. Downloadable from
http://www.jpeg.org/public/fcd15444-1.pdf
 
of course that is really a jasper issue not a gdal one, and it may
already be in the jasper lib.
 
 
 

Carl Anderson

 

GIS Manager

Fulton County E&CD

404.730.8026

carl.anderson@co.fulton.ga.us

 

-----Original Message-----
From: Brent Fraser [mailto:bfraser@geoanalytic.com] 
Sent: Wednesday, May 07, 2003 2:11 PM
To: gdal-dev
Subject: [Gdal-dev] GDAL, JasPer, JPEG2000 memory management plans?


Frank, Andrey (and others),
 
    I've done some experimenting with GDAL's JPEG2000 capabilities on
Windows 2000.
 
    While I got good results with a small (2mb, 929 x 986 pixels, RGB)
and medium (20 mb, 2961 x 2270, RGB) size files, I noticed memory
management  problems with large (100 mb, 4482 x x9011, RGB) and huge (1
gb, 18595 x 19729, RGB) files.
 
    During the translation of the large 100 mb file, 1.4 gb of ram was
eventually allocated (90% of it by the JasPer code), but it did
successfully finish after about 20 min.
 
    With the huge 1 gb tif file, GDAL_translate appears to allocate
about 1 gb during the reading of the original tif file and attemps to
allocate another 1 gb (in the Jasper code) just before starting to
compress.  The second memory allocation fails on my computer (Windows
2000) even though I've got my virtual memory set to the maximum of 4 gb.
 
    Are there any enhancements that could be done to GDAL to reduce the
amount of memory used?  I realize that wavelet compression (or at least
the implementation in JasPer) may not lend itself to efficient memory
use, and that GDAL's integration of JasPer is fairly new, but I thought
I would get my request in early!
 
FYI, here's an example of my command line for the translation: 
    gdal_translate -of JPEG2000 -co "FORMAT=JP2" -co "rate=0.05"
small.tif small.jp2
 
Thanks and keep up the good work!
 
Brent Fraser
GeoAnalytic Inc.
Tel:(403) 213-2700
bfraser@geoanalytic.com
www.geoanalytic.com
  _____  


The contents of this message have been scanned for viruses by
the TruSecure ShadowMail Service, and no viruses were found.




-----------------------------------------------------------------------

The contents of this message have been scanned for viruses by
the TruSecure ShadowMail Service, and no viruses were found.


-----------------------------------------------------------------------


* This message has been processed by TruSecure's ShadowMail service
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.osgeo.org/pipermail/gdal-dev/attachments/20030507/ff320824/attachment.html
From bfraser at geoanalytic.com  Wed May  7 15:17:26 2003
From: bfraser at geoanalytic.com (Brent Fraser)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] GDAL, JasPer, JPEG2000 memory management plans?
References: <73EE6720ADE81140A05137BDE0B0FB0A45A91E@fcgctex03.co.fulton.ga.us>
Message-ID: <01d701c314cd$4bd16090$020002c0@SHARK>

MessageCarl,

   I thought that using some more JasPer parameters might improve my situation, but JasPer's doc didn't go into very much detail on parameters (and I wasn't looking forward to reading the JPEG2000 spec at this point in my investigation).

   Can you give me an example of the gdal_translate command line you use with tiling parameters?

Thanks!
Brent Fraser
  ----- Original Message ----- 
  From: Anderson, Carl 
  To: gdal-dev@remotesensing.org 
  Sent: Wednesday, May 07, 2003 12:42 PM
  Subject: RE: [Gdal-dev] GDAL, JasPer, JPEG2000 memory management plans?




  I have been having problems encoding 13001x13001 JEPG2000 images on a
  Linux 2.4.20 machine and a Solaris 2.7 machine using gdal_translate and jasper

  on each machine unless I use tiling, encoding  dies inside jasper at
      jpc_t1enc.c on line 349   (  assert(0)  )

  When I do use tiling the result is ok.


  RE memory management:

  what about an implementation of a "Row-based wavelet transform" as described in
  ITU-T Rec T.800 (2000 FCDV1.0) page 163. Downloadable from http://www.jpeg.org/public/fcd15444-1.pdf

  of course that is really a jasper issue not a gdal one, and it may already be in the jasper lib.



  Carl Anderson

   

  GIS Manager

  Fulton County E&CD

  404.730.8026

  carl.anderson@co.fulton.ga.us

   

    -----Original Message-----
    From: Brent Fraser [mailto:bfraser@geoanalytic.com] 
    Sent: Wednesday, May 07, 2003 2:11 PM
    To: gdal-dev
    Subject: [Gdal-dev] GDAL, JasPer, JPEG2000 memory management plans?


    Frank, Andrey (and others),

        I've done some experimenting with GDAL's JPEG2000 capabilities on Windows 2000.

        While I got good results with a small (2mb, 929 x 986 pixels, RGB) and medium (20 mb, 2961 x 2270, RGB) size files, I noticed memory management  problems with large (100 mb, 4482 x x9011, RGB) and huge (1 gb, 18595 x 19729, RGB) files.

        During the translation of the large 100 mb file, 1.4 gb of ram was eventually allocated (90% of it by the JasPer code), but it did successfully finish after about 20 min.

        With the huge 1 gb tif file, GDAL_translate appears to allocate about 1 gb during the reading of the original tif file and attemps to allocate another 1 gb (in the Jasper code) just before starting to compress.  The second memory allocation fails on my computer (Windows 2000) even though I've got my virtual memory set to the maximum of 4 gb.

        Are there any enhancements that could be done to GDAL to reduce the amount of memory used?  I realize that wavelet compression (or at least the implementation in JasPer) may not lend itself to efficient memory use, and that GDAL's integration of JasPer is fairly new, but I thought I would get my request in early!

    FYI, here's an example of my command line for the translation: 
        gdal_translate -of JPEG2000 -co "FORMAT=JP2" -co "rate=0.05" small.tif small.jp2

    Thanks and keep up the good work!

    Brent Fraser
    GeoAnalytic Inc.
    Tel:(403) 213-2700
    bfraser@geoanalytic.com
    www.geoanalytic.com

----------------------------------------------------------------------------

    The contents of this message have been scanned for viruses by
    the TruSecure ShadowMail Service, and no viruses were found.



------------------------------------------------------------------------------

  The contents of this message have been scanned for viruses by
  the TruSecure ShadowMail Service, and no viruses were found.



------------------------------------------------------------------------------

  * This message has been processed by TruSecure's ShadowMail service


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.osgeo.org/pipermail/gdal-dev/attachments/20030507/dd35cdc4/attachment.html
From dron at ak4719.spb.edu  Wed May  7 16:15:19 2003
From: dron at ak4719.spb.edu (Andrey Kiselev)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] GDAL, JasPer, JPEG2000 memory management plans?
In-Reply-To: <01b501c314c4$17330130$020002c0@SHARK>
References: <01b501c314c4$17330130$020002c0@SHARK>
Message-ID: <20030507201519.GA17551@ak4719.spb.edu>

On Wed, May 07, 2003 at 12:11:25PM -0600, Brent Fraser wrote:
>     I've done some experimenting with GDAL's JPEG2000 capabilities on
>     Windows 2000. While I got good results with a small (2mb, 929 x
>     986 pixels, RGB) and medium (20 mb, 2961 x 2270, RGB) size files,
>     I noticed memory management  problems with large (100 mb, 4482 x
>     x9011, RGB) and huge (1 gb, 18595 x 19729, RGB) files.

Brent,

Frank exactly describes the situation with JasPer. This library in
current state is not suitable for large image processing. It has
significant memory requirements. In fact you will need in 8x-10x times
more memory than needed for storing whole uncompressed image and image
always will be fully uncompressed into memory. And we can't take only
parts of raster.

JasPer author knows about this problems and he is working to help us.
Eventually JasPer should become more suitable for our needs.


-- 
Andrey V. Kiselev
Home phone:  +7 812 5274898  ICQ# 26871517

From dron at ak4719.spb.edu  Wed May  7 16:19:58 2003
From: dron at ak4719.spb.edu (Andrey Kiselev)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] GDAL, JasPer, JPEG2000 memory management plans?
In-Reply-To: <73EE6720ADE81140A05137BDE0B0FB0A45A91E@fcgctex03.co.fulton.ga.us>
References: <73EE6720ADE81140A05137BDE0B0FB0A45A91E@fcgctex03.co.fulton.ga.us>
Message-ID: <20030507201958.GB17551@ak4719.spb.edu>

On Wed, May 07, 2003 at 02:42:26PM -0400, Anderson, Carl wrote:
> I have been having problems encoding 13001x13001 JEPG2000 images on a
> Linux 2.4.20 machine and a Solaris 2.7 machine using gdal_translate and
> jasper
> on each machine unless I use tiling, encoding  dies inside jasper at
>     jpc_t1enc.c on line 349   (  assert(0)  )

Carl,

Could you show your commandline resulting in this error?

> what about an implementation of a "Row-based wavelet transform" as
> described in
> ITU-T Rec T.800 (2000 FCDV1.0) page 163. Downloadable from
> http://www.jpeg.org/public/fcd15444-1.pdf
>  
> of course that is really a jasper issue not a gdal one, and it may
> already be in the jasper lib.

It seems, this is not implemeted in JasPEr.


-- 
Andrey V. Kiselev
Home phone:  +7 812 5274898  ICQ# 26871517

From Carl.Anderson at co.fulton.ga.us  Thu May  8 11:55:17 2003
From: Carl.Anderson at co.fulton.ga.us (Anderson, Carl)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] GDAL, JasPer, JPEG2000 memory management plans?
Message-ID: <73EE6720ADE81140A05137BDE0B0FB0A45A942@fcgctex03.co.fulton.ga.us>

>From: Andrey Kiselev [mailto:dron@ak4719.spb.edu] 

>Could you show your commandline resulting in this error?

Here is a gdb session wrapped around the command
precint or mode or rate make no change to the assert(0)

If I  add tiling thus
  /usr/bin/gdal_translate -of JPEG2000  -co "mode=int"  -co "rate=0.05"
-co "prcwidth=1024" -co "prcheight=1024" -co "tileheight=7000" -co
"tilewidth=7000" ../tiff/kz16_768_3766.tif kz16_768_3766_lqj.jp2

The command succeeds

----------------------------------------------------------------
cedar-grove.unix.gis.fc-candrsn >>  gdb gdal_translate  
GNU gdb Red Hat Linux (5.2.1-4)
Copyright 2002 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you
are
welcome to change it and/or distribute copies of it under certain
conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for
details.
This GDB was configured as "i386-redhat-linux"...
(gdb)  run -of JPEG2000 -co "mode=real"  -co "rate=0.05" -co
"prcwidth=1024" -co "prcheight=1024" ../tiff/kz16_768_3766.tif
kz16_768_3766_lq.jp2


Starting program: /usr/bin/gdal_translate -of JPEG2000  -co "mode=int"
-co "rate=0.05" -co "prcwidth=1024" -co "prcheight=1024"
../tiff/kz16_768_3766.tif kz16_768_3766_lqj.jp2
Input file size is 13001, 13001
0...10...20...30...40...50...60...70...80...90...100 - done.
gdal_translate: jpc_t1enc.c:272: jpc_enc_enccblk: Assertion
`cblk->passes' failed.

Program received signal SIGABRT, Aborted.
0x42028cc1 in kill () from /lib/i686/libc.so.6
(gdb) backtrace
#0  0x42028cc1 in kill () from /lib/i686/libc.so.6
#1  0x42028ac8 in raise () from /lib/i686/libc.so.6
#2  0x4202a019 in abort () from /lib/i686/libc.so.6
#3  0x42021cd6 in __assert_fail () from /lib/i686/libc.so.6
#4  0x40288e31 in jpc_enc_enccblk (enc=0x8053448, out=0x0,
tcmpt=0x80e1038, 
    band=0x8a3c3d8, cblk=0x8c728d4) at jpc_t1enc.c:349
#5  0x402887c4 in jpc_enc_enccblks (enc=0x8053448) at jpc_t1enc.c:218
#6  0x4027e0cc in jpc_enc_encodemainbody (enc=0x8053448) at
jpc_enc.c:1435
#7  0x4027c387 in jpc_encode (image=0x8056e88, out=0x8053998, 
    optstr=0xbfffcf40
"mode=int\nrate=0.05\nprcwidth=1024\nprcheight=1024\n_jp2overhead=343\n"
) at jpc_enc.c:354
#8  0x4027527b in jp2_write_codestream (image=0x8056e88, out=0x8053998, 
    optstr=0xbfffe0c0
"mode=int\nrate=0.05\nprcwidth=1024\nprcheight=1024")
    at jp2_enc.c:416
#9  0x40275337 in jp2_encode_uuid (image=0x8056e88, out=0x8053998, 
    optstr=0xbfffe0c0
"mode=int\nrate=0.05\nprcwidth=1024\nprcheight=1024", 
    uuid=0x8053358) at jp2_enc.c:450
#10 0x400bb19a in JPEG2000CreateCopy (
    pszFilename=0xbffff5e3 "kz16_768_3766_lqj.jp2", poSrcDS=0x804f968, 
    bStrict=1, papszOptions=0x804eaa8, 
    pfnProgress=0x400df254 <GDALTermProgress>, pProgressData=0x0)
    at jpeg2000dataset.cpp:1061
#11 0x400e2522 in GDALDriver::CreateCopy(char const*, GDALDataset*, int,
char** int (*)(double, char const*, void*), void*) () from
/usr/lib/libgdal.1.1.so
#12 0x400e295d in GDALCreateCopy () from /usr/lib/libgdal.1.1.so
#13 0x0804a2b2 in main ()
#14 0x420158d4 in __libc_start_main () from /lib/i686/libc.so.6
(gdb) 



Carl Anderson

GIS Manager
Fulton County E&CD
404.730.8026
carl.anderson@co.fulton.ga.us


-----------------------------------------------------------------------

The contents of this message have been scanned for viruses by
the TruSecure ShadowMail Service, and no viruses were found.


-----------------------------------------------------------------------


* This message has been processed by TruSecure's ShadowMail service

From dron at ak4719.spb.edu  Thu May  8 12:25:40 2003
From: dron at ak4719.spb.edu (Andrey Kiselev)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] GDAL, JasPer, JPEG2000 memory management plans?
In-Reply-To: <73EE6720ADE81140A05137BDE0B0FB0A45A942@fcgctex03.co.fulton.ga.us>
References: <73EE6720ADE81140A05137BDE0B0FB0A45A942@fcgctex03.co.fulton.ga.us>
Message-ID: <20030508162540.GA12353@ak4719.spb.edu>

On Thu, May 08, 2003 at 11:55:17AM -0400, Anderson, Carl wrote:
> Starting program: /usr/bin/gdal_translate -of JPEG2000  -co "mode=int"
> -co "rate=0.05" -co "prcwidth=1024" -co "prcheight=1024"
> ../tiff/kz16_768_3766.tif kz16_768_3766_lqj.jp2
> Input file size is 13001, 13001
> 0...10...20...30...40...50...60...70...80...90...100 - done.
> gdal_translate: jpc_t1enc.c:272: jpc_enc_enccblk: Assertion
> `cblk->passes' failed.

Hmm... Could you show tiffinfo output for kz16_768_3766.tif?
Or, probably, make available a small sample file demonstraiting this
problem?


-- 
Andrey V. Kiselev
Home phone:  +7 812 5274898  ICQ# 26871517

From Carl.Anderson at co.fulton.ga.us  Thu May  8 12:58:58 2003
From: Carl.Anderson at co.fulton.ga.us (Anderson, Carl)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] GDAL, JasPer, JPEG2000 memory management plans?
Message-ID: <73EE6720ADE81140A05137BDE0B0FB0A45A947@fcgctex03.co.fulton.ga.us>





I have successfully convert this tiff into a GeoTiff and into a JPEG
using GDAL

gdal_translate -of JPEG


TIFF Directory at offset 0x1e7b0008
  Image Width: 13001 Image Length: 13001
  Tile Width: 256 Tile Length: 256
  Bits/Sample: 8
  Sample Format: unsigned integer
  Compression Scheme: None
  Photometric Interpretation: RGB color
  Software: "ImageMagick 5.5.2 12/01/02 Q8 http://www.imagemagick.org"
  Document Name: "kz16_768_3766.tiff"
  Samples/Pixel: 3
  Planar Configuration: separate image planes

TIFF Directory at offset 0x5164780
  Image Width: 13001 Image Length: 13001
  Bits/Sample: 8
  Compression Scheme: JPEG
  Photometric Interpretation: RGB color
  FillOrder: msb-to-lsb
  Software: "ImageMagick 5.5.2 12/01/02 Q8 http://www.imagemagick.org"
  Document Name: "tiff/kz16_768_3766.tif"
  Orientation: row 0 top, col 0 lhs
  Samples/Pixel: 3
  Rows/Strip: 8
  Planar Configuration: single image plane
  JPEG Tables: (289 bytes)

Carl Anderson

GIS Manager
Fulton County E&CD
404.730.8026
carl.anderson@co.fulton.ga.us



-----Original Message-----
From: Andrey Kiselev [mailto:dron@ak4719.spb.edu] 
Sent: Thursday, May 08, 2003 12:26 PM
To: gdal-dev@remotesensing.org
Subject: Re: [Gdal-dev] GDAL, JasPer, JPEG2000 memory management plans?


On Thu, May 08, 2003 at 11:55:17AM -0400, Anderson, Carl wrote:
> Starting program: /usr/bin/gdal_translate -of JPEG2000  -co "mode=int"

> -co "rate=0.05" -co "prcwidth=1024" -co "prcheight=1024" 
> ../tiff/kz16_768_3766.tif kz16_768_3766_lqj.jp2 Input file size is 
> 13001, 13001 0...10...20...30...40...50...60...70...80...90...100 - 
> done.
> gdal_translate: jpc_t1enc.c:272: jpc_enc_enccblk: Assertion 
> `cblk->passes' failed.

Hmm... Could you show tiffinfo output for kz16_768_3766.tif? Or,
probably, make available a small sample file demonstraiting this
problem?


-- 
Andrey V. Kiselev
Home phone:  +7 812 5274898  ICQ# 26871517
_______________________________________________
Gdal-dev mailing list
Gdal-dev@remotesensing.org
http://remotesensing.org/mailman/listinfo/gdal-dev


-----------------------------------------------------------------------

The contents of this message have been scanned for viruses by the
TruSecure ShadowMail Service, and no viruses were found.


-----------------------------------------------------------------------

The contents of this message have been scanned for viruses by
the TruSecure ShadowMail Service, and no viruses were found.


-----------------------------------------------------------------------


* This message has been processed by TruSecure's ShadowMail service

From rich at greenwoodmap.com  Sat May 10 16:08:07 2003
From: rich at greenwoodmap.com (Richard Greenwood)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] gdalwarp incorrect output origin
Message-ID: <5.2.0.9.0.20030510133857.00a74e68@mail.greenwoodmap.com>

Hello;

Gdalwarp appears to be a wonderful tool.  Thank you Frank, for yet another 
great contribution to the world of open source geo-spatial software. 
Unfortunately, I am having some difficulty with gdalwarp, and I am seeking 
help. Specifically, I do not seem to be getting the correct origin in the 
output file. I am trying to convert from utm nad83, zone 12 to wyoming 
state plane nad83 west u.s. survey feet. I am launching gdalwarp as follows:

gdalwarp
     -s_srs "+proj=utm +ellps=GRS80 +zone=12 +north +datum=NAD83 +units=m 
+no_defs"
     -t_srs "+proj=tmerc +ellps=GRS80 +units=ft +lon_0=-110.0833333333 
+lat_0=40.5 +x_0=800000 +y_0=100000 +k=0.9999375 +no_defs"
     -order 3
     44110a71.ecw
     nw.tif

For my input file, gdalinfo returns:

     gdalinfo 44110A71.ecw
     Driver: ECW/ERMapper Compressed Wavelets
     Size is 5680, 7562
     Coordinate System is `'
     Origin = (509637.500000,4886074.500000)
     Pixel Size = (1.000000,-1.000000)

And for the output file:

     gdalinfo nw.tif
     Driver: GTiff/GeoTIFF
     Size is 5764, 7625
     Coordinate System is:
     PROJCS["unnamed",
     GEOGCS["unnamed",
         DATUM["unknown",
             SPHEROID["unnamed",6378137,298.2572221010002]],
         PRIMEM["Greenwich",0],
         UNIT[,0.0174532925199433]],
     PROJECTION["Transverse_Mercator"],
     PARAMETER["latitude_of_origin",40.5],
     PARAMETER["central_meridian",-110.0833333333],
     PARAMETER["scale_factor",0.9999375],
     PARAMETER["false_easting",800000],
     PARAMETER["false_northing",100000],
     UNIT["unknown",1]]
     Origin = (590,671.522659,1,423,022.262198)

However, using corpscon to convert the origin point yields:

     ;SOFTWARE:  Corpscon for Windows 5.11.08
     ;Horizontal Datum:  State Plane, NAD83
     ;Horizontal Zone:   Wyoming West - 4904
     ;Horizontal Units:  U.S. Survey Feet
         2,415,615.01666, 1,651,102.28794

(I realize that simply converting the origin with corpscon is not going to 
provide exactly the same output origin as gdalwarp, I'm just using it to 
illustrate the general neighborhood that I am expecting).

The source and target srs definitions are ones that I have used 
successfully with mapserver.

Any suggestions?

Rich

Richard W. Greenwood, PLS
(307) 733-0203
Rich@GreenwoodMap.com
www.GreenwoodMap.com 
From warmerdam at pobox.com  Mon May 12 09:59:38 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Re: build gdal for mingw32 on cygwin
In-Reply-To: <008b01c3188c$9d747910$818001db@webgis>
References: <008b01c3188c$9d747910$818001db@webgis>
Message-ID: <3EBFA8CA.9020501@pobox.com>

Hisaji Ono wrote:
> Hello, Mr. Warmerdam.
> 
>  For R language, GNU-S, there are two packages,
> RGDAL(http://keittlab.biosci.utexas.edu/R/GDAL/) &
> RMap(http://www.maths.lancs.ac.uk/Software/Rmap/), using gdal to display
> Raster & Vector map within R.
> 
>  Currently these packages' binaries are only available for unix(or linux).
> 
>  For cygwin, as you wrote, I could build gdal library on it. However R
> doesn't support Cygwin.
> So I have to build GDAL for mingw32.
>  I've tried to build GDAL for mingw32 on Cygwin as follows.

...

> ../../../port/cpl_vsi.h:172: ISO C++ forbids declaration of `vsi_l_offset'
> with
> 
>    no type
> ../../../port/cpl_vsi.h:172: parse error before `(' token
> make[3]: *** [ogrpgdriver.o] Error 1
> make[3]: Leaving directory
> `/home/Administrator/gdal-1.1.8/ogr/ogrsf_frmts/pg'
> make[2]: *** [default] Error 2
> make[2]: Leaving directory `/home/Administrator/gdal-1.1.8/ogr/ogrsf_frmts'
> make[1]: *** [sublibs] Error 2
> make[1]: Leaving directory `/home/Administrator/gdal-1.1.8/ogr'
> make: *** [ogr-target] Error 2
> 
> 
>  Could you suggest any idea to solve this situation?

Hisaji,

I believe the problem is that since the system isn't Cygwin but is Win32,
the WIN32 macro is defined and various decisions are being made under the
assumption of Visual C++.  For instance, in cpl_port.h, the type __int64
is being used for 64 bit integers.  It seems that "long long" may be
appropriate with the mingw-gcc compiler.  I would suggest you try changing
this section of cpl_port.h:

#ifdef WIN32

#define VSI_LARGE_API_SUPPORTED
typedef __int64          GIntBig;
typedef unsigned __int64 GUIntBig;

#elif HAVE_LONG_LONG
...

to:

#if defined(WIN32) && !defined(HAVE_LONG_LONG)

#define VSI_LARGE_API_SUPPORTED
typedef __int64          GIntBig;
typedef unsigned __int64 GUIntBig;

#elif HAVE_LONG_LONG
...

Of course, it would be more appropriate for me to actually test if the
compiler is VC++, but offhand I am not sure how to do that.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From Martin.Daly at cadcorp.com  Mon May 12 10:16:40 2003
From: Martin.Daly at cadcorp.com (Martin Daly)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Re: build gdal for mingw32 on cygwin
Message-ID: <DE8A435707FBA24392E5C67F58E294AA3FD5@dev001_pdc.Dev.cadcorp.net>

Frank,

> Of course, it would be more appropriate for me to actually 
> test if the compiler is VC++, but offhand I am not sure how 
> to do that.

"#ifdef _MSC_VER" could be a suitable test.

The VC++ 6.0 on-line helps says "Defines the compiler version. Defined
as 1200 for Microsoft Visual C++ 6.0. Always defined."  VC++ .NET is
>=1300.

Regards,
Martin

From warmerdam at pobox.com  Mon May 12 11:02:32 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Re: build gdal for mingw32 on cygwin
In-Reply-To: <DE8A435707FBA24392E5C67F58E294AA3FD5@dev001_pdc.Dev.cadcorp.net>
References: <DE8A435707FBA24392E5C67F58E294AA3FD5@dev001_pdc.Dev.cadcorp.net>
Message-ID: <3EBFB788.5040805@pobox.com>

Martin Daly wrote:
> Frank,
> 
> 
>>Of course, it would be more appropriate for me to actually 
>>test if the compiler is VC++, but offhand I am not sure how 
>>to do that.
> 
> 
> "#ifdef _MSC_VER" could be a suitable test.
> 
> The VC++ 6.0 on-line helps says "Defines the compiler version. Defined
> as 1200 for Microsoft Visual C++ 6.0. Always defined."  VC++ .NET is
> 
>>=1300.


Folks,

Thanks Martin ... I have tentatively modified cpl_port.h to make a few decisions
on this basis.  So the practice now is:

  o WIN32 is defined if access to the win32 API is OK.  Specifically disabled
    in Cygwin builds as we want to treat this case as "almost" unix.  However it
    *is* defined for MingW builds and builds for other Win32 based compilers.

  o CPL_DLL is only defined to be non-empty if _MSC_VER is defined.  So it is
    disabled in MingW, Cygwin and other builds.

The three configurations on windows I would like to work "out of the box"
are windows are MS Visual C++, Cygwin and Mingw GCC.  The Cygwin and Mingw GCC
would use the GNUmakefile based build mechanism and VC++ uses the NMAKE files
(ie. makefile.vc).

I would be interested in supporting other windows compilers (eg. Borland and
WATCOM) but I am not willing to support additional sets of build (make) files.
Two sets is already one too many to do well.  What might be interesting is
trying to extend the existing GNUmake based build to support non-unix like
environments.  In this case we would have to dispense with running configure,
and instead have more "canned" GNUmake.opt files or something similar.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From nhv at cape.com  Mon May 12 11:21:35 2003
From: nhv at cape.com (Norman Vine)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Re: build gdal for mingw32 on cygwin
In-Reply-To: <3EBFA8CA.9020501@pobox.com>
Message-ID: <EKEJIKAILPONGGENMBGAGEIMDGAA.nhv@cape.com>

Frank Warmerdam writes:
>
> Hisaji Ono wrote:
> > Hello, Mr. Warmerdam.
> >
> >  For R language, GNU-S, there are two packages,
> > RGDAL(http://keittlab.biosci.utexas.edu/R/GDAL/) &
> > RMap(http://www.maths.lancs.ac.uk/Software/Rmap/), using gdal to display
> > Raster & Vector map within R.
> >
> >  Currently these packages' binaries are only available for
> unix(or linux).
> >
> >  For cygwin, as you wrote, I could build gdal library on it. However R
> > doesn't support Cygwin.
> > So I have to build GDAL for mingw32.
> >  I've tried to build GDAL for mingw32 on Cygwin as follows.
>
> ...
>
> > ../../../port/cpl_vsi.h:172: ISO C++ forbids declaration of
> `vsi_l_offset'
> > with
> >
> >    no type
> > ../../../port/cpl_vsi.h:172: parse error before `(' token


Hmm... I build GDAL with both Cygwin and MingW32 and do not
see this error ??

Maybe there is a *very* recent change that effects something ?

>
> Of course, it would be more appropriate for me to actually test if the
> compiler is VC++, but offhand I am not sure how to do that.

#ifdef _MSC_VER  // All Microsoft Compilers define this

#  if _MSC_VER == 1200  // msvc++ 6.0 not sure about the other versions

also

#if defined (__MINGW32__)  || defined(__CYGWIN__)
#define unsigned long long ulong64
#define long long long64
#endif

Cheers

Norman






From s.perkins at lanl.gov  Mon May 12 12:17:15 2003
From: s.perkins at lanl.gov (Simon Perkins)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Re: build gdal for mingw32 on cygwin
References: <DE8A435707FBA24392E5C67F58E294AA3FD5@dev001_pdc.Dev.cadcorp.net> <3EBFB788.5040805@pobox.com>
Message-ID: <3EBFC90B.1080107@lanl.gov>

Frank Warmerdam wrote:

>
> Two sets is already one too many to do well.  What might be 
> interesting is
> trying to extend the existing GNUmake based build to support non-unix 
> like
> environments.  In this case we would have to dispense with running 
> configure,
> and instead have more "canned" GNUmake.opt files or something similar. 


This is a bit off topic, but for years I've wanted to see a true 
cross-platform configure-and-build system. Something that did all the 
jobs that autconf, automake and libtool are supposed to make easier, but 
did so in a way that is (a) more easily portable to windows, (b) more 
integrated - the synchronization between automake and autconf is very 
iffy and you have to always worry about versions of those tools,  (c) 
less cryptic - configure.in files are not exactly models of clarity 
typically, and (d) works better with more languages and is more easily 
extensible.

Is there anything out there already that does this that I've missed? 
I've seen Jam, but from what I can tell it's more of an automake 
replacement - I don't think it handles the complexities of configuration 
and shared libraries.

If anyone wants to reply, maybe we should take this off list...

Sy





From rich at greenwoodmap.com  Tue May 13 20:59:41 2003
From: rich at greenwoodmap.com (Richard Greenwood)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] gdalwarp UTM->SPCS
Message-ID: <5.2.0.9.0.20030513185850.00a761d8@mail.greenwoodmap.com>

Hello;

I am continuing to struggle with gdalwarp. Following up on my earlier query 
to this list - I am trying to reproject from UTM to state plane. My source 
image has a world file, but an incomplete SRS, so I am launching gdalwarp 
with both a s_srs and a t_srs where the s_srs defines my UTM zone, and the 
t_srs defines my state plane zone. Is this generally the right approach?

I have tried specifying both the s_srs and t_srs with EPSG:xxxx, PROJ.4 
declarations, and OGC WTK in text files, but in no case am I getting the 
expected results. For example, in no case does gdalinfo list the correct 
units for my output file. I have specifed 
UNIT["Foot_US",0.30480060960121924] in the t_srs WKT definition and 
+to_meter=0.3048006096012192 and +unit=ft in the proj.4 t_srs definitions, 
but the output always ends up as either 
UNIT["metre",1,AUTHORITY["EPSG","9001"] or UNIT["unknown",1].

I feel like I must be overlooking someting terribly obvious. Where might I 
find more examples of gdalwarp usage? Is there a more appropriate list to 
pose the questions to?

Thanks,
Rich

Richard W. Greenwood, PLS
(307) 733-0203
Rich@GreenwoodMap.com
www.GreenwoodMap.com 
From alessandro_amici at telespazio.it  Wed May 14 08:08:53 2003
From: alessandro_amici at telespazio.it (Amici Alessandro)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] python support under cygwin?
Message-ID: <A183DF60AC72D5119B990002A5749CB3040EB363@ROMADG-MAIL01>

Frank,

i installed Numeric-23.0 on cygwin in order to get python-gdal support.
on:
	$ ./configure --withou-ld-shared
	$ make
everything is ok, but on:
	# make install
i get the following error:

/bin/true gdal_wrap.o numpydataset.o gdalnumeric.o \
        -L.. -lgdal.1.1 -ljpeg -ltiff -lpng -lz -lm -lm -o _gdalmodule.so
../install-sh -d /usr/lib/python2.2/site-packages
for f in *.py _gdalmodule.so ; do ../install-sh -c $f
/usr/lib/python2.2/site-pa
ckages ; done
install:  _gdalmodule.so does not exist
make[1]: *** [install] Error 1
make[1]: Leaving directory
`/cygdrive/c/home/amici/devel/gdal-cvs-030509/pymod'
make: *** [install-actions] Error 2

the problem is linked to the lack of shared libraries (LD_SHARED=/bin/true)
on cygwin, which are assumed to be present in pymod/GNUmakefile.

is there any chance to get python support under cygwin?
have you (or anybody else) any idea on what needs to be done?
should i file a bug?

cheers,
alessandro

From warmerdam at pobox.com  Wed May 14 08:59:09 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Re: Adding const to OGR geometry classes?
In-Reply-To: <IHEAIHOJLJNLHCKGKJEDMEKGCEAA.ben@vterrain.org>
References: <IHEAIHOJLJNLHCKGKJEDMEKGCEAA.ben@vterrain.org>
Message-ID: <3EC23D9D.1020800@pobox.com>

Ben Discoe wrote:
> Hi Frank,
> 
> I have been forging ahead with the plan to make heavier use of the OGR
> geometry classes as replacements for the old, simple geometry classes the
> VTP currently uses.
> 
> This means i've been starting to use classes like OGRPolygon directly for my
> own storage and methods, rather than just as a means to use OGR as a format
> reader.
> 
> Here is one thing i've encountered.  How would you feel about adding 'const'
> as appropriate in methods that won't modify what they're passed.
> 	e.g.
> << OGRLinearRing::OGRLinearRing( OGRLinearRing * );
> 
>>>OGRLinearRing::OGRLinearRing( const OGRLinearRing * );
> 
> 
> <<    void   OGRPolygon::addRing( OGRLinearRing * );
> 
>>>   void   OGRPolygon::addRing( const OGRLinearRing * );
> 
> 
> If you have no objections, i'd be happy to make the changes and submit them
> to you.  I can play it conservatively, only using const where it's entirely
> unambiguous.

Ben,

I realize this would be a good idea for a clean C++ interface.  However, any
constness changes alter the C++ signatures and this gives me no end of
headaches from OGR uses trying to use slightly updated OGR shared libraries
with precompiled applications using OGR.  After getting burned painfully
with previous const correctness changes you suggested in OGRSpatialReference,
I have been hesitant to apply more.

Recently I have actually been encouraging applications to use the OGR C API
to reduce the tie-age to a specific GDAL/OGR build.

I am cc:ing this to the gdal-dev list to collect other opinions on whether
const correctness changes are worth the pain.  I realize it isn't clean, but
the issue is just whether you need to cast away the constness in your
application level code, right?

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From warmerdam at pobox.com  Wed May 14 09:24:57 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] gdalwarp UTM->SPCS
In-Reply-To: <5.2.0.9.0.20030513185850.00a761d8@mail.greenwoodmap.com>
References: <5.2.0.9.0.20030513185850.00a761d8@mail.greenwoodmap.com>
Message-ID: <3EC243A9.6010103@pobox.com>

Richard Greenwood wrote:
> Hello;
> 
> I am continuing to struggle with gdalwarp. Following up on my earlier 
> query to this list - I am trying to reproject from UTM to state plane. 
> My source image has a world file, but an incomplete SRS, so I am 
> launching gdalwarp with both a s_srs and a t_srs where the s_srs defines 
> my UTM zone, and the t_srs defines my state plane zone. Is this 
> generally the right approach?
> 
> I have tried specifying both the s_srs and t_srs with EPSG:xxxx, PROJ.4 
> declarations, and OGC WTK in text files, but in no case am I getting the 
> expected results. For example, in no case does gdalinfo list the correct 
> units for my output file. I have specifed 
> UNIT["Foot_US",0.30480060960121924] in the t_srs WKT definition and 
> +to_meter=0.3048006096012192 and +unit=ft in the proj.4 t_srs 
> definitions, but the output always ends up as either 
> UNIT["metre",1,AUTHORITY["EPSG","9001"] or UNIT["unknown",1].
> 
> I feel like I must be overlooking someting terribly obvious. Where might 
> I find more examples of gdalwarp usage? Is there a more appropriate list 
> to pose the questions to?

Rich,

I appologise for not responding to your earlier message yet.  I have been
bogged down in deliverables, and an addiction to an MMORPG (www.atitd.com).

I tried something similar to your earlier example with a UTM 11 file I
have here, and it seemed to work pretty well.  I used this command:

   gdalwarp
   -s_srs "+proj=utm +ellps=GRS80 +zone=11 +north +datum=NAD83 +units=m +no_defs"
   -t_srs "+proj=tmerc +ellps=GRS80 +units=ft +lon_0=-110.0833333333 +lat_0=40.5
        +x_0=800000 +y_0=100000 +k=0.9999375 +no_defs"
   -order 3 openev/utm.tif nw.tif

Unlike your experience, my output did seem to get the right linear units:

Coordinate System is:
PROJCS["unnamed",
     GEOGCS["unnamed",
         DATUM["unknown",
             SPHEROID["unnamed",6378137,298.2572221010042]],
         PRIMEM["Greenwich",0],
         UNIT[,0.0174532925199433]],
     PROJECTION["Transverse_Mercator"],
     PARAMETER["latitude_of_origin",40.5],
     PARAMETER["central_meridian",-110.0833333333],
     PARAMETER["scale_factor",0.9999375],
     PARAMETER["false_easting",2624671.916010499],
     PARAMETER["false_northing",328083.9895013123],
     UNIT["foot",0.3048,
         AUTHORITY["EPSG","9002"]]]

Based on that, I now wonder what is different about your build and mine.
Are you building from a recent CVS update?  I suggest we try to isolate
this issue off the list today if you have the time.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From Rich at GreenwoodMap.com  Wed May 14 10:10:14 2003
From: Rich at GreenwoodMap.com (Richard Greenwood)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] gdalwarp UTM->SPCS
In-Reply-To: <3EC243A9.6010103@pobox.com>
References: <5.2.0.9.0.20030513185850.00a761d8@mail.greenwoodmap.com>
 <5.2.0.9.0.20030513185850.00a761d8@mail.greenwoodmap.com>
Message-ID: <5.2.0.9.0.20030514080100.00aa4a70@mail.GreenwoodMap.com>

Skipped content of type multipart/alternative
From marcus at keyholecorp.com  Wed May 14 13:26:24 2003
From: marcus at keyholecorp.com (Marcus Barnes)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Re: Adding const to OGR geometry classes?
In-Reply-To: <3EC23D9D.1020800@pobox.com>
Message-ID: <000801c31a3d$f1660c70$aa03000a@marcuswxp>

Const correctness is often very difficult to retrofit into an existing
framework. Plus const-volatile qualifiers is another thing that can
break link compatibility depending on the implementation.

Regards.
---
Marcus Barnes mailto:marcus@keyholecorp.com 
Keyhole Inc. Mt View, CA http://www.earthviewer.com
 

-----Original Message-----
From: gdal-dev-admin@remotesensing.org
[mailto:gdal-dev-admin@remotesensing.org] On Behalf Of Frank Warmerdam
Sent: Wednesday, May 14, 2003 5:59 AM
To: Ben Discoe
Cc: Roger James; gdal-dev
Subject: [Gdal-dev] Re: Adding const to OGR geometry classes?


Ben Discoe wrote:
> Hi Frank,
> 
> I have been forging ahead with the plan to make heavier use of the OGR

> geometry classes as replacements for the old, simple geometry classes 
> the VTP currently uses.
> 
> This means i've been starting to use classes like OGRPolygon directly 
> for my own storage and methods, rather than just as a means to use OGR

> as a format reader.
> 
> Here is one thing i've encountered.  How would you feel about adding 
> 'const' as appropriate in methods that won't modify what they're
passed.
> 	e.g.
> << OGRLinearRing::OGRLinearRing( OGRLinearRing * );
> 
>>>OGRLinearRing::OGRLinearRing( const OGRLinearRing * );
> 
> 
> <<    void   OGRPolygon::addRing( OGRLinearRing * );
> 
>>>   void   OGRPolygon::addRing( const OGRLinearRing * );
> 
> 
> If you have no objections, i'd be happy to make the changes and submit

> them to you.  I can play it conservatively, only using const where 
> it's entirely unambiguous.

Ben,

I realize this would be a good idea for a clean C++ interface.  However,
any constness changes alter the C++ signatures and this gives me no end
of headaches from OGR uses trying to use slightly updated OGR shared
libraries with precompiled applications using OGR.  After getting burned
painfully with previous const correctness changes you suggested in
OGRSpatialReference, I have been hesitant to apply more.

Recently I have actually been encouraging applications to use the OGR C
API to reduce the tie-age to a specific GDAL/OGR build.

I am cc:ing this to the gdal-dev list to collect other opinions on
whether const correctness changes are worth the pain.  I realize it
isn't clean, but the issue is just whether you need to cast away the
constness in your application level code, right?

Best regards,

-- 
---------------------------------------+--------------------------------
---------------------------------------+------
I set the clouds in motion - turn up   | Frank Warmerdam,
warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent


_______________________________________________
Gdal-dev mailing list
Gdal-dev@remotesensing.org
http://remotesensing.org/mailman/listinfo/gdal-dev


From ben at vterrain.org  Wed May 14 13:28:02 2003
From: ben at vterrain.org (Ben Discoe)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Re: Adding const to OGR geometry classes?
In-Reply-To: <3EC23D9D.1020800@pobox.com>
Message-ID: <IHEAIHOJLJNLHCKGKJEDEELDCEAA.ben@vterrain.org>

Hi Frank,

> I realize this would be a good idea for a clean C++ interface.
> However, any constness changes alter the C++ signatures and this
> gives me no end of headaches from OGR uses trying to use slightly
> updated OGR shared libraries with precompiled applications using OGR.

Very sorry to hear that API changes cause(d) so much trouble for OGR; often
there are mechanisms for avoiding these problems, such as changing the name
of the DLL/SO to reflect API version; existing applications continue to work
with the previous version and don't conflict, while the API is permitted to
be developed rather than frozen in stone.

> Recently I have actually been encouraging applications to use the
> OGR C API to reduce the tie-age to a specific GDAL/OGR build.

C, eeeek! :)

> I realize it isn't clean, but
> the issue is just whether you need to cast away the constness in
> your application level code, right?

Indeed it is possible to do a lot of casting as a workaround, and if need
be, i can do it, until there comes a time when it is OK for the OGR API to
change.  In theory one could even define a whole set of subclasses for the
OGR classes, with each necessary method overridden to do the
unconst-casting, though it's icky.

-Ben


From tbeckman at usgs.gov  Wed May 14 14:21:44 2003
From: tbeckman at usgs.gov (Tim Beckmann)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] Re: Adding const to OGR geometry classes?
Message-ID: <OFB1149118.531C89DB-ON86256D26.0063AF91-86256D26.0064E2DE@cr.usgs.gov>

I think const correctness is important.  However, changing it doesn't 
cause me any pain ;).  (but not changing it does cause pain in the 
long-term by needing to typecast away const when it shouldn't be needed)

For backwards compatibility, you could have two versions of the affected 
methods included, one with the const declaration and another without it. 
One version could simply call the other with the correct cast.  Then at a 
major release point, the non-const version could be deleted and the 
appropriate warning issued to users.

Tim
--------------------------------------------------------------------------
Tim Beckmann               tbeckman@usgs.gov
Software Project Lead
SAIC
EROS Data Center, Sioux Falls, SD 57198
605-594-2521    Phone
605-594-6940    Fax





Frank Warmerdam <warmerdam@pobox.com>
Sent by: gdal-dev-admin@remotesensing.org
05/14/2003 07:59 AM
Please respond to gdal-dev

 
        To:     Ben Discoe <ben@vterrain.org>
        cc:     Roger James <rogerjames99@btinternet.com>, gdal-dev 
<gdal-dev@remotesensing.org>
        Subject:        [Gdal-dev] Re: Adding const to OGR geometry classes?


Ben Discoe wrote:
> Hi Frank,
> 
> I have been forging ahead with the plan to make heavier use of the OGR
> geometry classes as replacements for the old, simple geometry classes 
the
> VTP currently uses.
> 
> This means i've been starting to use classes like OGRPolygon directly 
for my
> own storage and methods, rather than just as a means to use OGR as a 
format
> reader.
> 
> Here is one thing i've encountered.  How would you feel about adding 
'const'
> as appropriate in methods that won't modify what they're passed.
>                e.g.
> << OGRLinearRing::OGRLinearRing( OGRLinearRing * );
> 
>>>OGRLinearRing::OGRLinearRing( const OGRLinearRing * );
> 
> 
> <<    void   OGRPolygon::addRing( OGRLinearRing * );
> 
>>>   void   OGRPolygon::addRing( const OGRLinearRing * );
> 
> 
> If you have no objections, i'd be happy to make the changes and submit 
them
> to you.  I can play it conservatively, only using const where it's 
entirely
> unambiguous.

Ben,

I realize this would be a good idea for a clean C++ interface.  However, 
any
constness changes alter the C++ signatures and this gives me no end of
headaches from OGR uses trying to use slightly updated OGR shared 
libraries
with precompiled applications using OGR.  After getting burned painfully
with previous const correctness changes you suggested in 
OGRSpatialReference,
I have been hesitant to apply more.

Recently I have actually been encouraging applications to use the OGR C 
API
to reduce the tie-age to a specific GDAL/OGR build.

I am cc:ing this to the gdal-dev list to collect other opinions on whether
const correctness changes are worth the pain.  I realize it isn't clean, 
but
the issue is just whether you need to cast away the constness in your
application level code, right?

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, 
warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent


_______________________________________________
Gdal-dev mailing list
Gdal-dev@remotesensing.org
http://remotesensing.org/mailman/listinfo/gdal-dev




From warmerdam at pobox.com  Wed May 14 15:50:28 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] python support under cygwin?
In-Reply-To: <A183DF60AC72D5119B990002A5749CB3040EB363@ROMADG-MAIL01>
References: <A183DF60AC72D5119B990002A5749CB3040EB363@ROMADG-MAIL01>
Message-ID: <3EC29E04.9090107@pobox.com>

Amici Alessandro wrote:
> Frank,
> 
> i installed Numeric-23.0 on cygwin in order to get python-gdal support.
> on:
> 	$ ./configure --withou-ld-shared
> 	$ make
> everything is ok, but on:
> 	# make install
> i get the following error:
> 
> /bin/true gdal_wrap.o numpydataset.o gdalnumeric.o \
>         -L.. -lgdal.1.1 -ljpeg -ltiff -lpng -lz -lm -lm -o _gdalmodule.so
> ../install-sh -d /usr/lib/python2.2/site-packages
> for f in *.py _gdalmodule.so ; do ../install-sh -c $f
> /usr/lib/python2.2/site-pa
> ckages ; done
> install:  _gdalmodule.so does not exist
> make[1]: *** [install] Error 1
> make[1]: Leaving directory
> `/cygdrive/c/home/amici/devel/gdal-cvs-030509/pymod'
> make: *** [install-actions] Error 2
> 
> the problem is linked to the lack of shared libraries (LD_SHARED=/bin/true)
> on cygwin, which are assumed to be present in pymod/GNUmakefile.
> 
> is there any chance to get python support under cygwin?
> have you (or anybody else) any idea on what needs to be done?
> should i file a bug?

Alessandro,

I have spent a couple of hours fiddling with the GDAL built on Cygwin.  I
found I had to upgrade to the latest Cygwin (1.3.22) to get good functioning
out of the DLL building support in Cygwin.  I also had to hack around at
the configure logic a bit for python support.  But now I am able to configure
GDAL out of the box on Cygwin and get a Python shared library (libgdal.1.1.dll)
and python support.

I would encourage you to try rebuilding tomorrow from the nightly snapshot,
or pull the current version out of CVS.

Known and suspected issues:

  o I was using the internal versions of libtiff, libpng, libjpeg and so
    forth because I avoided installing the cygwin versions at all.  I don't
    know if the cygwin versions will work or not, but I see the cygwin folks
    have updated to libtiff 3.6.0 already so it might.

  o I tried building and installing PROJ from CVS.  It works, but PROJ didn't
    produce shared libraries, and so the aspects of GDAL that utilize PROJ
    aren't going to work ... well, perhaps static PROJ linking could be
    utilized but that isn't trivial out of the box.

I have things setup so I can use a clean Cygwin environment on my NT partition
now, so perhaps I will do a better job at maintaining Cygwin build support in
the future.

I would also like to mention that I got most of the required changes from
Norman Vine's cygMakefile in gdal/pymod.  If I listened a little closer to
what Norman keeps telling me I am sure we would have had much better cygwin
support for some time.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From nhv at cape.com  Wed May 14 16:09:19 2003
From: nhv at cape.com (Norman Vine)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] python support under cygwin?
In-Reply-To: <A183DF60AC72D5119B990002A5749CB3040EB363@ROMADG-MAIL01>
Message-ID: <EKEJIKAILPONGGENMBGAOEPPDGAA.nhv@cape.com>

Amici Alessandro writes:
> 
> i installed Numeric-23.0 on cygwin in order to get python-gdal support.
> on:
> 	$ ./configure --withou-ld-shared
> 	$ make
> everything is ok, but on:
> 	# make install
> i get the following error:
> 
> /bin/true gdal_wrap.o numpydataset.o gdalnumeric.o \
>         -L.. -lgdal.1.1 -ljpeg -ltiff -lpng -lz -lm -lm -o _gdalmodule.so
> ../install-sh -d /usr/lib/python2.2/site-packages
> for f in *.py _gdalmodule.so ; do ../install-sh -c $f
> /usr/lib/python2.2/site-pa
> ckages ; done
> install:  _gdalmodule.so does not exist
> make[1]: *** [install] Error 1
> make[1]: Leaving directory
> `/cygdrive/c/home/amici/devel/gdal-cvs-030509/pymod'
> make: *** [install-actions] Error 2
> 
> the problem is linked to the lack of shared libraries 
> (LD_SHARED=/bin/true)
> on cygwin, which are assumed to be present in pymod/GNUmakefile.
> 
> is there any chance to get python support under cygwin?

the Python extension works well with Cygwin

> have you (or anybody else) any idea on what needs to be done?
> should i file a bug?

Just tweak the Makefile(s) a little :-)

Cheers

Norman

==== cut ====

GDAL_ROOT	=	..

include ../GDALmake.opt

GDALMODULE	=	_gdalmodule.$(SO_EXT)
OBJ        	=       gdal_wrap.o numpydataset.o gdalnumeric.o
PY_VER = python2.3
PYTHON_LIB = -L/usr/local/lib/$(PY_VER)/config -l$(PY_VER).$(SO_EXT)

default:	$(GDALMODULE)

clean:
	rm -f *.o *.$(SO_EXT)

%.o:	%.c
	$(CC) -c -I. $(GDAL_INCLUDE) $(PYTHON_INCLUDES)\
		$(CFLAGS) -DUSE_DL_IMPORT $(NUMPY_FLAG) $*.c -o $*.o

%.o:	%.cpp
	$(CXX) -c -I. $(GDAL_INCLUDE) $(PYTHON_INCLUDES) \
		 $(CXXFLAGS) -DUSE_DL_IMPORT $(NUMPY_FLAG) $*.cpp -o $*.o

gdal_wrap.c:	gdal.i
	-swig -python gdal.i

$(GDALMODULE):	$(OBJ) $(GDAL_LIB) $(GDAL_SLIB)
	$(LD_SHARED) $(OBJ) \
		$(GDAL_SLIB_LINK) $(LIBS) $(PYTHON_LIB) -o $(GDALMODULE)

install:	$(GDALMODULE)
	$(INSTALL_DIR) $(INST_PYMOD)
	for f in *.py $(GDALMODULE) ; do $(INSTALL) $$f $(INST_PYMOD) ; done



From rogerjames99 at btinternet.com  Wed May 14 16:44:08 2003
From: rogerjames99 at btinternet.com (Roger James)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] gml geometry information
Message-ID: <000001c31a59$930d26b0$fe0aa8c0@lancaster.beardandsandals.co.uk>

Frank,

 

I have just noticed that the ogr gml driver reports geometry at the
feature level but not at the layer level. Is this intended? Also the
spatial ref is not being picked up. Sorry I have not had chance to look
closely at these.

 

C:\mapdata\Vector Data\2085\sd>ogrinfo -al swh.gml|more

ERROR 1: Read failed on swh.gfs.

Had to open data source read-only.

INFO: Open of `swh.gml'

using driver `GML' successful.

 

Layer name: osgb:TopographicPoint

Geometry: Unknown (any)

Feature Count: 6

Extent: (347195.900000, 465403.500000) - (347443.100000, 465789.200000)

Layer SRS WKT:

(unknown)

osgb:featureCode: String (0.0)

osgb:version: String (0.0)

osgb:versionDate: String (0.0)

osgb:theme: String (0.0)

osgb:accuracyOfPosition: String (0.0)

osgb:descriptiveGroup: String (0.0)

osgb:descriptiveTerm: String (0.0)

osgb:physicalLevel: String (0.0)

osgb:make: String (0.0)

OGRFeature(osgb:TopographicPoint):0

  osgb:featureCode (String) = 10197

  osgb:version (String) = 1

  osgb:versionDate (String) = 2001-11-09

  osgb:theme (String) = Terrain And Height

  osgb:accuracyOfPosition (String) = Unknown

  osgb:descriptiveGroup (String) = Terrain And Height

  osgb:descriptiveTerm (String) = Spot Height

  osgb:physicalLevel (String) = 50

  osgb:make (String) = (null)

  POINT (347297.300 465584.000)

*      More  --

 

By the way the ERROR is the one I mentioned a few days ago on the list
caused by CR/LF processing. 

 

Roger

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.osgeo.org/pipermail/gdal-dev/attachments/20030514/d14daf22/attachment.html
From warmerdam at pobox.com  Wed May 14 16:59:07 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] gml geometry information
In-Reply-To: <000001c31a59$930d26b0$fe0aa8c0@lancaster.beardandsandals.co.uk>
References: <000001c31a59$930d26b0$fe0aa8c0@lancaster.beardandsandals.co.uk>
Message-ID: <3EC2AE1B.70107@pobox.com>

Roger James wrote:
> Frank,
> 
>  
> 
> I have just noticed that the ogr gml driver reports geometry at the 
> feature level but not at the layer level. Is this intended? Also the 
> spatial ref is not being picked up. Sorry I have not had chance to look 
> closely at these.

Roger,

Because the current OGR GML reader does not read the schema it doesn't have
an easy way of determining the geometry type of the layer as a whole, so
it leaves it undefined (any geometry).  Since we have to make a pass through
the file to start with this could be rectified.

Currently the GML driver has no understanding of coordinate systems in GML.
Furthermore, in GML 2 there is no meaningful standard on how coordinate
systems should be associated with features or layers.  Merely sometimes
followed conventions.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From nhv at cape.com  Wed May 14 17:07:31 2003
From: nhv at cape.com (Norman Vine)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] python support under cygwin?
In-Reply-To: <3EC29E04.9090107@pobox.com>
Message-ID: <EKEJIKAILPONGGENMBGACEADDHAA.nhv@cape.com>

Frank Warmerdam writes:
>
>   o I tried building and installing PROJ from CVS.  It works, but PROJ
didn't
>     produce shared libraries, and so the aspects of GDAL that utilize PROJ
>     aren't going to work ... well, perhaps static PROJ linking could be
>     utilized but that isn't trivial out of the box.

** WARNING HACK ATTACK ***

The following command issued from the top level proj directory
should build a DLL from the static libproj.a

gcc -shared -o cygproj.dll \
	-Wl,--out-implib=libproj.dll.a \
	-Wl,--export-all-symbols \
	-Wl,--enable-auto-import \
	-Wl,--whole-archive ./src/.libs/libproj.a \
	-Wl,--no-whole-archive /lib/libcygwin.a

< / hack >

HTH

Norman


From alessandro_amici at telespazio.it  Thu May 15 09:59:54 2003
From: alessandro_amici at telespazio.it (Amici Alessandro)
Date: Wed Nov 21 11:48:50 2007
Subject: R: [Gdal-dev] python support under cygwin?
Message-ID: <A183DF60AC72D5119B990002A5749CB30410FBC5@ROMADG-MAIL01>

Frank,

> I have spent a couple of hours fiddling with the GDAL built on Cygwin.  I
> found I had to upgrade to the latest Cygwin (1.3.22) to get good
functioning
> out of the DLL building support in Cygwin.  I also had to hack around at
> the configure logic a bit for python support.  But now I am able to
configure
> GDAL out of the box on Cygwin and get a Python shared library
(libgdal.1.1.dll)
> and python support.

i'm always amazed by your _fast_ response times!

> I would encourage you to try rebuilding tomorrow from the nightly
snapshot,
> or pull the current version out of CVS.

i got the 030514 cvs build (still without cygwin work) and pulled:

GDALLmake.opt.in
configure
aclocal.m4
pymod/GNUmakefile

from the cvs-web (no outgoing cvs access here due to overzelous network
admins)

as the only imperfection i had to rename _gdalmodule.so to _gdalmodule.dll
(the correct fix is to use $(SO_EXT) as in Norman mail).

the rest seem to work ok with:
Numeric 23.0
proj 4.4.7 (release)
installed with standard procedures.

> Known and suspected issues:
>
>   o I was using the internal versions of libtiff, libpng, libjpeg and so
>     forth because I avoided installing the cygwin versions at all.  I
don't
>     know if the cygwin versions will work or not, but I see the cygwin
folks
>     have updated to libtiff 3.6.0 already so it might.


cygwin is not my preferred platform, i'm just checking that my code is kind
of
portable to something else than debian :). i plan to do just a few test run
of my apps, anyhow this is what i get on my system, i'll let you know if i
hit
any probelm with the cygwin libraries.

checking for deflateInit_ in -lz... yes
checking for G_gisinit_2 in -lgrass5... no
checking for ffopen in -lcfitsio... no
libcfitsio not found - FITS support disabled
checking for png_set_IHDR in -lpng... yes
checking for png.h... yes
using pre-installed libpng.
checking for TIFFGetTagListCount in -ltiff... yes
checking for _TIFFsetDoubleArray in -ltiff... yes
using pre-installed libtiff.
checking for GTIFGetDefn in -lgeotiff... no
using internal GeoTIFF code.
checking for jpeg_read_scanlines in -ljpeg... yes
checking for jpeglib.h... yes
using pre-installed libjpeg.
checking for DGifOpenFileName in -lgif... no
using internal gif code.

>   o I tried building and installing PROJ from CVS.  It works, but PROJ
didn't
>     produce shared libraries, and so the aspects of GDAL that utilize PROJ
>     aren't going to work ... well, perhaps static PROJ linking could be
>     utilized but that isn't trivial out of the box.

how to test whether proj support is working?
 
> I have things setup so I can use a clean Cygwin environment on my NT
partition
> now, so perhaps I will do a better job at maintaining Cygwin build support
in
> the future.
>
> I would also like to mention that I got most of the required changes from
> Norman Vine's cygMakefile in gdal/pymod.  If I listened a little closer to
> what Norman keeps telling me I am sure we would have had much better
cygwin
> support for some time.

wooops, i didn't notice it!

thanks a lot
alessandro

From jmaupay at corys.fr  Thu May 15 10:12:29 2003
From: jmaupay at corys.fr (=?iso-8859-1?Q?J=E9r=F4me_MAUPAY?=)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] How to convert Lat/Long -> Pixel/Line ?
Message-ID: <00c901c31aec$053fb0d0$02c909c0@pccorys170p>

Sorry for that simple following question, but I really don't find the answer in the doc:

I convert a pixel/line to lat/long using the following code:

bool CoxGisGdalFile::PixelLineToLatLong(int aPixel,int aLine,double* aLat, double* aLong)
{
 // Cf http://www.remotesensing.org/gdal/class_GDALDataset.html#a8
  *aLat = mGeoTransform[3] + mGeoTransform[4] * (double)aPixel + mGeoTransform[5] * (double)aLine ;
  *aLong = mGeoTransform[0] + mGeoTransform[1] * (double)aPixel + mGeoTransform[2] * (double)aLine ;

    if( !OCTTransform(mTransform,1,aLong,aLat,NULL) )
        return false ;
    return true ;
}

But how to convert from lat/long to pixel/line ???
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://lists.osgeo.org/pipermail/gdal-dev/attachments/20030515/82b41547/attachment.html
From nsavard at dmsolutions.ca  Thu May 15 14:05:52 2003
From: nsavard at dmsolutions.ca (Normand Savard)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] PHP-OGR Extension- OGR_DS_GetLayer() doesn't always return the same
 layer handle
Message-ID: <3EC3D700.30E5A84C@dmsolutions.ca>

Hi Frank,

I have built php unit tests to verify the php-ogr extension functions.
In order to perform data comparison against validation data, I need to
get some specific layers. I used "OGR_DS_GetLayer()" function to get an
handle to a   specific layer.  As you know, this function takes two
arguments:  a data source handle and a layer number.

I was believing that giving the same layer number, this function will
always return me the same layer handle.  But when I copied a data
directory to a new directory the order of the layers changed.  So, when
I call the "OGR_DS_GetLayer()" function with a specific layer number,
the return layer handle did not correspond to the layer into the source
directory.

As a workaround, I used "OGR_DS_GetLayerByName()" function.  Is there a
plan to modify the "OGR_DS_GetLayer()" function to always return the
same layer handle giving a specific layer number?

Norm


From warmerdam at pobox.com  Thu May 15 18:00:38 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] PHP-OGR Extension- OGR_DS_GetLayer() doesn't always
 return the same layer handle
In-Reply-To: <3EC3D700.30E5A84C@dmsolutions.ca>
References: <3EC3D700.30E5A84C@dmsolutions.ca>
Message-ID: <3EC40E06.8060609@pobox.com>

Normand Savard wrote:
> Hi Frank,
> 
> I have built php unit tests to verify the php-ogr extension functions.
> In order to perform data comparison against validation data, I need to
> get some specific layers. I used "OGR_DS_GetLayer()" function to get an
> handle to a   specific layer.  As you know, this function takes two
> arguments:  a data source handle and a layer number.
> 
> I was believing that giving the same layer number, this function will
> always return me the same layer handle.  But when I copied a data
> directory to a new directory the order of the layers changed.  So, when
> I call the "OGR_DS_GetLayer()" function with a specific layer number,
> the return layer handle did not correspond to the layer into the source
> directory.
> 
> As a workaround, I used "OGR_DS_GetLayerByName()" function.  Is there a
> plan to modify the "OGR_DS_GetLayer()" function to always return the
> same layer handle giving a specific layer number?

Normand,

Some drivers, such as the directory based Shapefile driver read the files
in the directories and return the layer list in the order that the files
are returned from the directory.  This can, as you have encountered, vary
when the files are copied.

I do not anticipate making any changes to the driver(s) to alleviate this
situations.  The layer numbers are not guaranteed to be stable, so you will
have to use layer names as you have seen.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From neteler at itc.it  Fri May 16 11:45:18 2003
From: neteler at itc.it (Markus Neteler)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] VMAP0/Eurnasia -> SHAPE problems (OGR/OGDI driver)
Message-ID: <20030516174518.M31052@itc.it>

Dear list members,

did anyone (successfully) manage to convert VMAP0/Eurnasia
to SHAPE format (or some other widely used GIS format)?

I have compiled the OGDI-3.1.1 driver on Redhat Linux (a few
Makefile changes were required), then compiled OGR with
OGDI support (CVS version of GDAL/OGR).

The 'ogrinfo' works well, but only reports for 4 maps of
76 features:

- 72 maps are reported to contain 0 features
-  4 maps contain this number of features
     Feature Count: 1424 - libref@libref(*)_line
     Feature Count: 28   - tileref@tileref(*)_area
     Feature Count: 107  - libreft@libref(*)_text
     Feature Count: 28   - tilereft@tileref(*)_text

From alessandro_amici at telespazio.it  Mon May 19 04:15:20 2003
From: alessandro_amici at telespazio.it (Amici Alessandro)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] [ANNOUNCE] gdal debian package at mentors.debian.net
Message-ID: <A183DF60AC72D5119B990002A5749CB30416E1B4@ROMADG-MAIL01>

folks,

i'm maintaining an _unofficial_ debian package for gdal hosted by the 
debian mentors project.

Paul Baker was involved in the packaging of gdal one year ago, but he 
agreed to leave the burden on me :), at least for now.

in the short term i plan to track the gdal cvs for unstable, since this 
is what i personally need to have packaged to use with my apps.
in the longer term, i might try to apply as a debian developer or handle 
it to an offical developer in order to push gdal into the official 
archive, but this depends very much on the feed back i'll get from users.

right now the package have some issues, but it is perfectly usable on 
i386. anybody interested is invited to try it and send comments, 
suggestions or any kind of feed back to me. obviously priorities will be 
driven by the feed-back i'll have :)

the packages are at:
http://mentors.debian.net/debian/dists/unstable/main/binary-i386/gdal/

for easy upload add the following line to your /etc/apt/sources.list:
deb http://mentors.debian.net/debian unstable main
deb-src http://mentors.debian.net/debian unstable main
BUT PLEASE NOTE that there are a lot of other unrelated _unoffical_ 
packages on the same archive whose quility is probably not up to the 
debian standards!

cheers,
alessandro

From alessandro_amici at telespazio.it  Mon May 19 04:23:24 2003
From: alessandro_amici at telespazio.it (Amici Alessandro)
Date: Wed Nov 21 11:48:50 2007
Subject: R: [Gdal-dev] [ANNOUNCE] gdal debian package at mentors.debian.ne
	t
Message-ID: <A183DF60AC72D5119B990002A5749CB30416E1FD@ROMADG-MAIL01>

Frank,

in connection with my effort to get a debian package in shape, i'd like 
to ask you a few questions:
- are you interested (i guess yes, but... better ask :)?
- wuold you spend a minute to double check things like package descriptions,
README.Debian and copyright files, and bless/correct them?

moreover i have three problems with the gdal build system, that you might 
find of general interest:
- [TRIVIAL] stuff under /usr/local/include is installed 0755 (should be 
0644). the same for /usr/local/python?.?/site-packages/, but some python 
files _are_ scripts (so that 0755 is ok) and other are only modules (no 
#!/usr/bin/python) and those should be 0644. Debian build system is very 
picky about these things!
- the 'docs' target is... well 'messy'. expecially on a dial-up system. 
it would be nice to have it cleaned up.
- it wuold be very nice to have a real shared library with soname 
(actually the debian policy mandates it). this has been already 
discussed several times. what is the situation?

hope this is useful,
alessandro

From neteler at itc.it  Tue May 20 04:19:44 2003
From: neteler at itc.it (Markus Neteler)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] ASTER DEM and HDF and PROJ problem
In-Reply-To: <20030519183551.GA26450@ak4719.spb.edu>; from dron@ak4719.spb.edu on Mon, May 19, 2003 at 10:35:51PM +0400
References: <20030519184148.R7792@itc.it> <20030519183551.GA26450@ak4719.spb.edu>
Message-ID: <20030520101944.A18822@itc.it>

Dear GDAL developers,

I am facing a problem with gdal/hdf/asterdem/proj4 (GDAL and PROJ4 from
yesterday's CVS):

gdalinfo ASTER_DEM20020827134235.hdf | more
ERROR 6: Failed to initialize PROJ.4 with +proj=longlat +ellps=WGS84
+datum=WGS84 +no_defs '.
unknown projection id
ERROR 6: Failed to initialize PROJ.4 with +proj=longlat +ellps=WGS84
+datum=WGS84 +no_defs '.
unknown projection id
ERROR 6: Failed to initialize PROJ.4 with +proj=longlat +ellps=WGS84
+datum=WGS84 +no_defs '.
unknown projection id
ERROR 6: Failed to initialize PROJ.4 with +proj=longlat +ellps=WGS84
+datum=WGS84 +no_defs '.
unknown projection id

I don't know where the error occurs (GDAL or PROJ4).

Kind regards,
 
 Markus Neteler

From warmerdam at pobox.com  Tue May 20 09:25:32 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] ASTER DEM and HDF and PROJ problem
In-Reply-To: <20030520101944.A18822@itc.it>
References: <20030519184148.R7792@itc.it> <20030519183551.GA26450@ak4719.spb.edu> <20030520101944.A18822@itc.it>
Message-ID: <3ECA2CCC.7000903@pobox.com>

Markus Neteler wrote:
> Dear GDAL developers,
> 
> I am facing a problem with gdal/hdf/asterdem/proj4 (GDAL and PROJ4 from
> yesterday's CVS):
> 
> gdalinfo ASTER_DEM20020827134235.hdf | more
> ERROR 6: Failed to initialize PROJ.4 with +proj=longlat +ellps=WGS84
> +datum=WGS84 +no_defs '.
> unknown projection id
> ERROR 6: Failed to initialize PROJ.4 with +proj=longlat +ellps=WGS84
> +datum=WGS84 +no_defs '.
> unknown projection id
> ERROR 6: Failed to initialize PROJ.4 with +proj=longlat +ellps=WGS84
> +datum=WGS84 +no_defs '.
> unknown projection id
> ERROR 6: Failed to initialize PROJ.4 with +proj=longlat +ellps=WGS84
> +datum=WGS84 +no_defs '.
> unknown projection id
> 
> I don't know where the error occurs (GDAL or PROJ4).


Markus,

Offhand, my guess would be that somehow the wrong PROJ.4 has been picked
up at runtime (a very old one) and it doesn't know about latlong.  However,
it might also be that PROJ.4 isn't being picked up at all.  Does gdalinfo
report lat/long corners for other images such as a GeoTIFF file?

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From alessandro_amici at telespazio.it  Tue May 20 09:37:35 2003
From: alessandro_amici at telespazio.it (Amici Alessandro)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] gdal.py: operand precedence bug
Message-ID: <A183DF60AC72D5119B990002A5749CB304190639@ROMADG-MAIL01>

Frank,

in gdal.py line 347:

def GetRasterBand(self, i):
    if i > 0 & i <= self.RasterCount:

should read as:

def GetRasterBand(self, i):
    if i > 0 and i <= self.RasterCount:

or, in a more pythonic style, as:
def GetRasterBand(self, i):
    if 0 < i <= self.RasterCount:

in fact, due to the relative precedence, the first form is
evaluated as:
    i > (0 & i) <= self.Rastercount
which is valid python syntax, but obviously not the intended
behavior.

it seems overkill to me, but if you want i can file a bug report :).

cheers,
alessandro

From warmerdam at pobox.com  Tue May 20 09:52:38 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: R: [Gdal-dev] [ANNOUNCE] gdal debian package at mentors.debian.ne
 t
In-Reply-To: <A183DF60AC72D5119B990002A5749CB30416E1FD@ROMADG-MAIL01>
References: <A183DF60AC72D5119B990002A5749CB30416E1FD@ROMADG-MAIL01>
Message-ID: <3ECA3326.8060309@pobox.com>

Amici Alessandro wrote:
> Frank,
> 
> in connection with my effort to get a debian package in shape, i'd like 
> to ask you a few questions:
> - are you interested (i guess yes, but... better ask :)?
> - wuold you spend a minute to double check things like package descriptions,
> README.Debian and copyright files, and bless/correct them?
> 
> moreover i have three problems with the gdal build system, that you might 
> find of general interest:
> - [TRIVIAL] stuff under /usr/local/include is installed 0755 (should be 
> 0644). the same for /usr/local/python?.?/site-packages/, but some python 
> files _are_ scripts (so that 0755 is ok) and other are only modules (no 
> #!/usr/bin/python) and those should be 0644. Debian build system is very 
> picky about these things!

Alessandro,

If you provide patches for this, I am happy to have them applied.
Ideally this should be automated in the sense that the install
target should check each file for "#!/usr/bin/python" to decide if
it should be executable or not.   If we have file lists it will be
harder to maintain properly.

> - the 'docs' target is... well 'messy'. expecially on a dial-up system. 
> it would be nice to have it cleaned up.

I hadn't really seen the docs target as something that would be
widely run.  I guess part of the problem is the way it refreshes
a few files from CVS after deleting everything?  This could be
re-engineered to push the special files into a safe place before
blowing everything away, and then restore from there.

> - it wuold be very nice to have a real shared library with soname 
> (actually the debian policy mandates it). this has been already 
> discussed several times. what is the situation?

For GDAL 1.2.0 I would like to do this right (more or less ... not
using libtool though), and for now I would suggest we modify the
configure to allow the configurer to provide an "LD_SHARED" command.
The Debian build can provide one that correctly sets up the -soname
option.

It would likely be best if I provide CVS access for you so you can
do the patching directly, though I would like to be appraised of
changes you make.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From nhv at cape.com  Tue May 20 10:12:19 2003
From: nhv at cape.com (Norman Vine)
Date: Wed Nov 21 11:48:50 2007
Subject: R: [Gdal-dev] [ANNOUNCE] gdal debian package at mentors.debian.ne t
In-Reply-To: <3ECA3326.8060309@pobox.com>
Message-ID: <EKEJIKAILPONGGENMBGAIELADHAA.nhv@cape.com>

Frank Warmerdam writes:
> 
> Ideally this should be automated in the sense that the install
> target should check each file for "#!/usr/bin/python" to decide if
> it should be executable or not.   

Can we *please* use this instead

#! /usr/bin/env python

This makes it *much* easier when having multiple versions 
of Python installed

Cheers

Norman

From warmerdam at pobox.com  Tue May 20 10:26:34 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: R: [Gdal-dev] [ANNOUNCE] gdal debian package at mentors.debian.ne
 t
In-Reply-To: <EKEJIKAILPONGGENMBGAIELADHAA.nhv@cape.com>
References: <EKEJIKAILPONGGENMBGAIELADHAA.nhv@cape.com>
Message-ID: <3ECA3B1A.3090203@pobox.com>

Norman Vine wrote:
> Frank Warmerdam writes:
> 
>>Ideally this should be automated in the sense that the install
>>target should check each file for "#!/usr/bin/python" to decide if
>>it should be executable or not.   
> 
> 
> Can we *please* use this instead
> 
> #! /usr/bin/env python
> 
> This makes it *much* easier when having multiple versions 
> of Python installed


Norman,

In fact, it seems we do, at least in the scripts in gdal/pymod that
I just checked.  I really don't understand how it works though.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From warmerdam at pobox.com  Tue May 20 10:31:10 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] gdal.py: operand precedence bug
In-Reply-To: <A183DF60AC72D5119B990002A5749CB304190639@ROMADG-MAIL01>
References: <A183DF60AC72D5119B990002A5749CB304190639@ROMADG-MAIL01>
Message-ID: <3ECA3C2E.4030209@pobox.com>

Amici Alessandro wrote:
> Frank,
> 
> in gdal.py line 347:
> 
> def GetRasterBand(self, i):
>     if i > 0 & i <= self.RasterCount:
> 
> should read as:
> 
> def GetRasterBand(self, i):
>     if i > 0 and i <= self.RasterCount:
> 
> or, in a more pythonic style, as:
> def GetRasterBand(self, i):
>     if 0 < i <= self.RasterCount:
> 
> in fact, due to the relative precedence, the first form is
> evaluated as:
>     i > (0 & i) <= self.Rastercount
> which is valid python syntax, but obviously not the intended
> behavior.
> 
> it seems overkill to me, but if you want i can file a bug report :).

Alessandro,

fix committed.

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From alessandro_amici at telespazio.it  Tue May 20 10:44:58 2003
From: alessandro_amici at telespazio.it (Amici Alessandro)
Date: Wed Nov 21 11:48:50 2007
Subject: R: R: [Gdal-dev] [ANNOUNCE] gdal debian package at mentors.debian
	.ne t
Message-ID: <A183DF60AC72D5119B990002A5749CB3041907CC@ROMADG-MAIL01>

> In fact, it seems we do, at least in the scripts in gdal/pymod
> that I just checked.

woops! my fault. my memory retained '#!/$SOMETHING' and i
arbitrarily gave the SOMETHING a reasonable value... :-/

> I really don't understand how it works though.

Norman is right on the use of /usr/bin/env (so the script runs
with the same enviroment as the calling shell) and gdal does already
the right thing.

sorry for the noise
alessandro

From alessandro_amici at telespazio.it  Tue May 20 11:15:56 2003
From: alessandro_amici at telespazio.it (Amici Alessandro)
Date: Wed Nov 21 11:48:50 2007
Subject: R: [Gdal-dev] [ANNOUNCE] gdal debian package at mentors.debia
	n.ne t
Message-ID: <A183DF60AC72D5119B990002A5749CB304190859@ROMADG-MAIL01>

Frank,

> For GDAL 1.2.0 I would like to do this right (more or less ...
> not using libtool though), and for now I would suggest we
> modify the configure to allow the configurer to provide an
> "LD_SHARED" command. The Debian build can provide one that
> correctly sets up the -soname option.

in order to avoid future naming conflicts, is it ok if i use:
	LD_SHARED = ld -shared -Wl,-soname,libgdal.so.1.1.9
i think 1.1 is not enough (but i may be wrong) and since the 
last released version is 1.1.8 i'd better not use that number,
just in case someone tweaked the makefiles of the stable
version (i.e. i did).
what's your opinion? (i'm not sure i understood the soname
mechanism that deeply :)

i'll see if it is feasible.

> It would likely be best if I provide CVS access for you so you
> can do the patching directly, though I would like to be
> appraised of changes you make.

it _would_ be nice... unfortunately our overly zelous network 
admins decided we "dont need any no ssh access" to the outside 
world, and boldly blocked port 22... toghether with all other 
ports save for port 80! sigh!
i think i'll send you patches for now.

cheers,
alessandro

From neteler at itc.it  Tue May 20 12:29:23 2003
From: neteler at itc.it (Markus Neteler)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] ASTER DEM and HDF and PROJ problem
In-Reply-To: <3ECA2CCC.7000903@pobox.com>; from warmerdam@pobox.com on Tue, May 20, 2003 at 09:25:32AM -0400
References: <20030519184148.R7792@itc.it> <20030519183551.GA26450@ak4719.spb.edu> <20030520101944.A18822@itc.it> <3ECA2CCC.7000903@pobox.com>
Message-ID: <20030520182923.M18822@itc.it>

On Tue, May 20, 2003 at 09:25:32AM -0400, Frank Warmerdam wrote:
> Markus Neteler wrote:
> > Dear GDAL developers,
> > 
> > I am facing a problem with gdal/hdf/asterdem/proj4 (GDAL and PROJ4 from
> > yesterday's CVS):
> > 
> > gdalinfo ASTER_DEM20020827134235.hdf | more
> > ERROR 6: Failed to initialize PROJ.4 with +proj=longlat +ellps=WGS84
> > +datum=WGS84 +no_defs '.
> > unknown projection id
> > ERROR 6: Failed to initialize PROJ.4 with +proj=longlat +ellps=WGS84
> > +datum=WGS84 +no_defs '.
> > unknown projection id
> > ERROR 6: Failed to initialize PROJ.4 with +proj=longlat +ellps=WGS84
> > +datum=WGS84 +no_defs '.
> > unknown projection id
> > ERROR 6: Failed to initialize PROJ.4 with +proj=longlat +ellps=WGS84
> > +datum=WGS84 +no_defs '.
> > unknown projection id
> > 
> > I don't know where the error occurs (GDAL or PROJ4).
> 
> 
> Markus,
> 
> Offhand, my guess would be that somehow the wrong PROJ.4 has been picked
> up at runtime (a very old one) and it doesn't know about latlong.  However,
> it might also be that PROJ.4 isn't being picked up at all.  Does gdalinfo
> report lat/long corners for other images such as a GeoTIFF file?

Frank,

now I understand...
this sounds reasonable due to my last experiments with OGDI:

ldd /usr/local/bin/gdalinfo
        libgdal.1.1.so => /usr/local/lib/libgdal.1.1.so (0x40017000)
        libogdi31.so => /usr/local/lib/libogdi31.so (0x4039d000)
        libungif.so.4 => /usr/lib/libungif.so.4 (0x403dc000)
        libpng12.so.0 => /usr/lib/libpng12.so.0 (0x403e4000)
        libdl.so.2 => /lib/libdl.so.2 (0x4041d000)
        libm.so.6 => /lib/libm.so.6 (0x40422000)
        libstdc++-libc6.2-2.so.3 => /usr/lib/libstdc++-libc6.2-2.so.3 (0x40444000)
        libc.so.6 => /lib/libc.so.6 (0x40487000)
        libzlib_ogdi31.so => /usr/local/lib/libzlib_ogdi31.so (0x405bd000)
        libexpat_ogdi31.so => /usr/local/lib/libexpat_ogdi31.so (0x405ca000)
        libX11.so.6 => /usr/X11R6/lib/libX11.so.6 (0x405e6000)
        libz.so.1 => /usr/lib/libz.so.1 (0x406dd000)
        /lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0x40000000)

(My) OGDI uses it's internal proj which is old. So far I didn't manage to
configure OGDI to use an external PROJ4 (the new one) but I'll try harder.

Since I don't get OGR/OGDI to work with VMAP0 I'll disable it again.

Thanks for the hint,

 Markus


From warmerdam at pobox.com  Tue May 20 14:11:04 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] gdalwarp UTM->SPCS
In-Reply-To: <5.2.0.9.0.20030514103808.00aa4a80@mail.GreenwoodMap.com>
References: <5.2.0.9.0.20030514080100.00aa4a70@mail.GreenwoodMap.com> <5.2.0.9.0.20030513185850.00a761d8@mail.greenwoodmap.com> <5.2.0.9.0.20030513185850.00a761d8@mail.greenwoodmap.com> <5.2.0.9.0.20030514080100.00aa4a70@mail.GreenwoodMap.com> <5.2.0.9.0.20030514103808.00aa4a80@mail.GreenwoodMap.com>
Message-ID: <3ECA6FB8.50609@pobox.com>

Richard Greenwood wrote:
>> I get the following (obviously I made a poor choice of input position):
>>
>> (100000.000000,2500000.000000) -> (-822713.552290,-6399889.409433)
> 
> 
> Again, I am getting the same results as you are.
> 
> 
> Testing a more representitive point:
> (510000.000000,4885764.000000) -> (592126.581651,1421987.333814)
> whereas the correct result should be approximately:
> 2416793.28   1650070.67
> derived from my rather clumsy use of proj as follows:
> 
> C:\cygwin\home\Rich\gdal\ogr>proj -I  +proj=utm +ellps=GRS80 +zone=12 
> +north +datum=NAD83 +units=m
> 510000.000000 4885764.000000
> 110d52'30.031"W 44d7'29.998"N
> 
> C:\cygwin\home\Rich\gdal\ogr>proj +proj=tmerc +lat_0=40.5 
> +lon_0=-110.0833333333 +k=0.999938 +x_0=800000 +y_0=100000 +ellps=GRS80 
> +datum=NAD83 +to_meter=0.3048006096012192
> 110d52'30.031"W 44d7'29.998"N
> 2416793.28      1650070.67

Richard,

I have tracked down this to a real bug in the importFromProj4() method.
When PROJ.4 strings are converted into WKT format internally by gdalwarp
(or testepsg) the false easting and northing were being copied directly.
The false easting and northing of PROJ.4 strings is always in meters
regardless of the units of the projected coordinate system.  In WKT the
situation is the opposite.  The false easting and northing are always
in the units of the projected coordinate system.  The translation code in
OGR that goes the one way was not translating, but going the other way
(WKT->PROJ.4) it was.

I have committed a fix for this problem.

I would encourage you to update from CVS, or pick up tomorrows nightly
snapshot and try again.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From alessandro_amici at telespazio.it  Wed May 21 05:14:58 2003
From: alessandro_amici at telespazio.it (Amici Alessandro)
Date: Wed Nov 21 11:48:50 2007
Subject: R: R: [Gdal-dev] [ANNOUNCE] gdal debian package at mentors.debia 
	n.ne t
Message-ID: <A183DF60AC72D5119B990002A5749CB304190E8F@ROMADG-MAIL01>

Frank,
 
> > for now I would suggest we
> > modify the configure to allow the configurer to provide an
> > "LD_SHARED" command. The Debian build can provide one that
> > correctly sets up the -soname option.

after some experiments seems that the minimal approach without
_any_ change to gdal is the following:

- keep the configure and build system as they are,
- build with the following commands:
	ln -fs libgdal.so.$(version) libgdal.so
	ln -fs libgdal.so.$(version) libgdal.so.$(sover)
	$(MAKE) LD_SHARED="c++ -shared -Wl,-soname,libgdal.so.$(sover)"\
		GDAL_SLIB=libgdal.so.$(version) \
		GDAL_SLIB_LINK="-L$(CURDIR) -lgdal"
  where version=1.1.9 and sover=1
  this builds libgdal.so.1.1.9 with soname libgdal.so.1 and all the
  binaries and the python module seem ok, but...

unfortunately while building _gdalmodule.so you (rightly) use
$(LD_SHARED), so it gets the gdal soname as well :-/. 
this gives no visible problem, but it's ugly.

in order to allow a clean build for a sonamed library
i'd need at the minimum the following patch:

--- GNUmakefile.orig	2003-05-21 10:15:32.000000000 +0200
+++ GNUmakefile	2003-05-21 10:57:10.000000000 +0200
@@ -10,7 +10,7 @@
 force-lib:	
 	$(AR) r $(GDAL_LIB) $(GDAL_OBJ)
 	$(RANLIB) $(GDAL_LIB)
-	$(LD_SHARED) $(GDAL_OBJ) $(GDAL_LIBS) $(LIBS) -o $(GDAL_SLIB)
+	$(LD_SHARED) $(GDAL_SLIB_SONAME) $(GDAL_OBJ) $(GDAL_LIBS) $(LIBS) -o
$(GDAL_SLIB)
 
 #	If you really want proper SO files that will work in /usr/lib
 # 	Try replacing the above command with something like this:
@@ -23,7 +23,7 @@
 	$(RANLIB) $(GDAL_LIB)
 
 $(GDAL_SLIB):	$(GDAL_LIB) $(GDALA_DEP)
-	$(LD_SHARED) $(GDAL_OBJ) $(GDAL_LIBS) $(LIBS) -o $(GDAL_SLIB)
+	$(LD_SHARED) $(GDAL_SLIB_SONAME) $(GDAL_OBJ) $(GDAL_LIBS) $(LIBS) -o
$(GDAL_SLIB)
 
 check-lib:
 	$(MAKE) $(GDAL_LIB)


this way i can build with:
	$(MAKE) GDAL_SLIB_SONAME="-Wl,-soname,libgdal.so.$(sover)" \
		GDAL_SLIB=libgdal.so.$(version) \
		GDAL_SLIB_LINK="-L$(CURDIR) -lgdal"
avoiding any side effect.

> in order to avoid future naming conflicts, is it ok if i use:
> 	LD_SHARED = ld -shared -Wl,-soname,libgdal.so.1.1.9
> i think 1.1 is not enough (but i may be wrong) and since the 
> last released version is 1.1.8 i'd better not use that number,
> just in case someone tweaked the makefiles of the stable
> version (i.e. i did).
> what's your opinion? (i'm not sure i understood the soname
> mechanism that deeply :)

i checked the libraries on my debian system and looks like all
sonames are in the form libfoo.so.N with N being a one-digit 
soversion. i choosed soversion 1 for gdal.
if gdal has to follow this convention it is important that the 
soversion is incremented by one digit every time backward binary 
compatibility is broken (judging from the name libgdal.1.1.so i 
guess 1.0 is not compatible with 1.1).

please apply the will-be-broken-by-outlook-but-i-couldnt-avoid-it
patch,
alessandro

From dron at ak4719.spb.edu  Wed May 21 11:06:21 2003
From: dron at ak4719.spb.edu (Andrey Kiselev)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] MODIS Level 1B earth-view (EV) products
Message-ID: <20030521150621.GA2834@ak4719.spb.edu>

Hi, folks,

I have made a massive update to HDF4 driver and MODIS Level 1B
earth-view (EV) products now supported. This means, that list of GCPs
will be extracted by GDAL, so it is possible to make warping of the
input L1B dataset directly. All three types of EV products supported
(1km, 500m and 250m) for both satellites (TERRA and AQUA).

Note, that some datasets contain height information along with
longitude and latitude, so this may be used for DEM extraction.

Caveats:

1. Be ready to use `-nogcp' option in gdalinfo utility. MODIS L1B
   datasets contain huge amount of GCPs. For example, for 500m product
   you will get 1354 * 2030 = 2 748 620 points (1 point for every 2
   pixels).

2. I dont know what coordinate system (datum and ellipsoid) used for
   MODIS L1B GCPs. If somebody can point me to appropriate documentation,
   please, do it.

It is possible to implement the same for ASTER datasets, but slightly
harder. HDF is very flexible format and different products differ
significally. Also unification for a family of products also requires
reading a lot of data specifications. But I'm continue working on this
issue and complete support for ASTER L1A and L1B datasets will be
available at some point.

				Best regards,
				Andrey

-- 
Andrey V. Kiselev
Home phone:  +7 812 5274898  ICQ# 26871517

From warmerdam at pobox.com  Wed May 21 11:55:54 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:50 2007
Subject: R: R: [Gdal-dev] [ANNOUNCE] gdal debian package at mentors.debia
 	n.ne t
In-Reply-To: <A183DF60AC72D5119B990002A5749CB304190E8F@ROMADG-MAIL01>
References: <A183DF60AC72D5119B990002A5749CB304190E8F@ROMADG-MAIL01>
Message-ID: <3ECBA18A.9000602@pobox.com>

Amici Alessandro wrote:
> --- GNUmakefile.orig	2003-05-21 10:15:32.000000000 +0200
> +++ GNUmakefile	2003-05-21 10:57:10.000000000 +0200
> @@ -10,7 +10,7 @@
>  force-lib:	
>  	$(AR) r $(GDAL_LIB) $(GDAL_OBJ)
>  	$(RANLIB) $(GDAL_LIB)
> -	$(LD_SHARED) $(GDAL_OBJ) $(GDAL_LIBS) $(LIBS) -o $(GDAL_SLIB)
> +	$(LD_SHARED) $(GDAL_SLIB_SONAME) $(GDAL_OBJ) $(GDAL_LIBS) $(LIBS) -o
> $(GDAL_SLIB)
>  
>  #	If you really want proper SO files that will work in /usr/lib
>  # 	Try replacing the above command with something like this:
> @@ -23,7 +23,7 @@
>  	$(RANLIB) $(GDAL_LIB)
>  
>  $(GDAL_SLIB):	$(GDAL_LIB) $(GDALA_DEP)
> -	$(LD_SHARED) $(GDAL_OBJ) $(GDAL_LIBS) $(LIBS) -o $(GDAL_SLIB)
> +	$(LD_SHARED) $(GDAL_SLIB_SONAME) $(GDAL_OBJ) $(GDAL_LIBS) $(LIBS) -o
> $(GDAL_SLIB)
...
> this way i can build with:
> 	$(MAKE) GDAL_SLIB_SONAME="-Wl,-soname,libgdal.so.$(sover)" \
> 		GDAL_SLIB=libgdal.so.$(version) \
> 		GDAL_SLIB_LINK="-L$(CURDIR) -lgdal"
> avoiding any side effect.

Alessandro,

I have applied this patch as suggested in CVS.

> i checked the libraries on my debian system and looks like all
> sonames are in the form libfoo.so.N with N being a one-digit 
> soversion. i choosed soversion 1 for gdal.
> if gdal has to follow this convention it is important that the 
> soversion is incremented by one digit every time backward binary 
> compatibility is broken (judging from the name libgdal.1.1.so i 
> guess 1.0 is not compatible with 1.1).
> 
> please apply the will-be-broken-by-outlook-but-i-couldnt-avoid-it
> patch,

Using .1 is fine for now.  Essentially the leading digit in the GDAL
versions is fixed till a major architectural change.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From nhv at cape.com  Wed May 21 12:20:11 2003
From: nhv at cape.com (Norman Vine)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] MODIS Level 1B earth-view (EV) products
In-Reply-To: <20030521150621.GA2834@ak4719.spb.edu>
Message-ID: <EKEJIKAILPONGGENMBGAGEOBDHAA.nhv@cape.com>

Andrey Kiselev writes:
>
> I have made a massive update to HDF4 driver and MODIS Level 1B
> earth-view (EV) products now supported.

Great :-)
>
> 2. I dont know what coordinate system (datum and ellipsoid) used for
>    MODIS L1B GCPs. If somebody can point me to appropriate documentation,
>    please, do it.

I am 'reasonably sure' it is WGS84 but I can't seem to find a reference for
this


Thanks

Norman


From dron at ak4719.spb.edu  Wed May 21 12:59:41 2003
From: dron at ak4719.spb.edu (Andrey Kiselev)
Date: Wed Nov 21 11:48:50 2007
Subject: [Gdal-dev] MODIS Level 1B earth-view (EV) products
In-Reply-To: <EKEJIKAILPONGGENMBGAGEOBDHAA.nhv@cape.com>
References: <20030521150621.GA2834@ak4719.spb.edu> <EKEJIKAILPONGGENMBGAGEOBDHAA.nhv@cape.com>
Message-ID: <20030521165941.GA17947@ak4719.spb.edu>

On Wed, May 21, 2003 at 12:20:11PM -0400, Norman Vine wrote:
> > 2. I dont know what coordinate system (datum and ellipsoid) used for
> >    MODIS L1B GCPs. If somebody can point me to appropriate documentation,
> >    please, do it.
> 
> I am 'reasonably sure' it is WGS84 but I can't seem to find a reference for
> this

I'm also sure in this, but it is nowhere explicitly stated...


-- 
Andrey V. Kiselev
Home phone:  +7 812 5274898  ICQ# 26871517

From warmerdam at pobox.com  Thu May 22 13:02:58 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] How to convert Lat/Long -> Pixel/Line ?
In-Reply-To: <00c901c31aec$053fb0d0$02c909c0@pccorys170p>
References: <00c901c31aec$053fb0d0$02c909c0@pccorys170p>
Message-ID: <3ECD02C2.6030404@pobox.com>

J?r?me MAUPAY wrote:
> Sorry for that simple following question, but I really don't find the 
> answer in the doc:
>  
> I convert a pixel/line to lat/long using the following code:
>  
> bool CoxGisGdalFile::PixelLineToLatLong(int aPixel,int aLine,double* 
> aLat, double* aLong)
> {
>  // Cf http://www.remotesensing.org/gdal/class_GDALDataset.html#a8
>   *aLat = mGeoTransform[3] + mGeoTransform[4] * (double)aPixel + 
> mGeoTransform[5] * (double)aLine ;
>   *aLong = mGeoTransform[0] + mGeoTransform[1] * (double)aPixel + 
> mGeoTransform[2] * (double)aLine ;
>  
>     if( !OCTTransform(mTransform,1,aLong,aLat,NULL) )
>         return false ;
>     return true ;
> }
> But how to convert from lat/long to pixel/line ???

Jerome,

I realize this isn't a very fast answer.  I use the following function
to "invert" the geotransform when I want to translate the other way.

/************************************************************************/
/*                          InvGeoTransform()                           */
/*                                                                      */
/*      Invert a standard 3x2 "GeoTransform" style matrix with an       */
/*      implicit [1 0 0] final row.                                     */
/************************************************************************/

static int InvGeoTransform( double *gt_in, double *gt_out )

{
     double	det, inv_det;

     /* we assume a 3rd row that is [1 0 0] */

     /* Compute determinate */

     det = gt_in[1] * gt_in[5] - gt_in[2] * gt_in[4];

     if( fabs(det) < 0.000000000000001 )
         return 0;

     inv_det = 1.0 / det;

     /* compute adjoint, and devide by determinate */

     gt_out[1] =  gt_in[5] * inv_det;
     gt_out[4] = -gt_in[4] * inv_det;

     gt_out[2] = -gt_in[2] * inv_det;
     gt_out[5] =  gt_in[1] * inv_det;

     gt_out[0] = ( gt_in[2] * gt_in[3] - gt_in[0] * gt_in[5]) * inv_det;
     gt_out[3] = (-gt_in[1] * gt_in[3] + gt_in[0] * gt_in[4]) * inv_det;

     return 1;
}


You can see this used in GDALCreateGenImgProjTransformer() function in
gdal/alg/gdaltransformer.cpp (in CVS at least) which is documented at:

   http://www.remotesensing.org/gdal/gdal_alg_h.html#a4

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From nhv at cape.com  Thu May 22 13:10:44 2003
From: nhv at cape.com (Norman Vine)
Date: Wed Nov 21 11:48:51 2007
Subject: FW: [Gdal-dev] MODIS Level 1B earth-view (EV) products
In-Reply-To: <5.1.0.14.2.20030522102804.01a071f8@pop900.gsfc.nasa.gov>
Message-ID: <EKEJIKAILPONGGENMBGAKEBODIAA.nhv@cape.com>

> -----Original Message-----
> From: Robert Wolfe [mailto:robert.e.wolfe.1@gsfc.nasa.gov]
> Sent: Thursday, May 22, 2003 11:59 AM
> To: Norman Vine
> Cc: Wayne Esaias
> Subject: Fwd: FW: [Gdal-dev] MODIS Level 1B earth-view (EV) products
>
>
> Norman,
>
> Your right, the datum/ellipsoid we use is WGS84.  Two references you can
> use are the ATBD and our recent MODIS geolocation paper:
>
> Nishihama, M., Wolfe, R. E., Solomon, D., Patt, F. S., Blanchette, J.,
> Fleig, A. J., Masuoka, E. (1997), MODIS Level 1A Earth Location Algorithm
> Theoretical Basis Document Version 3.0, SDST-092, Lab. Terrestrial Phys.,
> NASA Goddard Space Flight Center, Greenbelt, MD.
>
>    ==> on the web at
> http://modis.gsfc.nasa.gov/data/atbd/atbd_mod28_v3.pdf
>           see pages 3-8 and 3-36.
>
> and
>
> Wolfe, R. E., M. Nishihama, A. J. Fleig, J. A. Kuyper, D. P. Roy, J. C.
> Storey and F. S. Patt, Achieving sub-pixel geolocation accuracy
> in support
> of MODIS land science, Remote Sens. of Env., 83 (1-2): 31-49, Nov. 2002.
>
>    ==> see page 35, end of second column.
>
> I hope this helps,
>
>   -Robert Wolfe
>
> *--------*---------*---------*--------*---------*--------*
>     Robert E. Wolfe
>     MODIS Land Science Team Support
>     GSFC: Code 922, Bld. 32, Rm. S036G  Raytheon ITSS
>     p. 301-614-5508  f. 301-614-5269    4400 Forbes Blvd.
>     e. robert.e.wolfe.1@gsfc.nasa.gov   Lanham, MD 20706
> *--------*---------*---------*--------*---------*--------*
>

Robert

This helps a lot,  thank you very much !

FYI  I am working on a method to automate run time updating
of the BMV texture using GDAL see
http://www.andesengineering.com/BlueMarbleViewer/

Also note that thanks to Andrey et al GDAL now provides
*cross-platform* < Unix, Mac, Win32 > methods that should
facilitate using MODIS data

for example to get a tiff image of the CZS pigment from
MODOCL2A.A2000341.1705.004.2002171004055.hdf

one can use the general purpose gdal_translate tool,  or easily
create your own with the library if a C or Python programmer

ie
% gdal_translate  -of GTiff -ot UInt16 \
 HDF4_SDS:MODIS_LIB:MODOCL2A.A2000341.1705.004.2002171004055.hdf:0 test.tif

Input file size is 1354, 2030
0...10...20...30...40...50...60...70...80...90...100 - done.

and a Tiff image with the pertinent metadata stuffed into
the Header Tags is created  :)

The metadata can be seen using the gdalinfo tool
or any tool capable of reading Tiff tags

i.e
% gdalinfo test.tif

Driver: GTiff/GeoTIFF
Size is 1354, 2030
Coordinate System is `'
Metadata:
  Miami Format=10
  Number of bands=17
  Number of samples per record=1354
............

  LONGNAME=MODIS/Terra Ocean Color Derived Products Group 1 5-Min L2 Swath
1km Day
  Long_name=Chlorophyll-a + pheopigment (fluorometric, empirical)
  Scale_type=y= Slope * x + Intercept;
  Slope=0.002
  Intercept=-5
  Name=Pigment
  Units=mg/m^3
  Quality_Bits=25-26
Corner Coordinates:
Upper Left  (    0.0,    0.0)
Lower Left  (    0.0, 2030.0)
Upper Right ( 1354.0,    0.0)
Lower Right ( 1354.0, 2030.0)
Center      (  677.0, 1015.0)
Band 1 Block=1354x3 Type=UInt16, ColorInterp=Gray

Cheers

Norman

==============================
> >User-Agent: Microsoft-Entourage/10.1.1.2418
> >Date: Thu, 22 May 2003 10:08:50 -0400
> >Subject: FW: [Gdal-dev] MODIS Level 1B earth-view (EV) products
> >From: Wayne Esaias <wayne.e.esaias@nasa.gov>
> >To: Robert Wolfe <robert.e.wolfe.1@gsfc.nasa.gov>
> >CC: <nhv@cape.com>
> >
> >robert - could you please direct
> >Norman to the appropriate place for this
> >information.  Norman attended the UNH
> >Ocean Workshop, and is doing some really
> >cool stuff.
> >thanks,
> >Wayne
> >
> >
> >Dr. Wayne E. Esaias
> >Oceanographer
> >Code 971 Oceans and Ice Branch
> >Goddard Space Flight Center
> >Greenbelt MD 20777
> >301-614-5709
> >
> >--
> >
> >
> >------ Forwarded Message
> >From: "Norman Vine" <nhv@cape.com>
> >Reply-To: <nhv@cape.com>
> >Date: Wed, 21 May 2003 13:46:23 -0400
> >To: "Wayne Esaias" <wayne.e.esaias@nasa.gov>
> >Subject: FW: [Gdal-dev] MODIS Level 1B earth-view (EV) products
> >
> >Hi
> >
> >I am wondering if there is some official documentation for the
> >coordinate system used in the MODIS products for the Latitude
> >and Longitude fields.
> >
> >FYI
> >We are working on improving MODIS support in the GDAL library
> >< Geospatial Data Abstraction Library >
> >http://www.remotesensing.org/gdal/
> >
> >Thanks
> >
> >Norman Vine
> >Woods Hole, Ma
> >
> > > -----Original Message-----
> > > From: gdal-dev-admin@remotesensing.org
> > > [mailto:gdal-dev-admin@remotesensing.org]On Behalf Of Andrey Kiselev
> > > Sent: Wednesday, May 21, 2003 1:00 PM
> > > To: gdal-dev@remotesensing.org
> > > Subject: Re: [Gdal-dev] MODIS Level 1B earth-view (EV) products
> > >
> > >
> > > On Wed, May 21, 2003 at 12:20:11PM -0400, Norman Vine wrote:
> > > > > 2. I dont know what coordinate system (datum and
> ellipsoid) used for
> > > > >    MODIS L1B GCPs. If somebody can point me to appropriate
> > > documentation,
> > > > >    please, do it.
> > > >
> > > > I am 'reasonably sure' it is WGS84 but I can't seem to find a
> > > reference for
> > > > this
> > >
> > > I'm also sure in this, but it is nowhere explicitly stated...
> > >
> > >
> > > --
> > > Andrey V. Kiselev
> > > Home phone:  +7 812 5274898  ICQ# 26871517
> > > _______________________________________________
> > > Gdal-dev mailing list
> > > Gdal-dev@remotesensing.org
> > > http://remotesensing.org/mailman/listinfo/gdal-dev
> > >
> >
> >
> >------ End of Forwarded Message
>


From dron at ak4719.spb.edu  Thu May 22 14:04:29 2003
From: dron at ak4719.spb.edu (Andrey Kiselev)
Date: Wed Nov 21 11:48:51 2007
Subject: FW: [Gdal-dev] MODIS Level 1B earth-view (EV) products
In-Reply-To: <EKEJIKAILPONGGENMBGAKEBODIAA.nhv@cape.com>
References: <5.1.0.14.2.20030522102804.01a071f8@pop900.gsfc.nasa.gov> <EKEJIKAILPONGGENMBGAKEBODIAA.nhv@cape.com>
Message-ID: <20030522180429.GA10357@ak4719.spb.edu>

> > Your right, the datum/ellipsoid we use is WGS84.  Two references you can
> > use are the ATBD and our recent MODIS geolocation paper:
> >
> > Nishihama, M., Wolfe, R. E., Solomon, D., Patt, F. S., Blanchette, J.,
> > Fleig, A. J., Masuoka, E. (1997), MODIS Level 1A Earth Location Algorithm
> > Theoretical Basis Document Version 3.0, SDST-092, Lab. Terrestrial Phys.,
> > NASA Goddard Space Flight Center, Greenbelt, MD.
> >
> >    ==> on the web at
> > http://modis.gsfc.nasa.gov/data/atbd/atbd_mod28_v3.pdf
> >           see pages 3-8 and 3-36.
> >
> > and
> >
> > Wolfe, R. E., M. Nishihama, A. J. Fleig, J. A. Kuyper, D. P. Roy, J. C.
> > Storey and F. S. Patt, Achieving sub-pixel geolocation accuracy
> > in support
> > of MODIS land science, Remote Sens. of Env., 83 (1-2): 31-49, Nov. 2002.
> >
> >    ==> see page 35, end of second column.

Thank you, Norman!

I shall update driver shortly.


-- 
Andrey V. Kiselev
Home phone:  +7 812 5274898  ICQ# 26871517

From ben at vterrain.org  Thu May 22 15:06:08 2003
From: ben at vterrain.org (Ben Discoe)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] /MD on Windows, SDTS problem and fix
In-Reply-To: <3ECD02C2.6030404@pobox.com>
Message-ID: <IHEAIHOJLJNLHCKGKJEDGEDOCFAA.ben@vterrain.org>

Recently i've been hitting memory problems with OGR, so i wanted to switch
to using /MD to build GDAL with MSVC.  In fact, i notice that this change
was checked into nmake.opt recently as well - and it's a good move.

However, switching to /MD caused a bug to pop up with using OGR to read
certain SDTS files.  I have tracked the bug down, and found it has to do
with using realloc() on a string that is precisely the length of its buffer,
which can cause (depending on heap conditions) an unterminated string and
subsequent crash.

Here is the 1-line fix:

RCS file: /cvsroot/osrs/gdal/frmts/iso8211/ddffielddefn.cpp,v
diff -w -r1.9 ddffielddefn.cpp
456c456
<                 if( (int) (strlen(pszExpandedContents) + strlen(pszDest))
---
>                 if( (int) (strlen(pszExpandedContents) + strlen(pszDest) +
1)

-Ben


From warmerdam at pobox.com  Thu May 22 15:15:09 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] /MD on Windows, SDTS problem and fix
In-Reply-To: <IHEAIHOJLJNLHCKGKJEDGEDOCFAA.ben@vterrain.org>
References: <IHEAIHOJLJNLHCKGKJEDGEDOCFAA.ben@vterrain.org>
Message-ID: <3ECD21BD.2010702@pobox.com>

Ben Discoe wrote:
> Recently i've been hitting memory problems with OGR, so i wanted to switch
> to using /MD to build GDAL with MSVC.  In fact, i notice that this change
> was checked into nmake.opt recently as well - and it's a good move.
> 
> However, switching to /MD caused a bug to pop up with using OGR to read
> certain SDTS files.  I have tracked the bug down, and found it has to do
> with using realloc() on a string that is precisely the length of its buffer,
> which can cause (depending on heap conditions) an unterminated string and
> subsequent crash.
> 
> Here is the 1-line fix:
> 
> RCS file: /cvsroot/osrs/gdal/frmts/iso8211/ddffielddefn.cpp,v
> diff -w -r1.9 ddffielddefn.cpp
> 456c456
> <                 if( (int) (strlen(pszExpandedContents) + strlen(pszDest))
> ---
> 
>>                if( (int) (strlen(pszExpandedContents) + strlen(pszDest) +
> 
> 1)

Ben,

I have committed this change.

Thanks Ben!

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From alobo at ija.csic.es  Fri May 23 04:48:00 2003
From: alobo at ija.csic.es (Agustin Lobo)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] PIX (PCI)
Message-ID: <Pine.OSF.3.91.1030523103911.18734E-100000@paleo.ija.csic.es>

Dear Gdal-developpers,

are you planning gdal
support for the PIX raster format
of PCI Geomatica ? 

Thanks
Agus

Dr. Agustin Lobo
Instituto de Ciencias de la Tierra (CSIC)
Lluis Sole Sabaris s/n
08028 Barcelona SPAIN
tel 34 93409 5410
fax 34 93411 0012
alobo@ija.csic.es




From alessandro_amici at telespazio.it  Fri May 23 06:28:35 2003
From: alessandro_amici at telespazio.it (Amici Alessandro)
Date: Wed Nov 21 11:48:51 2007
Subject: R: R: [Gdal-dev] [ANNOUNCE] gdal debian package at mentors.de
	bia n.ne t
Message-ID: <A183DF60AC72D5119B990002A5749CB3041FA8B8@ROMADG-MAIL01>

folks,

i uploaded new packages with the sonamed library to:
http://mentors.debian.net/debian/dists/unstable/main/binary-i386/gdal/

note that this introduces build and binary incopatibilities with the
source gdal distribution, i.e. old apps will not dynamicaly link with
the debian lib and need to be recompiled in order to get advantage
of it. OTOH the naming difference allows the debian and source
distributions to coexist. the trick is:
debian (installed under /usr): use '-lgdal' as link option,
source (installed under /usr/local): use '-lgdal.1.1' as link option

no incompatibility (and no coexistence) for python users (but make sure
you removed old gdal installations under /usr/local/).

note also, that all you need for making the debian package is contained
in the .diff.gz file (i.e. gdal_1.1.8+030521-1.diff.gz) that only creates
files under the gdal/debian directory.
in order to make custom packages of your updated or modified cvs copy, try:
$ cd gdal
$ gunzip -c ../gdal_1.1.8+030521-1.diff.gz
$ debuild -us -uc
this should work with cvs after 030521.

Frank, i'm working or plan to work on the following items:
	- make docs (move static html files under html/static)
	- make install-docs (same as web-update to $(docsdir))
	- look inside aclocal.m4 for a place to set the GDAL_SLIB* vars
	  (this should be enough for soname support on GNU binutils)
	- clear the exec flag on files (mainly python modules)

cheers,
alessandro

From warmerdam at pobox.com  Fri May 23 09:18:27 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] PIX (PCI)
In-Reply-To: <Pine.OSF.3.91.1030523103911.18734E-100000@paleo.ija.csic.es>
References: <Pine.OSF.3.91.1030523103911.18734E-100000@paleo.ija.csic.es>
Message-ID: <3ECE1FA3.5000601@pobox.com>

Agustin Lobo wrote:
> Dear Gdal-developpers,
> 
> are you planning gdal
> support for the PIX raster format
> of PCI Geomatica ? 

Agustin,

It has been my intention to implement PCIDSK (.pix) support in GDAL for
some time, but it has not been a priority for any of my clients so I haven't
done it yet.

Note, that I wrote much of the C code for PCIDSK support while at PCI, so I
may have a more intimate knowledge of the format than anyone else in the
world.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From alobo at ija.csic.es  Fri May 23 10:33:31 2003
From: alobo at ija.csic.es (Agustin Lobo)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] PIX (PCI)
In-Reply-To: <3ECE1FA3.5000601@pobox.com>
Message-ID: <Pine.OSF.3.91.1030523160010.29022B-100000@paleo.ija.csic.es>

Frank,

It would be great addition to gdal, please keep me 
posted on your plans.

Thanks

Agus

Dr. Agustin Lobo
Instituto de Ciencias de la Tierra (CSIC)
Lluis Sole Sabaris s/n
08028 Barcelona SPAIN
tel 34 93409 5410
fax 34 93411 0012
alobo@ija.csic.es


On Fri, 23 May 2003, Frank Warmerdam wrote:

> Agustin Lobo wrote:
> > Dear Gdal-developpers,
> > 
> > are you planning gdal
> > support for the PIX raster format
> > of PCI Geomatica ? 
> 
> Agustin,
> 
> It has been my intention to implement PCIDSK (.pix) support in GDAL for
> some time, but it has not been a priority for any of my clients so I haven't
> done it yet.
> 
> Note, that I wrote much of the C code for PCIDSK support while at PCI, so I
> may have a more intimate knowledge of the format than anyone else in the
> world.
> 
> Best regards,
> 
> -- 
> ---------------------------------------+--------------------------------------
> I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
> light and sound - activate the windows | http://pobox.com/~warmerdam
> and watch the world go round - Rush    | Geospatial Programmer for Rent
> 
> 
> _______________________________________________
> Gdal-dev mailing list
> Gdal-dev@remotesensing.org
> http://remotesensing.org/mailman/listinfo/gdal-dev
> 


From k.chodak at autoguard.pl  Fri May 23 12:33:37 2003
From: k.chodak at autoguard.pl (Krzysztof Chodak)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] ogr2ogr, TAB->SHP, MULTILINESTRINGs
Message-ID: <!~!UENERkVCMDkAAQACAAAAAAAAAAAAAAAAABgAAAAAAAAAFdPnwfXKHUWR3O5aC/3u8MKAAAAQAAAAKJqPvYY9P0u3QjZUXizbiQEAAAAA@autoguard.pl>

What are the objections of converting MULTILINESTRING (from MI TAB) into
(ESRI) shapes?

As sections from MULTILINESTRING can be independent/discontinuous it would
require creating one shape for each section. As ogr2ogr doesn't support such
conversion and MI Professional Universal Translator is doing it badly (it
makes one continuous line from all of segments which sometimes is correct
but sometimes produces rubbish) I have no tool and I'm in a dead point now.

It would be great if someone would suggest me the solution (or/and answer to
first question in this post).

BR
 
Krzysztof Chodak


From s.perkins at lanl.gov  Fri May 23 14:47:08 2003
From: s.perkins at lanl.gov (Simon Perkins)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] PROJ.4...
Message-ID: <1053715628.8138.68.camel@afreet.lanl.gov>

Hi,

I just ran into the problem of using a GDAL function
(OGRCreateCoordinateTransform) that needed the proj.4 library and
discovering that we didn't have it. I'm just in the process of
installing proj.4 and hopefully that will fix things.

A couple of questions:

- Why doesn't building GDAL require proj.4 to be around? I can guess the
answer is just to reduce dependencies but it seems like a gotcha.

- Is there a case for putting an internal copy of PROJ.4 in the GDAL
tree that configure uses if proj.4 is not installed on the build
machine?

- I can't see proj.4 listed on the GDAL page under "other libraries" you
might need.

- What kinds of things trigger the need to load in the PROJ.4 library?

Cheers!

Sy



From s.perkins at lanl.gov  Fri May 23 16:44:33 2003
From: s.perkins at lanl.gov (Simon Perkins)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] CreateCopy()
Message-ID: <1053722673.8138.118.camel@afreet.lanl.gov>

Just noticed that the default CreateCopy() routine doesn't copy metadata
from the source dataset to the target one. Although it does copy
metadata from each _band_ in the source dataset to each band in the
target (not sure what this is for).

I've CVS committed a one line fix to gdaldriver.cpp. Let me know if
there are any problems...

Cheers,

Sy



From warmerdam at pobox.com  Sat May 24 16:51:29 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] OpenEV 1.6.1_FW Release for Windows
Message-ID: <3ECFDB51.30902@pobox.com>

Folks,

I have prepared a new build of the OpenEV_FW tool suite for Win32 platforms.
This release bring PROJ.4, OpenEV and OGDI components up to date with
current CVS versions of each.   It can be found at:

   ftp://ftp.remotesensing.org/gdal/openev/OpenEV_161_FW.zip

I hope to issue a new cut in the not too distant future that includes
MapServer (likely without any mapscript extensions, or perhaps just
Python MapScript).

I have not prepared a Linux cut of this OpenEV_FW release.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent


		Open Source GIS/RS Binary Kit for Windows
		=========================================

OpenEV For Windows 98/NT/2000
-----------------------------

VERSION: OpenEV 1.6.1_FW   (May 24, 2003)

After unzipping edit the setfw.bat file in a text editor, and change
OPENEV_FW_DIR to point to wherever you put the resulting directory tree.

A sample image, utm.tif, is provided in the directory demo-data under
your install directory.  Start OpenEV by running openev.bat in a command
window, then select File, Open and double click on the demo-data directory
in the left column.  Select the image utm.tif and then OK.

See the online help for how to use OpenEV (fron the Help menu in OpenEV,
note: you must have a html browser such as Netscape or Internet Explorer
installed).

   web page:  http://openev.sourceforge.net

OpenEV was funded in part by Atlantis Scientific (www.atlsci.com)
and GeoInnovations (www.geoconnections.org).


Other Libraries, and Utilities
------------------------------

  o GDAL 1.1.9pre, including gdalinfo, gdal_translate, and gdaltindex, gdalwarp
    and gdalwarptest utilities.
    - Includes JPEG2000 (Kakadu), HDF4, ECW, and OGDI raster support.
  o OGR 1.1.8+, including ogrinfo, ogr2ogr, and ogrtindex utilities.
    - Includes OGDI vector, and GML support.
    - Includes FMEObjects vector reader.
    - Includes SoftmapSF.dll (OpenGIS Simple Features for COM/OLEDB provider)
      (just register it using "regsvr32 openev_fw\bin\SoftmapSF.dll")
    o Includes sfcdump.exe, an SF OLE DB provider dumper.
  o PROJ 4.4.7 plus proj.exe and cs2cs.exe
  o Gnuplot plotting package (run pgnuplot).
  o OGDI 3.1.1+, gltpd, ogdi_import and ogdi_info (includes VRF/VITD fixes)
  o Python 2.2

About this Package
------------------

This package was prepared by Frank Warmerdam (warmerdam@pobox.com) as a
handy package containing several related packages, with a maximum of
inter-component linkages enabled.  It is considerably more ad-hoc than some
of the more formal release packages, but it may have greater functionality
than formal releases.  This package aspires to be a "tool bench" of GIS/RS
tools for the end user.




From morissette at dmsolutions.ca  Sat May 24 11:45:54 2003
From: morissette at dmsolutions.ca (Daniel Morissette)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] New option to create points in polygon in ogr2ogr?
Message-ID: <3ECF93B2.975C93B3@dmsolutions.ca>

Frank,

For one of our projects we need to calculate label points (centroids)
for a set of shapefiles.  There is already a OGRPolygonLabelPoint()
function in mitab_geometry.cpp and we will probably use that in a custom
version of ogr2ogr.

Do you see any interest in making this a standard option in the release
version of ogr2ogr.cpp?  If yes then how would you want that option to
work?

Daniel
-- 
------------------------------------------------------------
 Daniel Morissette               morissette@dmsolutions.ca
 DM Solutions Group              http://www.dmsolutions.ca/
------------------------------------------------------------

From warmerdam at pobox.com  Sun May 25 14:13:01 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] New option to create points in polygon in ogr2ogr?
In-Reply-To: <3ECF93B2.975C93B3@dmsolutions.ca>
References: <3ECF93B2.975C93B3@dmsolutions.ca>
Message-ID: <3ED107AD.40708@pobox.com>

Daniel Morissette wrote:
> Frank,
> 
> For one of our projects we need to calculate label points (centroids)
> for a set of shapefiles.  There is already a OGRPolygonLabelPoint()
> function in mitab_geometry.cpp and we will probably use that in a custom
> version of ogr2ogr.
> 
> Do you see any interest in making this a standard option in the release
> version of ogr2ogr.cpp?  If yes then how would you want that option to
> work?

Daniel,

I am not too enthusiastic about making this a standard ogr2ogr option.
However, it does seem like a useful capability to move into the generic
OGR API, and to expose from python for those wanting to script specific
operations.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From saddergoat at hotmail.com  Mon May 26 15:26:45 2003
From: saddergoat at hotmail.com (Bill Bob)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] (no subject)
Message-ID: <Law12-F79PIei5gjakz0001701b@hotmail.com>

Hi,

I am trying to get familiar with the API by following the WarpAPI tutorial 
and also from gdalwarp.c and gdalwarptest.c.

I have included some of my code.  It appears that I do not setup the correct 
transformation.  My resulting image is in the orginal projection.

Any thoughts?


    char *pszTmpSrc = NULL;
    char *pszTmpDst = NULL;
    char *pszTargetSRS = NULL;
    char *pszSourceSRS = NULL;
    unsigned char aByte;
    int i,verbose=0;
    FILE *fpBuff = NULL;

    //GDAL specific vars
	GDALDatasetH hSrsDataset=NULL,hDstDataset=NULL;
	GDALWarpOptions *psWarpOptions=NULL;
	GDALWarpOperation oOperation;
    double adfGeoTransform[6];


// ....

	psWarpOptions = GDALCreateWarpOptions();
	psWarpOptions->hSrcDS = hSrsDataset;
	psWarpOptions->hDstDS = hDstDataset;
	psWarpOptions->nBandCount = GDALGetRasterCount(hSrsDataset); //1;
	psWarpOptions->panSrcBands = (int *) CPLMalloc( sizeof(int) * 
psWarpOptions->nBandCount );
	psWarpOptions->panSrcBands[0] = 1;
	psWarpOptions->panDstBands = (int *) CPLMalloc( sizeof(int) * 
psWarpOptions->nBandCount );
	psWarpOptions->panDstBands[0] = 1;
	psWarpOptions->pfnProgress = GDALTermProgress;


	// set projection transformer
	psWarpOptions->pTransformerArg = GDALCreateGenImgProjTransformer( 
hSrsDataset,
	                                                                  
GDALGetProjectionRef(hSrsDataset),
	                                                                  
hDstDataset,
	                                                                  
GDALGetProjectionRef(hDstDataset),
	                                                                  FALSE,
	                                                                  0.0,
	                                                                  1
	                                                                );

	psWarpOptions->pfnTransformer = GDALGenImgProjTransform;

	// do the warp
	if( oOperation.Initialize( psWarpOptions ) == CE_None )
	{
		oOperation.ChunkAndWarpImage( 0, 0,GDALGetRasterXSize( hDstDataset 
),GDALGetRasterYSize( hDstDataset ));
	}

	// clean up after the reprojection
	GDALDestroyGenImgProjTransformer( psWarpOptions->pTransformerArg );
	GDALDestroyWarpOptions( psWarpOptions );
	GDALClose( hSrsDataset );
	GDALClose( hDstDataset );

_________________________________________________________________
Add photos to your messages with MSN 8. Get 2 months FREE*.  
http://join.msn.com/?page=features/featuredemail


From garvank at optech.on.ca  Mon May 26 16:05:12 2003
From: garvank at optech.on.ca (Garvan Keeley)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] OGR projection: lat/long to UTM
Message-ID: <11E3973D1E78D311A5B400508B4A70CE6A9FAA@COMSRVR>

Is there a way to convert decimal lat/long (unprojected) to UTM without
using WKT?
I can't see how to set the destination projection to UTM without specifying
the zone. The function SetUTM() requires a zone argument, which isn't known
until the transform has occurred. 

For example,

OGRSpatialReference source;
source.SetWellKnownGeogCS("WGS84");

OGRSpatialReference destination;
destination.SetWellKnownGeogCS("WGS84"); 
destination.SetUTM();  <--------- this requires a parameter

I think I am going about this the wrong way,
Thanks.

=======================
Garvan Keeley
Programmer/Analyst
Optech Incorporated
100 Wildcat Road
Toronto, Ontario, Canada, M3J 2Z9
Web: http://www.optech.on.ca
Tel: 416.661.5904 x441 

From ed at topozone.com  Mon May 26 16:34:29 2003
From: ed at topozone.com (Ed McNierney)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] OGR projection: lat/long to UTM
Message-ID: <13858AA1A74F30419F319ACB66A9D122019704@mercator.topozone.com>

Garvan -

You need to calculate the target UTM zone from the input longitude.  It
is possible for a given lat/lon point to be projected into more than one
UTM zone - although purists would object to doing so, there are
practical applications in which that's desirable.

Take the input longitude, add 180, divide by 6, truncate to an integer,
and add 1 to get the standard UTM zone.

	UTM = floor((lon + 180) / 6) + 1


	- Ed

Ed McNierney
President and Chief Mapmaker
TopoZone.com / Maps a la carte, Inc.
73 Princeton Street, Suite 305
North Chelmsford, MA  01863
Phone: (978) 251-4242  Fax: (978) 251-1396
ed@topozone.com


-----Original Message-----
From: Garvan Keeley [mailto:garvank@optech.on.ca] 
Sent: Monday, May 26, 2003 4:05 PM
To: 'gdal-dev@remotesensing.org'
Subject: [Gdal-dev] OGR projection: lat/long to UTM

Is there a way to convert decimal lat/long (unprojected) to UTM without
using WKT?
I can't see how to set the destination projection to UTM without
specifying
the zone. The function SetUTM() requires a zone argument, which isn't
known
until the transform has occurred. 

For example,

OGRSpatialReference source;
source.SetWellKnownGeogCS("WGS84");

OGRSpatialReference destination;
destination.SetWellKnownGeogCS("WGS84"); 
destination.SetUTM();  <--------- this requires a parameter

I think I am going about this the wrong way,
Thanks.

=======================
Garvan Keeley
Programmer/Analyst
Optech Incorporated
100 Wildcat Road
Toronto, Ontario, Canada, M3J 2Z9
Web: http://www.optech.on.ca
Tel: 416.661.5904 x441 
_______________________________________________
Gdal-dev mailing list
Gdal-dev@remotesensing.org
http://remotesensing.org/mailman/listinfo/gdal-dev

From warmerdam at pobox.com  Tue May 27 16:06:01 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] (no subject)
References: <Law12-F79PIei5gjakz0001701b@hotmail.com>
Message-ID: <3ED3C529.7020306@pobox.com>

Bill Bob wrote:
> Hi,
> 
> I am trying to get familiar with the API by following the WarpAPI 
> tutorial and also from gdalwarp.c and gdalwarptest.c.
> 
> I have included some of my code.  It appears that I do not setup the 
> correct transformation.  My resulting image is in the orginal projection.
> 
> Any thoughts?
...
>     // set projection transformer
>     psWarpOptions->pTransformerArg = GDALCreateGenImgProjTransformer( 
> hSrsDataset,
>                                                                       
> GDALGetProjectionRef(hSrsDataset),
>                                                                       
> hDstDataset,
>                                                                       
> GDALGetProjectionRef(hDstDataset),
>                                                                       
> FALSE,
>                                                                       0.0,
>                                                                       1
>                                                                     );

Bill,

I think the most likely problem is that the source or destination coordinate
systems are not properly defined.  Trying printing out the results of
GDALGetProjectionRef() on the source and destination and see if they make
sense or post them here.

Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From alessandro_amici at telespazio.it  Tue May 27 08:55:40 2003
From: alessandro_amici at telespazio.it (Amici Alessandro)
Date: Wed Nov 21 11:48:51 2007
Subject: R: [Gdal-dev] [ANNOUNCE] gdal debian package at mentors.de bi
	a n.ne t
Message-ID: <A183DF60AC72D5119B990002A5749CB30425E65A@ROMADG-MAIL01>

Frank,

> i'm working or plan to work on the following items:
>	- make docs (move static html files under html/static)
>	- make install-docs (same as web-update to $(docsdir))
i didn't find any solution that i really like, but i think the 
following is the one more in line with present file placement.
move formats_list.html and frmt_various.html to frmts and
gdal_utilities.html gdalicon.png to apps, then apply the patch:

--- ../gdal-1.1.8+030521/GNUmakefile	2003-05-21 23:14:09.000000000 +0200
+++ GNUmakefile	2003-05-27 09:49:19.000000000 +0200
@@ -89,7 +89,8 @@
 	(cd pymod; $(MAKE))
 
 lclean:
-	rm -f *.a *.so config.log config.cache
+	rm -f *.a *.so config.log config.cache html/*.*
+
 
 distclean:	dist-clean
 
@@ -107,13 +108,17 @@
 
 docs:
 	(cd html; rm -f *.*)
-	(cd html; cvs update gdal_utilities.html gdalicon.png \
-		             formats_list.html frmt_various.html)
+	cp apps/gdal_utilities.html apps/gdalicon.png html
+	cp frmts/*.html html
 	doxygen
 	cp frmts/*/frmt_*.html html
 
 all:	default ogr-all
 
+install-docs:
+	$(INSTALL_DIR) $(INST_DOCS)
+	cp html/*.* $(INST_DOCS)
+
 web-update:	docs
 	rm -rf /u/www/gdal/html
 	mkdir /u/www/gdal/html
--- ../gdal-1.1.8+030521/GDALmake.opt.in	2003-05-21
23:14:09.000000000 +0200
+++ GDALmake.opt.in	2003-05-27 09:51:45.000000000 +0200
@@ -31,6 +31,7 @@
 INST_LIB	=	@libdir@
 INST_BIN	=	@bindir@
 INST_PYMOD      =       @pymoddir@
+INST_DOCS	=	@exec_prefix@/doc/gdal
 
 #
 #	Whether we use debug flags, or optimization is determined by

in this way the html directory becomes a kind of build directory
for the documentation and can be safely wiped out before running
doxygen.
BTW, i choosed @exec_prefix@/doc/gdal for installing html docs,
i'm not sure it is the best place (on debian they are placed under:
/usr/share/doc/libgdal1/html anyhow). i didn't add the doc-related 
targets to the 'all' and 'install' default targets, however IMHO it
could be a nice addition to the standard installed base. 

>	- look inside aclocal.m4 for a place to set the GDAL_SLIB* vars
>	  (this should be enough for soname support on GNU binutils)
>	- clear the exec flag on files (mainly python modules)
still in progress

cheers,
alessandro
_______________________________________________
Gdal-dev mailing list
Gdal-dev@remotesensing.org
http://remotesensing.org/mailman/listinfo/gdal-dev

From warmerdam at pobox.com  Tue May 27 09:12:47 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] ogr2ogr, TAB->SHP, MULTILINESTRINGs
In-Reply-To: <!~!UENERkVCMDkAAQACAAAAAAAAAAAAAAAAABgAAAAAAAAAFdPnwfXKHUWR3O5aC/3u8MKAAAAQAAAAKJqPvYY9P0u3QjZUXizbiQEAAAAA@autoguard.pl>
References: <!~!UENERkVCMDkAAQACAAAAAAAAAAAAAAAAABgAAAAAAAAAFdPnwfXKHUWR3O5aC/3u8MKAAAAQAAAAKJqPvYY9P0u3QjZUXizbiQEAAAAA@autoguard.pl>
Message-ID: <3ED3644F.8070307@pobox.com>

Krzysztof Chodak wrote:
> What are the objections of converting MULTILINESTRING (from MI TAB) into
> (ESRI) shapes?
> 
> As sections from MULTILINESTRING can be independent/discontinuous it would
> require creating one shape for each section. As ogr2ogr doesn't support such
> conversion and MI Professional Universal Translator is doing it badly (it
> makes one continuous line from all of segments which sometimes is correct
> but sometimes produces rubbish) I have no tool and I'm in a dead point now.
> 
> It would be great if someone would suggest me the solution (or/and answer to
> first question in this post).

Krzysztof,

Could you supply an example of these MapInfo multilinestrings?  When you say
they aren't supported by OGR for translation to shape, do you mean OGR doesn't
read them at all or that they aren't properly translated?

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From k.chodak at autoguard.pl  Tue May 27 09:31:19 2003
From: k.chodak at autoguard.pl (Krzysztof Chodak)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] ogr2ogr, TAB->SHP, MULTILINESTRINGs
In-Reply-To: <3ED3644F.8070307@pobox.com>
Message-ID: <!~!UENERkVCMDkAAQACAAAAAAAAAAAAAAAAABgAAAAAAAAAFdPnwfXKHUWR3O5aC/3u8KKCAAAQAAAAhNXboDI1TkuP+I1mdZ05VwEAAAAA@autoguard.pl>

Reads...

INFO: Open of `railways2-linestring.tab'
using driver `MapInfo File' successful.
1: railways2 (Line String)
...
OGRFeature(railways2):1491
  kolej (String) = kolej
  Style = PEN(w:1px,c:#000000,id:"mapinfo-pen-203.ogr-pen-0")
  MULTILINESTRING ((19.17392900 49.65804700,19.17453500
49.65919400,19.17873700 49.66676400,19.17926000 49.66771700,19.18079500
49.67061500,19.18130100 49.67143100,19.18148700 49.67212100,19.18159900
49.67285700,19.18180900 49.67383100,19.18186000 49.67430500,19.18188500
49.67454200,19.18189100 49.67520500,19.18204700 49.67577600,19.18238300
49.67635100,19.18399100 49.67922700,19.18513700 49.68112300,19.18553100
49.68188700,19.18559700 49.68200400,19.18560400 49.68207400,19.18567400
49.68229500,19.18571500 49.68276800,19.18554900 49.68323700,19.18481700
49.68504100,19.18413100 49.68660800,19.18278500 49.68998200,19.17935000
49.69798700,19.17796000 49.70152400,19.17767800 49.70217900,19.17764300
49.70295900,19.17746300 49.70373500,19.17738400 49.70467900,19.17732200
49.70526800,19.17692700 49.70599200,19.17611500 49.70715500,19.17518000
49.70781800,19.17394900 49.70864000,19.17266600 49.70901100,19.17094500
49.70944300,19.16918700 49.70989700,19.16871100 49.71002700,19.16616800
49.71103100,19.16564700 49.71135900),(19.18559700 49.68200400,19.18598700
49.68234900,19.18694000 49.68289300,19.18772600 49.68312500,19.18963700
49.68328900,19.19129400 49.68347100,19.19428700 49.68370800,19.19515700
49.68368100,19.19651000 49.68338300,19.19694800 49.68329900,19.19709900
49.68316100,19.19743600 49.68290900,19.19841100 49.68215200,19.19863600
49.68196800,19.19889800 49.68178500,19.19923100 49.68162700,19.20133200
49.68077900,19.20483300 49.67939700,19.20859000 49.67792700,19.21090500
49.67717800,19.21174500 49.67700900,19.21262100 49.67686400,19.21429100
49.67673900,19.21585000 49.67668200,19.21653700 49.67669800,19.21686800
49.67658800,19.21858500 49.67622700,19.22297700 49.67515000,19.22557500
49.67452700,19.22847500 49.67362700,19.23324800 49.67211000,19.23688100
49.67101400,19.23757900 49.67077100,19.23827300 49.67064600,19.23980000
49.67049300,19.24128800 49.67038700,19.24267300 49.67018400,19.24533400
49.66977500,19.24599100 49.66964900,19.24675000 49.66969600))

but doesn't translate

ogr2ogr 1 railways2.tab
ERROR 1: Attempt to write non-linestring (MULTILINESTRING) geometry to ARC
type shapefile.
ERROR 1: Terminating translation prematurely after failed
translation of layer railways2

BR
 
Krzysztof Chodak


-----Original Message-----
From: gdal-dev-admin@remotesensing.org
[mailto:gdal-dev-admin@remotesensing.org] On Behalf Of Frank Warmerdam
Sent: Tuesday, May 27, 2003 3:13 PM
To: gdal-dev@remotesensing.org
Subject: Re: [Gdal-dev] ogr2ogr, TAB->SHP, MULTILINESTRINGs


Krzysztof Chodak wrote:
> What are the objections of converting MULTILINESTRING (from MI TAB) into
> (ESRI) shapes?
> 
> As sections from MULTILINESTRING can be independent/discontinuous it would
> require creating one shape for each section. As ogr2ogr doesn't support
such
> conversion and MI Professional Universal Translator is doing it badly (it
> makes one continuous line from all of segments which sometimes is correct
> but sometimes produces rubbish) I have no tool and I'm in a dead point
now.
> 
> It would be great if someone would suggest me the solution (or/and answer
to
> first question in this post).

Krzysztof,

Could you supply an example of these MapInfo multilinestrings?  When you say
they aren't supported by OGR for translation to shape, do you mean OGR
doesn't
read them at all or that they aren't properly translated?

Best regards,

-- 
---------------------------------------+------------------------------------
--
I set the clouds in motion - turn up   | Frank Warmerdam,
warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent


_______________________________________________
Gdal-dev mailing list
Gdal-dev@remotesensing.org
http://remotesensing.org/mailman/listinfo/gdal-dev


From ben at vterrain.org  Mon May 26 16:20:26 2003
From: ben at vterrain.org (Ben Discoe)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] OGR projection: lat/long to UTM
In-Reply-To: <11E3973D1E78D311A5B400508B4A70CE6A9FAA@COMSRVR>
Message-ID: <IHEAIHOJLJNLHCKGKJEDIEIACFAA.ben@vterrain.org>

Garvan,

You can determine the UTM zone before the transformation.

	int zone = (int) (((longitude + 180.0) / 6.0) + 1.0);

-Ben

> -----Original Message-----
> From: gdal-dev-admin@remotesensing.org
> [mailto:gdal-dev-admin@remotesensing.org]On Behalf Of Garvan Keeley
> Sent: Monday, May 26, 2003 4:05 PM
> To: 'gdal-dev@remotesensing.org'
> Subject: [Gdal-dev] OGR projection: lat/long to UTM
> 
> 
> Is there a way to convert decimal lat/long (unprojected) to UTM without
> using WKT?
> I can't see how to set the destination projection to UTM without 
> specifying
> the zone. The function SetUTM() requires a zone argument, which 
> isn't known until the transform has occurred.

From warmerdam at pobox.com  Tue May 27 14:00:14 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: R: [Gdal-dev] [ANNOUNCE] gdal debian package at mentors.de bi
 a n.ne t
In-Reply-To: <A183DF60AC72D5119B990002A5749CB30425E65A@ROMADG-MAIL01>
References: <A183DF60AC72D5119B990002A5749CB30425E65A@ROMADG-MAIL01>
Message-ID: <3ED3A7AE.7050307@pobox.com>

Amici Alessandro wrote:
> i didn't find any solution that i really like, but i think the 
> following is the one more in line with present file placement.
> move formats_list.html and frmt_various.html to frmts and
> gdal_utilities.html gdalicon.png to apps, then apply the patch:

Alessandro,

I have applied the suggested changes with a few minor differences.
The gdal_utilities.html was already created from core/gdal_utilities.dox
(the old html file logic was left over), and the master version of
gdalicon.png is in gdal/data already.

Let me know if you have any problems with the code as committed now.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From tlsmith_1999 at yahoo.com  Wed May 28 08:17:41 2003
From: tlsmith_1999 at yahoo.com (Tim Smith)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] problem converting to jpeg
Message-ID: <20030528121741.88278.qmail@web12306.mail.yahoo.com>

I am trying to convert a NITF file into a JPEG file.
gdalinfo shows that the NITF has a
colorInterp=palette.
When I use gdal_translate (gdal_translate -of JPEG
/path/file.nitf /path/file.jpeg), the created jpeg
file has a colorInterp=Grey.  Is there a way to do
this without the loss of color?
Tim

__________________________________
Do you Yahoo!?
Yahoo! Calendar - Free online calendar with sync to Outlook(TM).
http://calendar.yahoo.com

From warmerdam at pobox.com  Wed May 28 10:08:43 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] problem converting to jpeg
In-Reply-To: <20030528121741.88278.qmail@web12306.mail.yahoo.com>
References: <20030528121741.88278.qmail@web12306.mail.yahoo.com>
Message-ID: <3ED4C2EB.9080807@pobox.com>

Tim Smith wrote:
> I am trying to convert a NITF file into a JPEG file.
> gdalinfo shows that the NITF has a
> colorInterp=palette.
> When I use gdal_translate (gdal_translate -of JPEG
> /path/file.nitf /path/file.jpeg), the created jpeg
> file has a colorInterp=Grey.  Is there a way to do
> this without the loss of color?

Tim,

JPEG does not support paletted output files, and gdal_translate does not
currently support converting 1 band paletted images into 3 band RGB images.
So currently gdal_translate cannot convert the file to JPEG in a useful way.
Do you really need it in JPEG?  It should convert easily to PNG, GeoTIFF, etc.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From warmerdam at pobox.com  Wed May 28 12:31:35 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] problem converting to jpeg
In-Reply-To: <3ED4C2EB.9080807@pobox.com>
References: <20030528121741.88278.qmail@web12306.mail.yahoo.com> <3ED4C2EB.9080807@pobox.com>
Message-ID: <3ED4E467.9050909@pobox.com>

Frank Warmerdam wrote:
> Tim Smith wrote:
> 
>> I am trying to convert a NITF file into a JPEG file.
>> gdalinfo shows that the NITF has a
>> colorInterp=palette.
>> When I use gdal_translate (gdal_translate -of JPEG
>> /path/file.nitf /path/file.jpeg), the created jpeg
>> file has a colorInterp=Grey.  Is there a way to do
>> this without the loss of color?
> 
> 
> Tim,
> 
> JPEG does not support paletted output files, and gdal_translate does not
> currently support converting 1 band paletted images into 3 band RGB images.
> So currently gdal_translate cannot convert the file to JPEG in a useful 
> way.
> Do you really need it in JPEG?  It should convert easily to PNG, 
> GeoTIFF, etc.

Tim,

In followup, I have written a Python script (pct2rgb.py) that is provides
a service to translate pseudocolored files into RGB or RGBA.  The script
is in CVS in gdal/pymod.  If you are interested in pursuing this you can
rebuild from CVS (ensuring you have the python Numeric package installed)
and then do something like:

  gdal/pymod/pct2rgb.py -of JPEG overview.ovr overview.jpg

This script is a good example of applying lookup tables in python using
the "take" operation.  The portion that applies the color table looks like
this:

# ----------------------------------------------------------------------------
# Build color table.

lookup = [ Numeric.arrayrange(256),
            Numeric.arrayrange(256),
            Numeric.arrayrange(256),
            Numeric.ones(256)*255 ]

ct = src_band.GetRasterColorTable()

if ct is not None:
     for i in range(min(256,ct.GetCount())):
         entry = ct.GetColorEntry(i)
         for c in range(4):
             lookup[c][i] = entry[c]

...

# ----------------------------------------------------------------------------
# Do the processing one scanline at a time.

for iY in range(src_ds.RasterYSize):
     src_data = src_band.ReadAsArray(0,iY,src_ds.RasterXSize,1)

     for iBand in range(out_bands):
         band_lookup = lookup[iBand]

         dst_data = Numeric.take(band_lookup,src_data)
         tif_ds.GetRasterBand(iBand+1).WriteArray(dst_data,0,iY)


Best regards,
-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From saddergoat at hotmail.com  Thu May 29 10:43:59 2003
From: saddergoat at hotmail.com (Bill Bob)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] Re: imagewarp help (previously no subject)
Message-ID: <Law12-F86Y6YHkidcDj00022b06@hotmail.com>

Hi Frank,

Thanks for your suggestion.  I am not sure if I am doing it right.  I have 
added the following:

	if( verbose )
	{
		fprintf(stderr,"using projection parameters of 
%s\n",CPLStrdup(GDALGetProjectionRef(hSrsDataset)) );
	}

What I get is an empty string, which leaves me wondering is it that I 
haven't setup the correct projection, or that I don't know how to use 
GDALGetProjectionRef().




Date: Tue, 27 May 2003 16:06:01 -0400
From: Frank Warmerdam <warmerdam@pobox.com>
To: gdal-dev@remotesensing.org
Subject: Re: [Gdal-dev] (no subject)
Reply-To: gdal-dev@remotesensing.org

Bill Bob wrote:
>Hi,
>
>I am trying to get familiar with the API by following the WarpAPI tutorial 
>and also from gdalwarp.c and gdalwarptest.c.
>
>I have included some of my code.  It appears that I do not setup the 
>correct transformation.  My resulting image is in the orginal projection.
>
>Any thoughts?
...
>     // set projection transformer
>     psWarpOptions->pTransformerArg = GDALCreateGenImgProjTransformer( 
>hSrsDataset,
>                                                                       
>GDALGetProjectionRef(hSrsDataset),
>                                                                       
>hDstDataset,
>                                                                       
>GDALGetProjectionRef(hDstDataset),
>                                                                       
>FALSE,
>                                                                       0.0,
>                                                                       1
>                                                                     );

Bill,

I think the most likely problem is that the source or destination coordinate
systems are not properly defined.  Trying printing out the results of
GDALGetProjectionRef() on the source and destination and see if they make
sense or post them here.

Best regards,
--
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, 
warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent

_________________________________________________________________
The new MSN 8: smart spam protection and 2 months FREE*  
http://join.msn.com/?page=features/junkmail


From warmerdam at pobox.com  Thu May 29 10:56:10 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] Re: imagewarp help (previously no subject)
In-Reply-To: <Law12-F86Y6YHkidcDj00022b06@hotmail.com>
References: <Law12-F86Y6YHkidcDj00022b06@hotmail.com>
Message-ID: <3ED61F8A.9020802@pobox.com>

Bill Bob wrote:
> Hi Frank,
> 
> Thanks for your suggestion.  I am not sure if I am doing it right.  I 
> have added the following:
> 
>     if( verbose )
>     {
>         fprintf(stderr,"using projection parameters of 
> %s\n",CPLStrdup(GDALGetProjectionRef(hSrsDataset)) );
>     }
> 
> What I get is an empty string, which leaves me wondering is it that I 
> haven't setup the correct projection, or that I don't know how to use 
> GDALGetProjectionRef().

Bill,

This is the source or destination dataset?  Reprojection will definately not
work if you don't have a coordinate system definition.  You will need a valid
source and destination coordinate system.  If you are creating the output file
you will generally have to define the output coordinate system yourself.  If
the source doesn't have one that GDAL recognises you will need to provide it.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From zhang at aero.und.edu  Thu May 29 17:38:10 2003
From: zhang at aero.und.edu (Xiaodong Zhang)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] color table
Message-ID: <3ED67DC2.4020405@aero.und.edu>

Hi,

I want to use GDALRasterBand::SetColorTable(GDAL ColorTable * ctb) to 
attach a color table to the image I created. How can I define the color 
table or if I have a predefined color table (3 columns, each column for 
R, G, B respectively), how can import that color table. Thanks.

Xiaodong


From warmerdam at pobox.com  Thu May 29 17:47:57 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] color table
In-Reply-To: <3ED67DC2.4020405@aero.und.edu>
References: <3ED67DC2.4020405@aero.und.edu>
Message-ID: <3ED6800D.6050903@pobox.com>

Xiaodong Zhang wrote:
> Hi,
> 
> I want to use GDALRasterBand::SetColorTable(GDAL ColorTable * ctb) to 
> attach a color table to the image I created. How can I define the color 
> table or if I have a predefined color table (3 columns, each column for 
> R, G, B respectively), how can import that color table. Thanks.

Hi,

This is example code for creating a GDALColorTable object in C++.  The source
data in this case uses normalized color values (0.0 to 1.0) so it has to be
scaled to 0 to 255.  If you don't have alpha (transparency) values make sure
you set all alpha values to 255 for opaque.

         poCT = new GDALColorTable();
         for( int iColor = 0; iColor < nColors; iColor++ )
         {
             GDALColorEntry   sEntry;

             sEntry.c1 = (short) (padfRed[iColor]   * 255);
             sEntry.c2 = (short) (padfGreen[iColor] * 255);
             sEntry.c3 = (short) (padfBlue[iColor]  * 255);
             sEntry.c4 = (short) (padfAlpha[iColor]  * 255);
             poCT->SetColorEntry( iColor, &sEntry );
         }

Note that many drivers do not allow you to update a colortable in place.

Good luck,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From garvank at optech.on.ca  Fri May 30 12:17:33 2003
From: garvank at optech.on.ca (Garvan Keeley)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] OGR Error on State Plane transform
Message-ID: <11E3973D1E78D311A5B400508B4A70CE6A9FB8@COMSRVR>

Hi,
I am attempting to project lat/long to state plane coordinates. The
transformation fails, and I am getting the following error reported:

"Unable to find state plane zone in horiz_cs.csv, likely because EPSG tables
cannot be found.  Using incomplete definition of state plane zone."
 
I have defined GEOTIFF_CSV to point to the csv files, and PROJ_LIB to point
to its required files. Any ideas where I might find the EPSG tables?

Thanks.


=======================
Garvan Keeley
Programmer/Analyst
Optech Incorporated
100 Wildcat Road
Toronto, Ontario, Canada, M3J 2Z9
Web: http://www.optech.on.ca
Tel: 416.661.5904 x441 

From warmerdam at pobox.com  Fri May 30 12:31:24 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] OGR Error on State Plane transform
In-Reply-To: <11E3973D1E78D311A5B400508B4A70CE6A9FB8@COMSRVR>
References: <11E3973D1E78D311A5B400508B4A70CE6A9FB8@COMSRVR>
Message-ID: <3ED7875C.8000004@pobox.com>

Garvan Keeley wrote:
> Hi,
> I am attempting to project lat/long to state plane coordinates. The
> transformation fails, and I am getting the following error reported:
> 
> "Unable to find state plane zone in horiz_cs.csv, likely because EPSG tables
> cannot be found.  Using incomplete definition of state plane zone."
>  
> I have defined GEOTIFF_CSV to point to the csv files, and PROJ_LIB to point
> to its required files. Any ideas where I might find the EPSG tables?

Garvan,

What version of GDAL are you using?  Note that GDAL now (since the EPSG
6.2.2 upgrade a couple of months ago) uses more csv files than those
distributed with libgeotiff, so it is necessary for GDAL to find the files
in the gdal/data directory.  These include a file listing state plane zones
and "concatenated" information about files projected and geographic coordinate
systems.

However, the message you are getting about horiz_cs.csv is odd.  The
horiz_cs.csv doesn't exist anymore.  It seems likely you are either using
old software, or there is a part of GDAL (or libgeotiff) that hasn't been
updated to the new scheme properly.  To track that down I need details
of the version of GDAL, command and projections involved.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From garvank at optech.on.ca  Fri May 30 14:09:02 2003
From: garvank at optech.on.ca (Garvan Keeley)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] OGR Error on State Plane transform
Message-ID: <11E3973D1E78D311A5B400508B4A70CE6A9FB9@COMSRVR>

Hi Frank,
the version of GDAL is from CVS, the last update was March 24. I'll pull the
latest and rebuild.

I am using Windows, Visual C++.

The code:

	OGRSpatialReference source;
	OGRSpatialReference destination;
	OGRCoordinateTransformation* transform;

	source.SetWellKnownGeogCS("NAD83");
	destination.SetWellKnownGeogCS("NAD83"); 
	destination.SetStatePlane(101, true);

	transform = OGRCreateCoordinateTransformation(&source,
&destination);
	if (transform != NULL) {
		double x = -87.0, y = 30.5;
		OGRErr err = transform->Transform(1, &x, &y, NULL);
		if (err != OGRERR_NONE)
			TRACE("%s\n", CPLGetLastErrorMsg());
		
		TRACE("Transform Result: %f %f  \n", x, y);
		delete transform;    
	}




> Garvan,
> 
> What version of GDAL are you using?  Note that GDAL now 
> (since the EPSG 6.2.2 upgrade a couple of months ago) uses 
> more csv files than those distributed with libgeotiff, so it 
> is necessary for GDAL to find the files in the gdal/data 
> directory.  These include a file listing state plane zones 
> and "concatenated" information about files projected and 
> geographic coordinate systems.
> 
> However, the message you are getting about horiz_cs.csv is 
> odd.  The horiz_cs.csv doesn't exist anymore.  It seems 
> likely you are either using old software, or there is a part 
> of GDAL (or libgeotiff) that hasn't been updated to the new 
> scheme properly.  To track that down I need details of the 
> version of GDAL, command and projections involved.
> 
> Best regards,
> 
> -- 
> ---------------------------------------+----------------------
> ----------
> ---------------------------------------+------
> I set the clouds in motion - turn up   | Frank Warmerdam, 
> warmerdam@pobox.com
> light and sound - activate the windows | http://pobox.com/~warmerdam
> and watch the world go round - Rush    | Geospatial 
> Programmer for Rent
> 
> 
> _______________________________________________
> Gdal-dev mailing list
> Gdal-dev@remotesensing.org 
> http://remotesensing.org/mailman/listinfo/gdal-> dev
> 

From warmerdam at pobox.com  Fri May 30 14:39:21 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] OGR Error on State Plane transform
In-Reply-To: <11E3973D1E78D311A5B400508B4A70CE6A9FB9@COMSRVR>
References: <11E3973D1E78D311A5B400508B4A70CE6A9FB9@COMSRVR>
Message-ID: <3ED7A559.7010301@pobox.com>

Garvan Keeley wrote:
> Hi Frank,
> the version of GDAL is from CVS, the last update was March 24. I'll pull the
> latest and rebuild.
> 
> I am using Windows, Visual C++.
> 
> The code:
> 
> 	OGRSpatialReference source;
> 	OGRSpatialReference destination;
> 	OGRCoordinateTransformation* transform;
> 
> 	source.SetWellKnownGeogCS("NAD83");
> 	destination.SetWellKnownGeogCS("NAD83"); 
> 	destination.SetStatePlane(101, true);
> 
> 	transform = OGRCreateCoordinateTransformation(&source,
> &destination);
> 	if (transform != NULL) {
> 		double x = -87.0, y = 30.5;
> 		OGRErr err = transform->Transform(1, &x, &y, NULL);
> 		if (err != OGRERR_NONE)
> 			TRACE("%s\n", CPLGetLastErrorMsg());
> 		
> 		TRACE("Transform Result: %f %f  \n", x, y);
> 		delete transform;    
> 	}


Garvan,

I have reproduced your problem.  The system isn't finding the stateplane.csv
file.  Try pointing GEOTIFF_CSV to your gdal/data directory, or copying
stateplane.csv (and likely pcs.csv and gcs.csv) to your GEOTIFF_CSV directory.

I have also improved the error message (the text of the message was out of
date), and a bug in the fallback code that uses SetLocalCS() if the state
plane zone can't be fully resolved.

Finally, I have just today made substantial other changes to SetStatePlane().
The C++ method now takes additional (optional) arguments to override the
linear units from what the legal (aka EPSG) definition of the zone is.  It
is common, for instance, to use NAD83 State Plane zone definitions, but to
force the units to feet.  Converting the meter definition to feet is a bit
tricky, but this is now all encapsulated in the SetStatePlane() method.

While this changes the C++ ABI, old code should still compile fine since
the extra arguments are defaulted.  I also added OSRSetStatePlaneWithUnits()
to the C API for the new args, and left the old call unchanged so there
is no C ABI change (just an extension).

The autotest suite now includes some state plane testing.

The Erdas Imagine driver now properly supports state plane files
where the units are not the same as the expected zone units.

A big day for state plane!

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From garvank at optech.on.ca  Fri May 30 15:27:51 2003
From: garvank at optech.on.ca (Garvan Keeley)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] OGR Error on State Plane transform
Message-ID: <11E3973D1E78D311A5B400508B4A70CE6A9FBA@COMSRVR>

Thanks Frank,
once the files were placed in the right place, the error went away and the
transform was successful. 

I didn't realize there is an testing suite, where is that located?

Also, in the SetStatePlane function (SetStatePlane(int nZone, int bNAD83 =
TRUE)) is the second argument indicating whether NAD27 or NAD83 are being
used as input coordinates?
If so, is SetWellKnownGeogCS() necessary in this instance?


> Garvan,
> 
> I have reproduced your problem.  The system isn't finding the 
> stateplane.csv file.  Try pointing GEOTIFF_CSV to your 
> gdal/data directory, or copying stateplane.csv (and likely 
> pcs.csv and gcs.csv) to your GEOTIFF_CSV directory.
> 
> I have also improved the error message (the text of the 
> message was out of date), and a bug in the fallback code that 
> uses SetLocalCS() if the state plane zone can't be fully resolved.
> 
> Finally, I have just today made substantial other changes to 
> SetStatePlane(). The C++ method now takes additional 
> (optional) arguments to override the linear units from what 
> the legal (aka EPSG) definition of the zone is.  It is 
> common, for instance, to use NAD83 State Plane zone 
> definitions, but to force the units to feet.  Converting the 
> meter definition to feet is a bit tricky, but this is now all 
> encapsulated in the SetStatePlane() method.
> 
> While this changes the C++ ABI, old code should still compile 
> fine since the extra arguments are defaulted.  I also added 
> OSRSetStatePlaneWithUnits() to the C API for the new args, 
> and left the old call unchanged so there is no C ABI change 
> (just an extension).
> 
> The autotest suite now includes some state plane testing.
> 
> The Erdas Imagine driver now properly supports state plane 
> files where the units are not the same as the expected zone units.
> 
> A big day for state plane!
> 
> Best regards,
> 
> -- 
> ---------------------------------------+----------------------
> ----------
> ---------------------------------------+------
> I set the clouds in motion - turn up   | Frank Warmerdam, 
> warmerdam@pobox.com
> light and sound - activate the windows | http://pobox.com/~warmerdam
> and watch the world go round - Rush    | Geospatial 
> Programmer for Rent
> 
> 
> _______________________________________________
> Gdal-dev mailing list
> Gdal-dev@remotesensing.org 
> http://remotesensing.org/mailman/listinfo/gdal-> dev
> 

From warmerdam at pobox.com  Fri May 30 16:03:01 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] OGR Error on State Plane transform
In-Reply-To: <11E3973D1E78D311A5B400508B4A70CE6A9FBA@COMSRVR>
References: <11E3973D1E78D311A5B400508B4A70CE6A9FBA@COMSRVR>
Message-ID: <3ED7B8F5.3070504@pobox.com>

Garvan Keeley wrote:
> Thanks Frank,
> once the files were placed in the right place, the error went away and the
> transform was successful. 
> 
> I didn't realize there is an testing suite, where is that located?
> 
> Also, in the SetStatePlane function (SetStatePlane(int nZone, int bNAD83 =
> TRUE)) is the second argument indicating whether NAD27 or NAD83 are being
> used as input coordinates?
> If so, is SetWellKnownGeogCS() necessary in this instance?

Garvan,

Unlike SetUTM() or the various specific projection set methods, the
SetStatePlane() method sets the geographic coordinate system, not just
the projected coordinate system information.  This is because it is
essentially part of the definition of a state plane zone.  The bNAD83
flag indicates whether the NAD83 (TRUE) or NAD27 (FALSE) version of the
state plane zone should be generated.  Note, the actual projection
parameters and even the set of zones that exist vary somewhat between
the NAD27 and NAD83 versions.  The state plane zones also have "legally"
defined units, generally feet in NAD27 and meters in NAD83 which the
SetStatePlane() method sets.  The new override stuff is to addres the
common practice of using feet on NAD83 stateplane maps that are theoretically
supposed to all be in meters.

In short, you don't need SetWellKnownGeogCS() with SetStatePlane().

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From warmerdam at pobox.com  Fri May 30 16:18:04 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] OGR Error on State Plane transform
In-Reply-To: <11E3973D1E78D311A5B400508B4A70CE6A9FB8@COMSRVR>
References: <11E3973D1E78D311A5B400508B4A70CE6A9FB8@COMSRVR>
Message-ID: <3ED7BC7C.8000802@pobox.com>

Garvan,

I think you asked about the autotest?  It seems I deleted your last reply
after a skim and now I remember there was another question.

The autotest is found in CVS and can be checked out using something like:

cvs -d <blah> co osrs/gdalautotest

It requires python, but otherwise should be runnable on Unix or Windows
if you have installed GDAL or ensured that the GDAL python module is
loadable within GDAL.  Just do something like this in the gdalautotest
directory:

   python run_all.py

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



From zhang at aero.und.edu  Fri May 30 19:12:20 2003
From: zhang at aero.und.edu (Xiaodong Zhang)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] color table
References: <3ED67DC2.4020405@aero.und.edu> <3ED6800D.6050903@pobox.com>
Message-ID: <3ED7E554.9080509@aero.und.edu>

Hi Frank,

I'm just wondering can I write a color table into a GeoTIFF file. I got 
an error message saying that
SetColorTable() not supported for existing TIFF files.

Thanks
Xiaodong

Frank Warmerdam wrote:

> Xiaodong Zhang wrote:
>
>> Hi,
>>
>> I want to use GDALRasterBand::SetColorTable(GDAL ColorTable * ctb) to 
>> attach a color table to the image I created. How can I define the 
>> color table or if I have a predefined color table (3 columns, each 
>> column for R, G, B respectively), how can import that color table. 
>> Thanks.
>
>
> Hi,
>
> This is example code for creating a GDALColorTable object in C++.  The 
> source
> data in this case uses normalized color values (0.0 to 1.0) so it has 
> to be
> scaled to 0 to 255.  If you don't have alpha (transparency) values 
> make sure
> you set all alpha values to 255 for opaque.
>
>         poCT = new GDALColorTable();
>         for( int iColor = 0; iColor < nColors; iColor++ )
>         {
>             GDALColorEntry   sEntry;
>
>             sEntry.c1 = (short) (padfRed[iColor]   * 255);
>             sEntry.c2 = (short) (padfGreen[iColor] * 255);
>             sEntry.c3 = (short) (padfBlue[iColor]  * 255);
>             sEntry.c4 = (short) (padfAlpha[iColor]  * 255);
>             poCT->SetColorEntry( iColor, &sEntry );
>         }
>
> Note that many drivers do not allow you to update a colortable in place.
>
> Good luck,
>



From warmerdam at pobox.com  Fri May 30 19:21:11 2003
From: warmerdam at pobox.com (Frank Warmerdam)
Date: Wed Nov 21 11:48:51 2007
Subject: [Gdal-dev] color table
In-Reply-To: <3ED7E554.9080509@aero.und.edu>
References: <3ED67DC2.4020405@aero.und.edu> <3ED6800D.6050903@pobox.com> <3ED7E554.9080509@aero.und.edu>
Message-ID: <3ED7E767.8020901@pobox.com>

Xiaodong Zhang wrote:
> Hi Frank,
> 
> I'm just wondering can I write a color table into a GeoTIFF file. I got 
> an error message saying that
> SetColorTable() not supported for existing TIFF files.
> 
> Thanks
> Xiaodong


Xiaodong,

I believe you can call SetColorTable() only on a newly created file
(created with the GDALDriver->Create() method) if you do it before writing
the first imagery.  This is a "quirk" of the TIFF library that makes it hard
to make some structural decisions (like whether an image has a color table)
after you have started writing imagery.

Best regards,

-- 
---------------------------------------+--------------------------------------
I set the clouds in motion - turn up   | Frank Warmerdam, warmerdam@pobox.com
light and sound - activate the windows | http://pobox.com/~warmerdam
and watch the world go round - Rush    | Geospatial Programmer for Rent



