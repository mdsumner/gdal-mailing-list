From jukka.rahkonen at maanmittauslaitos.fi  Thu Feb  1 03:18:19 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 1 Feb 2024 11:18:19 +0000
Subject: [gdal-dev] gdal_translate shifted values
In-Reply-To: <5EDBFA8B-1209-40E6-B81F-96B86487EFE7@gatech.edu>
References: <5EDBFA8B-1209-40E6-B81F-96B86487EFE7@gatech.edu>
Message-ID: <DB9PR09MB68876B38004CA4E8030773F9FD432@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

I used the gdal_compare script https://gdal.org/programs/gdalcompare.html

gdalcompare  st4_pr.2017092016.01h st4_pr.2017092016.01h.tif

and it reports three differences:

  *   Files differ at the binary level (normal, GRIB and tif are not the same)
  *   Difference in SRS (but they are alike, * IsSame() reports them as equivalent.)
  *   Difference in Dataset metadata key count ( ['AREA_OR_POINT'] added)

So if I read the report right the pixels in the files are identical. All I can conclude is that gdal_compare and your R script are doing something in different ways.

-Jukka Rahkonen-

L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Furuya, Takahiro via gdal-dev
L?hetetty: torstai 1. helmikuuta 2024 1.53
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] gdal_translate shifted values

Hi gdal-dev, I am Takahiro, a student who is using gdal_translate.
I have an issue with gdal_translate and would like to ask a question.
I used gdal_translate to transform a NCEP GRIB file (downloadable from https://data.eol.ucar.edu/cgi-bin/codiac/fgr_form/id=21.093, or attached to this email) to GeoTiff, and compare those 2 data formats. The command I used is
>gdal_translate -of GTiff st4_pr.2017092016.01h st4_pr.2017092016.01h.tif

(The GRIB file I used was st4_pr.2017092016.01h, which can be downloaded from the above link by specifying "Begin Date/Time" to "20170920"/"15:00:00"  and "End Date/Time" to "20170920"/"15:59:59".)

Then I read the 2 data files in R and checked if the original value at a certain grid cell in the GRIB file remained at the same grid cell in the GeoTiff file, but the value was shifted by 6 rows (the value I checked was 9.75 [mm/hour] that was stored in index [100,86] in the original GRIB file, but it was shifted to [106,86] in the GeoTiff file).

You can see the Python script used for reading the original GRIB file here: https://bpa.st/ZNOSI
The R script used for checking the tif-translated data: https://bpa.st/WZLSY

The version of gdal_translate I used is 3.0.2.
Is this a known issue of gdal_translate? Or is this issue not supposed to happen (is this the mistake of my side?)?

Best regards,
Takahiro



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240201/81569b2b/attachment.htm>

From lnicola at dend.ro  Thu Feb  1 03:24:49 2024
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Thu, 01 Feb 2024 13:24:49 +0200
Subject: [gdal-dev] gdal_translate shifted values
In-Reply-To: <DB9PR09MB68876B38004CA4E8030773F9FD432@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <5EDBFA8B-1209-40E6-B81F-96B86487EFE7@gatech.edu>
 <DB9PR09MB68876B38004CA4E8030773F9FD432@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <816c5589-ded0-43f3-9225-35b47c07805e@app.fastmail.com>

Hi Jukka,

If GDAL shuffled around the pixels in that file, you wouldn't be able to notice it by comparing the GRIB and the TIFF, because both would be shuffled.

My suggestion was to convert the GRIB to a NC or even CSV using xarray, then comparing the GDAL output against that.

Laurentiu

On Thu, Feb 1, 2024, at 13:18, Rahkonen Jukka via gdal-dev wrote:
> Hi,
>  
> I used the gdal_compare script https://gdal.org/programs/gdalcompare.html
> 
> gdalcompare  st4_pr.2017092016.01h st4_pr.2017092016.01h.tif
> and it reports three differences:
>  ? Files differ at the binary level (normal, GRIB and tif are not the same)
>  ? Difference in SRS (but they are alike, * IsSame() reports them as equivalent.)
>  ? Difference in Dataset metadata key count ( ['AREA_OR_POINT'] added)
> So if I read the report right the pixels in the files are identical. All I can conclude is that gdal_compare and your R script are doing something in different ways.
>  
> -Jukka Rahkonen-
>  
> *L?hett?j?:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *Puolesta *Furuya, Takahiro via gdal-dev
> *L?hetetty:* torstai 1. helmikuuta 2024 1.53
> *Vastaanottaja:* gdal-dev at lists.osgeo.org
> *Aihe:* [gdal-dev] gdal_translate shifted values
> 
>  
> Hi gdal-dev, I am Takahiro, a student who is using gdal_translate.
> I have an issue with gdal_translate and would like to ask a question.
> I used gdal_translate to transform a NCEP GRIB file (downloadable from https://data.eol.ucar.edu/cgi-bin/codiac/fgr_form/id=21.093, or attached to this email) to GeoTiff, and compare those 2 data formats. The command I used is
> >gdal_translate -of GTiff st4_pr.2017092016.01h st4_pr.2017092016.01h.tif
>  
> (The GRIB file I used was st4_pr.2017092016.01h, which can be downloaded from the above link by specifying ?Begin Date/Time? to ?20170920?/?15:00:00?  and ?End Date/Time? to ?20170920?/?15:59:59?.)
>  
> Then I read the 2 data files in R and checked if the original value at a certain grid cell in the GRIB file remained at the same grid cell in the GeoTiff file, but the value was shifted by 6 rows (the value I checked was 9.75 [mm/hour] that was stored in index [100,86] in the original GRIB file, but it was shifted to [106,86] in the GeoTiff file).
>  
> You can see the Python script used for reading the original GRIB file here: https://bpa.st/ZNOSI
> The R script used for checking the tif-translated data: https://bpa.st/WZLSY
>  
> The version of gdal_translate I used is 3.0.2.
> Is this a known issue of gdal_translate? Or is this issue not supposed to happen (is this the mistake of my side?)?
>  
> Best regards,
> Takahiro
>  
>  
>  
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240201/0bdb8176/attachment-0001.htm>

From Roger.Bivand at nhh.no  Thu Feb  1 04:06:41 2024
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Thu, 1 Feb 2024 12:06:41 +0000
Subject: [gdal-dev] gdal_translate shifted values
Message-ID: <SV0P279MB0475848984DA8097F161153CEE432@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>

>From the R code snippet I see: "Surprisingly, the value 9.75 is shifted to 106, 86 = 105,85 in Python indexing", but R is 1-base and Python 0-base. In R:

> library(terra)
terra 1.7.71
> gdal()
[1] "3.8.3"
> a <- rast("attachment.obj")
> b <- rast("st4_pr.2017092016.01h.tif")
> a
class       : SpatRaster 
dimensions  : 205, 205, 1  (nrow, ncol, nlyr)
resolution  : 4762, 4762  (x, y)
extent      : 4940902, 5917112, -7210793, -6234583  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=stere +lat_0=90 +lat_ts=60 +lon_0=-105 +x_0=0 +y_0=0 +R=6367470 +units=m +no_defs 
source      : attachment.obj 
name        : SFC (Ground or water surface); Total precipitation [kg/m^2] 
unit        :                                                      kg/m^2 
time        : 2017-09-20 16:00:00 UTC 
> b
class       : SpatRaster 
dimensions  : 205, 205, 1  (nrow, ncol, nlyr)
resolution  : 4762, 4762  (x, y)
extent      : 4940902, 5917112, -7210793, -6234583  (xmin, xmax, ymin, ymax)
coord. ref. : +proj=stere +lat_0=90 +lat_ts=60 +lon_0=-105 +x_0=0 +y_0=0 +R=6367470 +units=m +no_defs 
source      : st4_pr.2017092016.01h.tif 
name        : 0[-] SFC (Ground or water surface) 
> all.equal(values(a), values(b))
[1] "Attributes: < Component \"dimnames\": Component 2: 1 string mismatch >"
> dimnames(values(a))
[[1]]
NULL

[[2]]
[1] "SFC (Ground or water surface); Total precipitation [kg/m^2]"

> dimnames(values(b))
[[1]]
NULL

[[2]]
[1] "0[-] SFC (Ground or water surface)"
> all.equal(values(a), values(b), check.attributes=FALSE)
[1] TRUE

Reading both into R shows that the input GRIB data and the GTiff data converted by gdal_translate are identical.

By the way, better to use the terra package directly, raster uses it indirectly.

Hope this clarifies,

Roger

--
Roger Bivand
Emeritus Professor
Norwegian School of Economics
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway
Roger.Bivand at nhh.no

From lnicola at dend.ro  Thu Feb  1 04:57:40 2024
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Thu, 01 Feb 2024 14:57:40 +0200
Subject: [gdal-dev] gdal_translate shifted values
In-Reply-To: <816c5589-ded0-43f3-9225-35b47c07805e@app.fastmail.com>
References: <5EDBFA8B-1209-40E6-B81F-96B86487EFE7@gatech.edu>
 <DB9PR09MB68876B38004CA4E8030773F9FD432@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <816c5589-ded0-43f3-9225-35b47c07805e@app.fastmail.com>
Message-ID: <c207ea3a-6c78-4341-843e-224887bd83a8@betaapp.fastmail.com>

It's actually pretty easy to test:

import numpy as np
import xarray as xr
from osgeo import gdal

xarray_ds = xr.load_dataset("st4_pr.2017092016.01h", engine="cfgrib")
# GDAL uses 9999 as NODATA
xarray_data = np.nan_to_num(xarray_ds.tp.data, nan=9999.0)
gdal_ds = gdal.Open("st4_pr.2017092016.01h")
gdal_data = gdal_ds.GetRasterBand(1).ReadAsArray()

>>> gdal_data[80]
array([9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   ,   40.5  ,   41.125,   41.75 ,   42.5  ,
         43.   ,   26.5  ,   26.875,   27.   ,   29.875,   49.875,
         50.375,   41.5  ,   41.375,    0.   ,    0.   ,    0.   ,
          0.   ,    0.   ,    0.   ,    0.   ,    0.   ,    0.   ,
          0.   ,    0.   ,    0.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
          0.   ,    0.   ,    0.   ,    0.   ,    0.   ,    0.   ,
          0.   ,    0.   ,    0.   ,    0.   ,    0.   ,    0.   ,
          0.   ,    0.   ,    0.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   ])
>>> xarray_data[80]
array([9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   ,   13.75 ,   14.25 ,   14.75 ,
         19.125,   32.5  ,   30.125,   27.125,   25.5  ,   22.25 ,
         22.375,   20.25 ,   18.375,   16.625,   15.25 , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
       9999.   ], dtype=float32)

The values are obviously different.

I also tried to convert to NetCDF and open them in QGIS, but they look almost the same (not identical) to me after fixing up the coordinates, so there's probably more at play.

Again, comparing the gdal_translate output with the GRIB data as read by GDAL can't show any issues.

Laurentiu

On Thu, Feb 1, 2024, at 13:24, Lauren?iu Nicola via gdal-dev wrote:
> Hi Jukka,
> 
> If GDAL shuffled around the pixels in that file, you wouldn't be able to notice it by comparing the GRIB and the TIFF, because both would be shuffled.
> 
> My suggestion was to convert the GRIB to a NC or even CSV using xarray, then comparing the GDAL output against that.
> 
> Laurentiu
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240201/65267d0d/attachment-0001.htm>

From even.rouault at spatialys.com  Thu Feb  1 05:22:38 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 1 Feb 2024 14:22:38 +0100
Subject: [gdal-dev] gdal_translate shifted values
In-Reply-To: <c207ea3a-6c78-4341-843e-224887bd83a8@betaapp.fastmail.com>
References: <5EDBFA8B-1209-40E6-B81F-96B86487EFE7@gatech.edu>
 <DB9PR09MB68876B38004CA4E8030773F9FD432@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <816c5589-ded0-43f3-9225-35b47c07805e@app.fastmail.com>
 <c207ea3a-6c78-4341-843e-224887bd83a8@betaapp.fastmail.com>
Message-ID: <bfc4f725-a3e6-417a-b05e-964ec2d91f4f@spatialys.com>

Hi,

I don't think there's any problem regarding GDAL vs xarray. It is just a 
difference of convention on how GDAL and xarray choose the origin of 
rasters. GDAL selects the northern-west corner as the (0,0) image 
coordinate.

The line in GDAL that contains values 13.75 14.25 14.75 which are at 
line 80 for XArray is line 124?? . And 80 + 124 + 1 = 205 , the dataset 
height

Displaying the GRIB dataset with QGIS (/GDAL) on top of OSM shows a 
plausible georeferencing.

Even

Le 01/02/2024 ? 13:57, Lauren?iu Nicola via gdal-dev a ?crit?:
> It's actually pretty easy to test:
>
> import numpy as np
> import xarray as xr
> from osgeo import gdal
>
> xarray_ds = xr.load_dataset("st4_pr.2017092016.01h", engine="cfgrib")
> # GDAL uses 9999 as NODATA
> xarray_data = np.nan_to_num(xarray_ds.tp.data, nan=9999.0)
> gdal_ds = gdal.Open("st4_pr.2017092016.01h")
> gdal_data = gdal_ds.GetRasterBand(1).ReadAsArray()
>
> >>> gdal_data[80]
> array([9999. , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? ,?? 40.5? ,?? 41.125,?? 41.75 ,?? 42.5? ,
> 43.?? ,?? 26.5? ,?? 26.875,?? 27.?? ,?? 29.875,?? 49.875,
> 50.375,?? 41.5? ,?? 41.375,??? 0.?? ,??? 0.?? ,??? 0.?? ,
> 0.?? ,??? 0.?? ,??? 0.?? ,??? 0.?? ,??? 0.?? ,??? 0.?? ,
> 0.?? ,??? 0.?? ,??? 0.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 0.?? ,??? 0.?? ,??? 0.?? ,??? 0.?? ,??? 0.?? ,??? 0.?? ,
> 0.?? ,??? 0.?? ,??? 0.?? ,??? 0.?? ,??? 0.?? ,??? 0.?? ,
> 0.?? ,??? 0.?? ,??? 0.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? ])
> >>> xarray_data[80]
> array([9999. , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? ,?? 13.75 ,?? 14.25 ,?? 14.75 ,
> 19.125,?? 32.5? ,?? 30.125,?? 27.125,?? 25.5? ,?? 22.25 ,
> 22.375,?? 20.25 ,?? 18.375,?? 16.625,?? 15.25 , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? , 9999.?? ,
> 9999.?? ], dtype=float32)
>
> The values are obviously different.
>
> I also tried to convert to NetCDF and open them in QGIS, but they look 
> almost the same (not identical) to me after fixing up the coordinates, 
> so there's probably more at play.
>
> Again, comparing the gdal_translate output with the GRIB data as read 
> by GDAL can't show any issues.
>
> Laurentiu
>
> On Thu, Feb 1, 2024, at 13:24, Lauren?iu Nicola via gdal-dev wrote:
>> Hi Jukka,
>>
>> If GDAL shuffled around the pixels in that file, you wouldn't be able 
>> to notice it by comparing the GRIB and the TIFF, because both would 
>> be shuffled.
>>
>> My suggestion was to convert the GRIB to a NC or even CSV using 
>> xarray, then comparing the GDAL output against that.
>>
>> Laurentiu
>>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240201/c9ceb420/attachment-0001.htm>

From lnicola at dend.ro  Thu Feb  1 05:28:42 2024
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Thu, 01 Feb 2024 15:28:42 +0200
Subject: [gdal-dev] gdal_translate shifted values
In-Reply-To: <bfc4f725-a3e6-417a-b05e-964ec2d91f4f@spatialys.com>
References: <5EDBFA8B-1209-40E6-B81F-96B86487EFE7@gatech.edu>
 <DB9PR09MB68876B38004CA4E8030773F9FD432@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <816c5589-ded0-43f3-9225-35b47c07805e@app.fastmail.com>
 <c207ea3a-6c78-4341-843e-224887bd83a8@betaapp.fastmail.com>
 <bfc4f725-a3e6-417a-b05e-964ec2d91f4f@spatialys.com>
Message-ID: <ed383323-e033-43e6-884b-0a5a58c1f23c@betaapp.fastmail.com>

Indeed, good catch, I exported both of them to a new file and it's obvious now:


Laurentiu

On Thu, Feb 1, 2024, at 15:22, Even Rouault wrote:
> Hi,
> 
> I don't think there's any problem regarding GDAL vs xarray. It is just a difference of convention on how GDAL and xarray choose the origin of rasters. GDAL selects the northern-west corner as the (0,0) image coordinate.
> 
> The line in GDAL that contains values 13.75 14.25 14.75 which are at line 80 for XArray is line 124   . And 80 + 124 + 1 = 205 , the dataset height
> 
> Displaying the GRIB dataset with QGIS (/GDAL) on top of OSM shows a plausible georeferencing.
> 
> Even
> 
> Le 01/02/2024 ? 13:57, Lauren?iu Nicola via gdal-dev a ?crit :
>> It's actually pretty easy to test:
>> 
>> import numpy as np
>> import xarray as xr
>> from osgeo import gdal
>> 
>> xarray_ds = xr.load_dataset("st4_pr.2017092016.01h", engine="cfgrib")
>> # GDAL uses 9999 as NODATA
>> xarray_data = np.nan_to_num(xarray_ds.tp.data, nan=9999.0)
>> gdal_ds = gdal.Open("st4_pr.2017092016.01h")
>> gdal_data = gdal_ds.GetRasterBand(1).ReadAsArray()
>> 
>> >>> gdal_data[80]
>> array([9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   ,   40.5  ,   41.125,   41.75 ,   42.5  ,
>>          43.   ,   26.5  ,   26.875,   27.   ,   29.875,   49.875,
>>          50.375,   41.5  ,   41.375,    0.   ,    0.   ,    0.   ,
>>           0.   ,    0.   ,    0.   ,    0.   ,    0.   ,    0.   ,
>>           0.   ,    0.   ,    0.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>           0.   ,    0.   ,    0.   ,    0.   ,    0.   ,    0.   ,
>>           0.   ,    0.   ,    0.   ,    0.   ,    0.   ,    0.   ,
>>           0.   ,    0.   ,    0.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   ])
>> >>> xarray_data[80]
>> array([9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   ,   13.75 ,   14.25 ,   14.75 ,
>>          19.125,   32.5  ,   30.125,   27.125,   25.5  ,   22.25 ,
>>          22.375,   20.25 ,   18.375,   16.625,   15.25 , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   , 9999.   , 9999.   , 9999.   , 9999.   , 9999.   ,
>>        9999.   ], dtype=float32)
>> 
>> The values are obviously different.
>> 
>> I also tried to convert to NetCDF and open them in QGIS, but they look almost the same (not identical) to me after fixing up the coordinates, so there's probably more at play.
>> 
>> Again, comparing the gdal_translate output with the GRIB data as read by GDAL can't show any issues.
>> 
>> Laurentiu
>> 
>> On Thu, Feb 1, 2024, at 13:24, Lauren?iu Nicola via gdal-dev wrote:
>>> Hi Jukka,
>>> 
>>> If GDAL shuffled around the pixels in that file, you wouldn't be able to notice it by comparing the GRIB and the TIFF, because both would be shuffled.
>>> 
>>> My suggestion was to convert the GRIB to a NC or even CSV using xarray, then comparing the GDAL output against that.
>>> 
>>> Laurentiu
>>> 
>> 
>> 
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>> 
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240201/0943b469/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 7279 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240201/0943b469/attachment-0002.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image.png
Type: image/png
Size: 7458 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240201/0943b469/attachment-0003.png>

From jesse.r.meyer at nasa.gov  Thu Feb  1 07:11:40 2024
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Thu, 1 Feb 2024 15:11:40 +0000
Subject: [gdal-dev] gdal_rasterize "burn count" feature
Message-ID: <C8C81712-854B-4382-BE76-2B840C8B1F66@ndc.nasa.gov>

Hi,

We?d like to use gdal_rasterize to burn in a value that is a simple numerical function of the feature geometry.  Currently we pre-process the feature database, store the value into a new field, and then burn that in.  It works, but it would be handy to be able to express this directly to gdal_rasterize.  I see sql can be leveraged to select which features to burn in, but nothing regarding programmable burn values.

Jesse
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240201/692c71df/attachment.htm>

From lnicola at dend.ro  Thu Feb  1 07:14:01 2024
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Thu, 01 Feb 2024 17:14:01 +0200
Subject: [gdal-dev] gdal_rasterize "burn count" feature
In-Reply-To: <C8C81712-854B-4382-BE76-2B840C8B1F66@ndc.nasa.gov>
References: <C8C81712-854B-4382-BE76-2B840C8B1F66@ndc.nasa.gov>
Message-ID: <4acf25ba-b6dc-4fec-8182-7af4da5e0867@app.fastmail.com>

Hi,

You can use -sql and -a to burn a field of the query.

Laurentiu

On Thu, Feb 1, 2024, at 17:11, Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev wrote:
> Hi,
>  
> We?d like to use gdal_rasterize to burn in a value that is a simple numerical function of the feature geometry.  Currently we pre-process the feature database, store the value into a new field, and then burn that in.  It works, but it would be handy to be able to express this directly to gdal_rasterize.  I see sql can be leveraged to select which features to burn in, but nothing regarding programmable burn values.
>  
> Jesse
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240201/74b3787e/attachment.htm>

From jesse.r.meyer at nasa.gov  Thu Feb  1 07:18:36 2024
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Thu, 1 Feb 2024 15:18:36 +0000
Subject: [gdal-dev] [EXTERNAL] [BULK] Re: gdal_rasterize "burn count"
 feature
In-Reply-To: <4acf25ba-b6dc-4fec-8182-7af4da5e0867@app.fastmail.com>
References: <C8C81712-854B-4382-BE76-2B840C8B1F66@ndc.nasa.gov>
 <4acf25ba-b6dc-4fec-8182-7af4da5e0867@app.fastmail.com>
Message-ID: <C4F9AFE0-7E96-403C-A87C-FCEFF88F6913@ndc.nasa.gov>

I see.  Just create a new field with the sql query.  Of course.

Thanks.

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Lauren?iu Nicola via gdal-dev <gdal-dev at lists.osgeo.org>
Reply-To: Lauren?iu Nicola <lnicola at dend.ro>
Date: Thursday, February 1, 2024 at 10:14?AM
To: "gdal-dev at lists.osgeo.org" <gdal-dev at lists.osgeo.org>
Subject: [EXTERNAL] [BULK] Re: [gdal-dev] gdal_rasterize "burn count" feature

CAUTION: This email originated from outside of NASA.  Please take care when clicking links or opening attachments.  Use the "Report Message" button to report suspicious messages to the NASA SOC.


Hi,

You can use -sql and -a to burn a field of the query.

Laurentiu

On Thu, Feb 1, 2024, at 17:11, Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev wrote:

Hi,



We?d like to use gdal_rasterize to burn in a value that is a simple numerical function of the feature geometry.  Currently we pre-process the feature database, store the value into a new field, and then burn that in.  It works, but it would be handy to be able to express this directly to gdal_rasterize.  I see sql can be leveraged to select which features to burn in, but nothing regarding programmable burn values.



Jesse
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240201/416ebec0/attachment-0001.htm>

From even.rouault at spatialys.com  Thu Feb  1 07:40:10 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 1 Feb 2024 16:40:10 +0100
Subject: [gdal-dev] OGDI 4.1.1 is released
Message-ID: <ff17b525-2b6d-467a-ad4a-ee641a150893@spatialys.com>

Hi,

Following the well-known motto "release early, release often", and given 
the last release was 4.5 years ago :-), I've cut down a OGDI 4.1.1 
release. The main motivation was that 4.1.0 no longer built with recent 
compilers.

4.1.1 changes:
 ?o? Fix various compiler warnings, in particular for gcc 14 (fixes #23)
 ?o? Remove ogdi/attr_driver subdirectory (ODBC stuff) (fixes #23)
 ?o? Support GNU Hurd
 ?o? Support hardening buildflags set in the environment
 ?o? contrib/gdal: Fix C99 compatibility issue
 ?o? Add link libraries accordingly: $(EXPAT_LINKLIB), etc. (PR #16)

Source downloads at:

- 
https://github.com/libogdi/ogdi/releases/download/ogdi_4_1_1/ogdi-4.1.1.tar.gz

- 
https://github.com/libogdi/ogdi/releases/download/ogdi_4_1_1/ogdi-4.1.1.zip

For those wondering what OGDI is, this is an (obscure & antiquated) 
piece of code whose main purpose nowadays is to read VPF? / VRF / DCW / 
VMAP vector files.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From philippe.ghesquiere at airbus.com  Thu Feb  1 08:35:00 2024
From: philippe.ghesquiere at airbus.com (Philippe Ghesquiere)
Date: Thu, 1 Feb 2024 17:35:00 +0100
Subject: [gdal-dev] OGDI 4.1.1 is released
In-Reply-To: <ff17b525-2b6d-467a-ad4a-ee641a150893@spatialys.com>
References: <ff17b525-2b6d-467a-ad4a-ee641a150893@spatialys.com>
Message-ID: <CAAes_OF6P79RdwQQ9ULBC-QMV9Ji45u2RzSQFRwgVByZVVKrTg@mail.gmail.com>

Hi Even,

It is great to hear that some people still take care of this library :-)
Lately, I have tried to compile it with Visual C 2019. And I gave up,
because of too many errors ...
I wonder how people running GDAL under windows manage to compile it, for
example QGIS.

Do you have any hints ?
Thanks
Philippe

On Thu, Feb 1, 2024 at 4:56?PM Even Rouault via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> Following the well-known motto "release early, release often", and given
> the last release was 4.5 years ago :-), I've cut down a OGDI 4.1.1
> release. The main motivation was that 4.1.0 no longer built with recent
> compilers.
>
> 4.1.1 changes:
>   o  Fix various compiler warnings, in particular for gcc 14 (fixes #23)
>   o  Remove ogdi/attr_driver subdirectory (ODBC stuff) (fixes #23)
>   o  Support GNU Hurd
>   o  Support hardening buildflags set in the environment
>   o  contrib/gdal: Fix C99 compatibility issue
>   o  Add link libraries accordingly: $(EXPAT_LINKLIB), etc. (PR #16)
>
> Source downloads at:
>
> -
>
> https://github.com/libogdi/ogdi/releases/download/ogdi_4_1_1/ogdi-4.1.1.tar.gz
>
> -
> https://github.com/libogdi/ogdi/releases/download/ogdi_4_1_1/ogdi-4.1.1.zip
>
> For those wondering what OGDI is, this is an (obscure & antiquated)
> piece of code whose main purpose nowadays is to read VPF  / VRF / DCW /
> VMAP vector files.
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
The information in this e-mail is confidential. The contents may not be disclosed or used by anyone other than the addressee. Access to this e-mail by anyone else is unauthorised.
If you are not the intended recipient, please notify Airbus immediately and delete this e-mail.
Airbus cannot accept any responsibility for the accuracy or completeness of this e-mail as it has been sent over public networks. If you have any concerns over the content of this message or its Accuracy or Integrity, please contact Airbus immediately.
All outgoing e-mails from Airbus are checked using regularly updated virus scanning software but you should take whatever measures you deem to be appropriate to ensure that this message and any attachments are virus free.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240201/4be0c7f3/attachment.htm>

From Matt.Wilkie at yukon.ca  Thu Feb  1 10:51:34 2024
From: Matt.Wilkie at yukon.ca (Matt.Wilkie)
Date: Thu, 1 Feb 2024 18:51:34 +0000
Subject: [gdal-dev] [EXT] Re:  Unknown projection
In-Reply-To: <2b58cfbe-b292-4b16-a3fc-bfdaa232a383@spatialys.com>
References: <YT3PR01MB559058A7367D86E3984848FA877C2@YT3PR01MB5590.CANPRD01.PROD.OUTLOOK.COM>
 <2b58cfbe-b292-4b16-a3fc-bfdaa232a383@spatialys.com>
Message-ID: <YT3PR01MB5590937B7DD27651D249B0C987432@YT3PR01MB5590.CANPRD01.PROD.OUTLOOK.COM>

Thanks Even!


Matt



________________________________
From: Even Rouault <even.rouault at spatialys.com>
Sent: Wednesday, January 31, 2024 12:54
To: Matt.Wilkie <Matt.Wilkie at yukon.ca>; gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: [EXT] Re: [gdal-dev] Unknown projection


Matt,

surprisingly or not, the GTiff driver doesn't try to get the SRS from a .prj side car file.

So just do

gdal_edit.py 047_0001.tif -a_srs "$(cat 047_0001.prj)"

Even

Le 31/01/2024 ? 20:22, Matt.Wilkie via gdal-dev a ?crit :

Hello gdal,



I have a collection of aerial photos for which neither gdal nor arc pro recognize the projection. To my eye the .prj files look ok. Attached txt is gdalinfo v3.8.0 report along with the .prj. I manually formatted the below for readability:



PROJCS["UTM_07N",

    GEOGCS["NAD83-CSRS Epoch 2006 (7 Param+Vel)",

        DATUM["NAD83-CSRS Epoch 2006 (7 Param+Vel)",

            SPHEROID["GRS 80", 6378137,298.2572221010002],

            TOWGS84[1.0026,-1.9083,-0.5165, 1.288877171229702e-07, 8.998141921392988e-09, 5.376098909823645e-08, -1.18e-09]],

        PRIMEM["Greenwich",0],

        UNIT["degree",0.0174532925199433]

        ],

    PROJECTION["Transverse_Mercator"],

    PARAMETER["latitude_of_origin",0],

    PARAMETER["central_meridian",-141],

    PARAMETER["scale_factor",0.9996],

    PARAMETER["false_easting",500000],

    PARAMETER["false_northing",0],

    UNIT["metres",1]

    ]



Thanks!

Matt Wilkie

Geomatics Developer & Administrator

Environment | Technology, Innovation and Mapping

T 867-667-8133 | Yukon.ca<http://yukon.ca/>

Hours: 08:30-16:30, Mon-Wed: Office, Thu: Remote, Fri: Away.





_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev


--
http://www.spatialys.com<http://www.spatialys.com/>
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240201/3cb11cf7/attachment-0001.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Fri Feb  2 08:21:11 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Fri, 2 Feb 2024 16:21:11 +0000
Subject: [gdal-dev] GDAL Maintainers Meeting Minutes
In-Reply-To: <2BAF8607-689A-4F17-A46D-E835780F08C5@hobu.co>
References: <2BAF8607-689A-4F17-A46D-E835780F08C5@hobu.co>
Message-ID: <DB9PR09MB6887C2A5E00D7627D29CBAEAFD422@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

The spatialreference.org site looks very good! Thanks for the refactoring, and for the links to the definitions at epsg.org.
About the translations, by experience I can tell that translating technical text is harder than you may think because the translator should also understand what the documented thing is doing. Translating word-by-word may lead into badly misleading result. I am not at all against translations, for example QGIS is certainly more popular now in Finland because the user interface is localized. However, I think it took about three years from a group of volunteers before the translation was more useful than funny.

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Howard Butler via gdal-dev
L?hetetty: maanantai 29. tammikuuta 2024 20.43
Vastaanottaja: gdal dev <gdal-dev at lists.osgeo.org>
Aihe: [gdal-dev] GDAL Maintainers Meeting Minutes

Howard Butler, Even Rouault, Dan Baston, Sean Gilles, Javier Jiminez Shaw, and Alessandro Pasotti held the monthly GDAL Maintainers Meeting on 11/23/2023. The following items were discussed and reported upon:

Fundraising update
----------------------------

Annual renewals are now going out to sponsors, so if you are a coordinator of GDAL funding in your organization, please be on the lookout for them. 

Maintenance activities update
------------------------------------------

Dan

No activity this month

Alessandro

* Add GetExtent3D "fast" implementation for GeoJSON 
* GDAL Raster Tile Index driver review. Find out more at https://gdal.org/drivers/raster/gti.html
Even

* 3.8.3 Bugfix release. See https://github.com/OSGeo/gdal/blob/v3.8.3/NEWS.md for release notes
* Added CodeQL analyzer via GitHub Actions. It identified nearly 300 issues, though almost all of them were false positives or unconcerning.
* Submitted GDAL to the OpenSSF for a security scorecard. It initially ranked 5.8/10, and Even completed actions to improve its score such as providing PR submissions to CodeQL. It currently ranks 9.0/10.0, with the item most contributing to its slightly reduced score being the need for more code and PR reviews (we need more PR reviews from GDAL collaborators!) See  https://securityscorecards.dev/viewer/?uri=github.com/OSGeo/gdalfor details on the score. 

Javier

* Javier refactored https://spatialreference.org/. It now loads very fast, it is statically generated, and it is open source software that users can deploy in their own environments. Thanks again Javier!

Sean

* Sean added GitHub Actions that listen to the GDAL release tag and fire and runs rasterio's tests when a GDAL release is issued. 
* Sean added exception chaining in rasterio and this prompted a discussion about lack of enthusiasm for changing any of GDAL's error handling behaviors.

Translation Discussion

Alessandro began a discussion about the need to add language translation of open options for drivers, how the project could go about managing them. Discussion evolved to covering translation of contextual error messages and the challenge of maintaining and providing that. No action was to be taken at this time, but if this is a topic that's interesting to you, please chime in on the mailing list or in a ticket.

The next GDAL Maintainers Meeting is 02/22/2024 at 9:00 EDT. Any PSC members are welcome to join by reaching out to me for an invite.

Howard
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org

From rob.hewy at gmail.com  Fri Feb  2 10:45:57 2024
From: rob.hewy at gmail.com (Robert Hewlett)
Date: Fri, 2 Feb 2024 10:45:57 -0800
Subject: [gdal-dev] shptreevis functionality in GDAL
Message-ID: <CAG_Q50TJA7A3Utke7WdBk6UJOoyon5dN1ucc_vvXFeLtaUUBJg@mail.gmail.com>

Hi,

Does GDAL (ogr2ogr/ogrinfo) have the functionality to convert the .qix to a
spatial format that can be visualized such as shptreevis from mapserver?

Rob
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240202/e9391aa9/attachment.htm>

From alexandre.gacon at gmail.com  Fri Feb  2 11:31:58 2024
From: alexandre.gacon at gmail.com (Alexandre Gacon)
Date: Fri, 2 Feb 2024 20:31:58 +0100
Subject: [gdal-dev] GDAL Maintainers Meeting Minutes
In-Reply-To: <DB9PR09MB6887C2A5E00D7627D29CBAEAFD422@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <2BAF8607-689A-4F17-A46D-E835780F08C5@hobu.co>
 <DB9PR09MB6887C2A5E00D7627D29CBAEAFD422@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <CAFJaAp5YZGQ6v+HktnL9VUrWre1-9Y0gMr6tNuCUzqa_RHxPnQ@mail.gmail.com>

Don't know if it can help but OSGEO is hosting a weblate instance if you
are looking for a tool to allow people work on the translation (but you
have to find a format managed by weblate).

Alexandre

Le ven. 2 f?vr. 2024 ? 17:21, Rahkonen Jukka via gdal-dev <
gdal-dev at lists.osgeo.org> a ?crit :

> Hi,
>
> The spatialreference.org site looks very good! Thanks for the
> refactoring, and for the links to the definitions at epsg.org.
> About the translations, by experience I can tell that translating
> technical text is harder than you may think because the translator should
> also understand what the documented thing is doing. Translating
> word-by-word may lead into badly misleading result. I am not at all against
> translations, for example QGIS is certainly more popular now in Finland
> because the user interface is localized. However, I think it took about
> three years from a group of volunteers before the translation was more
> useful than funny.
>
> -Jukka Rahkonen-
>
> -----Alkuper?inen viesti-----
> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Howard
> Butler via gdal-dev
> L?hetetty: maanantai 29. tammikuuta 2024 20.43
> Vastaanottaja: gdal dev <gdal-dev at lists.osgeo.org>
> Aihe: [gdal-dev] GDAL Maintainers Meeting Minutes
>
> Howard Butler, Even Rouault, Dan Baston, Sean Gilles, Javier Jiminez Shaw,
> and Alessandro Pasotti held the monthly GDAL Maintainers Meeting on
> 11/23/2023. The following items were discussed and reported upon:
>
> Fundraising update
> ----------------------------
>
> Annual renewals are now going out to sponsors, so if you are a coordinator
> of GDAL funding in your organization, please be on the lookout for them.
>
> Maintenance activities update
> ------------------------------------------
>
> Dan
>
> No activity this month
>
> Alessandro
>
> * Add GetExtent3D "fast" implementation for GeoJSON
> * GDAL Raster Tile Index driver review. Find out more at
> https://gdal.org/drivers/raster/gti.html
> Even
>
> * 3.8.3 Bugfix release. See
> https://github.com/OSGeo/gdal/blob/v3.8.3/NEWS.md for release notes
> * Added CodeQL analyzer via GitHub Actions. It identified nearly 300
> issues, though almost all of them were false positives or unconcerning.
> * Submitted GDAL to the OpenSSF for a security scorecard. It initially
> ranked 5.8/10, and Even completed actions to improve its score such as
> providing PR submissions to CodeQL. It currently ranks 9.0/10.0, with the
> item most contributing to its slightly reduced score being the need for
> more code and PR reviews (we need more PR reviews from GDAL collaborators!)
> See  https://securityscorecards.dev/viewer/?uri=github.com/OSGeo/gdalfor
> details on the score.
>
> Javier
>
> * Javier refactored https://spatialreference.org/. It now loads very
> fast, it is statically generated, and it is open source software that users
> can deploy in their own environments. Thanks again Javier!
>
> Sean
>
> * Sean added GitHub Actions that listen to the GDAL release tag and fire
> and runs rasterio's tests when a GDAL release is issued.
> * Sean added exception chaining in rasterio and this prompted a discussion
> about lack of enthusiasm for changing any of GDAL's error handling
> behaviors.
>
> Translation Discussion
>
> Alessandro began a discussion about the need to add language translation
> of open options for drivers, how the project could go about managing them.
> Discussion evolved to covering translation of contextual error messages and
> the challenge of maintaining and providing that. No action was to be taken
> at this time, but if this is a topic that's interesting to you, please
> chime in on the mailing list or in a ticket.
>
> The next GDAL Maintainers Meeting is 02/22/2024 at 9:00 EDT. Any PSC
> members are welcome to join by reaching out to me for an invite.
>
> Howard
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>


-- 
Alexandre Gacon
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240202/bc29f673/attachment.htm>

From even.rouault at spatialys.com  Fri Feb  2 14:58:30 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 2 Feb 2024 23:58:30 +0100
Subject: [gdal-dev] shptreevis functionality in GDAL
In-Reply-To: <CAG_Q50TJA7A3Utke7WdBk6UJOoyon5dN1ucc_vvXFeLtaUUBJg@mail.gmail.com>
References: <CAG_Q50TJA7A3Utke7WdBk6UJOoyon5dN1ucc_vvXFeLtaUUBJg@mail.gmail.com>
Message-ID: <6d9a7337-7924-4dd6-ba6c-26d84e4d92d8@spatialys.com>

Robert,

>
> Does GDAL (ogr2ogr/ogrinfo) have the functionality to convert the .qix 
> to a spatial format?that can be visualized such?as shptreevis?from 
> mapserver?

Not that I'm aware of. That seems to be a rather uncommon use case. Just 
use shptreevis :-)

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240202/458ad798/attachment.htm>

From mdsumner at gmail.com  Fri Feb  2 17:35:58 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Sat, 3 Feb 2024 12:35:58 +1100
Subject: [gdal-dev] core dump on dir info
Message-ID: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>

I'm getting Illegal instruction / core dumped on ogrinfo of a directory:

ogr2ogr /tmp/newdir
https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson
-f "ESRI Shapefile"

ogrinfo /tmp/newdir/
Illegal instruction (core dumped)

I've worked back through some docker images and it wasn't a problem in
3.6.0, but I'm getting it since 3.7.0 - or I'm doing something wrong
entirely.

Cheers, Mike


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240203/043877dd/attachment.htm>

From even.rouault at spatialys.com  Fri Feb  2 17:46:25 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 3 Feb 2024 02:46:25 +0100
Subject: [gdal-dev] core dump on dir info
In-Reply-To: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>
References: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>
Message-ID: <d98a03d5-6223-4ef1-8936-09557ca74ea5@spatialys.com>

Michael,

I'm wondering if there not might be something wrong with your build or 
runtime environment. Or there's something subtle, because that works 
fine for me with my dev build or in the 
ghcr.io/osgeo/gdal:alpine-normal-3.8.3 Docker image

Try running "valgrind ogrinfo /tmp/newdir/" or "gdb --args ogrinfo 
/tmp/newdir/" (type "run") to get more useful information

Even

Le 03/02/2024 ? 02:35, Michael Sumner via gdal-dev a ?crit?:
> I'm getting Illegal instruction / core dumped on ogrinfo of a directory:
>
> ogr2ogr /tmp/newdir 
> https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson 
> -f "ESRI Shapefile"
>
> ogrinfo /tmp/newdir/
> Illegal instruction (core dumped)
>
> I've worked back through some docker images and it wasn't a problem in 
> 3.6.0, but I'm getting it since 3.7.0 - or I'm doing something wrong 
> entirely.
>
> Cheers, Mike
>
>
> -- 
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240203/4831f2a9/attachment.htm>

From mdsumner at gmail.com  Fri Feb  2 22:15:08 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Sat, 3 Feb 2024 17:15:08 +1100
Subject: [gdal-dev] core dump on dir info
In-Reply-To: <d98a03d5-6223-4ef1-8936-09557ca74ea5@spatialys.com>
References: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>
 <d98a03d5-6223-4ef1-8936-09557ca74ea5@spatialys.com>
Message-ID: <CAAcGz99QWfbQ98mc950sZUfG-x4VHhcnJcqbSQ14-zFM++TRXQ@mail.gmail.com>

Thanks Even, so there's something about tiledb under gdb (or maybe I am
mangling the context,  I will try variants of the host I'm using). Run with
valgrind included below.

gdb --args ogrinfo /tmp/newdir/
...
(gdb) run
Starting program: /usr/local/bin/ogrinfo /tmp/newdir/
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
[New Thread 0x7fffe7757640 (LWP 988)]
[New Thread 0x7fffe6f56640 (LWP 989)]
[New Thread 0x7fffde755640 (LWP 990)]
[New Thread 0x7fffd5f54640 (LWP 991)]
[New Thread 0x7fffc5753640 (LWP 992)]
[New Thread 0x7fffc4f52640 (LWP 993)]
[New Thread 0x7fffb4751640 (LWP 994)]
[New Thread 0x7fffabf50640 (LWP 995)]
[New Thread 0x7fffab74f640 (LWP 996)]
[New Thread 0x7fffa2f4e640 (LWP 997)]
[New Thread 0x7fff9a74d640 (LWP 998)]
[New Thread 0x7fff91f4c640 (LWP 999)]
[New Thread 0x7fff8974b640 (LWP 1000)]
[New Thread 0x7fff78f4a640 (LWP 1001)]
[New Thread 0x7fff78749640 (LWP 1002)]
[New Thread 0x7fff6f5ff640 (LWP 1003)]

Thread 1 "ogrinfo" received signal SIGILL, Illegal instruction.
0x00007ffff3773c9e in tiledb::common::ThreadPool::ThreadPool(unsigned long)
() from /lib/x86_64-linux-gnu/libtiledb.so.2.16




valgrind -s ogrinfo /tmp/newdir
==704== Memcheck, a memory error detector
==704== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
==704== Using Valgrind-3.18.1 and LibVEX; rerun with -h for copyright info
==704== Command: ogrinfo /tmp/newdir
==704==
INFO: Open of `/tmp/newdir'
      using driver `ESRI Shapefile' successful.
1: geo_melbourne (Polygon)
==704==
==704== HEAP SUMMARY:
==704==     in use at exit: 25,486 bytes in 216 blocks
==704==   total heap usage: 15,761 allocs, 15,545 frees, 2,390,169 bytes
allocated
==704==
==704== LEAK SUMMARY:
==704==    definitely lost: 0 bytes in 0 blocks
==704==    indirectly lost: 0 bytes in 0 blocks
==704==      possibly lost: 544 bytes in 1 blocks
==704==    still reachable: 24,942 bytes in 215 blocks
==704==         suppressed: 0 bytes in 0 blocks
==704== Rerun with --leak-check=full to see details of leaked memory
==704==
==704== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)


ogrinfo /tmp/newdir
Illegal instruction (core dumped)

Cheers, Mike




On Sat, Feb 3, 2024 at 12:46?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Michael,
>
> I'm wondering if there not might be something wrong with your build or
> runtime environment. Or there's something subtle, because that works fine
> for me with my dev build or in the ghcr.io/osgeo/gdal:alpine-normal-3.8.3
> Docker image
>
> Try running "valgrind ogrinfo /tmp/newdir/" or "gdb --args ogrinfo
> /tmp/newdir/" (type "run") to get more useful information
>
> Even
> Le 03/02/2024 ? 02:35, Michael Sumner via gdal-dev a ?crit :
>
> I'm getting Illegal instruction / core dumped on ogrinfo of a directory:
>
> ogr2ogr /tmp/newdir
> https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson
> -f "ESRI Shapefile"
>
> ogrinfo /tmp/newdir/
> Illegal instruction (core dumped)
>
> I've worked back through some docker images and it wasn't a problem in
> 3.6.0, but I'm getting it since 3.7.0 - or I'm doing something wrong
> entirely.
>
> Cheers, Mike
>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240203/8027dea6/attachment.htm>

From even.rouault at spatialys.com  Sat Feb  3 00:49:50 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 3 Feb 2024 09:49:50 +0100
Subject: [gdal-dev] core dump on dir info
In-Reply-To: <CAAcGz99QWfbQ98mc950sZUfG-x4VHhcnJcqbSQ14-zFM++TRXQ@mail.gmail.com>
References: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>
 <d98a03d5-6223-4ef1-8936-09557ca74ea5@spatialys.com>
 <CAAcGz99QWfbQ98mc950sZUfG-x4VHhcnJcqbSQ14-zFM++TRXQ@mail.gmail.com>
Message-ID: <327573e0-7d8e-4271-8697-6cc71f53becd@spatialys.com>

- When it crashes under gdb, type "thread apply all bt" to get the stack 
trace of all threads

- I suspect there is a connection with 
https://github.com/OSGeo/gdal/pull/9170 , but that pull request wouldn't 
help here as "/tmp/newdir" could be a valid connection to TileDB

- how did you get TileDB installed? It looks to be packaged? Which 
distribution do you use?

- SIGILL reminds me of issues with some TileDB builds using the AVX2 
instruction set by default, which could cause some crash on host CPUs 
that don't have AVX2 (unlikely on recent hardware though)

- Setting GDAL_SKIP=TileDB should be a workaround


Le 03/02/2024 ? 07:15, Michael Sumner a ?crit?:
> Thanks Even, so there's something about tiledb under gdb (or maybe I 
> am mangling the context,? I will try variants of the host I'm using). 
> Run with valgrind included below.
>
> gdb --args ogrinfo /tmp/newdir/
> ...
> (gdb) run
> Starting program: /usr/local/bin/ogrinfo /tmp/newdir/
> [Thread debugging using libthread_db enabled]
> Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
> [New Thread 0x7fffe7757640 (LWP 988)]
> [New Thread 0x7fffe6f56640 (LWP 989)]
> [New Thread 0x7fffde755640 (LWP 990)]
> [New Thread 0x7fffd5f54640 (LWP 991)]
> [New Thread 0x7fffc5753640 (LWP 992)]
> [New Thread 0x7fffc4f52640 (LWP 993)]
> [New Thread 0x7fffb4751640 (LWP 994)]
> [New Thread 0x7fffabf50640 (LWP 995)]
> [New Thread 0x7fffab74f640 (LWP 996)]
> [New Thread 0x7fffa2f4e640 (LWP 997)]
> [New Thread 0x7fff9a74d640 (LWP 998)]
> [New Thread 0x7fff91f4c640 (LWP 999)]
> [New Thread 0x7fff8974b640 (LWP 1000)]
> [New Thread 0x7fff78f4a640 (LWP 1001)]
> [New Thread 0x7fff78749640 (LWP 1002)]
> [New Thread 0x7fff6f5ff640 (LWP 1003)]
>
> Thread 1 "ogrinfo" received signal SIGILL, Illegal instruction.
> 0x00007ffff3773c9e in tiledb::common::ThreadPool::ThreadPool(unsigned 
> long) () from /lib/x86_64-linux-gnu/libtiledb.so.2.16
>
>
>
>
> valgrind -s ogrinfo /tmp/newdir
> ==704== Memcheck, a memory error detector
> ==704== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
> ==704== Using Valgrind-3.18.1 and LibVEX; rerun with -h for copyright info
> ==704== Command: ogrinfo /tmp/newdir
> ==704==
> INFO: Open of `/tmp/newdir'
> ? ? ? using driver `ESRI Shapefile' successful.
> 1: geo_melbourne (Polygon)
> ==704==
> ==704== HEAP SUMMARY:
> ==704== ? ? in use at exit: 25,486 bytes in 216 blocks
> ==704== ? total heap usage: 15,761 allocs, 15,545 frees, 2,390,169 
> bytes allocated
> ==704==
> ==704== LEAK SUMMARY:
> ==704== ? ?definitely lost: 0 bytes in 0 blocks
> ==704== ? ?indirectly lost: 0 bytes in 0 blocks
> ==704== ? ? ?possibly lost: 544 bytes in 1 blocks
> ==704== ? ?still reachable: 24,942 bytes in 215 blocks
> ==704== ? ? ? ? suppressed: 0 bytes in 0 blocks
> ==704== Rerun with --leak-check=full to see details of leaked memory
> ==704==
> ==704== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
>
>
> ogrinfo /tmp/newdir
> Illegal instruction (core dumped)
>
> Cheers, Mike
>
>
>
>
> On Sat, Feb 3, 2024 at 12:46?PM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     Michael,
>
>     I'm wondering if there not might be something wrong with your
>     build or runtime environment. Or there's something subtle, because
>     that works fine for me with my dev build or in the
>     ghcr.io/osgeo/gdal:alpine-normal-3.8.3
>     <http://ghcr.io/osgeo/gdal:alpine-normal-3.8.3> Docker image
>
>     Try running "valgrind ogrinfo /tmp/newdir/" or "gdb --args ogrinfo
>     /tmp/newdir/" (type "run") to get more useful information
>
>     Even
>
>     Le 03/02/2024 ? 02:35, Michael Sumner via gdal-dev a ?crit?:
>>     I'm getting Illegal instruction / core dumped on ogrinfo of a
>>     directory:
>>
>>     ogr2ogr /tmp/newdir
>>     https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson
>>     -f "ESRI Shapefile"
>>
>>     ogrinfo /tmp/newdir/
>>     Illegal instruction (core dumped)
>>
>>     I've worked back through some docker images and it wasn't a
>>     problem in 3.6.0, but I'm getting it since 3.7.0 - or I'm doing
>>     something wrong entirely.
>>
>>     Cheers, Mike
>>
>>
>>     -- 
>>     Michael Sumner
>>     Software and Database Engineer
>>     Australian Antarctic Division
>>     Hobart, Australia
>>     e-mail: mdsumner at gmail.com
>>
>>     _______________________________________________
>>     gdal-dev mailing list
>>     gdal-dev at lists.osgeo.org
>>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
>
>
> -- 
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240203/f4229ec6/attachment-0001.htm>

From mdsumner at gmail.com  Sat Feb  3 21:20:32 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Sun, 4 Feb 2024 16:20:32 +1100
Subject: [gdal-dev] core dump on dir info
In-Reply-To: <327573e0-7d8e-4271-8697-6cc71f53becd@spatialys.com>
References: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>
 <d98a03d5-6223-4ef1-8936-09557ca74ea5@spatialys.com>
 <CAAcGz99QWfbQ98mc950sZUfG-x4VHhcnJcqbSQ14-zFM++TRXQ@mail.gmail.com>
 <327573e0-7d8e-4271-8697-6cc71f53becd@spatialys.com>
Message-ID: <CAAcGz986hs2HL8NgghNi6o8v-54rX1bffScDWdg2O=Gg07Xs8A@mail.gmail.com>

skipping TileDB does fix:

ogr2ogr /tmp/newdir
https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson
-f
"ESRI Shapefile"
export GDAL_SKIP=TileDB
ogrinfo /tmp/newdir/
INFO: Open of `/tmp/newdir/'
      using driver `ESRI Shapefile' successful.
1: geo_melbourne (Polygon)

unset GDAL_SKIP
ogrinfo /tmp/newdir/
Illegal instruction (core dumped)

I failed to explain that I'm using gdal containers from the repo:

docker run --rm -ti ghcr.io/osgeo/gdal:ubunt

u-full-latest

apt update
apt install -y gdb

Here's the output of under gdb as you suggested, there was a lot so I put
it on a gist:
https://gist.github.com/mdsumner/839ae6e05ededf640b65bfee3a20a4c0

gdb --args ogrinfo /tmp/newdir/
> run
> thread apply all bt

Thanks!





On Sat, Feb 3, 2024 at 7:49?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> - When it crashes under gdb, type "thread apply all bt" to get the stack
> trace of all threads
>
> - I suspect there is a connection with
> https://github.com/OSGeo/gdal/pull/9170 , but that pull request wouldn't
> help here as "/tmp/newdir" could be a valid connection to TileDB
>
> - how did you get TileDB installed? It looks to be packaged? Which
> distribution do you use?
>
> - SIGILL reminds me of issues with some TileDB builds using the AVX2
> instruction set by default, which could cause some crash on host CPUs that
> don't have AVX2 (unlikely on recent hardware though)
>
> - Setting GDAL_SKIP=TileDB should be a workaround
>
>
> Le 03/02/2024 ? 07:15, Michael Sumner a ?crit :
>
> Thanks Even, so there's something about tiledb under gdb (or maybe I am
> mangling the context,  I will try variants of the host I'm using). Run with
> valgrind included below.
>
> gdb --args ogrinfo /tmp/newdir/
> ...
> (gdb) run
> Starting program: /usr/local/bin/ogrinfo /tmp/newdir/
> [Thread debugging using libthread_db enabled]
> Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
> [New Thread 0x7fffe7757640 (LWP 988)]
> [New Thread 0x7fffe6f56640 (LWP 989)]
> [New Thread 0x7fffde755640 (LWP 990)]
> [New Thread 0x7fffd5f54640 (LWP 991)]
> [New Thread 0x7fffc5753640 (LWP 992)]
> [New Thread 0x7fffc4f52640 (LWP 993)]
> [New Thread 0x7fffb4751640 (LWP 994)]
> [New Thread 0x7fffabf50640 (LWP 995)]
> [New Thread 0x7fffab74f640 (LWP 996)]
> [New Thread 0x7fffa2f4e640 (LWP 997)]
> [New Thread 0x7fff9a74d640 (LWP 998)]
> [New Thread 0x7fff91f4c640 (LWP 999)]
> [New Thread 0x7fff8974b640 (LWP 1000)]
> [New Thread 0x7fff78f4a640 (LWP 1001)]
> [New Thread 0x7fff78749640 (LWP 1002)]
> [New Thread 0x7fff6f5ff640 (LWP 1003)]
>
> Thread 1 "ogrinfo" received signal SIGILL, Illegal instruction.
> 0x00007ffff3773c9e in tiledb::common::ThreadPool::ThreadPool(unsigned
> long) () from /lib/x86_64-linux-gnu/libtiledb.so.2.16
>
>
>
>
> valgrind -s ogrinfo /tmp/newdir
> ==704== Memcheck, a memory error detector
> ==704== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
> ==704== Using Valgrind-3.18.1 and LibVEX; rerun with -h for copyright info
> ==704== Command: ogrinfo /tmp/newdir
> ==704==
> INFO: Open of `/tmp/newdir'
>       using driver `ESRI Shapefile' successful.
> 1: geo_melbourne (Polygon)
> ==704==
> ==704== HEAP SUMMARY:
> ==704==     in use at exit: 25,486 bytes in 216 blocks
> ==704==   total heap usage: 15,761 allocs, 15,545 frees, 2,390,169 bytes
> allocated
> ==704==
> ==704== LEAK SUMMARY:
> ==704==    definitely lost: 0 bytes in 0 blocks
> ==704==    indirectly lost: 0 bytes in 0 blocks
> ==704==      possibly lost: 544 bytes in 1 blocks
> ==704==    still reachable: 24,942 bytes in 215 blocks
> ==704==         suppressed: 0 bytes in 0 blocks
> ==704== Rerun with --leak-check=full to see details of leaked memory
> ==704==
> ==704== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
>
>
> ogrinfo /tmp/newdir
> Illegal instruction (core dumped)
>
> Cheers, Mike
>
>
>
>
> On Sat, Feb 3, 2024 at 12:46?PM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Michael,
>>
>> I'm wondering if there not might be something wrong with your build or
>> runtime environment. Or there's something subtle, because that works fine
>> for me with my dev build or in the ghcr.io/osgeo/gdal:alpine-normal-3.8.3
>> Docker image
>>
>> Try running "valgrind ogrinfo /tmp/newdir/" or "gdb --args ogrinfo
>> /tmp/newdir/" (type "run") to get more useful information
>>
>> Even
>> Le 03/02/2024 ? 02:35, Michael Sumner via gdal-dev a ?crit :
>>
>> I'm getting Illegal instruction / core dumped on ogrinfo of a directory:
>>
>> ogr2ogr /tmp/newdir
>> https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson
>> -f "ESRI Shapefile"
>>
>> ogrinfo /tmp/newdir/
>> Illegal instruction (core dumped)
>>
>> I've worked back through some docker images and it wasn't a problem in
>> 3.6.0, but I'm getting it since 3.7.0 - or I'm doing something wrong
>> entirely.
>>
>> Cheers, Mike
>>
>>
>> --
>> Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>>
>> _______________________________________________
>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240204/cbe1e6b6/attachment.htm>

From even.rouault at spatialys.com  Sun Feb  4 03:55:21 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 4 Feb 2024 12:55:21 +0100
Subject: [gdal-dev] core dump on dir info
In-Reply-To: <CAAcGz986hs2HL8NgghNi6o8v-54rX1bffScDWdg2O=Gg07Xs8A@mail.gmail.com>
References: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>
 <d98a03d5-6223-4ef1-8936-09557ca74ea5@spatialys.com>
 <CAAcGz99QWfbQ98mc950sZUfG-x4VHhcnJcqbSQ14-zFM++TRXQ@mail.gmail.com>
 <327573e0-7d8e-4271-8697-6cc71f53becd@spatialys.com>
 <CAAcGz986hs2HL8NgghNi6o8v-54rX1bffScDWdg2O=Gg07Xs8A@mail.gmail.com>
Message-ID: <7519ff78-afde-4b80-a3fb-f7a55d2a487c@spatialys.com>

ok, so I believe this is the AVX2 issue I was talking about, as I 
realize that enabling AVX2 is the default mode when TileDB is built from 
source (which the Docker image does), and must be explicitly disabled 
with "./bootstrap --disable-avx2" (I've just changed the build recipe to 
include that, will take effect next time the images are refreshed)

To confirm, can you send or just check the output of : cat 
/proc/cpuinfo|grep sse|head -n 1

If there is no "avx2" in it, this is at 99.9% the reason of the issue.

Even

Le 04/02/2024 ? 06:20, Michael Sumner a ?crit?:
> skipping TileDB does fix:
>
> ogr2ogr /tmp/newdir 
> https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson?-f 
> "ESRI Shapefile"
> export GDAL_SKIP=TileDB
> ogrinfo /tmp/newdir/
> INFO: Open of `/tmp/newdir/'
> ? ? ? using driver `ESRI Shapefile' successful.
> 1: geo_melbourne (Polygon)
>
> unset GDAL_SKIP
> ogrinfo /tmp/newdir/
> Illegal instruction (core dumped)
>
> I failed to explain that I'm using gdal containers from the repo:
>
> docker run --rm -ti ghcr.io/osgeo/gdal:ubunt 
> <http://ghcr.io/osgeo/gdal:ubunt>
>
> u-full-latest
>
> apt update
> apt install -y gdb
>
> Here's the output of under gdb as you suggested, there was a lot so I 
> put it on a gist: 
> https://gist.github.com/mdsumner/839ae6e05ededf640b65bfee3a20a4c0
>
> gdb --args ogrinfo /tmp/newdir/
> > run
> > thread apply all bt
>
> Thanks!
>
>
>
>
>
> On Sat, Feb 3, 2024 at 7:49?PM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     - When it crashes under gdb, type "thread apply all bt" to get the
>     stack trace of all threads
>
>     - I suspect there is a connection with
>     https://github.com/OSGeo/gdal/pull/9170 , but that pull request
>     wouldn't help here as "/tmp/newdir" could be a valid connection to
>     TileDB
>
>     - how did you get TileDB installed? It looks to be packaged? Which
>     distribution do you use?
>
>     - SIGILL reminds me of issues with some TileDB builds using the
>     AVX2 instruction set by default, which could cause some crash on
>     host CPUs that don't have AVX2 (unlikely on recent hardware though)
>
>     - Setting GDAL_SKIP=TileDB should be a workaround
>
>
>     Le 03/02/2024 ? 07:15, Michael Sumner a ?crit?:
>>     Thanks Even, so there's something about tiledb under gdb (or
>>     maybe I am mangling the context,? I will try variants of the host
>>     I'm using). Run with valgrind included below.
>>
>>     gdb --args ogrinfo /tmp/newdir/
>>     ...
>>     (gdb) run
>>     Starting program: /usr/local/bin/ogrinfo /tmp/newdir/
>>     [Thread debugging using libthread_db enabled]
>>     Using host libthread_db library
>>     "/lib/x86_64-linux-gnu/libthread_db.so.1".
>>     [New Thread 0x7fffe7757640 (LWP 988)]
>>     [New Thread 0x7fffe6f56640 (LWP 989)]
>>     [New Thread 0x7fffde755640 (LWP 990)]
>>     [New Thread 0x7fffd5f54640 (LWP 991)]
>>     [New Thread 0x7fffc5753640 (LWP 992)]
>>     [New Thread 0x7fffc4f52640 (LWP 993)]
>>     [New Thread 0x7fffb4751640 (LWP 994)]
>>     [New Thread 0x7fffabf50640 (LWP 995)]
>>     [New Thread 0x7fffab74f640 (LWP 996)]
>>     [New Thread 0x7fffa2f4e640 (LWP 997)]
>>     [New Thread 0x7fff9a74d640 (LWP 998)]
>>     [New Thread 0x7fff91f4c640 (LWP 999)]
>>     [New Thread 0x7fff8974b640 (LWP 1000)]
>>     [New Thread 0x7fff78f4a640 (LWP 1001)]
>>     [New Thread 0x7fff78749640 (LWP 1002)]
>>     [New Thread 0x7fff6f5ff640 (LWP 1003)]
>>
>>     Thread 1 "ogrinfo" received signal SIGILL, Illegal instruction.
>>     0x00007ffff3773c9e in
>>     tiledb::common::ThreadPool::ThreadPool(unsigned long) () from
>>     /lib/x86_64-linux-gnu/libtiledb.so.2.16
>>
>>
>>
>>
>>     valgrind -s ogrinfo /tmp/newdir
>>     ==704== Memcheck, a memory error detector
>>     ==704== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward
>>     et al.
>>     ==704== Using Valgrind-3.18.1 and LibVEX; rerun with -h for
>>     copyright info
>>     ==704== Command: ogrinfo /tmp/newdir
>>     ==704==
>>     INFO: Open of `/tmp/newdir'
>>     ? ? ? using driver `ESRI Shapefile' successful.
>>     1: geo_melbourne (Polygon)
>>     ==704==
>>     ==704== HEAP SUMMARY:
>>     ==704== ? ? in use at exit: 25,486 bytes in 216 blocks
>>     ==704== ? total heap usage: 15,761 allocs, 15,545 frees,
>>     2,390,169 bytes allocated
>>     ==704==
>>     ==704== LEAK SUMMARY:
>>     ==704== ? ?definitely lost: 0 bytes in 0 blocks
>>     ==704== ? ?indirectly lost: 0 bytes in 0 blocks
>>     ==704== ? ? ?possibly lost: 544 bytes in 1 blocks
>>     ==704== ? ?still reachable: 24,942 bytes in 215 blocks
>>     ==704== ? ? ? ? suppressed: 0 bytes in 0 blocks
>>     ==704== Rerun with --leak-check=full to see details of leaked memory
>>     ==704==
>>     ==704== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0
>>     from 0)
>>
>>
>>     ogrinfo /tmp/newdir
>>     Illegal instruction (core dumped)
>>
>>     Cheers, Mike
>>
>>
>>
>>
>>     On Sat, Feb 3, 2024 at 12:46?PM Even Rouault
>>     <even.rouault at spatialys.com> wrote:
>>
>>         Michael,
>>
>>         I'm wondering if there not might be something wrong with your
>>         build or runtime environment. Or there's something subtle,
>>         because that works fine for me with my dev build or in the
>>         ghcr.io/osgeo/gdal:alpine-normal-3.8.3
>>         <http://ghcr.io/osgeo/gdal:alpine-normal-3.8.3> Docker image
>>
>>         Try running "valgrind ogrinfo /tmp/newdir/" or "gdb --args
>>         ogrinfo /tmp/newdir/" (type "run") to get more useful information
>>
>>         Even
>>
>>         Le 03/02/2024 ? 02:35, Michael Sumner via gdal-dev a ?crit?:
>>>         I'm getting Illegal instruction / core dumped on ogrinfo of
>>>         a directory:
>>>
>>>         ogr2ogr /tmp/newdir
>>>         https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson
>>>         -f "ESRI Shapefile"
>>>
>>>         ogrinfo /tmp/newdir/
>>>         Illegal instruction (core dumped)
>>>
>>>         I've worked back through some docker images and it wasn't a
>>>         problem in 3.6.0, but I'm getting it since 3.7.0 - or I'm
>>>         doing something wrong entirely.
>>>
>>>         Cheers, Mike
>>>
>>>
>>>         -- 
>>>         Michael Sumner
>>>         Software and Database Engineer
>>>         Australian Antarctic Division
>>>         Hobart, Australia
>>>         e-mail: mdsumner at gmail.com
>>>
>>>         _______________________________________________
>>>         gdal-dev mailing list
>>>         gdal-dev at lists.osgeo.org
>>>         https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>>         -- 
>>         http://www.spatialys.com
>>         My software is free, but my time generally not.
>>
>>
>>
>>     -- 
>>     Michael Sumner
>>     Software and Database Engineer
>>     Australian Antarctic Division
>>     Hobart, Australia
>>     e-mail: mdsumner at gmail.com
>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
>
>
> -- 
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240204/3d349f17/attachment-0001.htm>

From mdsumner at gmail.com  Sun Feb  4 13:51:52 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 5 Feb 2024 08:51:52 +1100
Subject: [gdal-dev] core dump on dir info
In-Reply-To: <7519ff78-afde-4b80-a3fb-f7a55d2a487c@spatialys.com>
References: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>
 <d98a03d5-6223-4ef1-8936-09557ca74ea5@spatialys.com>
 <CAAcGz99QWfbQ98mc950sZUfG-x4VHhcnJcqbSQ14-zFM++TRXQ@mail.gmail.com>
 <327573e0-7d8e-4271-8697-6cc71f53becd@spatialys.com>
 <CAAcGz986hs2HL8NgghNi6o8v-54rX1bffScDWdg2O=Gg07Xs8A@mail.gmail.com>
 <7519ff78-afde-4b80-a3fb-f7a55d2a487c@spatialys.com>
Message-ID: <CAAcGz9_gWk6L6wrB+T2EQaHnRGUcOGRKeDj-jGNGr7npbPPuqg@mail.gmail.com>

indeed there's no avx2:

cat /proc/cpuinfo|grep sse|head -n 1
flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
cmov pat pse36 clflush mmx fxsr sse sse2 syscall nx mmxext fxsr_opt pdpe1gb
rdtscp lm rep_good nopl cpuid extd_apicid tsc_known_freq pni pclmulqdq
ssse3 fma cx16 sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes xsave avx
f16c hypervisor lahf_lm cmp_legacy svm cr8_legacy abm sse4a misalignsse
3dnowprefetch osvw xop fma4 tbm perfctr_core ssbd ibpb vmmcall tsc_adjust
bmi1 virt_ssbd arat npt nrip_save arch_capabilities

Cheers, Mike



On Sun, Feb 4, 2024 at 10:55?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> ok, so I believe this is the AVX2 issue I was talking about, as I realize
> that enabling AVX2 is the default mode when TileDB is built from source
> (which the Docker image does), and must be explicitly disabled with
> "./bootstrap --disable-avx2" (I've just changed the build recipe to include
> that, will take effect next time the images are refreshed)
>
> To confirm, can you send or just check the output of : cat
> /proc/cpuinfo|grep sse|head -n 1
>
> If there is no "avx2" in it, this is at 99.9% the reason of the issue.
>
> Even
> Le 04/02/2024 ? 06:20, Michael Sumner a ?crit :
>
> skipping TileDB does fix:
>
> ogr2ogr /tmp/newdir
> https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson -f
> "ESRI Shapefile"
> export GDAL_SKIP=TileDB
> ogrinfo /tmp/newdir/
> INFO: Open of `/tmp/newdir/'
>       using driver `ESRI Shapefile' successful.
> 1: geo_melbourne (Polygon)
>
> unset GDAL_SKIP
> ogrinfo /tmp/newdir/
> Illegal instruction (core dumped)
>
> I failed to explain that I'm using gdal containers from the repo:
>
> docker run --rm -ti ghcr.io/osgeo/gdal:ubunt
>
> u-full-latest
>
> apt update
> apt install -y gdb
>
> Here's the output of under gdb as you suggested, there was a lot so I put
> it on a gist:
> https://gist.github.com/mdsumner/839ae6e05ededf640b65bfee3a20a4c0
>
> gdb --args ogrinfo /tmp/newdir/
> > run
> > thread apply all bt
>
> Thanks!
>
>
>
>
>
> On Sat, Feb 3, 2024 at 7:49?PM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> - When it crashes under gdb, type "thread apply all bt" to get the stack
>> trace of all threads
>>
>> - I suspect there is a connection with
>> https://github.com/OSGeo/gdal/pull/9170 , but that pull request wouldn't
>> help here as "/tmp/newdir" could be a valid connection to TileDB
>>
>> - how did you get TileDB installed? It looks to be packaged? Which
>> distribution do you use?
>>
>> - SIGILL reminds me of issues with some TileDB builds using the AVX2
>> instruction set by default, which could cause some crash on host CPUs that
>> don't have AVX2 (unlikely on recent hardware though)
>>
>> - Setting GDAL_SKIP=TileDB should be a workaround
>>
>>
>> Le 03/02/2024 ? 07:15, Michael Sumner a ?crit :
>>
>> Thanks Even, so there's something about tiledb under gdb (or maybe I am
>> mangling the context,  I will try variants of the host I'm using). Run with
>> valgrind included below.
>>
>> gdb --args ogrinfo /tmp/newdir/
>> ...
>> (gdb) run
>> Starting program: /usr/local/bin/ogrinfo /tmp/newdir/
>> [Thread debugging using libthread_db enabled]
>> Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
>> [New Thread 0x7fffe7757640 (LWP 988)]
>> [New Thread 0x7fffe6f56640 (LWP 989)]
>> [New Thread 0x7fffde755640 (LWP 990)]
>> [New Thread 0x7fffd5f54640 (LWP 991)]
>> [New Thread 0x7fffc5753640 (LWP 992)]
>> [New Thread 0x7fffc4f52640 (LWP 993)]
>> [New Thread 0x7fffb4751640 (LWP 994)]
>> [New Thread 0x7fffabf50640 (LWP 995)]
>> [New Thread 0x7fffab74f640 (LWP 996)]
>> [New Thread 0x7fffa2f4e640 (LWP 997)]
>> [New Thread 0x7fff9a74d640 (LWP 998)]
>> [New Thread 0x7fff91f4c640 (LWP 999)]
>> [New Thread 0x7fff8974b640 (LWP 1000)]
>> [New Thread 0x7fff78f4a640 (LWP 1001)]
>> [New Thread 0x7fff78749640 (LWP 1002)]
>> [New Thread 0x7fff6f5ff640 (LWP 1003)]
>>
>> Thread 1 "ogrinfo" received signal SIGILL, Illegal instruction.
>> 0x00007ffff3773c9e in tiledb::common::ThreadPool::ThreadPool(unsigned
>> long) () from /lib/x86_64-linux-gnu/libtiledb.so.2.16
>>
>>
>>
>>
>> valgrind -s ogrinfo /tmp/newdir
>> ==704== Memcheck, a memory error detector
>> ==704== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
>> ==704== Using Valgrind-3.18.1 and LibVEX; rerun with -h for copyright info
>> ==704== Command: ogrinfo /tmp/newdir
>> ==704==
>> INFO: Open of `/tmp/newdir'
>>       using driver `ESRI Shapefile' successful.
>> 1: geo_melbourne (Polygon)
>> ==704==
>> ==704== HEAP SUMMARY:
>> ==704==     in use at exit: 25,486 bytes in 216 blocks
>> ==704==   total heap usage: 15,761 allocs, 15,545 frees, 2,390,169 bytes
>> allocated
>> ==704==
>> ==704== LEAK SUMMARY:
>> ==704==    definitely lost: 0 bytes in 0 blocks
>> ==704==    indirectly lost: 0 bytes in 0 blocks
>> ==704==      possibly lost: 544 bytes in 1 blocks
>> ==704==    still reachable: 24,942 bytes in 215 blocks
>> ==704==         suppressed: 0 bytes in 0 blocks
>> ==704== Rerun with --leak-check=full to see details of leaked memory
>> ==704==
>> ==704== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
>>
>>
>> ogrinfo /tmp/newdir
>> Illegal instruction (core dumped)
>>
>> Cheers, Mike
>>
>>
>>
>>
>> On Sat, Feb 3, 2024 at 12:46?PM Even Rouault <even.rouault at spatialys.com>
>> wrote:
>>
>>> Michael,
>>>
>>> I'm wondering if there not might be something wrong with your build or
>>> runtime environment. Or there's something subtle, because that works fine
>>> for me with my dev build or in the
>>> ghcr.io/osgeo/gdal:alpine-normal-3.8.3 Docker image
>>>
>>> Try running "valgrind ogrinfo /tmp/newdir/" or "gdb --args ogrinfo
>>> /tmp/newdir/" (type "run") to get more useful information
>>>
>>> Even
>>> Le 03/02/2024 ? 02:35, Michael Sumner via gdal-dev a ?crit :
>>>
>>> I'm getting Illegal instruction / core dumped on ogrinfo of a
>>> directory:
>>>
>>> ogr2ogr /tmp/newdir
>>> https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson
>>> -f "ESRI Shapefile"
>>>
>>> ogrinfo /tmp/newdir/
>>> Illegal instruction (core dumped)
>>>
>>> I've worked back through some docker images and it wasn't a problem in
>>> 3.6.0, but I'm getting it since 3.7.0 - or I'm doing something wrong
>>> entirely.
>>>
>>> Cheers, Mike
>>>
>>>
>>> --
>>> Michael Sumner
>>> Software and Database Engineer
>>> Australian Antarctic Division
>>> Hobart, Australia
>>> e-mail: mdsumner at gmail.com
>>>
>>> _______________________________________________
>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>> -- http://www.spatialys.com
>>> My software is free, but my time generally not.
>>>
>>>
>>
>> --
>> Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240205/c1ad302e/attachment.htm>

From Marian.Hadri at rib-software.com  Sun Feb  4 13:54:06 2024
From: Marian.Hadri at rib-software.com (=?iso-8859-1?Q?Mari=E1n_Hadri?=)
Date: Sun, 4 Feb 2024 21:54:06 +0000
Subject: [gdal-dev] ECW plugin
Message-ID: <VE1PR01MB6158D1B37B44181B22A7C6C3AE402@VE1PR01MB6158.eurprd01.prod.exchangelabs.com>

Hi,

I've build GDAL version 3.8.3 in VS2019 from source files "gdal-3.8.3.tar.gz". For creating project file "GDAL.vcxproj"
I used CMake program. I've added variables PROJ_INCLUDE_DIR = C:\OSGeo4W\include and PROJ_LIBRARY = C:\OSGeo4W\lib\proj.lib
and everything worked fine. When I added gdal.dll to our project ... it worked fine, it convert raster files and so on. But I have one problem,
I need to add ECW plugin to GDAL 3.8.3 project. Could you help me, how to do it ... ?

Thanks in advance, Marian Hadri


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240204/804681ef/attachment-0001.htm>

From even.rouault at spatialys.com  Sun Feb  4 14:58:41 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 4 Feb 2024 23:58:41 +0100
Subject: [gdal-dev] ECW plugin
In-Reply-To: <VE1PR01MB6158D1B37B44181B22A7C6C3AE402@VE1PR01MB6158.eurprd01.prod.exchangelabs.com>
References: <VE1PR01MB6158D1B37B44181B22A7C6C3AE402@VE1PR01MB6158.eurprd01.prod.exchangelabs.com>
Message-ID: <f29257f4-c09d-4fab-9f11-941e12cb1b97@spatialys.com>

Hi,

you need to download the ECW SDK from 
https://supportsi.hexagon.com/s/article/ERDAS-ECW-JP2-SDK-v5-5-Update-4-Release-Announcement?language=en_US 
and install it

and then point to it with the CMake variables indicated at 
https://gdal.org/development/building_from_source.html#ecw

Cf 
https://github.com/jef-n/OSGeo4W/blob/6a17ff489bd6dcd583cbfa51b542966ba2961c7d/src/gdal/osgeo4w/package.sh#L150 
for the build recipee of the OSGeo4W GDAL build with ECW support

Even

Le 04/02/2024 ? 22:54, Mari?n Hadri via gdal-dev a ?crit?:
>
> Hi,
>
> I've build GDAL version 3.8.3 in VS2019 from source files 
> "gdal-3.8.3.tar.gz". For creating project file "GDAL.vcxproj"
>
> I used CMake program. I've added variables PROJ_INCLUDE_DIR = 
> C:\OSGeo4W\include and PROJ_LIBRARY = C:\OSGeo4W\lib\proj.lib
>
> and everything worked fine. When I added gdal.dll to our project ... 
> it worked fine, it convert raster files and so on. But I have one 
> problem,
>
> I need to add ECW plugin to GDAL 3.8.3 project. Could you help me, how 
> to do it ... ?
>
> Thanks in advance, Marian Hadri
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240204/f561802b/attachment.htm>

From even.rouault at spatialys.com  Sun Feb  4 17:04:25 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 5 Feb 2024 02:04:25 +0100
Subject: [gdal-dev] core dump on dir info
In-Reply-To: <CAAcGz9_gWk6L6wrB+T2EQaHnRGUcOGRKeDj-jGNGr7npbPPuqg@mail.gmail.com>
References: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>
 <d98a03d5-6223-4ef1-8936-09557ca74ea5@spatialys.com>
 <CAAcGz99QWfbQ98mc950sZUfG-x4VHhcnJcqbSQ14-zFM++TRXQ@mail.gmail.com>
 <327573e0-7d8e-4271-8697-6cc71f53becd@spatialys.com>
 <CAAcGz986hs2HL8NgghNi6o8v-54rX1bffScDWdg2O=Gg07Xs8A@mail.gmail.com>
 <7519ff78-afde-4b80-a3fb-f7a55d2a487c@spatialys.com>
 <CAAcGz9_gWk6L6wrB+T2EQaHnRGUcOGRKeDj-jGNGr7npbPPuqg@mail.gmail.com>
Message-ID: <dbe72a35-90ff-43c4-a542-4f675e65e499@spatialys.com>

ghcr.io/osgeo/gdal:ubuntu-full-latest has been regenerated with the 
rebuild of TileDB without AVX2. I've also enabled the 
drivers-with-external-depencies-built-as-plugin GDAL build mode, so it 
is easy to just remove a given plugin by deleting the corresponding .so 
in /usr/lib/x86_64-linux-gnu/gdalplugins

Even

Le 04/02/2024 ? 22:51, Michael Sumner a ?crit?:
> indeed there's no avx2:
>
> cat /proc/cpuinfo|grep sse|head -n 1
> flags ? ? ? ? ? : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge 
> mca cmov pat pse36 clflush mmx fxsr sse sse2 syscall nx mmxext 
> fxsr_opt pdpe1gb rdtscp lm rep_good nopl cpuid extd_apicid 
> tsc_known_freq pni pclmulqdq ssse3 fma cx16 sse4_1 sse4_2 x2apic 
> popcnt tsc_deadline_timer aes xsave avx f16c hypervisor lahf_lm 
> cmp_legacy svm cr8_legacy abm sse4a misalignsse 3dnowprefetch osvw xop 
> fma4 tbm perfctr_core ssbd ibpb vmmcall tsc_adjust bmi1 virt_ssbd arat 
> npt nrip_save arch_capabilities
>
> Cheers, Mike
>
>
>
> On Sun, Feb 4, 2024 at 10:55?PM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     ok, so I believe this is the AVX2 issue I was talking about, as I
>     realize that enabling AVX2 is the default mode when TileDB is
>     built from source (which the Docker image does), and must be
>     explicitly disabled with "./bootstrap --disable-avx2" (I've just
>     changed the build recipe to include that, will take effect next
>     time the images are refreshed)
>
>     To confirm, can you send or just check the output of : cat
>     /proc/cpuinfo|grep sse|head -n 1
>
>     If there is no "avx2" in it, this is at 99.9% the reason of the issue.
>
>     Even
>
>     Le 04/02/2024 ? 06:20, Michael Sumner a ?crit?:
>>     skipping TileDB does fix:
>>
>>     ogr2ogr /tmp/newdir
>>     https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson?-f
>>     "ESRI Shapefile"
>>     export GDAL_SKIP=TileDB
>>     ogrinfo /tmp/newdir/
>>     INFO: Open of `/tmp/newdir/'
>>     ? ? ? using driver `ESRI Shapefile' successful.
>>     1: geo_melbourne (Polygon)
>>
>>     unset GDAL_SKIP
>>     ogrinfo /tmp/newdir/
>>     Illegal instruction (core dumped)
>>
>>     I failed to explain that I'm using gdal containers from the repo:
>>
>>     docker run --rm -ti ghcr.io/osgeo/gdal:ubunt
>>     <http://ghcr.io/osgeo/gdal:ubunt>
>>
>>     u-full-latest
>>
>>     apt update
>>     apt install -y gdb
>>
>>     Here's the output of under gdb as you suggested, there was a lot
>>     so I put it on a gist:
>>     https://gist.github.com/mdsumner/839ae6e05ededf640b65bfee3a20a4c0
>>
>>     gdb --args ogrinfo /tmp/newdir/
>>     > run
>>     > thread apply all bt
>>
>>     Thanks!
>>
>>
>>
>>
>>
>>     On Sat, Feb 3, 2024 at 7:49?PM Even Rouault
>>     <even.rouault at spatialys.com> wrote:
>>
>>         - When it crashes under gdb, type "thread apply all bt" to
>>         get the stack trace of all threads
>>
>>         - I suspect there is a connection with
>>         https://github.com/OSGeo/gdal/pull/9170 , but that pull
>>         request wouldn't help here as "/tmp/newdir" could be a valid
>>         connection to TileDB
>>
>>         - how did you get TileDB installed? It looks to be packaged?
>>         Which distribution do you use?
>>
>>         - SIGILL reminds me of issues with some TileDB builds using
>>         the AVX2 instruction set by default, which could cause some
>>         crash on host CPUs that don't have AVX2 (unlikely on recent
>>         hardware though)
>>
>>         - Setting GDAL_SKIP=TileDB should be a workaround
>>
>>
>>         Le 03/02/2024 ? 07:15, Michael Sumner a ?crit?:
>>>         Thanks Even, so there's something about tiledb under gdb (or
>>>         maybe I am mangling the context,? I will try variants of the
>>>         host I'm using). Run with valgrind included below.
>>>
>>>         gdb --args ogrinfo /tmp/newdir/
>>>         ...
>>>         (gdb) run
>>>         Starting program: /usr/local/bin/ogrinfo /tmp/newdir/
>>>         [Thread debugging using libthread_db enabled]
>>>         Using host libthread_db library
>>>         "/lib/x86_64-linux-gnu/libthread_db.so.1".
>>>         [New Thread 0x7fffe7757640 (LWP 988)]
>>>         [New Thread 0x7fffe6f56640 (LWP 989)]
>>>         [New Thread 0x7fffde755640 (LWP 990)]
>>>         [New Thread 0x7fffd5f54640 (LWP 991)]
>>>         [New Thread 0x7fffc5753640 (LWP 992)]
>>>         [New Thread 0x7fffc4f52640 (LWP 993)]
>>>         [New Thread 0x7fffb4751640 (LWP 994)]
>>>         [New Thread 0x7fffabf50640 (LWP 995)]
>>>         [New Thread 0x7fffab74f640 (LWP 996)]
>>>         [New Thread 0x7fffa2f4e640 (LWP 997)]
>>>         [New Thread 0x7fff9a74d640 (LWP 998)]
>>>         [New Thread 0x7fff91f4c640 (LWP 999)]
>>>         [New Thread 0x7fff8974b640 (LWP 1000)]
>>>         [New Thread 0x7fff78f4a640 (LWP 1001)]
>>>         [New Thread 0x7fff78749640 (LWP 1002)]
>>>         [New Thread 0x7fff6f5ff640 (LWP 1003)]
>>>
>>>         Thread 1 "ogrinfo" received signal SIGILL, Illegal instruction.
>>>         0x00007ffff3773c9e in
>>>         tiledb::common::ThreadPool::ThreadPool(unsigned long) ()
>>>         from /lib/x86_64-linux-gnu/libtiledb.so.2.16
>>>
>>>
>>>
>>>
>>>         valgrind -s ogrinfo /tmp/newdir
>>>         ==704== Memcheck, a memory error detector
>>>         ==704== Copyright (C) 2002-2017, and GNU GPL'd, by Julian
>>>         Seward et al.
>>>         ==704== Using Valgrind-3.18.1 and LibVEX; rerun with -h for
>>>         copyright info
>>>         ==704== Command: ogrinfo /tmp/newdir
>>>         ==704==
>>>         INFO: Open of `/tmp/newdir'
>>>         ? ? ? using driver `ESRI Shapefile' successful.
>>>         1: geo_melbourne (Polygon)
>>>         ==704==
>>>         ==704== HEAP SUMMARY:
>>>         ==704== ? ? in use at exit: 25,486 bytes in 216 blocks
>>>         ==704== ? total heap usage: 15,761 allocs, 15,545 frees,
>>>         2,390,169 bytes allocated
>>>         ==704==
>>>         ==704== LEAK SUMMARY:
>>>         ==704== ? ?definitely lost: 0 bytes in 0 blocks
>>>         ==704== ? ?indirectly lost: 0 bytes in 0 blocks
>>>         ==704== ? ? ?possibly lost: 544 bytes in 1 blocks
>>>         ==704== ? ?still reachable: 24,942 bytes in 215 blocks
>>>         ==704== ? ? ? ? suppressed: 0 bytes in 0 blocks
>>>         ==704== Rerun with --leak-check=full to see details of
>>>         leaked memory
>>>         ==704==
>>>         ==704== ERROR SUMMARY: 0 errors from 0 contexts (suppressed:
>>>         0 from 0)
>>>
>>>
>>>         ogrinfo /tmp/newdir
>>>         Illegal instruction (core dumped)
>>>
>>>         Cheers, Mike
>>>
>>>
>>>
>>>
>>>         On Sat, Feb 3, 2024 at 12:46?PM Even Rouault
>>>         <even.rouault at spatialys.com> wrote:
>>>
>>>             Michael,
>>>
>>>             I'm wondering if there not might be something wrong with
>>>             your build or runtime environment. Or there's something
>>>             subtle, because that works fine for me with my dev build
>>>             or in the ghcr.io/osgeo/gdal:alpine-normal-3.8.3
>>>             <http://ghcr.io/osgeo/gdal:alpine-normal-3.8.3> Docker image
>>>
>>>             Try running "valgrind ogrinfo /tmp/newdir/" or "gdb
>>>             --args ogrinfo /tmp/newdir/" (type "run") to get more
>>>             useful information
>>>
>>>             Even
>>>
>>>             Le 03/02/2024 ? 02:35, Michael Sumner via gdal-dev a ?crit?:
>>>>             I'm getting Illegal instruction / core dumped on
>>>>             ogrinfo of a directory:
>>>>
>>>>             ogr2ogr /tmp/newdir
>>>>             https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson
>>>>             -f "ESRI Shapefile"
>>>>
>>>>             ogrinfo /tmp/newdir/
>>>>             Illegal instruction (core dumped)
>>>>
>>>>             I've worked back through some docker images and it
>>>>             wasn't a problem in 3.6.0, but I'm getting it since
>>>>             3.7.0 - or I'm doing something wrong entirely.
>>>>
>>>>             Cheers, Mike
>>>>
>>>>
>>>>             -- 
>>>>             Michael Sumner
>>>>             Software and Database Engineer
>>>>             Australian Antarctic Division
>>>>             Hobart, Australia
>>>>             e-mail: mdsumner at gmail.com
>>>>
>>>>             _______________________________________________
>>>>             gdal-dev mailing list
>>>>             gdal-dev at lists.osgeo.org
>>>>             https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>>             -- 
>>>             http://www.spatialys.com
>>>             My software is free, but my time generally not.
>>>
>>>
>>>
>>>         -- 
>>>         Michael Sumner
>>>         Software and Database Engineer
>>>         Australian Antarctic Division
>>>         Hobart, Australia
>>>         e-mail: mdsumner at gmail.com
>>
>>         -- 
>>         http://www.spatialys.com
>>         My software is free, but my time generally not.
>>
>>
>>
>>     -- 
>>     Michael Sumner
>>     Software and Database Engineer
>>     Australian Antarctic Division
>>     Hobart, Australia
>>     e-mail: mdsumner at gmail.com
>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
>
>
> -- 
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240205/57931cc3/attachment-0001.htm>

From mdsumner at gmail.com  Sun Feb  4 19:32:36 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Mon, 5 Feb 2024 14:32:36 +1100
Subject: [gdal-dev] core dump on dir info
In-Reply-To: <dbe72a35-90ff-43c4-a542-4f675e65e499@spatialys.com>
References: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>
 <d98a03d5-6223-4ef1-8936-09557ca74ea5@spatialys.com>
 <CAAcGz99QWfbQ98mc950sZUfG-x4VHhcnJcqbSQ14-zFM++TRXQ@mail.gmail.com>
 <327573e0-7d8e-4271-8697-6cc71f53becd@spatialys.com>
 <CAAcGz986hs2HL8NgghNi6o8v-54rX1bffScDWdg2O=Gg07Xs8A@mail.gmail.com>
 <7519ff78-afde-4b80-a3fb-f7a55d2a487c@spatialys.com>
 <CAAcGz9_gWk6L6wrB+T2EQaHnRGUcOGRKeDj-jGNGr7npbPPuqg@mail.gmail.com>
 <dbe72a35-90ff-43c4-a542-4f675e65e499@spatialys.com>
Message-ID: <CAAcGz98EzKmc1s+sRK4NDB_RS5UiJO+ji_1SYWr=+njLwJ6kcw@mail.gmail.com>

Excellent, thanks Even - confirmed at my end and on my original use-case.

Cheers, Mike



On Mon, Feb 5, 2024 at 12:04?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> ghcr.io/osgeo/gdal:ubuntu-full-latest has been regenerated with the
> rebuild of TileDB without AVX2. I've also enabled the
> drivers-with-external-depencies-built-as-plugin GDAL build mode, so it is
> easy to just remove a given plugin by deleting the corresponding .so in
> /usr/lib/x86_64-linux-gnu/gdalplugins
>
> Even
> Le 04/02/2024 ? 22:51, Michael Sumner a ?crit :
>
> indeed there's no avx2:
>
> cat /proc/cpuinfo|grep sse|head -n 1
> flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
> cmov pat pse36 clflush mmx fxsr sse sse2 syscall nx mmxext fxsr_opt pdpe1gb
> rdtscp lm rep_good nopl cpuid extd_apicid tsc_known_freq pni pclmulqdq
> ssse3 fma cx16 sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes xsave avx
> f16c hypervisor lahf_lm cmp_legacy svm cr8_legacy abm sse4a misalignsse
> 3dnowprefetch osvw xop fma4 tbm perfctr_core ssbd ibpb vmmcall tsc_adjust
> bmi1 virt_ssbd arat npt nrip_save arch_capabilities
>
> Cheers, Mike
>
>
>
> On Sun, Feb 4, 2024 at 10:55?PM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> ok, so I believe this is the AVX2 issue I was talking about, as I realize
>> that enabling AVX2 is the default mode when TileDB is built from source
>> (which the Docker image does), and must be explicitly disabled with
>> "./bootstrap --disable-avx2" (I've just changed the build recipe to include
>> that, will take effect next time the images are refreshed)
>>
>> To confirm, can you send or just check the output of : cat
>> /proc/cpuinfo|grep sse|head -n 1
>>
>> If there is no "avx2" in it, this is at 99.9% the reason of the issue.
>>
>> Even
>> Le 04/02/2024 ? 06:20, Michael Sumner a ?crit :
>>
>> skipping TileDB does fix:
>>
>> ogr2ogr /tmp/newdir
>> https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson -f
>> "ESRI Shapefile"
>> export GDAL_SKIP=TileDB
>> ogrinfo /tmp/newdir/
>> INFO: Open of `/tmp/newdir/'
>>       using driver `ESRI Shapefile' successful.
>> 1: geo_melbourne (Polygon)
>>
>> unset GDAL_SKIP
>> ogrinfo /tmp/newdir/
>> Illegal instruction (core dumped)
>>
>> I failed to explain that I'm using gdal containers from the repo:
>>
>> docker run --rm -ti ghcr.io/osgeo/gdal:ubunt
>>
>> u-full-latest
>>
>> apt update
>> apt install -y gdb
>>
>> Here's the output of under gdb as you suggested, there was a lot so I put
>> it on a gist:
>> https://gist.github.com/mdsumner/839ae6e05ededf640b65bfee3a20a4c0
>>
>> gdb --args ogrinfo /tmp/newdir/
>> > run
>> > thread apply all bt
>>
>> Thanks!
>>
>>
>>
>>
>>
>> On Sat, Feb 3, 2024 at 7:49?PM Even Rouault <even.rouault at spatialys.com>
>> wrote:
>>
>>> - When it crashes under gdb, type "thread apply all bt" to get the stack
>>> trace of all threads
>>>
>>> - I suspect there is a connection with
>>> https://github.com/OSGeo/gdal/pull/9170 , but that pull request
>>> wouldn't help here as "/tmp/newdir" could be a valid connection to TileDB
>>>
>>> - how did you get TileDB installed? It looks to be packaged? Which
>>> distribution do you use?
>>>
>>> - SIGILL reminds me of issues with some TileDB builds using the AVX2
>>> instruction set by default, which could cause some crash on host CPUs that
>>> don't have AVX2 (unlikely on recent hardware though)
>>>
>>> - Setting GDAL_SKIP=TileDB should be a workaround
>>>
>>>
>>> Le 03/02/2024 ? 07:15, Michael Sumner a ?crit :
>>>
>>> Thanks Even, so there's something about tiledb under gdb (or maybe I am
>>> mangling the context,  I will try variants of the host I'm using). Run with
>>> valgrind included below.
>>>
>>> gdb --args ogrinfo /tmp/newdir/
>>> ...
>>> (gdb) run
>>> Starting program: /usr/local/bin/ogrinfo /tmp/newdir/
>>> [Thread debugging using libthread_db enabled]
>>> Using host libthread_db library
>>> "/lib/x86_64-linux-gnu/libthread_db.so.1".
>>> [New Thread 0x7fffe7757640 (LWP 988)]
>>> [New Thread 0x7fffe6f56640 (LWP 989)]
>>> [New Thread 0x7fffde755640 (LWP 990)]
>>> [New Thread 0x7fffd5f54640 (LWP 991)]
>>> [New Thread 0x7fffc5753640 (LWP 992)]
>>> [New Thread 0x7fffc4f52640 (LWP 993)]
>>> [New Thread 0x7fffb4751640 (LWP 994)]
>>> [New Thread 0x7fffabf50640 (LWP 995)]
>>> [New Thread 0x7fffab74f640 (LWP 996)]
>>> [New Thread 0x7fffa2f4e640 (LWP 997)]
>>> [New Thread 0x7fff9a74d640 (LWP 998)]
>>> [New Thread 0x7fff91f4c640 (LWP 999)]
>>> [New Thread 0x7fff8974b640 (LWP 1000)]
>>> [New Thread 0x7fff78f4a640 (LWP 1001)]
>>> [New Thread 0x7fff78749640 (LWP 1002)]
>>> [New Thread 0x7fff6f5ff640 (LWP 1003)]
>>>
>>> Thread 1 "ogrinfo" received signal SIGILL, Illegal instruction.
>>> 0x00007ffff3773c9e in tiledb::common::ThreadPool::ThreadPool(unsigned
>>> long) () from /lib/x86_64-linux-gnu/libtiledb.so.2.16
>>>
>>>
>>>
>>>
>>> valgrind -s ogrinfo /tmp/newdir
>>> ==704== Memcheck, a memory error detector
>>> ==704== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
>>> ==704== Using Valgrind-3.18.1 and LibVEX; rerun with -h for copyright
>>> info
>>> ==704== Command: ogrinfo /tmp/newdir
>>> ==704==
>>> INFO: Open of `/tmp/newdir'
>>>       using driver `ESRI Shapefile' successful.
>>> 1: geo_melbourne (Polygon)
>>> ==704==
>>> ==704== HEAP SUMMARY:
>>> ==704==     in use at exit: 25,486 bytes in 216 blocks
>>> ==704==   total heap usage: 15,761 allocs, 15,545 frees, 2,390,169 bytes
>>> allocated
>>> ==704==
>>> ==704== LEAK SUMMARY:
>>> ==704==    definitely lost: 0 bytes in 0 blocks
>>> ==704==    indirectly lost: 0 bytes in 0 blocks
>>> ==704==      possibly lost: 544 bytes in 1 blocks
>>> ==704==    still reachable: 24,942 bytes in 215 blocks
>>> ==704==         suppressed: 0 bytes in 0 blocks
>>> ==704== Rerun with --leak-check=full to see details of leaked memory
>>> ==704==
>>> ==704== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
>>>
>>>
>>> ogrinfo /tmp/newdir
>>> Illegal instruction (core dumped)
>>>
>>> Cheers, Mike
>>>
>>>
>>>
>>>
>>> On Sat, Feb 3, 2024 at 12:46?PM Even Rouault <even.rouault at spatialys.com>
>>> wrote:
>>>
>>>> Michael,
>>>>
>>>> I'm wondering if there not might be something wrong with your build or
>>>> runtime environment. Or there's something subtle, because that works fine
>>>> for me with my dev build or in the
>>>> ghcr.io/osgeo/gdal:alpine-normal-3.8.3 Docker image
>>>>
>>>> Try running "valgrind ogrinfo /tmp/newdir/" or "gdb --args ogrinfo
>>>> /tmp/newdir/" (type "run") to get more useful information
>>>>
>>>> Even
>>>> Le 03/02/2024 ? 02:35, Michael Sumner via gdal-dev a ?crit :
>>>>
>>>> I'm getting Illegal instruction / core dumped on ogrinfo of a
>>>> directory:
>>>>
>>>> ogr2ogr /tmp/newdir
>>>> https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson
>>>> -f "ESRI Shapefile"
>>>>
>>>> ogrinfo /tmp/newdir/
>>>> Illegal instruction (core dumped)
>>>>
>>>> I've worked back through some docker images and it wasn't a problem in
>>>> 3.6.0, but I'm getting it since 3.7.0 - or I'm doing something wrong
>>>> entirely.
>>>>
>>>> Cheers, Mike
>>>>
>>>>
>>>> --
>>>> Michael Sumner
>>>> Software and Database Engineer
>>>> Australian Antarctic Division
>>>> Hobart, Australia
>>>> e-mail: mdsumner at gmail.com
>>>>
>>>> _______________________________________________
>>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>>> -- http://www.spatialys.com
>>>> My software is free, but my time generally not.
>>>>
>>>>
>>>
>>> --
>>> Michael Sumner
>>> Software and Database Engineer
>>> Australian Antarctic Division
>>> Hobart, Australia
>>> e-mail: mdsumner at gmail.com
>>>
>>> -- http://www.spatialys.com
>>> My software is free, but my time generally not.
>>>
>>>
>>
>> --
>> Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240205/5cf9a8a9/attachment-0001.htm>

From j1 at jimenezshaw.com  Sun Feb  4 23:44:08 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Mon, 5 Feb 2024 08:44:08 +0100
Subject: [gdal-dev] core dump on dir info
In-Reply-To: <dbe72a35-90ff-43c4-a542-4f675e65e499@spatialys.com>
References: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>
 <d98a03d5-6223-4ef1-8936-09557ca74ea5@spatialys.com>
 <CAAcGz99QWfbQ98mc950sZUfG-x4VHhcnJcqbSQ14-zFM++TRXQ@mail.gmail.com>
 <327573e0-7d8e-4271-8697-6cc71f53becd@spatialys.com>
 <CAAcGz986hs2HL8NgghNi6o8v-54rX1bffScDWdg2O=Gg07Xs8A@mail.gmail.com>
 <7519ff78-afde-4b80-a3fb-f7a55d2a487c@spatialys.com>
 <CAAcGz9_gWk6L6wrB+T2EQaHnRGUcOGRKeDj-jGNGr7npbPPuqg@mail.gmail.com>
 <dbe72a35-90ff-43c4-a542-4f675e65e499@spatialys.com>
Message-ID: <CADRrdKvRx6auqyzfKWde4+WVxDCdznUKdPq=+HuY3nxswG+xFg@mail.gmail.com>

Hi Mike

Out of curiosity, are run running it in a virtual machine?
A few year ago I had problems running a program in a virtual machine
(virtualbox, but I read it happens in others) due to a missing SSE
instruction. The solution there was to "enable" the missing instructions in
the virtual machine configuration (that I don't know why it was not the
default).

Cheers


On Mon, 5 Feb 2024, 02:04 Even Rouault via gdal-dev, <
gdal-dev at lists.osgeo.org> wrote:

> ghcr.io/osgeo/gdal:ubuntu-full-latest has been regenerated with the
> rebuild of TileDB without AVX2. I've also enabled the
> drivers-with-external-depencies-built-as-plugin GDAL build mode, so it is
> easy to just remove a given plugin by deleting the corresponding .so in
> /usr/lib/x86_64-linux-gnu/gdalplugins
>
> Even
> Le 04/02/2024 ? 22:51, Michael Sumner a ?crit :
>
> indeed there's no avx2:
>
> cat /proc/cpuinfo|grep sse|head -n 1
> flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca
> cmov pat pse36 clflush mmx fxsr sse sse2 syscall nx mmxext fxsr_opt pdpe1gb
> rdtscp lm rep_good nopl cpuid extd_apicid tsc_known_freq pni pclmulqdq
> ssse3 fma cx16 sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes xsave avx
> f16c hypervisor lahf_lm cmp_legacy svm cr8_legacy abm sse4a misalignsse
> 3dnowprefetch osvw xop fma4 tbm perfctr_core ssbd ibpb vmmcall tsc_adjust
> bmi1 virt_ssbd arat npt nrip_save arch_capabilities
>
> Cheers, Mike
>
>
>
> On Sun, Feb 4, 2024 at 10:55?PM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> ok, so I believe this is the AVX2 issue I was talking about, as I realize
>> that enabling AVX2 is the default mode when TileDB is built from source
>> (which the Docker image does), and must be explicitly disabled with
>> "./bootstrap --disable-avx2" (I've just changed the build recipe to include
>> that, will take effect next time the images are refreshed)
>>
>> To confirm, can you send or just check the output of : cat
>> /proc/cpuinfo|grep sse|head -n 1
>>
>> If there is no "avx2" in it, this is at 99.9% the reason of the issue.
>>
>> Even
>> Le 04/02/2024 ? 06:20, Michael Sumner a ?crit :
>>
>> skipping TileDB does fix:
>>
>> ogr2ogr /tmp/newdir
>> https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson -f
>> "ESRI Shapefile"
>> export GDAL_SKIP=TileDB
>> ogrinfo /tmp/newdir/
>> INFO: Open of `/tmp/newdir/'
>>       using driver `ESRI Shapefile' successful.
>> 1: geo_melbourne (Polygon)
>>
>> unset GDAL_SKIP
>> ogrinfo /tmp/newdir/
>> Illegal instruction (core dumped)
>>
>> I failed to explain that I'm using gdal containers from the repo:
>>
>> docker run --rm -ti ghcr.io/osgeo/gdal:ubunt
>>
>> u-full-latest
>>
>> apt update
>> apt install -y gdb
>>
>> Here's the output of under gdb as you suggested, there was a lot so I put
>> it on a gist:
>> https://gist.github.com/mdsumner/839ae6e05ededf640b65bfee3a20a4c0
>>
>> gdb --args ogrinfo /tmp/newdir/
>> > run
>> > thread apply all bt
>>
>> Thanks!
>>
>>
>>
>>
>>
>> On Sat, Feb 3, 2024 at 7:49?PM Even Rouault <even.rouault at spatialys.com>
>> wrote:
>>
>>> - When it crashes under gdb, type "thread apply all bt" to get the stack
>>> trace of all threads
>>>
>>> - I suspect there is a connection with
>>> https://github.com/OSGeo/gdal/pull/9170 , but that pull request
>>> wouldn't help here as "/tmp/newdir" could be a valid connection to TileDB
>>>
>>> - how did you get TileDB installed? It looks to be packaged? Which
>>> distribution do you use?
>>>
>>> - SIGILL reminds me of issues with some TileDB builds using the AVX2
>>> instruction set by default, which could cause some crash on host CPUs that
>>> don't have AVX2 (unlikely on recent hardware though)
>>>
>>> - Setting GDAL_SKIP=TileDB should be a workaround
>>>
>>>
>>> Le 03/02/2024 ? 07:15, Michael Sumner a ?crit :
>>>
>>> Thanks Even, so there's something about tiledb under gdb (or maybe I am
>>> mangling the context,  I will try variants of the host I'm using). Run with
>>> valgrind included below.
>>>
>>> gdb --args ogrinfo /tmp/newdir/
>>> ...
>>> (gdb) run
>>> Starting program: /usr/local/bin/ogrinfo /tmp/newdir/
>>> [Thread debugging using libthread_db enabled]
>>> Using host libthread_db library
>>> "/lib/x86_64-linux-gnu/libthread_db.so.1".
>>> [New Thread 0x7fffe7757640 (LWP 988)]
>>> [New Thread 0x7fffe6f56640 (LWP 989)]
>>> [New Thread 0x7fffde755640 (LWP 990)]
>>> [New Thread 0x7fffd5f54640 (LWP 991)]
>>> [New Thread 0x7fffc5753640 (LWP 992)]
>>> [New Thread 0x7fffc4f52640 (LWP 993)]
>>> [New Thread 0x7fffb4751640 (LWP 994)]
>>> [New Thread 0x7fffabf50640 (LWP 995)]
>>> [New Thread 0x7fffab74f640 (LWP 996)]
>>> [New Thread 0x7fffa2f4e640 (LWP 997)]
>>> [New Thread 0x7fff9a74d640 (LWP 998)]
>>> [New Thread 0x7fff91f4c640 (LWP 999)]
>>> [New Thread 0x7fff8974b640 (LWP 1000)]
>>> [New Thread 0x7fff78f4a640 (LWP 1001)]
>>> [New Thread 0x7fff78749640 (LWP 1002)]
>>> [New Thread 0x7fff6f5ff640 (LWP 1003)]
>>>
>>> Thread 1 "ogrinfo" received signal SIGILL, Illegal instruction.
>>> 0x00007ffff3773c9e in tiledb::common::ThreadPool::ThreadPool(unsigned
>>> long) () from /lib/x86_64-linux-gnu/libtiledb.so.2.16
>>>
>>>
>>>
>>>
>>> valgrind -s ogrinfo /tmp/newdir
>>> ==704== Memcheck, a memory error detector
>>> ==704== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
>>> ==704== Using Valgrind-3.18.1 and LibVEX; rerun with -h for copyright
>>> info
>>> ==704== Command: ogrinfo /tmp/newdir
>>> ==704==
>>> INFO: Open of `/tmp/newdir'
>>>       using driver `ESRI Shapefile' successful.
>>> 1: geo_melbourne (Polygon)
>>> ==704==
>>> ==704== HEAP SUMMARY:
>>> ==704==     in use at exit: 25,486 bytes in 216 blocks
>>> ==704==   total heap usage: 15,761 allocs, 15,545 frees, 2,390,169 bytes
>>> allocated
>>> ==704==
>>> ==704== LEAK SUMMARY:
>>> ==704==    definitely lost: 0 bytes in 0 blocks
>>> ==704==    indirectly lost: 0 bytes in 0 blocks
>>> ==704==      possibly lost: 544 bytes in 1 blocks
>>> ==704==    still reachable: 24,942 bytes in 215 blocks
>>> ==704==         suppressed: 0 bytes in 0 blocks
>>> ==704== Rerun with --leak-check=full to see details of leaked memory
>>> ==704==
>>> ==704== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
>>>
>>>
>>> ogrinfo /tmp/newdir
>>> Illegal instruction (core dumped)
>>>
>>> Cheers, Mike
>>>
>>>
>>>
>>>
>>> On Sat, Feb 3, 2024 at 12:46?PM Even Rouault <even.rouault at spatialys.com>
>>> wrote:
>>>
>>>> Michael,
>>>>
>>>> I'm wondering if there not might be something wrong with your build or
>>>> runtime environment. Or there's something subtle, because that works fine
>>>> for me with my dev build or in the
>>>> ghcr.io/osgeo/gdal:alpine-normal-3.8.3 Docker image
>>>>
>>>> Try running "valgrind ogrinfo /tmp/newdir/" or "gdb --args ogrinfo
>>>> /tmp/newdir/" (type "run") to get more useful information
>>>>
>>>> Even
>>>> Le 03/02/2024 ? 02:35, Michael Sumner via gdal-dev a ?crit :
>>>>
>>>> I'm getting Illegal instruction / core dumped on ogrinfo of a
>>>> directory:
>>>>
>>>> ogr2ogr /tmp/newdir
>>>> https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson
>>>> -f "ESRI Shapefile"
>>>>
>>>> ogrinfo /tmp/newdir/
>>>> Illegal instruction (core dumped)
>>>>
>>>> I've worked back through some docker images and it wasn't a problem in
>>>> 3.6.0, but I'm getting it since 3.7.0 - or I'm doing something wrong
>>>> entirely.
>>>>
>>>> Cheers, Mike
>>>>
>>>>
>>>> --
>>>> Michael Sumner
>>>> Software and Database Engineer
>>>> Australian Antarctic Division
>>>> Hobart, Australia
>>>> e-mail: mdsumner at gmail.com
>>>>
>>>> _______________________________________________
>>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>>> -- http://www.spatialys.com
>>>> My software is free, but my time generally not.
>>>>
>>>>
>>>
>>> --
>>> Michael Sumner
>>> Software and Database Engineer
>>> Australian Antarctic Division
>>> Hobart, Australia
>>> e-mail: mdsumner at gmail.com
>>>
>>> -- http://www.spatialys.com
>>> My software is free, but my time generally not.
>>>
>>>
>>
>> --
>> Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>>
>
> --
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240205/9a888f3b/attachment-0001.htm>

From raghav.singh at eagleview.com  Mon Feb  5 05:53:25 2024
From: raghav.singh at eagleview.com (Raghav Singh)
Date: Mon, 5 Feb 2024 13:53:25 +0000
Subject: [gdal-dev] Black image pixels
Message-ID: <SA1PR20MB61218F3DF15344F859D0C57D8C472@SA1PR20MB6121.namprd20.prod.outlook.com>

Hi,

I am loading one image on qgis and arcmap so that image is available till zoom 20 but if I am loading after that image I am getting a black image but I tested one more image which is also available till same zoom but it loads at max zoom like 1:50 level also. For reference this is the black image passthru file data -


<GDAL_WMS>

    <Service name="TMS">

        <ServerUrl>http://gserve-connect/v1/map/urn:eagleview.com.../tile?tileRow=${y}&amp;tileColumn=${x}&amp;zoomLevel=${z}&amp;minZoom=6&amp;maxZoom=20</ServerUrl>

    </Service>

    <DataWindow>

        <UpperLeftX>-20037508.34</UpperLeftX>

        <UpperLeftY>20037508.34</UpperLeftY>

        <LowerRightX>20037508.34</LowerRightX>

        <LowerRightY>-20037508.34</LowerRightY>

        <TileLevel>21</TileLevel>

        <TileCountX>1</TileCountX>

        <TileCountY>1</TileCountY>

        <YOrigin>bottom</YOrigin>

    </DataWindow>

    <Projection>EPSG:3857</Projection>

    <BlockSizeX>256</BlockSizeX>

    <BlockSizeY>256</BlockSizeY>

    <BandsCount>3</BandsCount>

    <Timeout>60</Timeout>

    <MaxConnections>4</MaxConnections>

    <ZeroBlockHttpCodes>204,404,500</ZeroBlockHttpCodes>

    <ZeroBlockOnServerException>true</ZeroBlockOnServerException>

</GDAL_WMS>


Now this file is same for this image urn for every query so query for black image pixel - SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&CRS=EPSG:3857&BBOX=-7081493.48537824768573046,5579761.67419921327382326,-7081372.5176363131031394,5579868.71160078886896372&WIDTH=1016&HEIGHT=899&LAYERS=PICT-NSPVSC22-OUKuEawvk2&STYLES=&EXCEPTIONS=XML&FORMAT=image/png&BGCOLOR=0xFEFFFF&TRANSPARENT=TRUE&

and for another zoom level where it's loading fine - SERVICE=WMS&VERSION=1.3.0&REQUEST=GetMap&CRS=EPSG:3857&BBOX=-7081500.20580835547298193,5579755.72767690382897854,-7081365.79720620531588793,5579874.65812309831380844&WIDTH=1016&HEIGHT=899&LAYERS=PICT-NSPVSC22-OUKuEawvk2&STYLES=&EXCEPTIONS=XML&FORMAT=image/png&BGCOLOR=0xFEFFFF&TRANSPARENT=TRUE&

Any idea on this?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240205/ed80c4f6/attachment.htm>

From mdsumner at gmail.com  Mon Feb  5 12:54:28 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Tue, 6 Feb 2024 07:54:28 +1100
Subject: [gdal-dev] core dump on dir info
In-Reply-To: <CADRrdKvRx6auqyzfKWde4+WVxDCdznUKdPq=+HuY3nxswG+xFg@mail.gmail.com>
References: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>
 <d98a03d5-6223-4ef1-8936-09557ca74ea5@spatialys.com>
 <CAAcGz99QWfbQ98mc950sZUfG-x4VHhcnJcqbSQ14-zFM++TRXQ@mail.gmail.com>
 <327573e0-7d8e-4271-8697-6cc71f53becd@spatialys.com>
 <CAAcGz986hs2HL8NgghNi6o8v-54rX1bffScDWdg2O=Gg07Xs8A@mail.gmail.com>
 <7519ff78-afde-4b80-a3fb-f7a55d2a487c@spatialys.com>
 <CAAcGz9_gWk6L6wrB+T2EQaHnRGUcOGRKeDj-jGNGr7npbPPuqg@mail.gmail.com>
 <dbe72a35-90ff-43c4-a542-4f675e65e499@spatialys.com>
 <CADRrdKvRx6auqyzfKWde4+WVxDCdznUKdPq=+HuY3nxswG+xFg@mail.gmail.com>
Message-ID: <CAAcGz9-hgCdmVaiPQ_HvqBLqAAECfAm-g_mFFf-JgiNShBYzOg@mail.gmail.com>

yes, jammy VM on openstack is the host (and is where I run pretty much
everything, though will increasingly use AWS).

Thanks for the note, I'll try on other systems too. We need a
security-allow set for vsicurl to work so if there are other little details
I'll be keen to flush them out.

Cheers, Mike

On Mon, 5 Feb 2024, 18:44 Javier Jimenez Shaw, <j1 at jimenezshaw.com> wrote:

> Hi Mike
>
> Out of curiosity, are run running it in a virtual machine?
> A few year ago I had problems running a program in a virtual machine
> (virtualbox, but I read it happens in others) due to a missing SSE
> instruction. The solution there was to "enable" the missing instructions in
> the virtual machine configuration (that I don't know why it was not the
> default).
>
> Cheers
>
>
> On Mon, 5 Feb 2024, 02:04 Even Rouault via gdal-dev, <
> gdal-dev at lists.osgeo.org> wrote:
>
>> ghcr.io/osgeo/gdal:ubuntu-full-latest has been regenerated with the
>> rebuild of TileDB without AVX2. I've also enabled the
>> drivers-with-external-depencies-built-as-plugin GDAL build mode, so it is
>> easy to just remove a given plugin by deleting the corresponding .so in
>> /usr/lib/x86_64-linux-gnu/gdalplugins
>>
>> Even
>> Le 04/02/2024 ? 22:51, Michael Sumner a ?crit :
>>
>> indeed there's no avx2:
>>
>> cat /proc/cpuinfo|grep sse|head -n 1
>> flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge
>> mca cmov pat pse36 clflush mmx fxsr sse sse2 syscall nx mmxext fxsr_opt
>> pdpe1gb rdtscp lm rep_good nopl cpuid extd_apicid tsc_known_freq pni
>> pclmulqdq ssse3 fma cx16 sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes
>> xsave avx f16c hypervisor lahf_lm cmp_legacy svm cr8_legacy abm sse4a
>> misalignsse 3dnowprefetch osvw xop fma4 tbm perfctr_core ssbd ibpb vmmcall
>> tsc_adjust bmi1 virt_ssbd arat npt nrip_save arch_capabilities
>>
>> Cheers, Mike
>>
>>
>>
>> On Sun, Feb 4, 2024 at 10:55?PM Even Rouault <even.rouault at spatialys.com>
>> wrote:
>>
>>> ok, so I believe this is the AVX2 issue I was talking about, as I
>>> realize that enabling AVX2 is the default mode when TileDB is built from
>>> source (which the Docker image does), and must be explicitly disabled with
>>> "./bootstrap --disable-avx2" (I've just changed the build recipe to include
>>> that, will take effect next time the images are refreshed)
>>>
>>> To confirm, can you send or just check the output of : cat
>>> /proc/cpuinfo|grep sse|head -n 1
>>>
>>> If there is no "avx2" in it, this is at 99.9% the reason of the issue.
>>>
>>> Even
>>> Le 04/02/2024 ? 06:20, Michael Sumner a ?crit :
>>>
>>> skipping TileDB does fix:
>>>
>>> ogr2ogr /tmp/newdir
>>> https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson -f
>>> "ESRI Shapefile"
>>> export GDAL_SKIP=TileDB
>>> ogrinfo /tmp/newdir/
>>> INFO: Open of `/tmp/newdir/'
>>>       using driver `ESRI Shapefile' successful.
>>> 1: geo_melbourne (Polygon)
>>>
>>> unset GDAL_SKIP
>>> ogrinfo /tmp/newdir/
>>> Illegal instruction (core dumped)
>>>
>>> I failed to explain that I'm using gdal containers from the repo:
>>>
>>> docker run --rm -ti ghcr.io/osgeo/gdal:ubunt
>>>
>>> u-full-latest
>>>
>>> apt update
>>> apt install -y gdb
>>>
>>> Here's the output of under gdb as you suggested, there was a lot so I
>>> put it on a gist:
>>> https://gist.github.com/mdsumner/839ae6e05ededf640b65bfee3a20a4c0
>>>
>>> gdb --args ogrinfo /tmp/newdir/
>>> > run
>>> > thread apply all bt
>>>
>>> Thanks!
>>>
>>>
>>>
>>>
>>>
>>> On Sat, Feb 3, 2024 at 7:49?PM Even Rouault <even.rouault at spatialys.com>
>>> wrote:
>>>
>>>> - When it crashes under gdb, type "thread apply all bt" to get the
>>>> stack trace of all threads
>>>>
>>>> - I suspect there is a connection with
>>>> https://github.com/OSGeo/gdal/pull/9170 , but that pull request
>>>> wouldn't help here as "/tmp/newdir" could be a valid connection to TileDB
>>>>
>>>> - how did you get TileDB installed? It looks to be packaged? Which
>>>> distribution do you use?
>>>>
>>>> - SIGILL reminds me of issues with some TileDB builds using the AVX2
>>>> instruction set by default, which could cause some crash on host CPUs that
>>>> don't have AVX2 (unlikely on recent hardware though)
>>>>
>>>> - Setting GDAL_SKIP=TileDB should be a workaround
>>>>
>>>>
>>>> Le 03/02/2024 ? 07:15, Michael Sumner a ?crit :
>>>>
>>>> Thanks Even, so there's something about tiledb under gdb (or maybe I am
>>>> mangling the context,  I will try variants of the host I'm using). Run with
>>>> valgrind included below.
>>>>
>>>> gdb --args ogrinfo /tmp/newdir/
>>>> ...
>>>> (gdb) run
>>>> Starting program: /usr/local/bin/ogrinfo /tmp/newdir/
>>>> [Thread debugging using libthread_db enabled]
>>>> Using host libthread_db library
>>>> "/lib/x86_64-linux-gnu/libthread_db.so.1".
>>>> [New Thread 0x7fffe7757640 (LWP 988)]
>>>> [New Thread 0x7fffe6f56640 (LWP 989)]
>>>> [New Thread 0x7fffde755640 (LWP 990)]
>>>> [New Thread 0x7fffd5f54640 (LWP 991)]
>>>> [New Thread 0x7fffc5753640 (LWP 992)]
>>>> [New Thread 0x7fffc4f52640 (LWP 993)]
>>>> [New Thread 0x7fffb4751640 (LWP 994)]
>>>> [New Thread 0x7fffabf50640 (LWP 995)]
>>>> [New Thread 0x7fffab74f640 (LWP 996)]
>>>> [New Thread 0x7fffa2f4e640 (LWP 997)]
>>>> [New Thread 0x7fff9a74d640 (LWP 998)]
>>>> [New Thread 0x7fff91f4c640 (LWP 999)]
>>>> [New Thread 0x7fff8974b640 (LWP 1000)]
>>>> [New Thread 0x7fff78f4a640 (LWP 1001)]
>>>> [New Thread 0x7fff78749640 (LWP 1002)]
>>>> [New Thread 0x7fff6f5ff640 (LWP 1003)]
>>>>
>>>> Thread 1 "ogrinfo" received signal SIGILL, Illegal instruction.
>>>> 0x00007ffff3773c9e in tiledb::common::ThreadPool::ThreadPool(unsigned
>>>> long) () from /lib/x86_64-linux-gnu/libtiledb.so.2.16
>>>>
>>>>
>>>>
>>>>
>>>> valgrind -s ogrinfo /tmp/newdir
>>>> ==704== Memcheck, a memory error detector
>>>> ==704== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.
>>>> ==704== Using Valgrind-3.18.1 and LibVEX; rerun with -h for copyright
>>>> info
>>>> ==704== Command: ogrinfo /tmp/newdir
>>>> ==704==
>>>> INFO: Open of `/tmp/newdir'
>>>>       using driver `ESRI Shapefile' successful.
>>>> 1: geo_melbourne (Polygon)
>>>> ==704==
>>>> ==704== HEAP SUMMARY:
>>>> ==704==     in use at exit: 25,486 bytes in 216 blocks
>>>> ==704==   total heap usage: 15,761 allocs, 15,545 frees, 2,390,169
>>>> bytes allocated
>>>> ==704==
>>>> ==704== LEAK SUMMARY:
>>>> ==704==    definitely lost: 0 bytes in 0 blocks
>>>> ==704==    indirectly lost: 0 bytes in 0 blocks
>>>> ==704==      possibly lost: 544 bytes in 1 blocks
>>>> ==704==    still reachable: 24,942 bytes in 215 blocks
>>>> ==704==         suppressed: 0 bytes in 0 blocks
>>>> ==704== Rerun with --leak-check=full to see details of leaked memory
>>>> ==704==
>>>> ==704== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)
>>>>
>>>>
>>>> ogrinfo /tmp/newdir
>>>> Illegal instruction (core dumped)
>>>>
>>>> Cheers, Mike
>>>>
>>>>
>>>>
>>>>
>>>> On Sat, Feb 3, 2024 at 12:46?PM Even Rouault <
>>>> even.rouault at spatialys.com> wrote:
>>>>
>>>>> Michael,
>>>>>
>>>>> I'm wondering if there not might be something wrong with your build or
>>>>> runtime environment. Or there's something subtle, because that works fine
>>>>> for me with my dev build or in the
>>>>> ghcr.io/osgeo/gdal:alpine-normal-3.8.3 Docker image
>>>>>
>>>>> Try running "valgrind ogrinfo /tmp/newdir/" or "gdb --args ogrinfo
>>>>> /tmp/newdir/" (type "run") to get more useful information
>>>>>
>>>>> Even
>>>>> Le 03/02/2024 ? 02:35, Michael Sumner via gdal-dev a ?crit :
>>>>>
>>>>> I'm getting Illegal instruction / core dumped on ogrinfo of a
>>>>> directory:
>>>>>
>>>>> ogr2ogr /tmp/newdir
>>>>> https://github.com/SymbolixAU/geojsonsf/raw/master/inst/examples/geo_melbourne.geojson
>>>>> -f "ESRI Shapefile"
>>>>>
>>>>> ogrinfo /tmp/newdir/
>>>>> Illegal instruction (core dumped)
>>>>>
>>>>> I've worked back through some docker images and it wasn't a problem in
>>>>> 3.6.0, but I'm getting it since 3.7.0 - or I'm doing something wrong
>>>>> entirely.
>>>>>
>>>>> Cheers, Mike
>>>>>
>>>>>
>>>>> --
>>>>> Michael Sumner
>>>>> Software and Database Engineer
>>>>> Australian Antarctic Division
>>>>> Hobart, Australia
>>>>> e-mail: mdsumner at gmail.com
>>>>>
>>>>> _______________________________________________
>>>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>
>>>>> -- http://www.spatialys.com
>>>>> My software is free, but my time generally not.
>>>>>
>>>>>
>>>>
>>>> --
>>>> Michael Sumner
>>>> Software and Database Engineer
>>>> Australian Antarctic Division
>>>> Hobart, Australia
>>>> e-mail: mdsumner at gmail.com
>>>>
>>>> -- http://www.spatialys.com
>>>> My software is free, but my time generally not.
>>>>
>>>>
>>>
>>> --
>>> Michael Sumner
>>> Software and Database Engineer
>>> Australian Antarctic Division
>>> Hobart, Australia
>>> e-mail: mdsumner at gmail.com
>>>
>>> -- http://www.spatialys.com
>>> My software is free, but my time generally not.
>>>
>>>
>>
>> --
>> Michael Sumner
>> Software and Database Engineer
>> Australian Antarctic Division
>> Hobart, Australia
>> e-mail: mdsumner at gmail.com
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240206/6dd4c5c3/attachment-0001.htm>

From aborruso at gmail.com  Mon Feb  5 15:00:09 2024
From: aborruso at gmail.com (andy)
Date: Tue, 6 Feb 2024 00:00:09 +0100
Subject: [gdal-dev] Compyle gdal >=3.7: lib2to3 error
Message-ID: <CAHEdGZM-wN5BmFw_JLO6zujwHYq5+KNTtHT9fzb8_WBez8Vo2Q@mail.gmail.com>

Hi,
I compile gdal 3.7 in this way:

mkdir -p build
cd build
cmake -D GDAL_USE_GEOS=ON -D OGR_ENABLE_DRIVER_PARQUET:BOOL=OFF -D
OGR_ENABLE_DRIVER_ARROW:BOOL=OFF ..
cmake --build .
sudo cmake --build . --target install

When I run "cmake --build ." I have this error:

Deprecated command line option: -py3. Ignored, this option is no longer
supported.
/usr/bin/python3.9: No module named lib2to3

How to solve this problem?

Thank you

-- 
___________________

Andrea Borruso
website: https://medium.com/tantotanto
38? 7' 48" N, 13? 21' 9" E, EPSG:4326
___________________

"cercare e saper riconoscere chi e cosa,
 in mezzo all?inferno, non ? inferno,
e farlo durare, e dargli spazio"

Italo Calvino
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240206/c207a637/attachment.htm>

From even.rouault at spatialys.com  Mon Feb  5 15:09:28 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 6 Feb 2024 00:09:28 +0100
Subject: [gdal-dev] Compyle gdal >=3.7: lib2to3 error
In-Reply-To: <CAHEdGZM-wN5BmFw_JLO6zujwHYq5+KNTtHT9fzb8_WBez8Vo2Q@mail.gmail.com>
References: <CAHEdGZM-wN5BmFw_JLO6zujwHYq5+KNTtHT9fzb8_WBez8Vo2Q@mail.gmail.com>
Message-ID: <3348e7d4-c7e2-482d-af89-c1a2dad8677d@spatialys.com>

Andrea,

Cf related https://github.com/OSGeo/gdal/pull/9174 that has been 
backported in 3.8 branch (not in release yet) and which will completely 
remove the use of lib2to3 in preparation of python 3.13 which will no 
longer provide it.

But you should probably be able to solve your issue by just installing 
the appropriate package which conveys lib2to3 since it is still part of 
python 3.9. This is dependent of your distro. On Debian, it is called 
"python3-lib2to3"

Een

Le 06/02/2024 ? 00:00, andy via gdal-dev a ?crit?:
> Hi,
> I compile gdal?3.7 in this way:
>
> mkdir -p build
> cd build
> cmake -D GDAL_USE_GEOS=ON -D OGR_ENABLE_DRIVER_PARQUET:BOOL=OFF -D 
> OGR_ENABLE_DRIVER_ARROW:BOOL=OFF ..
> cmake --build .
> sudo cmake --build . --target install
>
> When I run "cmake --build ." I have this error:
>
> Deprecated command line option: -py3. Ignored, this option is no 
> longer supported.
> /usr/bin/python3.9: No module named lib2to3
>
> How to solve this problem?
>
> Thank you
>
> -- 
> ___________________
>
> Andrea Borruso
> website: https://medium.com/tantotanto
> 38? 7' 48" N, 13? 21' 9" E, EPSG:4326
> ___________________
>
> "cercare e saper riconoscere chi e cosa,
> ?in mezzo all?inferno, non ? inferno,
> e farlo durare, e dargli spazio"
>
> Italo Calvino
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240206/87db0d2a/attachment.htm>

From aborruso at gmail.com  Mon Feb  5 15:15:04 2024
From: aborruso at gmail.com (andy)
Date: Tue, 6 Feb 2024 00:15:04 +0100
Subject: [gdal-dev] Compyle gdal >=3.7: lib2to3 error
In-Reply-To: <3348e7d4-c7e2-482d-af89-c1a2dad8677d@spatialys.com>
References: <CAHEdGZM-wN5BmFw_JLO6zujwHYq5+KNTtHT9fzb8_WBez8Vo2Q@mail.gmail.com>
 <3348e7d4-c7e2-482d-af89-c1a2dad8677d@spatialys.com>
Message-ID: <CAHEdGZP+3G5cT_uh66xWMrmD0YaxW=9UcdcYHS+d4HHq_MXFrg@mail.gmail.com>

Thank you Even,
Unfortunately, python 3.9 and 3.11 coexist on my system, and gdal is
compiled with 3.9.
In any case if I launch "python3," it launches Python 3.11.2. And to run
the 3.9 I must run "/usr/bin/python3.9".

If I can compile on 3.11, do I solve? And if so, is there a way to do it
and disregard 3.9?

Thank you


-- 
___________________

Andrea Borruso
website: https://medium.com/tantotanto
38? 7' 48" N, 13? 21' 9" E, EPSG:4326
___________________

"cercare e saper riconoscere chi e cosa,
 in mezzo all?inferno, non ? inferno,
e farlo durare, e dargli spazio"

Italo Calvino
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240206/1915f6e8/attachment.htm>

From afernandez at odyhpc.com  Mon Feb  5 14:23:20 2024
From: afernandez at odyhpc.com (afernandez)
Date: Mon, 05 Feb 2024 22:23:20 +0000
Subject: [gdal-dev] Running into GDAL ERROR 1
Message-ID: <378ceb51e4284.803113fc61cee@odyhpc.com>

Hello,
I've upgraded QGIS from v3.30 to v3.34. However, and when plotting the same 
raster layer, it is now generating the error: 
GDAL ERROR 1: Cannot invert geotransform
The geotransform value is (0.0, -3.88...e-11, 0, -6.402...e-10, 0, -0.0). 
QGIS is listing the GDAL version as 3.4.1, which is almost certainly 
upgraded from QGISv3.30, but I still cannot figure out why of the error in 
the newer version.
Thanks. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240205/82fba897/attachment.htm>

From afernandez at odyhpc.com  Mon Feb  5 15:07:05 2024
From: afernandez at odyhpc.com (afernandez)
Date: Mon, 05 Feb 2024 23:07:05 +0000
Subject: [gdal-dev] Please disregard my previous email (dx and dy are zeros)
Message-ID: <8572f04b0841e.fdf9d98db0d4e@odyhpc.com>

Hello, 
Please disregard my previous email (dx and dy are zeros). I apologize for 
sending it in a rush as it clearly is bound to fail when dx & dy =0.
Sorry about it.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240205/456be49f/attachment.htm>

From afernandez at odyhpc.com  Mon Feb  5 15:41:48 2024
From: afernandez at odyhpc.com (afernandez)
Date: Mon, 05 Feb 2024 23:41:48 +0000
Subject: [gdal-dev] Running into GDAL ERROR 1
References: <378ceb51e4284.803113fc61cee@odyhpc.com>
Message-ID: <0787c92aca0e.32589632e2e48@odyhpc.com>

Please disregard this thread as the error is caused by dx and dy are equal 
to zero (still need to check why the coordinates are resulting in these 
values).
afernandez via gdal-dev wrote:
Hello,
I've upgraded QGIS from v3.30 to v3.34. However, and when plotting the same 
raster layer, it is now generating the error: 
GDAL ERROR 1: Cannot invert geotransform
The geotransform value is (0.0, -3.88...e-11, 0, -6.402...e-10, 0, -0.0). 
QGIS is listing the GDAL version as 3.4.1, which is almost certainly 
upgraded from QGISv3.30, but I still cannot figure out why of the error in 
the newer version.
Thanks. 
Hello,
I've upgraded QGIS from v3.30 to v3.34. However, and when plotting the same 
raster layer, it is now generating the error: 
GDAL ERROR 1: Cannot invert geotransform
The geotransform value is (0.0, -3.88...e-11, 0, -6.402...e-10, 0, -0.0). 
QGIS is listing the GDAL version as 3.4.1, which is almost certainly 
upgraded from QGISv3.30, but I still cannot figure out why of the error in 
the newer version.
Thanks. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240205/6f4d5ee9/attachment-0001.htm>

From Marian.Hadri at rib-software.com  Tue Feb  6 02:17:01 2024
From: Marian.Hadri at rib-software.com (=?iso-8859-1?Q?Mari=E1n_Hadri?=)
Date: Tue, 6 Feb 2024 10:17:01 +0000
Subject: [gdal-dev] GDALClose() crash with ECW file
Message-ID: <AS8PR01MB85059B8DF906BE3994BF3314AE462@AS8PR01MB8505.eurprd01.prod.exchangelabs.com>

Hi,
I've built new gdal.dll (3.8.3) with ECW support. After calling function GDALClose(dataset);
there comes to crash. I changed nothing in GDAL, or ECW code,
I only call it, from my console appication. What could be a problem with it ?
I found in google, that similar problem ws there cca 15 years ago, but it was closed ...
Thanks in advance, Marian Hadri


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240206/f23f6284/attachment.htm>

From j1 at jimenezshaw.com  Tue Feb  6 05:46:24 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Tue, 6 Feb 2024 14:46:24 +0100
Subject: [gdal-dev] core dump on dir info
In-Reply-To: <CAAcGz9-hgCdmVaiPQ_HvqBLqAAECfAm-g_mFFf-JgiNShBYzOg@mail.gmail.com>
References: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>
 <d98a03d5-6223-4ef1-8936-09557ca74ea5@spatialys.com>
 <CAAcGz99QWfbQ98mc950sZUfG-x4VHhcnJcqbSQ14-zFM++TRXQ@mail.gmail.com>
 <327573e0-7d8e-4271-8697-6cc71f53becd@spatialys.com>
 <CAAcGz986hs2HL8NgghNi6o8v-54rX1bffScDWdg2O=Gg07Xs8A@mail.gmail.com>
 <7519ff78-afde-4b80-a3fb-f7a55d2a487c@spatialys.com>
 <CAAcGz9_gWk6L6wrB+T2EQaHnRGUcOGRKeDj-jGNGr7npbPPuqg@mail.gmail.com>
 <dbe72a35-90ff-43c4-a542-4f675e65e499@spatialys.com>
 <CADRrdKvRx6auqyzfKWde4+WVxDCdznUKdPq=+HuY3nxswG+xFg@mail.gmail.com>
 <CAAcGz9-hgCdmVaiPQ_HvqBLqAAECfAm-g_mFFf-JgiNShBYzOg@mail.gmail.com>
Message-ID: <CADRrdKtmLEj38PmaYSTmO4fzruLHEEdA_dFVNQQ1L89W8vUM2Q@mail.gmail.com>

Could you set up your VMs to include those SSE instructions? I think that
keeping VMs that "old" configured is a source of problems using
pre-compiled binaries.
The same way GDAL updates dependencies of compilers and other libraries to
something more modern (but not too modern), those SSE instructions should
be updated.

@Even knowing now that the "old" hardware is "virtually old", should we
remove AVX2 compatibility from ubuntu-full-latest? I do not know how much
is the performance impact.

Cheers,
Javier.

On Mon, 5 Feb 2024 at 21:54, Michael Sumner <mdsumner at gmail.com> wrote:

> yes, jammy VM on openstack is the host (and is where I run pretty much
> everything, though will increasingly use AWS).
>
> Thanks for the note, I'll try on other systems too. We need a
> security-allow set for vsicurl to work so if there are other little details
> I'll be keen to flush them out.
>
> Cheers, Mike
>
> On Mon, 5 Feb 2024, 18:44 Javier Jimenez Shaw, <j1 at jimenezshaw.com> wrote:
>
>> Hi Mike
>>
>> Out of curiosity, are run running it in a virtual machine?
>> A few year ago I had problems running a program in a virtual machine
>> (virtualbox, but I read it happens in others) due to a missing SSE
>> instruction. The solution there was to "enable" the missing instructions in
>> the virtual machine configuration (that I don't know why it was not the
>> default).
>>
>> Cheers
>>
>>
>> On Mon, 5 Feb 2024, 02:04 Even Rouault via gdal-dev, <
>> gdal-dev at lists.osgeo.org> wrote:
>>
>>> ghcr.io/osgeo/gdal:ubuntu-full-latest has been regenerated with the
>>> rebuild of TileDB without AVX2. I've also enabled the
>>> drivers-with-external-depencies-built-as-plugin GDAL build mode, so it is
>>> easy to just remove a given plugin by deleting the corresponding .so in
>>> /usr/lib/x86_64-linux-gnu/gdalplugins
>>>
>>> Even
>>> Le 04/02/2024 ? 22:51, Michael Sumner a ?crit :
>>>
>>> indeed there's no avx2:
>>>
>>> cat /proc/cpuinfo|grep sse|head -n 1
>>> flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge
>>> mca cmov pat pse36 clflush mmx fxsr sse sse2 syscall nx mmxext fxsr_opt
>>> pdpe1gb rdtscp lm rep_good nopl cpuid extd_apicid tsc_known_freq pni
>>> pclmulqdq ssse3 fma cx16 sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes
>>> xsave avx f16c hypervisor lahf_lm cmp_legacy svm cr8_legacy abm sse4a
>>> misalignsse 3dnowprefetch osvw xop fma4 tbm perfctr_core ssbd ibpb vmmcall
>>> tsc_adjust bmi1 virt_ssbd arat npt nrip_save arch_capabilities
>>>
>>> Cheers, Mike
>>>
>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240206/916ea3fc/attachment.htm>

From even.rouault at spatialys.com  Tue Feb  6 06:04:54 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 6 Feb 2024 15:04:54 +0100
Subject: [gdal-dev] core dump on dir info
In-Reply-To: <CADRrdKtmLEj38PmaYSTmO4fzruLHEEdA_dFVNQQ1L89W8vUM2Q@mail.gmail.com>
References: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>
 <d98a03d5-6223-4ef1-8936-09557ca74ea5@spatialys.com>
 <CAAcGz99QWfbQ98mc950sZUfG-x4VHhcnJcqbSQ14-zFM++TRXQ@mail.gmail.com>
 <327573e0-7d8e-4271-8697-6cc71f53becd@spatialys.com>
 <CAAcGz986hs2HL8NgghNi6o8v-54rX1bffScDWdg2O=Gg07Xs8A@mail.gmail.com>
 <7519ff78-afde-4b80-a3fb-f7a55d2a487c@spatialys.com>
 <CAAcGz9_gWk6L6wrB+T2EQaHnRGUcOGRKeDj-jGNGr7npbPPuqg@mail.gmail.com>
 <dbe72a35-90ff-43c4-a542-4f675e65e499@spatialys.com>
 <CADRrdKvRx6auqyzfKWde4+WVxDCdznUKdPq=+HuY3nxswG+xFg@mail.gmail.com>
 <CAAcGz9-hgCdmVaiPQ_HvqBLqAAECfAm-g_mFFf-JgiNShBYzOg@mail.gmail.com>
 <CADRrdKtmLEj38PmaYSTmO4fzruLHEEdA_dFVNQQ1L89W8vUM2Q@mail.gmail.com>
Message-ID: <5aaf13ca-591c-4cff-8603-d51a73b36ffd@spatialys.com>


Le 06/02/2024 ? 14:46, Javier Jimenez Shaw a ?crit?:
> Could you set up your VMs to include those SSE instructions?
I remember older VirtualBox versions indeed had issues to propage AVX to 
guest, but I believed that has been fixed now. I'm not aware of issues 
with SSEx not being propagate.
> I think that keeping VMs that "old" configured is a source of problems 
> using pre-compiled binaries.
> The same way GDAL updates dependencies of compilers and other 
> libraries to something more modern (but not too modern), those SSE 
> instructions should be updated.
>
> @Even knowing now that the "old" hardware is "virtually old", should 
> we remove AVX2 compatibility from ubuntu-full-latest? I do not know 
> how much is the performance impact.

Well, GDAL itself is built with default compiler flags, so only SSE2 on 
x86_64 (at least currently, but there seems to be a move by some distros 
to switch to SSE4.2 as the baseline)? (some parts of GDAL can use higher 
SSE or AVX instruction sets, but they only do so by checking first 
runtime CPU capabilities)

The tiledb issue was unfortunate in that its default config enables AVX2 
and you have to explicitly disable it. On the ubuntu-full image, we also 
use the Apache .deb for libarrow, and I believe they use SSE4.2.

Even


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From a.pau at creaf.uab.cat  Tue Feb  6 06:11:41 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Tue, 6 Feb 2024 14:11:41 +0000
Subject: [gdal-dev] Fields of type List to simple fields with N times
 the feature?
In-Reply-To: <ef4f83b6-64e9-4f7b-8a4f-b482112700c2@spatialys.com>
References: <PAXPR07MB777523F635DC737A9CAC177CA2702@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <b7ce4180-5e29-42cd-ba42-0f5ba84d22bd@spatialys.com>
 <ef4f83b6-64e9-4f7b-8a4f-b482112700c2@spatialys.com>
Message-ID: <PAXPR07MB7775523AB0CCEE467128F873A2462@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi Even,
I finally offer several options.
1.-Export as string list or integer list, o r whatever list;
2.- Export only the fisrt, second,... or last member of the list (it can be usefull sometimes)
3.- export the JSON format you comment in this mail.

Every user will be able to choose whatever he needs.
Thanks

De: Even Rouault <even.rouault at spatialys.com>
Enviado el: divendres, 19 de gener de 2024 17:16
Para: Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Fields of type List to simple fields with N times the feature?


Actually, an alternative would be that you type your list fields with type=OFTString and subtype=OFSTJSon, and emit a serialized JSON array (``[1,2]``). This is probably more in the spirit of nowadays uses, and that should make all output drivers happy (at worse they won't understand the JSON hint)

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240206/5385619a/attachment-0001.htm>

From lnicola at dend.ro  Tue Feb  6 06:25:51 2024
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Tue, 06 Feb 2024 16:25:51 +0200
Subject: [gdal-dev] core dump on dir info
In-Reply-To: <5aaf13ca-591c-4cff-8603-d51a73b36ffd@spatialys.com>
References: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>
 <d98a03d5-6223-4ef1-8936-09557ca74ea5@spatialys.com>
 <CAAcGz99QWfbQ98mc950sZUfG-x4VHhcnJcqbSQ14-zFM++TRXQ@mail.gmail.com>
 <327573e0-7d8e-4271-8697-6cc71f53becd@spatialys.com>
 <CAAcGz986hs2HL8NgghNi6o8v-54rX1bffScDWdg2O=Gg07Xs8A@mail.gmail.com>
 <7519ff78-afde-4b80-a3fb-f7a55d2a487c@spatialys.com>
 <CAAcGz9_gWk6L6wrB+T2EQaHnRGUcOGRKeDj-jGNGr7npbPPuqg@mail.gmail.com>
 <dbe72a35-90ff-43c4-a542-4f675e65e499@spatialys.com>
 <CADRrdKvRx6auqyzfKWde4+WVxDCdznUKdPq=+HuY3nxswG+xFg@mail.gmail.com>
 <CAAcGz9-hgCdmVaiPQ_HvqBLqAAECfAm-g_mFFf-JgiNShBYzOg@mail.gmail.com>
 <CADRrdKtmLEj38PmaYSTmO4fzruLHEEdA_dFVNQQ1L89W8vUM2Q@mail.gmail.com>
 <5aaf13ca-591c-4cff-8603-d51a73b36ffd@spatialys.com>
Message-ID: <7ea2321f-a662-441a-9bbb-85eaece433ea@betaapp.fastmail.com>

On Tue, Feb 6, 2024, at 16:04, Even Rouault via gdal-dev wrote:
> Le 06/02/2024 ? 14:46, Javier Jimenez Shaw a ?crit?:
> I remember older VirtualBox versions indeed had issues to propage AVX to 
> guest, but I believed that has been fixed now. I'm not aware of issues 
> with SSEx not being propagate.

Not the same thing, but I've seen a VM where loading numpy was crashing because of a misreported CPU model. OpenBLAS got "AMD Opteron 63xx class CPU" from CPUID and assumed FMA4 support without actually doing feature detection. But the CPU was actually an EPYC, which have no FMA4. I filed an issue against OpenBLAS, but they weren't interested in fixing it.

So it's still possible to get a misconfigured VM, especially if you're running an older libvirt. This was also on OpenStack AFAIK.

Laurentiu

From aborruso at gmail.com  Tue Feb  6 09:14:32 2024
From: aborruso at gmail.com (andy)
Date: Tue, 6 Feb 2024 18:14:32 +0100
Subject: [gdal-dev] Compyle gdal >=3.7: lib2to3 error
In-Reply-To: <3348e7d4-c7e2-482d-af89-c1a2dad8677d@spatialys.com>
References: <CAHEdGZM-wN5BmFw_JLO6zujwHYq5+KNTtHT9fzb8_WBez8Vo2Q@mail.gmail.com>
 <3348e7d4-c7e2-482d-af89-c1a2dad8677d@spatialys.com>
Message-ID: <CAHEdGZMOiNK0158Wbhp+K_PFJSXoVO3+YpSEA9KX3mBqRUpB0Q@mail.gmail.com>

Hi Even,

On Tue, 6 Feb 2024 at 00:09, Even Rouault <even.rouault at spatialys.com>
wrote:

> Cf related https://github.com/OSGeo/gdal/pull/9174 that has been
> backported in 3.8 branch (not in release yet) and which will completely
> remove the use of lib2to3 in preparation of python 3.13 which will no
> longer provide it.
>
can I try to compile  version  3.8 branch and see if I can overcome the
problem?

Or is it useless?

Thank you


-- 
___________________

Andrea Borruso
website: https://medium.com/tantotanto
38? 7' 48" N, 13? 21' 9" E, EPSG:4326
___________________

"cercare e saper riconoscere chi e cosa,
 in mezzo all?inferno, non ? inferno,
e farlo durare, e dargli spazio"

Italo Calvino
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240206/dcec7a02/attachment.htm>

From mdsumner at gmail.com  Tue Feb  6 16:40:53 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Wed, 7 Feb 2024 11:40:53 +1100
Subject: [gdal-dev] core dump on dir info
In-Reply-To: <CADRrdKtmLEj38PmaYSTmO4fzruLHEEdA_dFVNQQ1L89W8vUM2Q@mail.gmail.com>
References: <CAAcGz99z0ii4xO0adRs1L2TPh9Ud1NX1iF1n-T0ayqR6BiR-=g@mail.gmail.com>
 <d98a03d5-6223-4ef1-8936-09557ca74ea5@spatialys.com>
 <CAAcGz99QWfbQ98mc950sZUfG-x4VHhcnJcqbSQ14-zFM++TRXQ@mail.gmail.com>
 <327573e0-7d8e-4271-8697-6cc71f53becd@spatialys.com>
 <CAAcGz986hs2HL8NgghNi6o8v-54rX1bffScDWdg2O=Gg07Xs8A@mail.gmail.com>
 <7519ff78-afde-4b80-a3fb-f7a55d2a487c@spatialys.com>
 <CAAcGz9_gWk6L6wrB+T2EQaHnRGUcOGRKeDj-jGNGr7npbPPuqg@mail.gmail.com>
 <dbe72a35-90ff-43c4-a542-4f675e65e499@spatialys.com>
 <CADRrdKvRx6auqyzfKWde4+WVxDCdznUKdPq=+HuY3nxswG+xFg@mail.gmail.com>
 <CAAcGz9-hgCdmVaiPQ_HvqBLqAAECfAm-g_mFFf-JgiNShBYzOg@mail.gmail.com>
 <CADRrdKtmLEj38PmaYSTmO4fzruLHEEdA_dFVNQQ1L89W8vUM2Q@mail.gmail.com>
Message-ID: <CAAcGz98HjZJA7AceSxLL8bjYtOqbMUq6400hH+ENTAMK3Vs2rA@mail.gmail.com>

I don't understand how jammy is "old" when the full build is itself using
"BASE_IMAGE=ubuntu:22.04"

But, I'm out of my depth in these emails and trying to learn, thanks!

Cheers, Mike




On Wed, 7 Feb 2024, 00:46 Javier Jimenez Shaw, <j1 at jimenezshaw.com> wrote:

> Could you set up your VMs to include those SSE instructions? I think that
> keeping VMs that "old" configured is a source of problems using
> pre-compiled binaries.
> The same way GDAL updates dependencies of compilers and other libraries to
> something more modern (but not too modern), those SSE instructions should
> be updated.
>
> @Even knowing now that the "old" hardware is "virtually old", should we
> remove AVX2 compatibility from ubuntu-full-latest? I do not know how much
> is the performance impact.
>
> Cheers,
> Javier.
>
> On Mon, 5 Feb 2024 at 21:54, Michael Sumner <mdsumner at gmail.com> wrote:
>
>> yes, jammy VM on openstack is the host (and is where I run pretty much
>> everything, though will increasingly use AWS).
>>
>> Thanks for the note, I'll try on other systems too. We need a
>> security-allow set for vsicurl to work so if there are other little details
>> I'll be keen to flush them out.
>>
>> Cheers, Mike
>>
>> On Mon, 5 Feb 2024, 18:44 Javier Jimenez Shaw, <j1 at jimenezshaw.com>
>> wrote:
>>
>>> Hi Mike
>>>
>>> Out of curiosity, are run running it in a virtual machine?
>>> A few year ago I had problems running a program in a virtual machine
>>> (virtualbox, but I read it happens in others) due to a missing SSE
>>> instruction. The solution there was to "enable" the missing instructions in
>>> the virtual machine configuration (that I don't know why it was not the
>>> default).
>>>
>>> Cheers
>>>
>>>
>>> On Mon, 5 Feb 2024, 02:04 Even Rouault via gdal-dev, <
>>> gdal-dev at lists.osgeo.org> wrote:
>>>
>>>> ghcr.io/osgeo/gdal:ubuntu-full-latest has been regenerated with the
>>>> rebuild of TileDB without AVX2. I've also enabled the
>>>> drivers-with-external-depencies-built-as-plugin GDAL build mode, so it is
>>>> easy to just remove a given plugin by deleting the corresponding .so in
>>>> /usr/lib/x86_64-linux-gnu/gdalplugins
>>>>
>>>> Even
>>>> Le 04/02/2024 ? 22:51, Michael Sumner a ?crit :
>>>>
>>>> indeed there's no avx2:
>>>>
>>>> cat /proc/cpuinfo|grep sse|head -n 1
>>>> flags           : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge
>>>> mca cmov pat pse36 clflush mmx fxsr sse sse2 syscall nx mmxext fxsr_opt
>>>> pdpe1gb rdtscp lm rep_good nopl cpuid extd_apicid tsc_known_freq pni
>>>> pclmulqdq ssse3 fma cx16 sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes
>>>> xsave avx f16c hypervisor lahf_lm cmp_legacy svm cr8_legacy abm sse4a
>>>> misalignsse 3dnowprefetch osvw xop fma4 tbm perfctr_core ssbd ibpb vmmcall
>>>> tsc_adjust bmi1 virt_ssbd arat npt nrip_save arch_capabilities
>>>>
>>>> Cheers, Mike
>>>>
>>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240207/9878893a/attachment.htm>

From aborruso at gmail.com  Wed Feb  7 07:52:46 2024
From: aborruso at gmail.com (andy)
Date: Wed, 7 Feb 2024 16:52:46 +0100
Subject: [gdal-dev] Compyle gdal >=3.7: lib2to3 error
In-Reply-To: <CAHEdGZM-wN5BmFw_JLO6zujwHYq5+KNTtHT9fzb8_WBez8Vo2Q@mail.gmail.com>
References: <CAHEdGZM-wN5BmFw_JLO6zujwHYq5+KNTtHT9fzb8_WBez8Vo2Q@mail.gmail.com>
Message-ID: <CAHEdGZPvooi=5wewscpinxY_MLu=6vZMdczDcbiZxPO_sryX5w@mail.gmail.com>

Hi,
I have renamed my "/usr/bin/python3.9" and restarted all and I was able to
close the thing, because it only took '/usr/bin/python3.11' into account

Cheers



-- 
___________________

Andrea Borruso
website: https://medium.com/tantotanto
38? 7' 48" N, 13? 21' 9" E, EPSG:4326
___________________

"cercare e saper riconoscere chi e cosa,
 in mezzo all?inferno, non ? inferno,
e farlo durare, e dargli spazio"

Italo Calvino
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240207/418929ee/attachment.htm>

From j1 at jimenezshaw.com  Wed Feb  7 09:02:39 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Wed, 7 Feb 2024 18:02:39 +0100
Subject: [gdal-dev] axis order in gdal_translate
Message-ID: <CADRrdKvhe1E8_MK0Dk1MiGOLp2Sw+dzx4+OZKJhR43m1UxWK9w@mail.gmail.com>

Hi

I am calling the python method osgeo.gdal.VectorTranslate to convert a
GeoJSON (with CRS) to shapefile.
To keep consistency among EPSG versions, I have the pipeline of the
conversion, using what in pyproj was "always_xy=True"

            gdal.VectorTranslate(
                dst_file,
                src_file,
                coorindateOperation=coordinateOperation,
                dstSRS="EPSG:4326",
            )

with something like this:
coordinateOperation="+proj=pipeline +step +inv +proj=tmerc +lat_0=44
+lon_0=144.25 +k=0.9999 +x_0=0 +y_0=0 +ellps=GRS80 +step +proj=unitconvert
+xy_in=rad +xy_out=deg"

the srcSRS is taken automatically from the GeoJSON.

The first thing I noticed is that EPSG:4326 is left handed, and I have to
swap the axes. Ok, it is easy to add " +step +proj=axisswap +order=2,1"

In the case of EPSG:2455 (left handed CRS in Japan) I should do the swap
also for the input values, that is a bit uglier. (I have to do some parsing
of the pipeline that was generated time ago, and know that EPSG:2455 is
left handed).

Is there a way to tell gdal.VectorTranslate that transformation is
"always_xy", and I do not have to do the swaps manually? Or maybe there is
a better way to do it?

What about the command line gdal_translate?

Thank you.
Javier

.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240207/5e4686b3/attachment.htm>

From even.rouault at spatialys.com  Wed Feb  7 09:09:48 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 7 Feb 2024 18:09:48 +0100
Subject: [gdal-dev] axis order in gdal_translate
In-Reply-To: <CADRrdKvhe1E8_MK0Dk1MiGOLp2Sw+dzx4+OZKJhR43m1UxWK9w@mail.gmail.com>
References: <CADRrdKvhe1E8_MK0Dk1MiGOLp2Sw+dzx4+OZKJhR43m1UxWK9w@mail.gmail.com>
Message-ID: <55a68ab5-0083-4080-9273-47cca6337b50@spatialys.com>

Javier,
>
> Is there a way to tell gdal.VectorTranslate that transformation is 
> "always_xy", and I do not have to do the swaps manually? Or maybe 
> there is a better way to do it?

If you specify a pipeline, you need to make sure it is written in a way 
where its input coordinates are in the order of the input CRS and its 
output in the order of the axis of the output CRS. The rationale being 
that you copy&paste blindly a pipeline that projinfo -s FOO -t BAR would 
output.

https://gdal.org/programs/ogr2ogr.html#cmdoption-ogr2ogr-ct : "It must 
take into account the axis order of the source and target CRS."

There's no way to override this.

>
> What about the command line gdal_translate?

Same as ogr2ogr / gdal.VectorTranslate

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240207/569ca4d6/attachment.htm>

From sean.gillies at gmail.com  Wed Feb  7 09:13:06 2024
From: sean.gillies at gmail.com (Sean Gillies)
Date: Wed, 7 Feb 2024 10:13:06 -0700
Subject: [gdal-dev] What is the empty pixel value for datasets?
Message-ID: <CAOodmJqVBF-f0pX8B4-uQ-nbkfFq9v=pUt06ia0+BLrBEyYsKA@mail.gmail.com>

Hi all,

I haven't found a specification for the empty pixel value of datasets
created by, say, gdal_create. Is it format specific?

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240207/f2299246/attachment-0001.htm>

From even.rouault at spatialys.com  Wed Feb  7 09:26:28 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 7 Feb 2024 18:26:28 +0100
Subject: [gdal-dev] What is the empty pixel value for datasets?
In-Reply-To: <CAOodmJqVBF-f0pX8B4-uQ-nbkfFq9v=pUt06ia0+BLrBEyYsKA@mail.gmail.com>
References: <CAOodmJqVBF-f0pX8B4-uQ-nbkfFq9v=pUt06ia0+BLrBEyYsKA@mail.gmail.com>
Message-ID: <76cf03a9-d205-41a5-adc5-4e32d863add4@spatialys.com>

Hi Sean,

good question.

gdal_create just calls GDALCreate(), and doesn't "burn" any pixel value 
by itself, unless you use the -burn switch

Which brings the question to the behavior of GDALCreate() itself. And I 
don't think this is specified indeed and behavior will be driver dependant.

I would expect most "raw" drivers to zero initialize the dataset, 
typically by seeking to the (size of the file - 1)th byte and writing a 
single zero, and relying on sparse file mechanisms of operating systems 
to also zero-initialize the areas of the file not explicitly written.

A few "smart" drivers like the GTiff one will write the nodata value (or 
0 if no nodata explicitly set). Either physically in default mode, or in 
SPARSE_OK=YES mode, the reading side of the driver will consider that 
sparse tiles are initialized to nodata. The GPKG raster driver will also 
behave like that (it has actually an optimization that if you burn a 
tile to the nodata value, it will detect that and will not physically 
write it).? The ERDAS Imagine one also honours implicitly burning the 
nodata value.

Hopefully drivers should implement one of the above 2 behaviors. I'd 
consider it a bug of a driver if you get random garbage

Even

Le 07/02/2024 ? 18:13, Sean Gillies via gdal-dev a ?crit?:
> Hi all,
>
> I haven't found a specification for the empty pixel value of datasets 
> created by, say, gdal_create. Is it format specific?
>
> -- 
> Sean Gillies
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240207/988723fb/attachment.htm>

From j1 at jimenezshaw.com  Wed Feb  7 11:08:18 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Wed, 7 Feb 2024 20:08:18 +0100
Subject: [gdal-dev] axis order in gdal_translate
In-Reply-To: <55a68ab5-0083-4080-9273-47cca6337b50@spatialys.com>
References: <CADRrdKvhe1E8_MK0Dk1MiGOLp2Sw+dzx4+OZKJhR43m1UxWK9w@mail.gmail.com>
 <55a68ab5-0083-4080-9273-47cca6337b50@spatialys.com>
Message-ID: <CADRrdKtAQAG3HAzjCw_+wiUUES7bp9f23cg-K2VtWFr8u8zsuw@mail.gmail.com>

Thank you.

Yes, I got confused with gdal.VectorTranslate and gdal_translate, when I
really meant ogr2ogr. But you realized that already. Great catch.

On Wed, 7 Feb 2024 at 18:09, Even Rouault <even.rouault at spatialys.com>
wrote:

> Javier,
>
>
> Is there a way to tell gdal.VectorTranslate that transformation is
> "always_xy", and I do not have to do the swaps manually? Or maybe there is
> a better way to do it?
>
> If you specify a pipeline, you need to make sure it is written in a way
> where its input coordinates are in the order of the input CRS and its
> output in the order of the axis of the output CRS. The rationale being that
> you copy&paste blindly a pipeline that projinfo -s FOO -t BAR would output.
>
> https://gdal.org/programs/ogr2ogr.html#cmdoption-ogr2ogr-ct : "It must
> take into account the axis order of the source and target CRS."
>
> There's no way to override this.
>
>
> What about the command line gdal_translate?
>
> Same as ogr2ogr / gdal.VectorTranslate
>
> Even
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240207/731df03c/attachment.htm>

From scott at agi.com  Wed Feb  7 10:55:46 2024
From: scott at agi.com (Reynolds, Scott)
Date: Wed, 7 Feb 2024 18:55:46 +0000
Subject: [gdal-dev] WriteBlock() not supported using JP2ECW driver?
Message-ID: <BN2P110MB14326CAEB5A756C699E4A4FFA545A@BN2P110MB1432.NAMP110.PROD.OUTLOOK.COM>

Hi,

I'm trying to create a JPEG2000 file using the JP2ECW driver, but I'm getting "WriteBlock() not supported...".  The same code works using the PNM driver.

What am I missing?

Thanks,
Scott
Disclaimer

The information contained in this electronic message and any attachments to this message are intended only for the individual(s) addressed in the message and may contain proprietary and confidential information. If you are not the intended recipient, you should not disseminate, distribute or copy this e-mail. Please notify the sender and delete this message. WARNING: Computer viruses can be transmitted via email. The recipient should scan this email before opening it. The company accepts no liability for any damage caused by any virus transmitted by this email.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240207/e52e4905/attachment.htm>

From even.rouault at spatialys.com  Wed Feb  7 11:45:24 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 7 Feb 2024 20:45:24 +0100
Subject: [gdal-dev] WriteBlock() not supported using JP2ECW driver?
In-Reply-To: <BN2P110MB14326CAEB5A756C699E4A4FFA545A@BN2P110MB1432.NAMP110.PROD.OUTLOOK.COM>
References: <BN2P110MB14326CAEB5A756C699E4A4FFA545A@BN2P110MB1432.NAMP110.PROD.OUTLOOK.COM>
Message-ID: <0a893e59-4d5f-4df6-9264-502f683cd972@spatialys.com>

Scott,
>
> I?m trying to create a JPEG2000 file using the JP2ECW driver, but I?m 
> getting ?WriteBlock() not supported??.? The same code works using the 
> PNM driver.
>
> What am I missing?
>
This comment in the code 
https://github.com/OSGeo/gdal/blob/0255b1d767bbfc6910d8044e37019f1d1ea5a617/frmts/ecw/ecwcreatecopy.cpp#L1653 
which basically says that there's some form of Create() support in the 
JP2ECW driver but you need to write by scanline from top to bottom. The 
PNM, GTiff etc drivers implement full random-writing, which is what is 
required typically for gdalwarp. The workaround is either to modify the 
way you write the file (if you use the API), or if you use GDAL tools to 
write to an intermediate format (GeoTIFF) and then gdal_translate to 
JPEG2000 afterwards.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240207/0aa12b62/attachment.htm>

From even.rouault at spatialys.com  Wed Feb  7 12:16:44 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 7 Feb 2024 21:16:44 +0100
Subject: [gdal-dev] WriteBlock() not supported using JP2ECW driver?
In-Reply-To: <0a893e59-4d5f-4df6-9264-502f683cd972@spatialys.com>
References: <BN2P110MB14326CAEB5A756C699E4A4FFA545A@BN2P110MB1432.NAMP110.PROD.OUTLOOK.COM>
 <0a893e59-4d5f-4df6-9264-502f683cd972@spatialys.com>
Message-ID: <1099efba-1fa6-40de-ade2-36bfa55987a1@spatialys.com>

For future doc readers: https://github.com/OSGeo/gdal/pull/9211

Le 07/02/2024 ? 20:45, Even Rouault via gdal-dev a ?crit?:
> Scott,
>>
>> I?m trying to create a JPEG2000 file using the JP2ECW driver, but I?m 
>> getting ?WriteBlock() not supported??.? The same code works using the 
>> PNM driver.
>>
>> What am I missing?
>>
> This comment in the code 
> https://github.com/OSGeo/gdal/blob/0255b1d767bbfc6910d8044e37019f1d1ea5a617/frmts/ecw/ecwcreatecopy.cpp#L1653 
> which basically says that there's some form of Create() support in the 
> JP2ECW driver but you need to write by scanline from top to bottom. 
> The PNM, GTiff etc drivers implement full random-writing, which is 
> what is required typically for gdalwarp. The workaround is either to 
> modify the way you write the file (if you use the API), or if you use 
> GDAL tools to write to an intermediate format (GeoTIFF) and then 
> gdal_translate to JPEG2000 afterwards.
>
> Even
>
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240207/314cf49e/attachment.htm>

From arjan at bureauvoorarcheologie.nl  Thu Feb  8 00:24:09 2024
From: arjan at bureauvoorarcheologie.nl (Bureau voor Archeologie)
Date: Thu, 8 Feb 2024 09:24:09 +0100
Subject: [gdal-dev] ogr2ogr using PDF driver reports: ERROR 1: Max token
 stack size reached
Message-ID: <c700d5b3-88e8-4578-b399-7e9fd8a65f2b@bureauvoorarcheologie.nl>

I'm trying to convert a PDF with vector data into a shape with:

ogr2ogr test.shp Archeologische\ beleidskaart\ 2023.pdf? --config 
OGR_PDF_READ_NON_STRUCTURED YES

However, It gives the error: ERROR 1: Max token stack size reached

The sources are only converted partly, possibly because of this error. 
Might there be something wrong with my pdf source? Or can this be solved 
by setting some kind of config option when using the PDF driver?

Some additional info:
* I can't find information about setting the token stack size, nor can I 
find messages from others reporting this error.
* I found this error is coded in (sources gdal-3.8.3): 'pdfreadvectors.cpp'
* It's value is defined in gdal_pdf.h: #define TOKEN_STACK_SIZE 8
* this error also occurs when converting to other file format, like gml

Arjan.


-- 
Bureau voor Archeologie
Arjan de Boer
Koningsweg 244, Utrecht
030 245 1895


From even.rouault at spatialys.com  Thu Feb  8 03:48:51 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 8 Feb 2024 12:48:51 +0100
Subject: [gdal-dev] ogr2ogr using PDF driver reports: ERROR 1: Max token
 stack size reached
In-Reply-To: <c700d5b3-88e8-4578-b399-7e9fd8a65f2b@bureauvoorarcheologie.nl>
References: <c700d5b3-88e8-4578-b399-7e9fd8a65f2b@bureauvoorarcheologie.nl>
Message-ID: <a444a7ee-cc30-4785-a6f3-c68fbb197357@spatialys.com>

Arjan,


> I'm trying to convert a PDF with vector data into a shape with:
>
> ogr2ogr test.shp Archeologische\ beleidskaart\ 2023.pdf? --config 
> OGR_PDF_READ_NON_STRUCTURED YES
>
> However, It gives the error: ERROR 1: Max token stack size reached
>
> The sources are only converted partly, possibly because of this error. 
> Might there be something wrong with my pdf source? Or can this be 
> solved by setting some kind of config option when using the PDF driver?

This is likely an error/omission in pdfreadvectors.cpp itself. Parsing 
PDF is a complicated task. We'd need the PDF to further analyze

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Thu Feb  8 06:32:10 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 8 Feb 2024 15:32:10 +0100
Subject: [gdal-dev] ogr2ogr using PDF driver reports: ERROR 1: Max token
 stack size reached
In-Reply-To: <c700d5b3-88e8-4578-b399-7e9fd8a65f2b@bureauvoorarcheologie.nl>
References: <c700d5b3-88e8-4578-b399-7e9fd8a65f2b@bureauvoorarcheologie.nl>
Message-ID: <ede2f599-aae4-4b22-b6ed-a30997081a00@spatialys.com>

Fix in https://github.com/OSGeo/gdal/pull/9213 for the "max token stack 
size reached" error. However opening the resulting converted file 
doesn't show something that can be immediately correlated with the 
content of the PDF. It is likely that some geometry transformations are 
missed by the GDAL PDF vector interpreter.

Le 08/02/2024 ? 09:24, Bureau voor Archeologie via gdal-dev a ?crit?:
> I'm trying to convert a PDF with vector data into a shape with:
>
> ogr2ogr test.shp Archeologische\ beleidskaart\ 2023.pdf? --config 
> OGR_PDF_READ_NON_STRUCTURED YES
>
> However, It gives the error: ERROR 1: Max token stack size reached
>
> The sources are only converted partly, possibly because of this error. 
> Might there be something wrong with my pdf source? Or can this be 
> solved by setting some kind of config option when using the PDF driver?
>
> Some additional info:
> * I can't find information about setting the token stack size, nor can 
> I find messages from others reporting this error.
> * I found this error is coded in (sources gdal-3.8.3): 
> 'pdfreadvectors.cpp'
> * It's value is defined in gdal_pdf.h: #define TOKEN_STACK_SIZE 8
> * this error also occurs when converting to other file format, like gml
>
> Arjan.
>
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240208/b41266b9/attachment.htm>

From even.rouault at spatialys.com  Thu Feb  8 11:27:30 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 8 Feb 2024 20:27:30 +0100
Subject: [gdal-dev] GDAL 3.8.4 RC1 is available
Message-ID: <a4a411bd-667f-4f2d-9cc4-640768ed6ecf@spatialys.com>

Hi,

I have prepared a GDAL/OGR 3.8.4 release candidate. Nothing particularly 
urgent
to get into the wild, but we have a sizeable amounts of fixes since 
3.8.3, and
if I'm not wrong, it might be the last one to be candidate to go into 
the next
Ubuntu LTS.

Pick up an archive among the following ones (by ascending size):

 ? https://download.osgeo.org/gdal/3.8.4/gdal-3.8.4rc1.tar.xz
 ? https://download.osgeo.org/gdal/3.8.4/gdal-3.8.4rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.8.4/gdal384rc1.zip

A snapshot of the gdalautotest suite is also available:

https://download.osgeo.org/gdal/3.8.4/gdalautotest-3.8.4rc1.tar.gz
 ? https://download.osgeo.org/gdal/3.8.4/gdalautotest-3.8.4rc1.zip

The NEWS file is here:

 ? https://github.com/OSGeo/gdal/blob/v3.8.4RC1/NEWS.md

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Fri Feb  9 01:13:18 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 9 Feb 2024 10:13:18 +0100
Subject: [gdal-dev] Motion: Adopt GDAL 3.8.4RC1 as 3.8.4 release
Message-ID: <00bae3aa-bca9-42e1-9c99-c60bf9c0b734@spatialys.com>

Hi,

Motion:

Adopt GDAL 3.8.4RC1 as 3.8.4 release

Starting with my +1

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From a.pau at creaf.uab.cat  Fri Feb  9 01:55:02 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Fri, 9 Feb 2024 09:55:02 +0000
Subject: [gdal-dev] Testing the driver
Message-ID: <AS8PR07MB7766B7BD8750D12E3D01EC53A24B2@AS8PR07MB7766.eurprd07.prod.outlook.com>

Hi,
I am at the lasts steps before pulling a request about the MiraMon driver.
I need to write some documentation and formalize the tests.
After that, I'll do the pull request to github.

I am a little confused about the testing. I can use pytest or ctest, right? Which is the favourite? Are there any changes from the official documentation?
There is a minimal test to create?
Can you recommend me some driver that tests things like:

*         Read a point/arc/polygon layer from some format (gml,kml, gpckg,..) and assert the number of readed objectes

*         Read a point layer and assert some points (3d included) and some of the fields values

*         The same with arcs and polygons

*         Create some layer from the own format to anothers and compare the results with some "good" results.

*         Create multiple layers from one outer format (like gpx) and verify the name of the created files...

Thanks for any comment to testing.


Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/142838af/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/142838af/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/142838af/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/142838af/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/142838af/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/142838af/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/142838af/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/142838af/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/142838af/attachment-0003.jpg>

From even.rouault at spatialys.com  Fri Feb  9 02:47:43 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 9 Feb 2024 11:47:43 +0100
Subject: [gdal-dev] Testing the driver
In-Reply-To: <AS8PR07MB7766B7BD8750D12E3D01EC53A24B2@AS8PR07MB7766.eurprd07.prod.outlook.com>
References: <AS8PR07MB7766B7BD8750D12E3D01EC53A24B2@AS8PR07MB7766.eurprd07.prod.outlook.com>
Message-ID: <3049631d-5857-4338-bd4f-e37abe88da50@spatialys.com>

Abel,

Le 09/02/2024 ? 10:55, Abel Pau via gdal-dev a ?crit?:
>
> Hi,
>
> I am at the lasts steps before pulling a request about the MiraMon 
> driver.
> I need to write some documentation and formalize the tests.
>
> After that, I?ll do the pull request to github.
>
I'd suggest first before issuing the pull request that you push to your 
fork on github and look at the Actions tab. That will allow you to fix a 
lot of things on your side, before issuing the PR itself
>
> I am a little confused about the testing. I can use pytest or ctest, 
> right? Which is the favourite? Are there any changes from the official 
> documentation?
>
ctest is just the CMake way of launching the test suite. It will execute 
C++ tests of autotest/cpp directly, and for tests written in python will 
launch "pytest autotest/XXXXX" for each directory.

"ctest --test-dir $build_dir -R autotest_ogr -V"? will just run all the 
autotest/ogr tests, which can be quite long already.

To test your own development, you may have a more pleasant experience by 
directly running just the tests for your driver with something like 
"pytest autotest/ogr/ogr_miramon.py"? (be careful on Windows, the 
content of $build_dir/autotest is copied from $source_dir/autotest each 
time "cmake" is run, so if you edit your test .py file directly in the 
build directory, be super careful of not accidentally losing your work, 
and make sure to copy its content to the source directory first. That's 
admittedly an annoying point of the current test setup on Windows, 
compared to Unix where we use symbolic links)

after setting the environment to have PYTHONPATH point to something like 
$build_dir/swig/python/Release or $build_dir/swig/python/Debug (I 
believe you're on Windows?).? If you look at the first lines output by 
the above "ctest --test-dir $build_dir -R autotest_ogr -V" invokation, 
you'll actually see the PYTHONPATH value to specify.

You also need to first install pytest and other testing dependencies 
with: python -m pip install autotest/requirements.txt

> There is a minimal test to create?
>
A maximal test suite, you mean ;-) You should aim for a "reasonable" 
coverage of the code you wrote. Aiming to test the nominal code paths of 
your driver is desirable (testing the error cases generally requires a 
lot more effort).
>
> Can you recommend me some driver that tests things like:
>
> ?Read a point/arc/polygon layer from some format (gml,kml, gpckg,..) 
> and assert the number of readed objectes
>
> ?Read a point layer and assert some points (3d included) and some of 
> the fields values
>
> ?The same with arcs and polygons
>
> ?Create some layer from the own format to anothers and compare the 
> results with some ?good? results.
>
> ?Create multiple layers from one outer format (like gpx) and verify 
> the name of the created files...
>
You don't necessarily need to use other formats. It is actually better 
if the tests of a format don't depend too much on other formats, to keep 
things isolated.

To test the read part of your driver, add a autotest/ogr/data/miramon 
directory with *small* test files, ideally at most a few KB each to keep 
the size of the GDAL repository reasonable, and a few features in each 
is often enough to unit test, with different type of geometries, 
attributes, and use the OGR Python API to open the file and iterate over 
its layers and features to check their content. Those files should have 
ideally be produced by the Miramon software and not by the writing side 
of your driver, to check the interoperability of your driver with a 
"reference" software.

For the write site of the driver, you can for example run 
gdal.VectorTranslate(dest, source) on those files, and use again the 
test function to validate that the read side of your driver likes what 
the write site has produced. An alternative is also to do a binary 
comparison of the file generated by your driver with a reference test 
file stored in for example autotest/ogr/data/miramon/ref_output. But 
this may be sometimes a fragile approach if the output of your driver 
might change in the future (would require regenerating the reference 
test files).

I'd suggest your test suite also has a test that runs the "test_ogrsf" 
command line utility which is a kind of compliance test suite which 
checks a number of expectations for a driver, like that 
GetFeatureCount() returns the same number as iterating with 
GetNextFeature(), etc etc

It is difficult to point at a "reference" test suite, as all drivers 
have their particularities and may need specific tests. Potential 
sources of inspirations:

- autotest/ogr/ogr_gtfs.py? . Shows very simple testing of the read side 
of a driver, and includes a test_ogrsf test

- autotest/ogr/ogr_csv.py? has examples where the writing side of the 
driver is checked by opening the output file and checking that some 
strings are present in it (only easily doable with text based formats)

- autotest/ogr/ogr_openfilegdb_write.py . Extensive testing of the 
writing side of a driver . A lot in it will be specific to the format 
and irrelevant to your concern, but you should at least find all 
possible aspects of how to test the write side of a driver.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/78c677ab/attachment.htm>

From j1 at jimenezshaw.com  Fri Feb  9 03:20:53 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Fri, 9 Feb 2024 12:20:53 +0100
Subject: [gdal-dev] Motion: Adopt GDAL 3.8.4RC1 as 3.8.4 release
In-Reply-To: <00bae3aa-bca9-42e1-9c99-c60bf9c0b734@spatialys.com>
References: <00bae3aa-bca9-42e1-9c99-c60bf9c0b734@spatialys.com>
Message-ID: <CADRrdKu5p7O=V9RKBS4AGaFDGpCjFboJLCs4WE9Syh+YWQpMNw@mail.gmail.com>

+1 Javier

On Fri, 9 Feb 2024 at 10:13, Even Rouault via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> Motion:
>
> Adopt GDAL 3.8.4RC1 as 3.8.4 release
>
> Starting with my +1
>
> Even
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/97d8da86/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Fri Feb  9 06:04:13 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Fri, 9 Feb 2024 14:04:13 +0000
Subject: [gdal-dev] Motion: Adopt GDAL 3.8.4RC1 as 3.8.4 release
In-Reply-To: <00bae3aa-bca9-42e1-9c99-c60bf9c0b734@spatialys.com>
References: <00bae3aa-bca9-42e1-9c99-c60bf9c0b734@spatialys.com>
Message-ID: <DB9PR09MB6887806CF9933793FEA97533FD4B2@DB9PR09MB6887.eurprd09.prod.outlook.com>

+1

-Jukka Rahkonen-

-----Alkuper?inen viesti-----
L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault via gdal-dev
L?hetetty: perjantai 9. helmikuuta 2024 11.13
Vastaanottaja: gdal-dev at lists.osgeo.org
Aihe: [gdal-dev] Motion: Adopt GDAL 3.8.4RC1 as 3.8.4 release

Hi,

Motion:

Adopt GDAL 3.8.4RC1 as 3.8.4 release

Starting with my +1

Even


From jesse.r.meyer at nasa.gov  Fri Feb  9 06:31:49 2024
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Fri, 9 Feb 2024 14:31:49 +0000
Subject: [gdal-dev] GeoTiff JXL sample format & bits per sample restrictions?
Message-ID: <AA9F2D56-D46B-415B-82A2-D1E9551EA56D@ndc.nasa.gov>

We are trying to convert a 2 band int16 ZSTD compressed geotiff to JXL compression.  However for each band the following error message is given ?ERROR 1: GetJXLDataType:Unsupported combination of SampleFormat and BitsPerSample?.

On GDAL 3.8.3, released 2024/01/04.  JXL v0.9.2

gdal_translate -ot int16 -co "COMPRESS=JXL" -co "NUM_THREADS=8" -co "TILED=YES" -co "SPARSE_OK=YES" -
co "INTERLEAVE=BAND" -co "JXL_LOSSLESS=YES" in.tif out_JXL.tif

The docs state an encode limitation for GDAL < 3.6 wrt interleave and band counts.  We?re not subject to that, unless there?s a bug, but I do wonder if we have nonetheless gone off the support path with band interleave with 2 bands?

Jesse
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/cc692f23/attachment.htm>

From thomas.bonfort at gmail.com  Fri Feb  9 06:33:15 2024
From: thomas.bonfort at gmail.com (thomas bonfort)
Date: Fri, 9 Feb 2024 15:33:15 +0100
Subject: [gdal-dev] GeoTiff JXL sample format & bits per sample
 restrictions?
In-Reply-To: <AA9F2D56-D46B-415B-82A2-D1E9551EA56D@ndc.nasa.gov>
References: <AA9F2D56-D46B-415B-82A2-D1E9551EA56D@ndc.nasa.gov>
Message-ID: <CAOM3y2ggjZps-WhRE1ZA2pRf1DSJV41QDM2_J+P4AH7CGsrAWg@mail.gmail.com>

could you share the output of "gdalinfo in.tif" please?

On Fri, Feb 9, 2024 at 3:32?PM Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS
AND APPLICATIONS INC] via gdal-dev <gdal-dev at lists.osgeo.org> wrote:

> We are trying to convert a 2 band int16 ZSTD compressed geotiff to JXL
> compression.  However for each band the following error message is given
> ?ERROR 1: GetJXLDataType:Unsupported combination of SampleFormat and
> BitsPerSample?.
>
>
>
> On GDAL 3.8.3, released 2024/01/04.  JXL v0.9.2
>
>
>
> gdal_translate -ot int16 -co "COMPRESS=JXL" -co "NUM_THREADS=8" -co
> "TILED=YES" -co "SPARSE_OK=YES" -
>
> co "INTERLEAVE=BAND" -co "JXL_LOSSLESS=YES" in.tif out_JXL.tif
>
>
>
> The docs state an encode limitation for GDAL < 3.6 wrt interleave and band
> counts.  We?re not subject to that, unless there?s a bug, but I do wonder
> if we have nonetheless gone off the support path with band interleave with
> 2 bands?
>
>
>
> Jesse
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/36392c79/attachment.htm>

From jesse.r.meyer at nasa.gov  Fri Feb  9 06:36:49 2024
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Fri, 9 Feb 2024 14:36:49 +0000
Subject: [gdal-dev] [EXTERNAL] Re: GeoTiff JXL sample format & bits per
 sample restrictions?
In-Reply-To: <CAOM3y2ggjZps-WhRE1ZA2pRf1DSJV41QDM2_J+P4AH7CGsrAWg@mail.gmail.com>
References: <AA9F2D56-D46B-415B-82A2-D1E9551EA56D@ndc.nasa.gov>
 <CAOM3y2ggjZps-WhRE1ZA2pRf1DSJV41QDM2_J+P4AH7CGsrAWg@mail.gmail.com>
Message-ID: <B2BB1097-B0C3-4730-A426-E00977E64024@ndc.nasa.gov>

Gladly,

Driver: GTiff/GeoTIFF
Files: in.tif
Size is 32000, 32000
Coordinate System is:
PROJCRS["Africa_Albers_Equal_Area_Conic",
    BASEGEOGCRS["WGS 84",
        DATUM["World Geodetic System 1984",
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["Albers Equal Area",
        METHOD["Albers Equal Area",
            ID["EPSG",9822]],
        PARAMETER["Latitude of false origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8821]],
        PARAMETER["Longitude of false origin",25,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8822]],
        PARAMETER["Latitude of 1st standard parallel",20,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8823]],
        PARAMETER["Latitude of 2nd standard parallel",-23,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8824]],
        PARAMETER["Easting at false origin",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8826]],
        PARAMETER["Northing at false origin",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8827]]],
    CS[Cartesian,2],
        AXIS["easting",east,
            ORDER[1],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]],
        AXIS["northing",north,
            ORDER[2],
            LENGTHUNIT["metre",1,
                ID["EPSG",9001]]]]
Data axis to CRS axis mapping: 1,2
Origin = (-3800000.000000000000000,1928000.000000000000000)
Pixel Size = (0.500000000000000,-0.500000000000000)
Metadata:
  ACQDATE=2010-11-26 11:20:06.338865
  AREA_OR_POINT=Area
  CAT_ID=1050410001250C00
  CHIRPS=214.43
  CLOUDCOVER=0.0
  CLOUD_FRAC=0.0
  IMAGENAME=redacted.ntf
  MAX_AOD=0.233
  OFF_NADIR=11.8
  RESOLUTION=0.5
  RF_ADD=0.0
  RF_MULT=2000.0
  SAT_AZ=185.9
  SAT_ELEV=76.8
  SENSOR=GE01
  SUN_AZ=154.2
  SUN_ELEV=48.5
  TDI=16.0
Image Structure Metadata:
  COMPRESSION=ZSTD
  INTERLEAVE=BAND
  PREDICTOR=2
Corner Coordinates:
Upper Left  (-3800000.000, 1928000.000) ( 11d22' 1.85"W, 16d47' 0.21"N)
Lower Left  (-3800000.000, 1912000.000) ( 11d22'10.38"W, 16d38'30.31"N)
Upper Right (-3784000.000, 1928000.000) ( 11d12'50.68"W, 16d46'52.33"N)
Lower Right (-3784000.000, 1912000.000) ( 11d12'59.18"W, 16d38'22.44"N)
Center      (-3792000.000, 1920000.000) ( 11d17'30.52"W, 16d42'41.27"N)
Band 1 Block=256x256 Type=UInt16, ColorInterp=Gray
  Description = Panchromatic
  Min=1.000 Max=1734.000
  Minimum=1.000, Maximum=1734.000, Mean=489.009, StdDev=65.409
  NoData Value=0
  Metadata:
    STATISTICS_MAXIMUM=1734
    STATISTICS_MEAN=489.00875598419
    STATISTICS_MINIMUM=1
    STATISTICS_STDDEV=65.408895074611
    STATISTICS_VALID_PERCENT=99.999
Band 2 Block=256x256 Type=UInt16, ColorInterp=Undefined
  Description = NDVI
  Min=582.000 Max=1781.000
  Minimum=582.000, Maximum=1781.000, Mean=1103.895, StdDev=61.554
  NoData Value=0
  Metadata:
    STATISTICS_MAXIMUM=1781
    STATISTICS_MEAN=1103.8951663354
    STATISTICS_MINIMUM=582
    STATISTICS_STDDEV=61.553712802204
    STATISTICS_VALID_PERCENT=99.99

From: thomas bonfort <thomas.bonfort at gmail.com>
Date: Friday, February 9, 2024 at 9:33?AM
To: "Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC]" <jesse.r.meyer at nasa.gov>
Cc: "gdal-dev at lists.osgeo.org" <gdal-dev at lists.osgeo.org>
Subject: [EXTERNAL] Re: [gdal-dev] GeoTiff JXL sample format & bits per sample restrictions?

CAUTION: This email originated from outside of NASA.  Please take care when clicking links or opening attachments.  Use the "Report Message" button to report suspicious messages to the NASA SOC.


could you share the output of "gdalinfo in.tif" please?

On Fri, Feb 9, 2024 at 3:32?PM Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
We are trying to convert a 2 band int16 ZSTD compressed geotiff to JXL compression.  However for each band the following error message is given ?ERROR 1: GetJXLDataType:Unsupported combination of SampleFormat and BitsPerSample?.

On GDAL 3.8.3, released 2024/01/04.  JXL v0.9.2

gdal_translate -ot int16 -co "COMPRESS=JXL" -co "NUM_THREADS=8" -co "TILED=YES" -co "SPARSE_OK=YES" -
co "INTERLEAVE=BAND" -co "JXL_LOSSLESS=YES" in.tif out_JXL.tif

The docs state an encode limitation for GDAL < 3.6 wrt interleave and band counts.  We?re not subject to that, unless there?s a bug, but I do wonder if we have nonetheless gone off the support path with band interleave with 2 bands?

Jesse
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/777158bc/attachment-0001.htm>

From thomas.bonfort at gmail.com  Fri Feb  9 06:36:49 2024
From: thomas.bonfort at gmail.com (thomas bonfort)
Date: Fri, 9 Feb 2024 15:36:49 +0100
Subject: [gdal-dev] GeoTiff JXL sample format & bits per sample
 restrictions?
In-Reply-To: <AA9F2D56-D46B-415B-82A2-D1E9551EA56D@ndc.nasa.gov>
References: <AA9F2D56-D46B-415B-82A2-D1E9551EA56D@ndc.nasa.gov>
Message-ID: <CAOM3y2gtO5KQGEhCnddKeWnTW28237UCXDzfdH58m0wQUbbNLQ@mail.gmail.com>

JXL in tiff should support the 2 band case correctly. What is not supported
here is the int16 datatype. Only uint8, uint16 and float32 are supported.

TB

On Fri, Feb 9, 2024 at 3:32?PM Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS
AND APPLICATIONS INC] via gdal-dev <gdal-dev at lists.osgeo.org> wrote:

> We are trying to convert a 2 band int16 ZSTD compressed geotiff to JXL
> compression.  However for each band the following error message is given
> ?ERROR 1: GetJXLDataType:Unsupported combination of SampleFormat and
> BitsPerSample?.
>
>
>
> On GDAL 3.8.3, released 2024/01/04.  JXL v0.9.2
>
>
>
> gdal_translate -ot int16 -co "COMPRESS=JXL" -co "NUM_THREADS=8" -co
> "TILED=YES" -co "SPARSE_OK=YES" -
>
> co "INTERLEAVE=BAND" -co "JXL_LOSSLESS=YES" in.tif out_JXL.tif
>
>
>
> The docs state an encode limitation for GDAL < 3.6 wrt interleave and band
> counts.  We?re not subject to that, unless there?s a bug, but I do wonder
> if we have nonetheless gone off the support path with band interleave with
> 2 bands?
>
>
>
> Jesse
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/bfae4df5/attachment.htm>

From jesse.r.meyer at nasa.gov  Fri Feb  9 06:38:45 2024
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Fri, 9 Feb 2024 14:38:45 +0000
Subject: [gdal-dev] [EXTERNAL] Re: GeoTiff JXL sample format & bits per
 sample restrictions?
In-Reply-To: <CAOM3y2gtO5KQGEhCnddKeWnTW28237UCXDzfdH58m0wQUbbNLQ@mail.gmail.com>
References: <AA9F2D56-D46B-415B-82A2-D1E9551EA56D@ndc.nasa.gov>
 <CAOM3y2gtO5KQGEhCnddKeWnTW28237UCXDzfdH58m0wQUbbNLQ@mail.gmail.com>
Message-ID: <D9B7A097-37D4-4C3C-8729-EF06B41CEEE1@ndc.nasa.gov>

We can work with the Uint16 case.  These dtype limitations should be listed on the gtiff docs presumably.

From: thomas bonfort <thomas.bonfort at gmail.com>
Date: Friday, February 9, 2024 at 9:37?AM
To: "Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC]" <jesse.r.meyer at nasa.gov>
Cc: "gdal-dev at lists.osgeo.org" <gdal-dev at lists.osgeo.org>
Subject: [EXTERNAL] Re: [gdal-dev] GeoTiff JXL sample format & bits per sample restrictions?

CAUTION: This email originated from outside of NASA.  Please take care when clicking links or opening attachments.  Use the "Report Message" button to report suspicious messages to the NASA SOC.


JXL in tiff should support the 2 band case correctly. What is not supported here is the int16 datatype. Only uint8, uint16 and float32 are supported.

TB

On Fri, Feb 9, 2024 at 3:32?PM Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
We are trying to convert a 2 band int16 ZSTD compressed geotiff to JXL compression.  However for each band the following error message is given ?ERROR 1: GetJXLDataType:Unsupported combination of SampleFormat and BitsPerSample?.

On GDAL 3.8.3, released 2024/01/04.  JXL v0.9.2

gdal_translate -ot int16 -co "COMPRESS=JXL" -co "NUM_THREADS=8" -co "TILED=YES" -co "SPARSE_OK=YES" -
co "INTERLEAVE=BAND" -co "JXL_LOSSLESS=YES" in.tif out_JXL.tif

The docs state an encode limitation for GDAL < 3.6 wrt interleave and band counts.  We?re not subject to that, unless there?s a bug, but I do wonder if we have nonetheless gone off the support path with band interleave with 2 bands?

Jesse
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/2ca5c312/attachment.htm>

From thomas.bonfort at gmail.com  Fri Feb  9 06:49:47 2024
From: thomas.bonfort at gmail.com (thomas bonfort)
Date: Fri, 9 Feb 2024 15:49:47 +0100
Subject: [gdal-dev] [EXTERNAL] Re: GeoTiff JXL sample format & bits per
 sample restrictions?
In-Reply-To: <D9B7A097-37D4-4C3C-8729-EF06B41CEEE1@ndc.nasa.gov>
References: <AA9F2D56-D46B-415B-82A2-D1E9551EA56D@ndc.nasa.gov>
 <CAOM3y2gtO5KQGEhCnddKeWnTW28237UCXDzfdH58m0wQUbbNLQ@mail.gmail.com>
 <D9B7A097-37D4-4C3C-8729-EF06B41CEEE1@ndc.nasa.gov>
Message-ID: <CAOM3y2h8Y4i6pYrs8YSVNqB=Cta16krL-BKNmAPQhXgiFjvJqg@mail.gmail.com>

doc update PR in https://github.com/OSGeo/gdal/pull/9220

On Fri, Feb 9, 2024 at 3:38?PM Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS
AND APPLICATIONS INC] <jesse.r.meyer at nasa.gov> wrote:

> We can work with the Uint16 case.  These dtype limitations should be
> listed on the gtiff docs presumably.
>
>
>
> *From: *thomas bonfort <thomas.bonfort at gmail.com>
> *Date: *Friday, February 9, 2024 at 9:37?AM
> *To: *"Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS
> INC]" <jesse.r.meyer at nasa.gov>
> *Cc: *"gdal-dev at lists.osgeo.org" <gdal-dev at lists.osgeo.org>
> *Subject: *[EXTERNAL] Re: [gdal-dev] GeoTiff JXL sample format & bits per
> sample restrictions?
>
>
>
> *CAUTION:* This email originated from outside of NASA.  Please take care
> when clicking links or opening attachments.  Use the "Report Message"
> button to report suspicious messages to the NASA SOC.
>
>
>
> JXL in tiff should support the 2 band case correctly. What is not
> supported here is the int16 datatype. Only uint8, uint16 and float32 are
> supported.
>
>
>
> TB
>
>
>
> On Fri, Feb 9, 2024 at 3:32?PM Meyer, Jesse R. (GSFC-618.0)[SCIENCE
> SYSTEMS AND APPLICATIONS INC] via gdal-dev <gdal-dev at lists.osgeo.org>
> wrote:
>
> We are trying to convert a 2 band int16 ZSTD compressed geotiff to JXL
> compression.  However for each band the following error message is given
> ?ERROR 1: GetJXLDataType:Unsupported combination of SampleFormat and
> BitsPerSample?.
>
>
>
> On GDAL 3.8.3, released 2024/01/04.  JXL v0.9.2
>
>
>
> gdal_translate -ot int16 -co "COMPRESS=JXL" -co "NUM_THREADS=8" -co
> "TILED=YES" -co "SPARSE_OK=YES" -
>
> co "INTERLEAVE=BAND" -co "JXL_LOSSLESS=YES" in.tif out_JXL.tif
>
>
>
> The docs state an encode limitation for GDAL < 3.6 wrt interleave and band
> counts.  We?re not subject to that, unless there?s a bug, but I do wonder
> if we have nonetheless gone off the support path with band interleave with
> 2 bands?
>
>
>
> Jesse
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/3c3fb815/attachment-0001.htm>

From jesse.r.meyer at nasa.gov  Fri Feb  9 06:59:46 2024
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Fri, 9 Feb 2024 14:59:46 +0000
Subject: [gdal-dev] [EXTERNAL] Re: GeoTiff JXL sample format & bits per
 sample restrictions?
In-Reply-To: <CAOM3y2h8Y4i6pYrs8YSVNqB=Cta16krL-BKNmAPQhXgiFjvJqg@mail.gmail.com>
References: <AA9F2D56-D46B-415B-82A2-D1E9551EA56D@ndc.nasa.gov>
 <CAOM3y2gtO5KQGEhCnddKeWnTW28237UCXDzfdH58m0wQUbbNLQ@mail.gmail.com>
 <D9B7A097-37D4-4C3C-8729-EF06B41CEEE1@ndc.nasa.gov>
 <CAOM3y2h8Y4i6pYrs8YSVNqB=Cta16krL-BKNmAPQhXgiFjvJqg@mail.gmail.com>
Message-ID: <220751CA-DD95-49C3-865F-26B1FFB627E9@ndc.nasa.gov>

Thanks TB!

From: thomas bonfort <thomas.bonfort at gmail.com>
Date: Friday, February 9, 2024 at 9:50?AM
To: "Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC]" <jesse.r.meyer at nasa.gov>
Cc: "gdal-dev at lists.osgeo.org" <gdal-dev at lists.osgeo.org>
Subject: Re: [EXTERNAL] Re: [gdal-dev] GeoTiff JXL sample format & bits per sample restrictions?

CAUTION: This email originated from outside of NASA.  Please take care when clicking links or opening attachments.  Use the "Report Message" button to report suspicious messages to the NASA SOC.


doc update PR in https://github.com/OSGeo/gdal/pull/9220

On Fri, Feb 9, 2024 at 3:38?PM Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] <jesse.r.meyer at nasa.gov<mailto:jesse.r.meyer at nasa.gov>> wrote:
We can work with the Uint16 case.  These dtype limitations should be listed on the gtiff docs presumably.

From: thomas bonfort <thomas.bonfort at gmail.com<mailto:thomas.bonfort at gmail.com>>
Date: Friday, February 9, 2024 at 9:37?AM
To: "Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC]" <jesse.r.meyer at nasa.gov<mailto:jesse.r.meyer at nasa.gov>>
Cc: "gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>" <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>>
Subject: [EXTERNAL] Re: [gdal-dev] GeoTiff JXL sample format & bits per sample restrictions?

CAUTION: This email originated from outside of NASA.  Please take care when clicking links or opening attachments.  Use the "Report Message" button to report suspicious messages to the NASA SOC.

JXL in tiff should support the 2 band case correctly. What is not supported here is the int16 datatype. Only uint8, uint16 and float32 are supported.

TB

On Fri, Feb 9, 2024 at 3:32?PM Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
We are trying to convert a 2 band int16 ZSTD compressed geotiff to JXL compression.  However for each band the following error message is given ?ERROR 1: GetJXLDataType:Unsupported combination of SampleFormat and BitsPerSample?.

On GDAL 3.8.3, released 2024/01/04.  JXL v0.9.2

gdal_translate -ot int16 -co "COMPRESS=JXL" -co "NUM_THREADS=8" -co "TILED=YES" -co "SPARSE_OK=YES" -
co "INTERLEAVE=BAND" -co "JXL_LOSSLESS=YES" in.tif out_JXL.tif

The docs state an encode limitation for GDAL < 3.6 wrt interleave and band counts.  We?re not subject to that, unless there?s a bug, but I do wonder if we have nonetheless gone off the support path with band interleave with 2 bands?

Jesse
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/62787236/attachment.htm>

From stephenknox73 at gmail.com  Fri Feb  9 07:10:18 2024
From: stephenknox73 at gmail.com (Stephen Knox)
Date: Fri, 9 Feb 2024 15:10:18 +0000
Subject: [gdal-dev] gdal_fillnodata - odd artifacts
Message-ID: <CAFkojsZZtBeXbmWYYCaHmoWfWXnsJERBoaFo6C0uuPg9ixwyVg@mail.gmail.com>

Hi all,

I'm seeing an odd artifact when using gdal_fillnodata.py.

My source raster is (https://i.stack.imgur.com/t42tR.png)
(purple is no data, white and black are two different numeric values).

Using a mask exactly corresponding to the no data pixels (i.e. all no
data pixels are set to 0 in the mask raster, and all others set to 1)
and running the following command:

gdal_fillnodata.py -md 20 -mask path_to_mask.tif path_to_raster.tif output.tif

I get the following output: https://i.stack.imgur.com/S6UYm.png

The thing I am confused about is the rectangular area of slightly
lighter pixels to the bottom left of the image - it seems very
uniform, and I can't see anything obvious in the source raster that
would cause that. It does become less prominent when smoothing is
used, but the anomaly is still there.

Is this an expected artefact of the algorithm, or potentially a bug?

Source image: https://drive.google.com/file/d/1xyGZE3alZxvutHGb_F7zs-bOjFAZQZis/view?usp=drive_link

Mask image: https://drive.google.com/file/d/14H9ZIb29dZ3j-dxkGfXONVgByZn5TsY1/view?usp=drive_link

Result image: https://drive.google.com/file/d/1Sb4bQv7hDfUDfziQtpgVKYKvrkotPghE/view?usp=drive_link

From howard at hobu.co  Fri Feb  9 07:29:41 2024
From: howard at hobu.co (Howard Butler)
Date: Fri, 9 Feb 2024 09:29:41 -0600
Subject: [gdal-dev] Motion: Adopt GDAL 3.8.4RC1 as 3.8.4 release
In-Reply-To: <DB9PR09MB6887806CF9933793FEA97533FD4B2@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <00bae3aa-bca9-42e1-9c99-c60bf9c0b734@spatialys.com>
 <DB9PR09MB6887806CF9933793FEA97533FD4B2@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <4A4BD865-B13F-43BC-88A1-9C2038EDEBED@hobu.co>

+1

Howard

> On Feb 9, 2024, at 8:04?AM, Rahkonen Jukka via gdal-dev <gdal-dev at lists.osgeo.org> wrote:
> 
> +1
> 
> -Jukka Rahkonen-
> 
> -----Alkuper?inen viesti-----
> L?hett?j?: gdal-dev <gdal-dev-bounces at lists.osgeo.org> Puolesta Even Rouault via gdal-dev
> L?hetetty: perjantai 9. helmikuuta 2024 11.13
> Vastaanottaja: gdal-dev at lists.osgeo.org
> Aihe: [gdal-dev] Motion: Adopt GDAL 3.8.4RC1 as 3.8.4 release
> 
> Hi,
> 
> Motion:
> 
> Adopt GDAL 3.8.4RC1 as 3.8.4 release
> 
> Starting with my +1
> 
> Even
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev


From jesse.r.meyer at nasa.gov  Fri Feb  9 09:13:33 2024
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Fri, 9 Feb 2024 17:13:33 +0000
Subject: [gdal-dev] Jp2 driver "unhandled projection"
Message-ID: <1936B52D-E52D-4AAB-8219-243B599B2973@ndc.nasa.gov>

I noticed a warning after converting a gtiff image to jp2 stating ?Warning 6: Unhandled projection method Albers_Conic_Equal_Area?.  The driver apparently completes the conversion and happily reports the projection correctly under gdalinfo.  But I find it weird that the format would care about the projection.  Is this a serious warning?

I believe the driver used was JP2OpenJPEG, GDAL 3.8.3, released 2024/01/04

Jesse
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/1f4987a4/attachment.htm>

From even.rouault at spatialys.com  Fri Feb  9 09:24:09 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 9 Feb 2024 18:24:09 +0100
Subject: [gdal-dev] Jp2 driver "unhandled projection"
In-Reply-To: <1936B52D-E52D-4AAB-8219-243B599B2973@ndc.nasa.gov>
References: <1936B52D-E52D-4AAB-8219-243B599B2973@ndc.nasa.gov>
Message-ID: <ce677db9-9d0f-48b8-8994-da4ca12c854c@spatialys.com>


Le 09/02/2024 ? 18:13, Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND 
APPLICATIONS INC] via gdal-dev a ?crit?:
>
> I noticed a warning after converting a gtiff image to jp2 stating 
> ?Warning 6: Unhandled projection method Albers_Conic_Equal_Area?.? The 
> driver apparently completes the conversion and happily reports the 
> projection correctly under gdalinfo.? But I find it weird that the 
> format would care about the projection.? Is this a serious warning?
>
It is a bit strange that you get this warning (especially since this 
should be a projection method handled by GDAL) and get a SRS after the 
projection.

It is fully expected that the JP2OpenJPEG driver tries to get 
georeferencing from the metadata. There are several ways to embed 
georeferencing in a JPEG2000 image : GeoJP2, GMLJP2. All 
JPEG2000-capable drivers in GDAL share the same code to read that 
georeferencing when present and expose it.

Any link to that JP2 image? (sometimes images have both GeoJP2 and 
GMLJP2, or possibly a side-car file. I'm wondering if the warning might 
not come from an attempt at reading with one method, and finally a 
fallback is used)

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/c2a5041a/attachment.htm>

From jesse.r.meyer at nasa.gov  Fri Feb  9 09:37:52 2024
From: jesse.r.meyer at nasa.gov (Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC])
Date: Fri, 9 Feb 2024 17:37:52 +0000
Subject: [gdal-dev] [EXTERNAL] Re:  Jp2 driver "unhandled projection"
In-Reply-To: <ce677db9-9d0f-48b8-8994-da4ca12c854c@spatialys.com>
References: <1936B52D-E52D-4AAB-8219-243B599B2973@ndc.nasa.gov>
 <ce677db9-9d0f-48b8-8994-da4ca12c854c@spatialys.com>
Message-ID: <82BECE50-8509-4C1F-9229-DBD5F6E2A3CF@ndc.nasa.gov>

Hi Even,

I can share in private the image.  Should I send it directly to your @spatialys.com account?

Jesse

From: Even Rouault <even.rouault at spatialys.com>
Date: Friday, February 9, 2024 at 12:24?PM
To: "Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC]" <jesse.r.meyer at nasa.gov>, "gdal-dev at lists.osgeo.org" <gdal-dev at lists.osgeo.org>
Subject: [EXTERNAL] Re: [gdal-dev] Jp2 driver "unhandled projection"

CAUTION: This email originated from outside of NASA.  Please take care when clicking links or opening attachments.  Use the "Report Message" button to report suspicious messages to the NASA SOC.




Le 09/02/2024 ? 18:13, Meyer, Jesse R. (GSFC-618.0)[SCIENCE SYSTEMS AND APPLICATIONS INC] via gdal-dev a ?crit :
I noticed a warning after converting a gtiff image to jp2 stating ?Warning 6: Unhandled projection method Albers_Conic_Equal_Area?.  The driver apparently completes the conversion and happily reports the projection correctly under gdalinfo.  But I find it weird that the format would care about the projection.  Is this a serious warning?

It is a bit strange that you get this warning (especially since this should be a projection method handled by GDAL) and get a SRS after the projection.

It is fully expected that the JP2OpenJPEG driver tries to get georeferencing from the metadata. There are several ways to embed georeferencing in a JPEG2000 image : GeoJP2, GMLJP2. All JPEG2000-capable drivers in GDAL share the same code to read that georeferencing when present and expose it.

Any link to that JP2 image? (sometimes images have both GeoJP2 and GMLJP2, or possibly a side-car file. I'm wondering if the warning might not come from an attempt at reading with one method, and finally a fallback is used)
Even

--

http://www.spatialys.com<http://www.spatialys.com/>

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240209/6552e6ef/attachment-0001.htm>

From even.rouault at spatialys.com  Fri Feb  9 15:43:59 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 10 Feb 2024 00:43:59 +0100
Subject: [gdal-dev] Testing the driver
In-Reply-To: <3049631d-5857-4338-bd4f-e37abe88da50@spatialys.com>
References: <AS8PR07MB7766B7BD8750D12E3D01EC53A24B2@AS8PR07MB7766.eurprd07.prod.outlook.com>
 <3049631d-5857-4338-bd4f-e37abe88da50@spatialys.com>
Message-ID: <1375f5b9-dd9b-4f04-a67e-8838fb7bf355@spatialys.com>


> To test your own development, you may have a more pleasant experience 
> by directly running just the tests for your driver with something like 
> "pytest autotest/ogr/ogr_miramon.py"? (be careful on Windows, the 
> content of $build_dir/autotest is copied from $source_dir/autotest 
> each time "cmake" is run, so if you edit your test .py file directly 
> in the build directory, be super careful of not accidentally losing 
> your work, and make sure to copy its content to the source directory 
> first. That's admittedly an annoying point of the current test setup 
> on Windows, compared to Unix where we use symbolic links)
>
Actually Dan figured out it was possible to run directly the tests 
against your test file from the source directory, and not the one that 
is copied. Cf https://github.com/OSGeo/gdal/pull/9224

So you can actually do from the build directory:

pytest -c autotest/pytest.ini ../autotest/ogr/ogr_gpx.py

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240210/d43bd757/attachment.htm>

From andrew at aitchison.me.uk  Sat Feb 10 09:34:39 2024
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Sat, 10 Feb 2024 17:34:39 +0000 (GMT)
Subject: [gdal-dev] Testing the driver
In-Reply-To: <1375f5b9-dd9b-4f04-a67e-8838fb7bf355@spatialys.com>
References: <AS8PR07MB7766B7BD8750D12E3D01EC53A24B2@AS8PR07MB7766.eurprd07.prod.outlook.com>
 <3049631d-5857-4338-bd4f-e37abe88da50@spatialys.com>
 <1375f5b9-dd9b-4f04-a67e-8838fb7bf355@spatialys.com>
Message-ID: <4dbe78c2-def8-f5de-1aa7-cfa2ab9f0859@aitchison.me.uk>

On Sat, 10 Feb 2024, Even Rouault via gdal-dev wrote:

>
>> To test your own development, you may have a more pleasant experience by 
>> directly running just the tests for your driver with something like "pytest 
>> autotest/ogr/ogr_miramon.py"? (be careful on Windows, the content of 
>> $build_dir/autotest is copied from $source_dir/autotest each time "cmake" 
>> is run, so if you edit your test .py file directly in the build directory, 
>> be super careful of not accidentally losing your work, and make sure to 
>> copy its content to the source directory first. That's admittedly an 
>> annoying point of the current test setup on Windows, compared to Unix where 
>> we use symbolic links)
>> 
> Actually Dan figured out it was possible to run directly the tests against 
> your test file from the source directory, and not the one that is copied. Cf 
> https://github.com/OSGeo/gdal/pull/9224
>
> So you can actually do from the build directory:
>
> pytest -c autotest/pytest.ini ../autotest/ogr/ogr_gpx.py

Recent tarball releases have cmake/template/pytest.ini.in
but how do I genenerate autotest/pytest.ini ?

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From j1 at jimenezshaw.com  Sun Feb 11 04:09:31 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Sun, 11 Feb 2024 13:09:31 +0100
Subject: [gdal-dev] Warp with non-square pixels in C++
Message-ID: <CADRrdKuhn7XZ=GzMDEUWg=Mgr2ZNQ0xcDbbqCyiUq3kkO4xsmg@mail.gmail.com>

The origin of this question is this ticket in QGIS:

https://github.com/qgis/QGIS/issues/56288

The summary is that with rasters ordered bottom-up, QGIS is doing a Warped
VRT. But Warp us using square pixels... that is distorting too much the
image in some cases (and I would say it is more expensive, but that is not
the problem).
I know, looking at gdalwarp, that the warp can be done with different pixel
size for X and Y.
for instance, with this command:
gdalwarp -tr 0.2 0.1 bottom-up.xyz warped.xyz

I want to provide the pixel size of the original image. And I could use
"GDALWarpAppOptions" dfXRes and dfYRes for that.

However in the code in QGIS (mentioned in the ticket)
https://github.com/qgis/QGIS/blob/3a18496f7c25a00cb26cb5abe0e53b2a13b3de68/src/core/providers/gdal/qgsgdalprovider.cpp#L3590
I only have access to "GDALWarpOptions" (see that there is no "App" in the
name).

I don't see how to provide that data to "GDALAutoCreateWarpedVRT".

Any idea?

Thanks.
Javier

.___ ._ ..._ .. . ._.  .___ .. __ . _. . __..  ... .... ._ .__
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240211/84fdc3c2/attachment.htm>

From a.pau at creaf.uab.cat  Mon Feb 12 01:04:59 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Mon, 12 Feb 2024 09:04:59 +0000
Subject: [gdal-dev] =?iso-8859-1?q?A_q=FCestion_about_ICreateLayer=28=29_?=
 =?iso-8859-1?q?and_it=27s_parameter_eType?=
Message-ID: <PAXPR07MB7775BB646D27AF42E2277236A2482@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi,

I am currently addressing all errors in Actions (in my fork), and I've encountered this one in 'slow_tests (slow_tests, ubuntu_22_04, build.sh, test.sh)':

/home/runner/work/gdal/gdal/ogr/ogrsf_frmts/miramon/ogrmiramondatasource.cpp:133:44: error: unused parameter 'eType' [-Werror=unused-parameter]

It's true, I'm not using this parameter because I don't need it at the moment. I'm adding features in the appropriate layer in the ICreateFeature() function.

So, my question is, should I be using this parameter for anything other than determining the type of layer I'm working with?

Thanks :)

Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/db95a399/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/db95a399/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/db95a399/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/db95a399/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/db95a399/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/db95a399/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/db95a399/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/db95a399/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/db95a399/attachment-0003.jpg>

From a.pau at creaf.uab.cat  Mon Feb 12 02:05:09 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Mon, 12 Feb 2024 10:05:09 +0000
Subject: [gdal-dev] 
 =?iso-8859-1?q?A_q=FCestion_about_ICreateLayer=28=29_?=
 =?iso-8859-1?q?and_it=27s_parameter_eType?=
In-Reply-To: <PAXPR07MB7775BB646D27AF42E2277236A2482@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB7775BB646D27AF42E2277236A2482@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <PAXPR07MB77755F1A3BD2EC3A70C15F6DA2482@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi again,
forget the question.
I finally use the variable to inform that layers with measures will be processed without Measures.

Thanks again

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 12 de febrer de 2024 10:05
Para: gdal-dev at lists.osgeo.org
Asunto: [gdal-dev] A q?estion about ICreateLayer() and it's parameter eType

Hi,

I am currently addressing all errors in Actions (in my fork), and I've encountered this one in 'slow_tests (slow_tests, ubuntu_22_04, build.sh, test.sh)':

/home/runner/work/gdal/gdal/ogr/ogrsf_frmts/miramon/ogrmiramondatasource.cpp:133:44: error: unused parameter 'eType' [-Werror=unused-parameter]

It's true, I'm not using this parameter because I don't need it at the moment. I'm adding features in the appropriate layer in the ICreateFeature() function.

So, my question is, should I be using this parameter for anything other than determining the type of layer I'm working with?

Thanks :)

Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/dfaccb18/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/dfaccb18/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/dfaccb18/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/dfaccb18/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/dfaccb18/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/dfaccb18/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/dfaccb18/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/dfaccb18/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/dfaccb18/attachment-0003.jpg>

From a.pau at creaf.uab.cat  Mon Feb 12 02:40:19 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Mon, 12 Feb 2024 10:40:19 +0000
Subject: [gdal-dev] Delete untagged containers
Message-ID: <PAXPR07MB777532C5FF1BDC9803E1C41EA2482@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi,
when passing "actions" there is one that I think it's not depending on me: Delete untagged containers

Anyone know if I have to do something special to pass this one?

Thanks

Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/82643dd3/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/82643dd3/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/82643dd3/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/82643dd3/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/82643dd3/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/82643dd3/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/82643dd3/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/82643dd3/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/82643dd3/attachment-0003.jpg>

From michael.otto at data-experts.de  Mon Feb 12 03:57:30 2024
From: michael.otto at data-experts.de (Michael Otto)
Date: Mon, 12 Feb 2024 12:57:30 +0100
Subject: [gdal-dev] Build static GDAL-Lib and static GDAL-Apps
Message-ID: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>

Hello,

I have been trying for some time to compile GDAL and the GDAL apps as a 
static library / executable programs.

The goal is to cast GDAL and all its dependencies (PROJ / GEOS / all 
dependencies to system libraries / ...) into a static library and to 
create the GDAL apps as static executable programs. 
There should be no dynamic dependencies.

Unfortunately, I have not had any success so far. The library is created 
statically but the apps are not yet.
Does anyone have experience with this topic or possibly a procedure that 
leads to success?

Best regards.
Michael Otto

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/30d68150/attachment.htm>

From robert.coup at koordinates.com  Mon Feb 12 06:42:47 2024
From: robert.coup at koordinates.com (Robert Coup)
Date: Mon, 12 Feb 2024 14:42:47 +0000
Subject: [gdal-dev] Build static GDAL-Lib and static GDAL-Apps
In-Reply-To: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
Message-ID: <CAFLLRpLb8AfHASb2eTER2obpz7HxYdUWZnFwHQ+HKUqAr7oMBA@mail.gmail.com>

Hi Michael,

On Mon, 12 Feb 2024 at 12:02, Michael Otto via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

>
> The goal is to cast GDAL and all its dependencies (PROJ / GEOS / all
> dependencies to system libraries / ...) into a static library and to create
> the GDAL apps as static executable programs.


Which platform are you working on? If you need a fully static compilation
of everything *all* the way down including openssl + zlib + zstd + libtiff
+ all the other libraries, using vcpkg[1] might be a reasonable approach.
By default it does static compilation on macOS & Linux, and it has a static
compilation option on Windows (the default on Windows is dynamic). It
doesn't support every compile option though, but it's customisable and if
you're after a reasonably vanilla GDAL it should work ok.


>
> There should be no dynamic dependencies.


Note that GDAL + Proj (maybe others), have data files they rely on, so
while you may be able to get a single executable, you'll still need to
distribute these files. I can imagine ways around that, but they're getting
fairly complex.


> Unfortunately, I have not had any success so far. The library is created
> statically but the apps are not yet.
> Does anyone have experience with this topic or possibly a procedure that
> leads to success?


Can you share the process you've currently got to?

Rob :)

[1] https://github.com/microsoft/vcpkg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/4caf8aec/attachment.htm>

From lnicola at dend.ro  Mon Feb 12 08:18:51 2024
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Mon, 12 Feb 2024 18:18:51 +0200
Subject: [gdal-dev] Delete untagged containers
In-Reply-To: <PAXPR07MB777532C5FF1BDC9803E1C41EA2482@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB777532C5FF1BDC9803E1C41EA2482@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <8ff8de37-4390-4426-8ca8-0e0d9c859d48@betaapp.fastmail.com>

Hi,

That's related to the ghcr.io container registry, it's failing on your fork because you're missing an access token. Don't worry about it.

Laurentiu

On Mon, Feb 12, 2024, at 12:40, Abel Pau via gdal-dev wrote:
> Hi,
> when passing ?actions? there is one that I think it?s not depending on me: Delete untagged containers
>  
> Anyone know if I have to do something special to pass this one?
>  
> Thanks
>  
> *Abel Pau Garcia*
> *GIS developer*
> https://www.creaf.cat/sites/default/files/creaf-signature.png
> *a.pau at creaf.uab.cat*
> *Let's chat on Teams!* <https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
> *Tel. +34 934814277*
> https://www.creaf.cat/sites/default/files/so-en-signature.png
> https://www.creaf.cat/sites/default/files/twitter-icon-signature.png <https://twitter.com/CREAF_ecologia>https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png <https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>https://www.creaf.cat/sites/default/files/youtube-icon-signature.png <https://www.youtube.com/c/creafecologia>https://www.creaf.cat/sites/default/files/instagram-icon-signature.png <https://www.instagram.com/CREAF_ecologia/>
> *www.creaf.cat** | **http://blog.creaf.cat*
> https://www.creaf.cat/sites/default/files/uab_logo_signatura.png
> CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)
> 
> Before printing this electronic message, think about the environment.
> http://www.creaf.uab.cat/_signatura/line.gif
>  
>  
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/a3c40e70/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/a3c40e70/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/a3c40e70/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/a3c40e70/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/a3c40e70/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/a3c40e70/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/a3c40e70/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/a3c40e70/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240212/a3c40e70/attachment-0003.jpg>

From michael.otto at data-experts.de  Mon Feb 12 23:18:07 2024
From: michael.otto at data-experts.de (Michael Otto)
Date: Tue, 13 Feb 2024 08:18:07 +0100
Subject: [gdal-dev] Antwort: Re: Build static GDAL-Lib and static GDAL-Apps
In-Reply-To: <CAFLLRpLb8AfHASb2eTER2obpz7HxYdUWZnFwHQ+HKUqAr7oMBA@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAFLLRpLb8AfHASb2eTER2obpz7HxYdUWZnFwHQ+HKUqAr7oMBA@mail.gmail.com>
Message-ID: <OFAE0B81C2.ED89AD5C-ONC1258AC2.00243F7A-C1258AC2.00281B89@data-experts.de>

Hello Robert,

at the moment it's only about the Linux platform. And yes, it should be a 
static compilation with all the necessary dependencies (including libtiff 
and all the others).

I currently use an Ubuntu VM and use an Alpine-Linux Docker container for 
compiling. First a static Geos library is created via cmake, then a static 
Proj library (without Curl, because this currently leads to errors) and 
then Gdal as a static library. 
The basis of the script comes from this source: 
https://github.com/OSGeo/gdal/issues/4815.
I have updated the version used to the current version and replaced the 
existing './configure' and 'make' commands with cmake.

This is what it looks like:

Start docker:  docker run -it --rm -v $(pwd):/tmp golang:1.17.3-alpine3.13 
/bin/sh /tmp/mo_gdalbuild.sh

mo_gdalbuild.sh
---------------

#!/bin/sh

rm -r /tmp/gdal-3.8.3
rm -r /tmp/gdal-3.8.3.tar.gz
rm -r /tmp/geos-3.12.1
rm -r /tmp/geos-3.12.1.tar.bz2
rm -r /tmp/proj-9.3.0
rm -r /tmp/proj-9.3.0.tar.gz
rm -r /tmp/mo_gdal_install

set -e

proxy="http://172.16.7.13:8080"
export HTTP_PROXY="$proxy"
export HTTPS_PROXY="$proxy"

GDAL_VERSION=3.8.3
PROJ_VERSION=9.3.0
GEOS_VERSION=3.12.1

apk add --no-cache \
    wget \
    coreutils \
    build-base \
    unzip \
    cmake

# statically linked version of PROJ.

apk add --no-cache \
    sqlite \
    sqlite-dev \
    sqlite-static \
    tiff \
    tiff-dev
cd /tmp
wget --no-verbose -e use_proxy=yes -e https_proxy=$proxy https:
//download.osgeo.org/proj/proj-${PROJ_VERSION}.tar.gz
tar -xzf proj-${PROJ_VERSION}.tar.gz
cd proj-${PROJ_VERSION}

mkdir build
cd build

cmake \
-DBUILD_SHARED_LIBS=OFF \
-DBUILD_TESTING=OFF \
-DBUILD_PROJSYNC=OFF \
-DCMAKE_BUILD_TYPE=Release \
-DCMAKE_INSTALL_PREFIX=/tmp/mo_gdal_install/proj/dist \
-DENABLE_CURL=OFF \
..

cmake --build .
cmake --build . --target install


# statically linked version of GEOS.

cd /tmp
wget --no-verbose -e use_proxy=yes -e https_proxy=$proxy https:
//download.osgeo.org/geos/geos-${GEOS_VERSION}.tar.bz2
tar -xjf geos-${GEOS_VERSION}.tar.bz2
cd geos-${GEOS_VERSION}

mkdir build
cd build
cmake \
    -DCMAKE_BUILD_TYPE=Release \
    -DBUILD_SHARED_LIBS=OFF \
    -DBUILD_TESTING=OFF \
    -DCMAKE_INSTALL_PREFIX=/tmp/mo_gdal_install/geos/dist \
    ..

cmake --build .
cmake --build . --target install

# statically linked version of GDAL
# (a minimal version still needs to be configured !)

apk add --no-cache \
    jpeg-dev \
    libjpeg-turbo-static \
    openssl-libs-static \
    linux-headers

cd /tmp
wget --no-verbose -e use_proxy=yes -e http_proxy=$proxy http:
//download.osgeo.org/gdal/${GDAL_VERSION}/gdal-${GDAL_VERSION}.tar.gz
tar -xzf gdal-${GDAL_VERSION}.tar.gz
cd gdal-${GDAL_VERSION}

mkdir build
cd build

cmake \
-DCMAKE_BUILD_TYPE=Release \
-DBUILD_APPS=ON \
-DBUILD_SHARED_LIBS=OFF \
-DBUILD_TESTING=OFF \
-DCMAKE_PREFIX_PATH=/tmp/mo_gdal_install/gdal \
-DCMAKE_INSTALL_PREFIX=/tmp/mo_gdal_install/gdal \
-DGEOS_INCLUDE_DIR=/tmp/mo_gdal_install/geos/dist/include \
-DGEOS_LIBRARY=/tmp/mo_gdal_install/geos/dist/lib64/libgeos_c.a \
-DPROJ_INCLUDE_DIR=/tmp/mo_gdal_install/proj/dist/include \
-DPROJ_LIBRARY_RELEASE=/tmp/mo_gdal_install/proj/dist/lib64/libproj.a \
-DBUILD_JAVA_BINDINGS=ON \
-DGDAL_JAVA_INSTALL_DIR=/tmp/mo_gdal_install/java \
-DGDAL_JAVA_JNI_INSTALL_DIR=/tmp/mo_gdal_install/java/jni \
..

cmake --build .
cmake --build . --target install



If I check the individual libraries created using 'ldd', I can see that 
they are statically linked.

If I run 'ldd' on the resulting apps, it looks different. Everything is 
still linked dynamically. This should be changed ;o).

Best regards
Michael




Von:    "Robert Coup" <robert.coup at koordinates.com>
An:     "Michael Otto" <michael.otto at data-experts.de>
Kopie:  gdal-dev at lists.osgeo.org
Datum:  12.02.2024 15:43
Betreff:        Re: [gdal-dev] Build static GDAL-Lib and static GDAL-Apps



Hi Michael,

On Mon, 12 Feb 2024 at 12:02, Michael Otto via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

The goal is to cast GDAL and all its dependencies (PROJ / GEOS / all 
dependencies to system libraries / ...) into a static library and to 
create the GDAL apps as static executable programs. 

Which platform are you working on? If you need a fully static compilation 
of everything all the way down including openssl + zlib + zstd + libtiff + 
all the other libraries, using vcpkg[1] might be a reasonable approach. By 
default it does static compilation on macOS & Linux, and it has a static 
compilation option on Windows (the default on Windows is dynamic). It 
doesn't support every compile option though, but it's customisable and if 
you're after a reasonably vanilla GDAL it should work ok.
 

There should be no dynamic dependencies.

Note that GDAL + Proj (maybe others), have data files they rely on, so 
while you may be able to get a single executable, you'll still need to 
distribute these files. I can imagine ways around that, but they're 
getting fairly complex.
 
Unfortunately, I have not had any success so far. The library is created 
statically but the apps are not yet.
Does anyone have experience with this topic or possibly a procedure that 
leads to success?

Can you share the process you've currently got to?

Rob :) 

[1] https://github.com/microsoft/vcpkg



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240213/de90b356/attachment-0001.htm>

From Roger.Bivand at nhh.no  Tue Feb 13 04:21:08 2024
From: Roger.Bivand at nhh.no (Roger Bivand)
Date: Tue, 13 Feb 2024 12:21:08 +0000
Subject: [gdal-dev] Build static GDAL-Lib and static GDAL-Apps
Message-ID: <SV0P279MB0475C6EDBE3026889769ED92EE4F2@SV0P279MB0475.NORP279.PROD.OUTLOOK.COM>

You may find the listings used to build static libraries for R Windows packages using MXE as the basis to be helpful:

https://svn.r-project.org/R-dev-web/trunk/WindowsBuilds/winutf8/ucrt3/toolchain_libs/mxe/src/

These are targeted at Windows, but the dependency tree logic should be similar. In building the successive static libraries, very likely the link order will matter too, so some patience is needed.

Hope this helps,

Roger

--
Roger Bivand
Emeritus Professor
Norwegian School of Economics
Postboks 3490 Ytre Sandviken, 5045 Bergen, Norway
Roger.Bivand at nhh.no

From a.pau at creaf.uab.cat  Tue Feb 13 04:25:07 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Tue, 13 Feb 2024 12:25:07 +0000
Subject: [gdal-dev] linting test in Code Checks always fails
Message-ID: <PAXPR07MB7775D730F89EA81276CAEA56A24F2@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi,
I am trying to make my code good for all Actions in the project.
Yesterday I was trying to format my code using clang. I looked at that:
Commit hooks

GDAL provides pre-commit hooks to run code linters before a commit is made. The hooks are cloned with the repository and can be installed using pre-commit<https://pre-commit.com/>:

python3 -m pip install pre-commit

pre-commit install

Once installed, the hooks can be run manually via pre-commit run --all-files.

Since Then, I think, the linting test in Code Checks (Pharentesis * AbelPau/gdal at 91bbaa9 (github.com)<https://github.com/AbelPau/gdal/actions/runs/7886238742/job/21519074148>) always fails but I have no Idea why.
Can anyone tell me why it's failing?? Did I do something wrong with the pre-commit?

Thanks a lot in advance!


Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240213/cd8c3d58/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240213/cd8c3d58/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240213/cd8c3d58/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240213/cd8c3d58/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240213/cd8c3d58/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240213/cd8c3d58/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240213/cd8c3d58/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240213/cd8c3d58/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240213/cd8c3d58/attachment-0003.jpg>

From lnicola at dend.ro  Tue Feb 13 04:37:20 2024
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Tue, 13 Feb 2024 14:37:20 +0200
Subject: [gdal-dev] linting test in Code Checks always fails
In-Reply-To: <PAXPR07MB7775D730F89EA81276CAEA56A24F2@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB7775D730F89EA81276CAEA56A24F2@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <6730317a-081d-4f88-8622-b670551d14de@betaapp.fastmail.com>

On Tue, Feb 13, 2024, at 14:25, Abel Pau via gdal-dev wrote:
> Hi,
> I am trying to make my code good for all Actions in the project.
I'm guessing you should remove https://github.com/AbelPau/gdal/tree/master/out/build/x64-Debug from git (and ideally squash at the end).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240213/8117022d/attachment.htm>

From robert.coup at koordinates.com  Tue Feb 13 05:39:34 2024
From: robert.coup at koordinates.com (Robert Coup)
Date: Tue, 13 Feb 2024 13:39:34 +0000
Subject: [gdal-dev] Build static GDAL-Lib and static GDAL-Apps
In-Reply-To: <OFAE0B81C2.ED89AD5C-ONC1258AC2.00243F7A-C1258AC2.00281B89@data-experts.de>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAFLLRpLb8AfHASb2eTER2obpz7HxYdUWZnFwHQ+HKUqAr7oMBA@mail.gmail.com>
 <OFAE0B81C2.ED89AD5C-ONC1258AC2.00243F7A-C1258AC2.00281B89@data-experts.de>
Message-ID: <CAFLLRpJGAan04BN9kSsKLCic3rkHYd1X_fukyTJvuvJ3UK+TEg@mail.gmail.com>

Hi Michael,

On Tue, 13 Feb 2024 at 07:18, Michael Otto <michael.otto at data-experts.de>
wrote:

> at the moment it's only about the Linux platform. And yes, it should be a
> static compilation with all the necessary dependencies (including libtiff
> and all the others).
>
> I currently use an Ubuntu VM and use an Alpine-Linux Docker container for
> compiling. First a static Geos library is created via cmake, then a static
> Proj library (without Curl, because this currently leads to errors) and
> then Gdal as a static library.
> The basis of the script comes from this source:
> https://github.com/OSGeo/gdal/issues/4815.
> I have updated the version used to the current version and replaced the
> existing './configure' and 'make' commands with cmake.
>
> This is what it looks like:


Thanks, that's helpful :-) Following your script, there's no dynamic
libgdal linked into the app binaries...

# ldd /tmp/mo_gdal_install/bin/gdal_translate
/lib/ld-musl-aarch64.so.1 (0xffffb968b000)
libz.so.1 => /lib/libz.so.1 (0xffffb7e06000)
libtiff.so.5 => /usr/lib/libtiff.so.5 (0xffffb7d87000)
libsqlite3.so.0 => /usr/lib/libsqlite3.so.0 (0xffffb7c80000)
libjpeg.so.8 => /usr/lib/libjpeg.so.8 (0xffffb7c2a000)
libstdc++.so.6 => /usr/lib/libstdc++.so.6 (0xffffb7a6a000)
libgcc_s.so.1 => /usr/lib/libgcc_s.so.1 (0xffffb7a45000)
libc.musl-aarch64.so.1 => /lib/ld-musl-aarch64.so.1 (0xffffb968b000)

If you want it to error instead of creating anything dynamic, add -DCMAKE_
EXE_LINKER_FLAGS=-static to your GDAL configuration. Then you get errors!

[ 95%] Linking CXX executable test_ogrsf
/usr/lib/gcc/aarch64-alpine-linux-musl/10.2.1/../../../../aarch64-alpine-linux-musl/bin/ld:
attempted static link of dynamic object `/lib/libz.so'
collect2: error: ld returned 1 exit status
make[2]: *** [apps/CMakeFiles/test_ogrsf.dir/build.make:112:
apps/test_ogrsf] Error 1
make[1]: *** [CMakeFiles/Makefile2:8116:
apps/CMakeFiles/test_ogrsf.dir/all] Error 2
make: *** [Makefile:149: all] Error 2

So you need to add CMake options to specifically point to the static
libraries via -DJPEG_LIBRARY=/usr/lib/libjpegturbo.a and so on. Using the
GDAL internal zlib/libtiff/etc build options might make your life simpler.

Note that GDAL is pretty big! *Each* of gdaltranslate, gdalwarp, etc will
end up at >30MB ...

Rob :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240213/1104b083/attachment.htm>

From sean.gillies at gmail.com  Tue Feb 13 09:10:59 2024
From: sean.gillies at gmail.com (Sean Gillies)
Date: Tue, 13 Feb 2024 10:10:59 -0700
Subject: [gdal-dev] VSI sidecar and sibling file lookup
Message-ID: <CAOodmJo3ngjDEh9rDN7EmFyGoJ_OesGBNDDn3j8vu-HAMwuH0g@mail.gmail.com>

Hi all,

It's not clear to me from reading
https://gdal.org/user/virtual_file_systems.html if VSI sidecar and sibling
file lookup works in general, by design, or whether it's an implementation
detail of the standard VSI filesystems ("vsizip", "vsicurl", etc.).

More specifically: if I have a "/vsipyopener/foo.tif" object, do drivers
always look for other files at paths precisely relative to that one? Does
this vary among drivers?

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240213/789c9780/attachment.htm>

From cgodkin at gmail.com  Tue Feb 13 09:49:58 2024
From: cgodkin at gmail.com (Carl Godkin)
Date: Tue, 13 Feb 2024 09:49:58 -0800
Subject: [gdal-dev] Build question: GDAL with libwebp....
Message-ID: <CAE=8km=i_LBx8hH4x1FX0ydyknG71HOApqV5GQq3uBVbV7-xPA@mail.gmail.com>

Hi,

Sorry if this is an elementary cmake question but I am curious if there is
a cleaner solution than I came up with.

I'm trying to build GDAL 3.8.3 with WEBP support.

I built libwebp 1.3.2 (the latest) without any problems, also using cmake.

However, when building GDAL, the link on the shared library fails since
WEBP seems to require TWO libraries (in the libwebp package), libwebp and
libsharpyuv.

My question is how can I persuade cmake to accept both libraries for
WEBP_LIBRARY?

I thought quotes would help.  What I think I ought to be able to do is
something like

   -DWEBP_LIBRARY="/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a
/usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a" \

or else

   "-DWEBP_LIBRARY=/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a
/usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a" \

but both options produce link lines that include the double quotes!  This
is an issue on Windows and Linux for me.

I have a couple of workarounds that I won't bore you with, but I was
wondering what the best practice is here (other than hand-editing the cmake
output of course).

I think that libwebp added the "sharpyuv" stuff at version 1.3.0 so perhaps
using an older version would also work, but that doesn't seem sustainable.

Thanks for suggestions,

carl
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240213/0d7c22f0/attachment.htm>

From andrew at aitchison.me.uk  Tue Feb 13 10:45:03 2024
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Tue, 13 Feb 2024 18:45:03 +0000 (GMT)
Subject: [gdal-dev] Build question: GDAL with libwebp....
In-Reply-To: <CAE=8km=i_LBx8hH4x1FX0ydyknG71HOApqV5GQq3uBVbV7-xPA@mail.gmail.com>
References: <CAE=8km=i_LBx8hH4x1FX0ydyknG71HOApqV5GQq3uBVbV7-xPA@mail.gmail.com>
Message-ID: <b91ff4fa-46d0-0c89-deb2-b8e3fbb7890d@aitchison.me.uk>

On Tue, 13 Feb 2024, Carl Godkin via gdal-dev wrote:

> Hi,
>
> Sorry if this is an elementary cmake question but I am curious if there is
> a cleaner solution than I came up with.
>
> I'm trying to build GDAL 3.8.3 with WEBP support.
>
> I built libwebp 1.3.2 (the latest) without any problems, also using cmake.
>
> However, when building GDAL, the link on the shared library fails since
> WEBP seems to require TWO libraries (in the libwebp package), libwebp and
> libsharpyuv.
>
> My question is how can I persuade cmake to accept both libraries for
> WEBP_LIBRARY?
>
> I thought quotes would help.  What I think I ought to be able to do is
> something like
>
>   -DWEBP_LIBRARY="/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a
> /usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a" \
>
> or else
>
>   "-DWEBP_LIBRARY=/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a
> /usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a" \
>
> but both options produce link lines that include the double quotes!  This
> is an issue on Windows and Linux for me.

CMAKE is rather more verbose than that.

Compare
    gdal/frmts/webp/CMakeLists.txt
with
    gdal/frmts/png/CMakeLists.txt
for how the png driver uses libpng and zlib

You probably don't need the gdal_add_vendored_lib commands or the 
GDAL_USE_..._INTERNAL tests, since gdal is not bundling libwebp.

> I have a couple of workarounds that I won't bore you with, but I was
> wondering what the best practice is here (other than hand-editing the cmake
> output of course).
>
> I think that libwebp added the "sharpyuv" stuff at version 1.3.0 so perhaps
> using an older version would also work, but that doesn't seem sustainable.
>
> Thanks for suggestions,
>
> carl
>

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From cgodkin at gmail.com  Tue Feb 13 16:13:28 2024
From: cgodkin at gmail.com (Carl Godkin)
Date: Tue, 13 Feb 2024 16:13:28 -0800
Subject: [gdal-dev] Build question: GDAL with libwebp....
In-Reply-To: <b91ff4fa-46d0-0c89-deb2-b8e3fbb7890d@aitchison.me.uk>
References: <CAE=8km=i_LBx8hH4x1FX0ydyknG71HOApqV5GQq3uBVbV7-xPA@mail.gmail.com>
 <b91ff4fa-46d0-0c89-deb2-b8e3fbb7890d@aitchison.me.uk>
Message-ID: <CAE=8km=+oA0AETcA57NReA5wEiuSg6WjmF3htYXsNodG4JyMEw@mail.gmail.com>

Hi Andrew,

Thanks for replying.  I am not looking for ways to edit CMakeLists.txt
files, especially since I don't really understand the syntax.

 I was just hoping that someone who had built GDAL with WEBP enabled would
tell me how to specify both libraries to cmake on the command line.

Sorry I over-complicated my question!

carl

On Tue, Feb 13, 2024 at 10:45?AM Andrew C Aitchison <andrew at aitchison.me.uk>
wrote:

> On Tue, 13 Feb 2024, Carl Godkin via gdal-dev wrote:
>
> > Hi,
> >
> > Sorry if this is an elementary cmake question but I am curious if there
> is
> > a cleaner solution than I came up with.
> >
> > I'm trying to build GDAL 3.8.3 with WEBP support.
> >
> > I built libwebp 1.3.2 (the latest) without any problems, also using
> cmake.
> >
> > However, when building GDAL, the link on the shared library fails since
> > WEBP seems to require TWO libraries (in the libwebp package), libwebp and
> > libsharpyuv.
> >
> > My question is how can I persuade cmake to accept both libraries for
> > WEBP_LIBRARY?
> >
> > I thought quotes would help.  What I think I ought to be able to do is
> > something like
> >
> >   -DWEBP_LIBRARY="/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a
> > /usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a" \
> >
> > or else
> >
> >   "-DWEBP_LIBRARY=/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a
> > /usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a" \
> >
> > but both options produce link lines that include the double quotes!  This
> > is an issue on Windows and Linux for me.
>
> CMAKE is rather more verbose than that.
>
> Compare
>     gdal/frmts/webp/CMakeLists.txt
> with
>     gdal/frmts/png/CMakeLists.txt
> for how the png driver uses libpng and zlib
>
> You probably don't need the gdal_add_vendored_lib commands or the
> GDAL_USE_..._INTERNAL tests, since gdal is not bundling libwebp.
>
> > I have a couple of workarounds that I won't bore you with, but I was
> > wondering what the best practice is here (other than hand-editing the
> cmake
> > output of course).
> >
> > I think that libwebp added the "sharpyuv" stuff at version 1.3.0 so
> perhaps
> > using an older version would also work, but that doesn't seem
> sustainable.
> >
> > Thanks for suggestions,
> >
> > carl
> >
>
> --
> Andrew C. Aitchison                      Kendal, UK
>                     andrew at aitchison.me.uk
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240213/3e675a19/attachment.htm>

From dg0yt at darc.de  Tue Feb 13 23:20:12 2024
From: dg0yt at darc.de (Kai Pastor, DG0YT)
Date: Wed, 14 Feb 2024 08:20:12 +0100
Subject: [gdal-dev] Build question: GDAL with libwebp....
In-Reply-To: <CAE=8km=+oA0AETcA57NReA5wEiuSg6WjmF3htYXsNodG4JyMEw@mail.gmail.com>
References: <CAE=8km=i_LBx8hH4x1FX0ydyknG71HOApqV5GQq3uBVbV7-xPA@mail.gmail.com>
 <b91ff4fa-46d0-0c89-deb2-b8e3fbb7890d@aitchison.me.uk>
 <CAE=8km=+oA0AETcA57NReA5wEiuSg6WjmF3htYXsNodG4JyMEw@mail.gmail.com>
Message-ID: <9a55d9d8-28cf-4708-b176-f9561546ffac@darc.de>

To pass lists into cmake, you usually need ';' as item separator.
(Exception: CMAKE_<lang>_FLAGS which is a command line fragment with 
space-separated items.)

In vcpkg, webp is configured via a CMAKE_PROJECT_INCLUDE file:

if(GDAL_USE_WEBP)
 ??? find_package(WebP CONFIG REQUIRED)
 ??? add_library(WEBP::WebP ALIAS WebP::webp)
 ??? set(GDAL_CHECK_PACKAGE_WebP_NAMES WebP CACHE INTERNAL "vcpkg")
 ??? set(GDAL_CHECK_PACKAGE_WebP_TARGETS WebP::webp CACHE INTERNAL "vcpkg")
endif()

Kai

Am 14.02.24 um 01:13 schrieb Carl Godkin via gdal-dev:
> Hi Andrew,
>
> Thanks for replying.? I am not looking for ways to edit CMakeLists.txt 
> files, especially since I don't really understand the syntax.
>
> ?I was just hoping that someone who had built GDAL with WEBP enabled 
> would tell me how to specify both libraries to cmake on the command line.
>
> Sorry I over-complicated my question!
>
> carl
>
> On Tue, Feb 13, 2024 at 10:45?AM Andrew C Aitchison 
> <andrew at aitchison.me.uk> wrote:
>
>     On Tue, 13 Feb 2024, Carl Godkin via gdal-dev wrote:
>
>     > Hi,
>     >
>     > Sorry if this is an elementary cmake question but I am curious
>     if there is
>     > a cleaner solution than I came up with.
>     >
>     > I'm trying to build GDAL 3.8.3 with WEBP support.
>     >
>     > I built libwebp 1.3.2 (the latest) without any problems, also
>     using cmake.
>     >
>     > However, when building GDAL, the link on the shared library
>     fails since
>     > WEBP seems to require TWO libraries (in the libwebp package),
>     libwebp and
>     > libsharpyuv.
>     >
>     > My question is how can I persuade cmake to accept both libraries for
>     > WEBP_LIBRARY?
>     >
>     > I thought quotes would help.? What I think I ought to be able to
>     do is
>     > something like
>     >
>     > ?-DWEBP_LIBRARY="/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a
>     > /usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a" \
>     >
>     > or else
>     >
>     > ?"-DWEBP_LIBRARY=/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a
>     > /usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a" \
>     >
>     > but both options produce link lines that include the double
>     quotes!? This
>     > is an issue on Windows and Linux for me.
>
>     CMAKE is rather more verbose than that.
>
>     Compare
>     ? ? gdal/frmts/webp/CMakeLists.txt
>     with
>     ? ? gdal/frmts/png/CMakeLists.txt
>     for how the png driver uses libpng and zlib
>
>     You probably don't need the gdal_add_vendored_lib commands or the
>     GDAL_USE_..._INTERNAL tests, since gdal is not bundling libwebp.
>
>     > I have a couple of workarounds that I won't bore you with, but I was
>     > wondering what the best practice is here (other than
>     hand-editing the cmake
>     > output of course).
>     >
>     > I think that libwebp added the "sharpyuv" stuff at version 1.3.0
>     so perhaps
>     > using an older version would also work, but that doesn't seem
>     sustainable.
>     >
>     > Thanks for suggestions,
>     >
>     > carl
>     >
>
>     -- 
>     Andrew C. Aitchison? ? ? ? ? ? ? ? ? ? ? Kendal, UK
>     andrew at aitchison.me.uk
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240214/6bcbf4db/attachment.htm>

From dg0yt at darc.de  Tue Feb 13 23:35:52 2024
From: dg0yt at darc.de (Kai Pastor, DG0YT)
Date: Wed, 14 Feb 2024 08:35:52 +0100
Subject: [gdal-dev] Antwort: Re: Build static GDAL-Lib and static
 GDAL-Apps
In-Reply-To: <OFAE0B81C2.ED89AD5C-ONC1258AC2.00243F7A-C1258AC2.00281B89@data-experts.de>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAFLLRpLb8AfHASb2eTER2obpz7HxYdUWZnFwHQ+HKUqAr7oMBA@mail.gmail.com>
 <OFAE0B81C2.ED89AD5C-ONC1258AC2.00243F7A-C1258AC2.00281B89@data-experts.de>
Message-ID: <9d6992ae-64ac-458e-84cb-28bdc389fe79@darc.de>

Am 13.02.24 um 08:18 schrieb Michael Otto via gdal-dev:
> I currently use an Ubuntu VM and use an Alpine-Linux Docker container 
> for compiling. First a static Geos library is created via cmake, then 
> a static Proj library (without Curl, because this currently leads to 
> errors) and then Gdal as a static library.

You must consider all transitive dependencies, build them in the right 
order, and ensure that transitive link libraries are passed on down to 
gdal and to the final app (with link libraries in correct order).
For more than a minimal build, it is really better solved by using 
package managers such as vcpkg than by reinventing the wheel - each 
dependency may add its own set of problems. A simplified(!) dependency 
graph for a minimal build in vcpkg, just gdal core features + geos:

zlib:
libjpeg-turbo:
liblzma:
openssl:
nlohmann-json:
curl[openssl, ssl, non-http]: openssl, zlib
sqlite3[json1, tool]:
tiff[lzma, jpeg, zip]: libjpeg-turbo, liblzma, zlib
proj[tiff, net]: curl, nlohmann-json, sqlite3, tiff
libgeotiff: proj, tiff
json-c:
geos:
gdal: geos, json-c, libgeotiff, proj, tiff, zlib

So libgeotiff, proj, tiff, curl all come with transitive usage 
requirements which depend on actual configuration.
This is impossible to reconstruct in CMake find modules (coming with 
CMake or GDAL).
In vcpkg, ports (maintainers) ensure that usage requirements are 
exported by each package (using CMake config or find module wrappers).

Kai
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240214/d26d93f1/attachment.htm>

From a.pau at creaf.uab.cat  Wed Feb 14 00:53:34 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Wed, 14 Feb 2024 08:53:34 +0000
Subject: [gdal-dev] CPLCalloc() used for small memory allocations. And for
 big ones?
Message-ID: <PAXPR07MB7775F53C2CF2C04576DCD88DA24E2@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi,

I am currently working on a driver and have been utilizing CPL_calloc(). However, when attempting to pass the Actions, I encounter errors such as:

warning C4244: 'function': conversion from 'MM_INTERNAL_FID' to 'size_t', possible loss of data

This issue can be addressed by casting 'MM_INTERNAL_FID' (which is a GUInt64, essentially an unsigned long long) to 'size_t' (also essentially an unsigned long long). So, utilizing a cast is not problematic in this context.

However, I noticed in the function description it states "used for small memory allocations," which prompts me to inquire if there is an alternative calloc function for larger memory allocations. If not, I will proceed with casting the variable in all instances. Nonetheless, I would appreciate knowing if there is a cleaner solution available.

Thank you for your assistance.

/************************************************************************/
/*                             CPLCalloc()                              */
/************************************************************************/

/**
* Safe version of calloc().
*
* This function is like the C library calloc(), but raises a CE_Fatal
* error with CPLError() if it fails to allocate the desired memory.  It
* should be used for small memory allocations that are unlikely to fail
* and for which the application is unwilling to test for out of memory
* conditions.  It uses VSICalloc() to get the memory, so any hooking of
* VSICalloc() will apply to CPLCalloc() as well.  CPLFree() or VSIFree()
* can be used free memory allocated by CPLCalloc().
*
* @param nCount number of objects to allocate.
* @param nSize size (in bytes) of object to allocate.
* @return pointer to newly allocated memory, only NULL if nSize * nCount is
* NULL.
*/

Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240214/a893a4e9/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240214/a893a4e9/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240214/a893a4e9/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240214/a893a4e9/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240214/a893a4e9/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240214/a893a4e9/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240214/a893a4e9/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240214/a893a4e9/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240214/a893a4e9/attachment-0003.jpg>

From lnicola at dend.ro  Wed Feb 14 01:00:59 2024
From: lnicola at dend.ro (=?UTF-8?Q?Lauren=C8=9Biu_Nicola?=)
Date: Wed, 14 Feb 2024 11:00:59 +0200
Subject: [gdal-dev] CPLCalloc() used for small memory allocations. And
 for big ones?
In-Reply-To: <PAXPR07MB7775F53C2CF2C04576DCD88DA24E2@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB7775F53C2CF2C04576DCD88DA24E2@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <24d5b072-6eac-42a5-8075-67f1d5c36f82@betaapp.fastmail.com>

Hi,

On Wed, Feb 14, 2024, at 10:53, Abel Pau via gdal-dev wrote:
> Hi,
> 
> I am currently working on a driver and have been utilizing CPL_calloc(). However, when attempting to pass the Actions, I encounter errors such as:
> 
> warning C4244: 'function': conversion from 'MM_INTERNAL_FID' to 'size_t', possible loss of data
> 
> This issue can be addressed by casting 'MM_INTERNAL_FID' (which is a GUInt64, essentially an unsigned long long) to 'size_t' (also essentially an unsigned long long). So, utilizing a cast is not problematic in this context.
> 
The warning makes sense on 32-bit platforms, where that cast will be problematic.

However, while I didn't check what MM_INTERNAL_FID is, it doesn't sound like something calloc() would take.

> However, I noticed in the function description it states "used for small memory allocations," which prompts me to inquire if there is an alternative calloc function for larger memory allocations
> 
"Small" probably means "infallible" here. If you want a fallible allocation (which you're supposed to handle), you can use VSICalloc(), VSIMalloc() etc.

Laurentiu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240214/7936fe7d/attachment.htm>

From r.nijssen at terglobo.nl  Wed Feb 14 05:51:08 2024
From: r.nijssen at terglobo.nl (Raymond Nijssen)
Date: Wed, 14 Feb 2024 14:51:08 +0100
Subject: [gdal-dev] GDAL does not support gpkg files generated by GeoServer
Message-ID: <ca764ecc-af1c-4c97-8735-b0cdb6e81baf@terglobo.nl>

Some fields in geopackages generated by GeoServer are not supported by 
GDAL. I have already made a ticket for GeoServer, but I'm unsure where 
the problem lies.

More info in the GeoServer ticket here:
https://osgeo-org.atlassian.net/browse/GEOS-11292

---
Gpkg output can contain fields of type INT4, VARCHAR(255) and FLOAT8 
which are not supported by GDAL/OGR. For this reason, QGIS, GRASS and 
FME ignore those fields on import.

ray at fw13:~/Downloads$ ogrinfo ext_nat_nbp.gpkg
Warning 1: GPKG: unrecognized user_version=0x00000000 (0) on 
'ext_nat_nbp.gpkg'
INFO: Open of ext_nat_nbp.gpkg'       using driver GPKG' successful.
Warning 1: Field format 'INT4' not supported. Interpreted as INT
Warning 1: Field format 'VARCHAR(255)' not supported
Warning 1: geometry column 'deelgebied' of type 'VARCHAR(255)' ignored
Warning 1: Field format 'FLOAT8' not supported
Warning 1: geometry column 'oppervlakte_hectare' of type 'FLOAT8' ignored
Warning 1: Field format 'VARCHAR(255)' not supported
Warning 1: geometry column 'plan_naam' of type 'VARCHAR(255)' ignored
1: ext_nat_nbp (Multi Polygon)


The INT4 fields are visible as INT, but all other other fields are 
ignored. (There?s also an ?unrecognized user version?.)
---

This also affects QGIS, GRASS and FME, cause they use GDAL for opening 
the data source.

Who's right and who's wrong here? :)

Kind regards,
Raymond

From cgodkin at gmail.com  Wed Feb 14 15:42:46 2024
From: cgodkin at gmail.com (Carl Godkin)
Date: Wed, 14 Feb 2024 15:42:46 -0800
Subject: [gdal-dev] Build question: GDAL with libwebp....
In-Reply-To: <9a55d9d8-28cf-4708-b176-f9561546ffac@darc.de>
References: <CAE=8km=i_LBx8hH4x1FX0ydyknG71HOApqV5GQq3uBVbV7-xPA@mail.gmail.com>
 <b91ff4fa-46d0-0c89-deb2-b8e3fbb7890d@aitchison.me.uk>
 <CAE=8km=+oA0AETcA57NReA5wEiuSg6WjmF3htYXsNodG4JyMEw@mail.gmail.com>
 <9a55d9d8-28cf-4708-b176-f9561546ffac@darc.de>
Message-ID: <CAE=8kmn04bPZ7L277gesVnGa1u-B4siDiDLc-XJd-Fht92ci8Q@mail.gmail.com>

Hi Kai,

> To pass lists into cmake, you usually need ';' as item separator.

Thanks for the suggestion.  I am sure I am missing something but inserting
a semi-colon on the Linux command line appears to require it be escaped.

When I pass this:

   -DWEBP_INCLUDE_DIR:PATH=/usr/local/devlibs/libwebp-1.3.2/include \
   -DWEBP_LIBRARY=/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a\;/usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a
\

the link line comes out with the semi-colon (and also quoted):


 "/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a;/usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a"

Or were you suggesting a different syntax?

I do not really understand the second part of your reply but I'm not using
vcpkg; I'm trying to use cmake at the command line (and trying to build on
both Windows and Linux).

Maybe most people using libwebp just let cmake find it on their system
somehow?

My workaround, in case someone else is interested, is to do this

   -DWEBP_INCLUDE_DIR:PATH=/usr/local/devlibs/libwebp-1.3.2/include \
   -DWEBP_LIBRARY=/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a \
   -DCMAKE_CXX_STANDARD_LIBRARIES=/usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a
\

Now libsharpyuv is included in every link line which works but isn't quite
right.  (I have also hand-edited the generated link line but I was looking
for a scriptable solution.)

Thanks,
carl


On Tue, Feb 13, 2024 at 11:29?PM Kai Pastor, DG0YT via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> To pass lists into cmake, you usually need ';' as item separator.
> (Exception: CMAKE_<lang>_FLAGS which is a command line fragment with
> space-separated items.)
>
> In vcpkg, webp is configured via a CMAKE_PROJECT_INCLUDE file:
>
> if(GDAL_USE_WEBP)
>     find_package(WebP CONFIG REQUIRED)
>     add_library(WEBP::WebP ALIAS WebP::webp)
>     set(GDAL_CHECK_PACKAGE_WebP_NAMES WebP CACHE INTERNAL "vcpkg")
>     set(GDAL_CHECK_PACKAGE_WebP_TARGETS WebP::webp CACHE INTERNAL "vcpkg")
> endif()
>
> Kai
>
> Am 14.02.24 um 01:13 schrieb Carl Godkin via gdal-dev:
>
> Hi Andrew,
>
> Thanks for replying.  I am not looking for ways to edit CMakeLists.txt
> files, especially since I don't really understand the syntax.
>
>  I was just hoping that someone who had built GDAL with WEBP enabled would
> tell me how to specify both libraries to cmake on the command line.
>
> Sorry I over-complicated my question!
>
> carl
>
> On Tue, Feb 13, 2024 at 10:45?AM Andrew C Aitchison <
> andrew at aitchison.me.uk> wrote:
>
>> On Tue, 13 Feb 2024, Carl Godkin via gdal-dev wrote:
>>
>> > Hi,
>> >
>> > Sorry if this is an elementary cmake question but I am curious if there
>> is
>> > a cleaner solution than I came up with.
>> >
>> > I'm trying to build GDAL 3.8.3 with WEBP support.
>> >
>> > I built libwebp 1.3.2 (the latest) without any problems, also using
>> cmake.
>> >
>> > However, when building GDAL, the link on the shared library fails since
>> > WEBP seems to require TWO libraries (in the libwebp package), libwebp
>> and
>> > libsharpyuv.
>> >
>> > My question is how can I persuade cmake to accept both libraries for
>> > WEBP_LIBRARY?
>> >
>> > I thought quotes would help.  What I think I ought to be able to do is
>> > something like
>> >
>> >   -DWEBP_LIBRARY="/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a
>> > /usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a" \
>> >
>> > or else
>> >
>> >   "-DWEBP_LIBRARY=/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a
>> > /usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a" \
>> >
>> > but both options produce link lines that include the double quotes!
>> This
>> > is an issue on Windows and Linux for me.
>>
>> CMAKE is rather more verbose than that.
>>
>> Compare
>>     gdal/frmts/webp/CMakeLists.txt
>> with
>>     gdal/frmts/png/CMakeLists.txt
>> for how the png driver uses libpng and zlib
>>
>> You probably don't need the gdal_add_vendored_lib commands or the
>> GDAL_USE_..._INTERNAL tests, since gdal is not bundling libwebp.
>>
>> > I have a couple of workarounds that I won't bore you with, but I was
>> > wondering what the best practice is here (other than hand-editing the
>> cmake
>> > output of course).
>> >
>> > I think that libwebp added the "sharpyuv" stuff at version 1.3.0 so
>> perhaps
>> > using an older version would also work, but that doesn't seem
>> sustainable.
>> >
>> > Thanks for suggestions,
>> >
>> > carl
>> >
>>
>> --
>> Andrew C. Aitchison                      Kendal, UK
>>                     andrew at aitchison.me.uk
>>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240214/f910e458/attachment.htm>

From mdsumner at gmail.com  Wed Feb 14 19:29:40 2024
From: mdsumner at gmail.com (Michael Sumner)
Date: Thu, 15 Feb 2024 14:29:40 +1100
Subject: [gdal-dev] netcdf url : should lack of range support be the error?
Message-ID: <CAAcGz99sLqPwawx8my9p=2+jNbFgKqbHbMvXUSp6HyqMJ-EUyg@mail.gmail.com>

on this URL I get an error, and as far as i understand - the server doesn't
support range downloading, the file otherwise works fine.

gdalinfo failed - unable to open '/vsicurl/
https://erddap.emodnet.eu/erddap/files/biology_6640_benthos_NorthSea_e4af_0f0e_6a73/04_2021_6640_diva_benthos_erddap.nc
'.


Should this trigger "Range downloading is not supported by this server" ?

Full output with debug messages on:


gdalinfo --config CPL_DEBUG ON /vsicurl/
https://erddap.emodnet.eu/erddap/files/biology_6640_benthos_NorthSea_e4af_0f0e_6a73/04_2021_6640_diva_benthos_erddap.nc
-if NetCDF


HTTP: libcurl/7.81.0 OpenSSL/3.0.2 zlib/1.2.11 brotli/1.0.9 zstd/1.4.8
libidn2/2.3.2 libpsl/0.21.0 (+libidn2/2.3.2) libssh/0.9.6/openssl/zlib
nghttp2/1.43.0 librtmp/2.3 OpenLDAP/2.5.16
VSICURL: GetFileSize(
https://erddap.emodnet.eu/erddap/files/biology_6640_benthos_NorthSea_e4af_0f0e_6a73/04_2021_6640_diva_benthos_erddap.nc)=339890640
 response_code=200
VSICURL: Downloading 0-16383 (
https://erddap.emodnet.eu/erddap/files/biology_6640_benthos_NorthSea_e4af_0f0e_6a73/04_2021_6640_diva_benthos_erddap.nc).
..
VSICURL: Got response_code=416
ERROR 4: `/vsicurl/
https://erddap.emodnet.eu/erddap/files/biology_6640_benthos_NorthSea_e4af_0f0e_6a73/04_2021_6640_diva_benthos_erddap.nc'
not recognized as being in a supported file format.


-- 
Michael Sumner
Software and Database Engineer
Australian Antarctic Division
Hobart, Australia
e-mail: mdsumner at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240215/7d3fa4bd/attachment.htm>

From dg0yt at darc.de  Wed Feb 14 21:06:33 2024
From: dg0yt at darc.de (Kai Pastor, DG0YT)
Date: Thu, 15 Feb 2024 06:06:33 +0100
Subject: [gdal-dev] Build question: GDAL with libwebp....
In-Reply-To: <CAE=8kmn04bPZ7L277gesVnGa1u-B4siDiDLc-XJd-Fht92ci8Q@mail.gmail.com>
References: <CAE=8km=i_LBx8hH4x1FX0ydyknG71HOApqV5GQq3uBVbV7-xPA@mail.gmail.com>
 <b91ff4fa-46d0-0c89-deb2-b8e3fbb7890d@aitchison.me.uk>
 <CAE=8km=+oA0AETcA57NReA5wEiuSg6WjmF3htYXsNodG4JyMEw@mail.gmail.com>
 <9a55d9d8-28cf-4708-b176-f9561546ffac@darc.de>
 <CAE=8kmn04bPZ7L277gesVnGa1u-B4siDiDLc-XJd-Fht92ci8Q@mail.gmail.com>
Message-ID: <b669902f-fdbf-42f0-8aeb-dc27b108eaec@darc.de>

Am 15.02.24 um 00:42 schrieb Carl Godkin:
> Hi Kai,
>
> > To pass lists into cmake, you usually need ';' as item separator.
>
> Thanks for the suggestion.? I am sure I am missing something but 
> inserting a semi-colon on the Linux command line appears to require it 
> be escaped.
>
> When I pass this:
>     -DWEBP_INCLUDE_DIR:PATH=/usr/local/devlibs/libwebp-1.3.2/include \
>     -DWEBP_LIBRARY=/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a\;/usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a \
> the link line comes out with the semi-colon?(and also quoted):
>
> ?"/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a;/usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a" 
>
>
> Or were you suggesting a different syntax?

Did you try to quote for the linux command line, instead of escaping:

"-DWEBP_LIBRARY=/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a;/usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a"

(YMMV. "LIBRARY" usually isn't for lists at all.)

> I do not really understand the second part of your reply but I'm not 
> using vcpkg; I'm trying to use cmake at the command line (and trying 
> to build on both Windows and Linux).
>
> Maybe most people using libwebp just let cmake find it on their system 
> somehow?

The second part is CMake code in a separate script which is injected 
into the configuration process by using the CMAKE_PROJECT_INCLUDE 
variable at the command line.

It really doesn't do more than finding webp's cmake config and making it 
available in a way that GDAL can consume. I would be happy if GDAL would 
just use the webp CMake config.

The pattern can be adapted to other packages. It also works for Kealib.

>
> My workaround, in case someone else is interested, is to do this
>     -DWEBP_INCLUDE_DIR:PATH=/usr/local/devlibs/libwebp-1.3.2/include \
>     -DWEBP_LIBRARY=/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a \
>     -DCMAKE_CXX_STANDARD_LIBRARIES=/usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a \
> Now libsharpyuv?is included in every link line which works but isn't 
> quite right.? (I have also hand-edited the generated link line but I 
> was looking for a scriptable solution.)

Working on the vcpkg port is my approach to this scriptable solution.

Kai.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240215/1ed36a65/attachment-0001.htm>

From cgodkin at gmail.com  Thu Feb 15 05:49:20 2024
From: cgodkin at gmail.com (Carl Godkin)
Date: Thu, 15 Feb 2024 05:49:20 -0800
Subject: [gdal-dev] Build question: GDAL with libwebp....
In-Reply-To: <b669902f-fdbf-42f0-8aeb-dc27b108eaec@darc.de>
References: <CAE=8km=i_LBx8hH4x1FX0ydyknG71HOApqV5GQq3uBVbV7-xPA@mail.gmail.com>
 <b91ff4fa-46d0-0c89-deb2-b8e3fbb7890d@aitchison.me.uk>
 <CAE=8km=+oA0AETcA57NReA5wEiuSg6WjmF3htYXsNodG4JyMEw@mail.gmail.com>
 <9a55d9d8-28cf-4708-b176-f9561546ffac@darc.de>
 <CAE=8kmn04bPZ7L277gesVnGa1u-B4siDiDLc-XJd-Fht92ci8Q@mail.gmail.com>
 <b669902f-fdbf-42f0-8aeb-dc27b108eaec@darc.de>
Message-ID: <CAE=8kmnYW2FXRdnwmGUDLWkmWHvk+ZOZp4x6sS8WOF5e8vK03Q@mail.gmail.com>

On Wed, Feb 14, 2024 at 9:06?PM Kai Pastor, DG0YT <dg0yt at darc.de> wrote:

>
> Did you try to quote for the linux command line, instead of escaping:
>
> "-DWEBP_LIBRARY=/usr/local/devlibs/libwebp-1.3.2/lib64/libwebp.a;/usr/local/devlibs/libwebp-1.3.2/lib64/libsharpyuv.a"
>
> (YMMV. "LIBRARY" usually isn't for lists at all.)
>
>
Hi Kai,

Yes, it behaves the same way.   I had tried that too earlier and just
double-checked it.

I'll live with my workaround.  Another possibility is to use an older
version of libwebp, from before version 1.3.0 when the "libsharpyuv" code
was added.

Thanks a lot,

carl
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240215/aa6a2eee/attachment.htm>

From jluis at ualg.pt  Thu Feb 15 06:21:26 2024
From: jluis at ualg.pt (=?iso-8859-1?Q?Joaquim_Manuel_Freire_Lu=EDs?=)
Date: Thu, 15 Feb 2024 14:21:26 +0000
Subject: [gdal-dev] Failing to build gdal with arrow 15 on Win
Message-ID: <GVXPR04MB99260945E18840F63671E7D3A64D2@GVXPR04MB9926.eurprd04.prod.outlook.com>

Hi,

I can build GDAL with an arrow dev version up until before version 15. Then building GDAL dev started to fail after the commit

SHA-1: 16439ecbb66ee6848a463037d355f42b5268b07a

* Arrow/Parquet: add (minimum) support for libarrow 15.0

Complaining that STRING_VIEW and other were not found. I than rebuilt arrow version 15 and all build went fine, but it now error as run time with.


[cid:image001.jpg at 01DA601A.2B6AD9D0]



Thanks

Joaquim

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240215/99b40c91/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 52431 bytes
Desc: image001.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240215/99b40c91/attachment-0001.jpg>

From thomas.bonfort at gmail.com  Thu Feb 15 08:45:43 2024
From: thomas.bonfort at gmail.com (thomas bonfort)
Date: Thu, 15 Feb 2024 17:45:43 +0100
Subject: [gdal-dev] VSI sidecar and sibling file lookup
In-Reply-To: <CAOodmJo3ngjDEh9rDN7EmFyGoJ_OesGBNDDn3j8vu-HAMwuH0g@mail.gmail.com>
References: <CAOodmJo3ngjDEh9rDN7EmFyGoJ_OesGBNDDn3j8vu-HAMwuH0g@mail.gmail.com>
Message-ID: <CAOM3y2jmLQ67KtxGF-wtQPZyVh-TGGBQq7P_5QHa45FCsiF+NQ@mail.gmail.com>

Hi Sean,
I believe/recall this is very driver dependent. Some drivers will look for
their sidecars in the provided sibling files list returned by
VSISiblingFiles, whereas others will unconditionally try to open well-known
sidecar names they will have computed from their own name. IIRC I added
VSISiblingFiles so that some vsi backends (namely object storage based
ones) could explicitly return an empty list of sibling files in order to
prevent drivers to emit a subsequent Readdir() (which might break drivers
that require sidecar files to work, but speeds up those where sidecar files
are optional and not used in a cloud-storage environment (namely cogs) )

On Tue, Feb 13, 2024 at 6:12?PM Sean Gillies via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi all,
>
> It's not clear to me from reading
> https://gdal.org/user/virtual_file_systems.html if VSI sidecar and
> sibling file lookup works in general, by design, or whether it's an
> implementation detail of the standard VSI filesystems ("vsizip", "vsicurl",
> etc.).
>
> More specifically: if I have a "/vsipyopener/foo.tif" object, do drivers
> always look for other files at paths precisely relative to that one? Does
> this vary among drivers?
>
> --
> Sean Gillies
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240215/4c21a372/attachment.htm>

From sean.gillies at gmail.com  Fri Feb 16 07:29:41 2024
From: sean.gillies at gmail.com (Sean Gillies)
Date: Fri, 16 Feb 2024 08:29:41 -0700
Subject: [gdal-dev] VSI sidecar and sibling file lookup
In-Reply-To: <CAOM3y2jmLQ67KtxGF-wtQPZyVh-TGGBQq7P_5QHa45FCsiF+NQ@mail.gmail.com>
References: <CAOodmJo3ngjDEh9rDN7EmFyGoJ_OesGBNDDn3j8vu-HAMwuH0g@mail.gmail.com>
 <CAOM3y2jmLQ67KtxGF-wtQPZyVh-TGGBQq7P_5QHa45FCsiF+NQ@mail.gmail.com>
Message-ID: <CAOodmJogPUgS8uvXHeJYZ1KTjKRrW2A9mLJm80ngYNa2qzO-Gw@mail.gmail.com>

Thanks for the tip, Thomas!

On Thu, Feb 15, 2024 at 9:45?AM thomas bonfort <thomas.bonfort at gmail.com>
wrote:

> Hi Sean,
> I believe/recall this is very driver dependent. Some drivers will look for
> their sidecars in the provided sibling files list returned by
> VSISiblingFiles, whereas others will unconditionally try to open well-known
> sidecar names they will have computed from their own name. IIRC I added
> VSISiblingFiles so that some vsi backends (namely object storage based
> ones) could explicitly return an empty list of sibling files in order to
> prevent drivers to emit a subsequent Readdir() (which might break drivers
> that require sidecar files to work, but speeds up those where sidecar files
> are optional and not used in a cloud-storage environment (namely cogs) )
>
> On Tue, Feb 13, 2024 at 6:12?PM Sean Gillies via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> Hi all,
>>
>> It's not clear to me from reading
>> https://gdal.org/user/virtual_file_systems.html if VSI sidecar and
>> sibling file lookup works in general, by design, or whether it's an
>> implementation detail of the standard VSI filesystems ("vsizip", "vsicurl",
>> etc.).
>>
>> More specifically: if I have a "/vsipyopener/foo.tif" object, do drivers
>> always look for other files at paths precisely relative to that one? Does
>> this vary among drivers?
>>
>

-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240216/1732055b/attachment.htm>

From sean.gillies at gmail.com  Fri Feb 16 15:00:42 2024
From: sean.gillies at gmail.com (Sean Gillies)
Date: Fri, 16 Feb 2024 16:00:42 -0700
Subject: [gdal-dev] VSI sidecar and sibling file lookup
In-Reply-To: <CAOodmJogPUgS8uvXHeJYZ1KTjKRrW2A9mLJm80ngYNa2qzO-Gw@mail.gmail.com>
References: <CAOodmJo3ngjDEh9rDN7EmFyGoJ_OesGBNDDn3j8vu-HAMwuH0g@mail.gmail.com>
 <CAOM3y2jmLQ67KtxGF-wtQPZyVh-TGGBQq7P_5QHa45FCsiF+NQ@mail.gmail.com>
 <CAOodmJogPUgS8uvXHeJYZ1KTjKRrW2A9mLJm80ngYNa2qzO-Gw@mail.gmail.com>
Message-ID: <CAOodmJq6BVe9=_cyTGGOH5CLOF4gXtzzPqoNyZ4jyjAP3qMZvQ@mail.gmail.com>

Update... It looks like there are at least two different kinds of logic
around sidecar/sibling files.

My Rasterio VSI plugin currently implements only open, tell, seek, read,
write, and close. The mandatory methods. I can see GDAL probing for .aux
and .AUX files. But not .aux.xml files for some reason that I don't
understand. The dataset I'm exposing through this VSI plugin has a .ovr
file, but there's no attempt to find it. It looks like .aux.xml and .ovr
require VSI sibling files and/or readdir support, but that .aux file
support does not? I'm deducing this from the behavior of the system. It
would be hard to figure it out just by reading the code.

On Fri, Feb 16, 2024 at 8:29?AM Sean Gillies <sean.gillies at gmail.com> wrote:

> Thanks for the tip, Thomas!
>
> On Thu, Feb 15, 2024 at 9:45?AM thomas bonfort <thomas.bonfort at gmail.com>
> wrote:
>
>> Hi Sean,
>> I believe/recall this is very driver dependent. Some drivers will look
>> for their sidecars in the provided sibling files list returned by
>> VSISiblingFiles, whereas others will unconditionally try to open well-known
>> sidecar names they will have computed from their own name. IIRC I added
>> VSISiblingFiles so that some vsi backends (namely object storage based
>> ones) could explicitly return an empty list of sibling files in order to
>> prevent drivers to emit a subsequent Readdir() (which might break drivers
>> that require sidecar files to work, but speeds up those where sidecar files
>> are optional and not used in a cloud-storage environment (namely cogs) )
>>
>> On Tue, Feb 13, 2024 at 6:12?PM Sean Gillies via gdal-dev <
>> gdal-dev at lists.osgeo.org> wrote:
>>
>>> Hi all,
>>>
>>> It's not clear to me from reading
>>> https://gdal.org/user/virtual_file_systems.html if VSI sidecar and
>>> sibling file lookup works in general, by design, or whether it's an
>>> implementation detail of the standard VSI filesystems ("vsizip", "vsicurl",
>>> etc.).
>>>
>>> More specifically: if I have a "/vsipyopener/foo.tif" object, do drivers
>>> always look for other files at paths precisely relative to that one? Does
>>> this vary among drivers?
>>>
>>
>
> --
> Sean Gillies
>


-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240216/36bcf8c2/attachment.htm>

From even.rouault at spatialys.com  Sun Feb 18 07:22:36 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 18 Feb 2024 16:22:36 +0100
Subject: [gdal-dev] Motion: Adopt GDAL 3.8.4RC1 as 3.8.4 release
In-Reply-To: <00bae3aa-bca9-42e1-9c99-c60bf9c0b734@spatialys.com>
References: <00bae3aa-bca9-42e1-9c99-c60bf9c0b734@spatialys.com>
Message-ID: <c0f25609-395d-488d-b4bc-46c9cda30abb@spatialys.com>

Motion passed with +1 from PSC members JavierJS, JukkaR, HowardB and me.

Even

Le 09/02/2024 ? 10:13, Even Rouault via gdal-dev a ?crit?:
> Hi,
>
> Motion:
>
> Adopt GDAL 3.8.4RC1 as 3.8.4 release
>
> Starting with my +1
>
> Even
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Sun Feb 18 07:39:09 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 18 Feb 2024 16:39:09 +0100
Subject: [gdal-dev] GDAL 3.8.4 is released
Message-ID: <e1e3b154-4859-4150-ac3f-e769560d3e77@spatialys.com>

Hi,

On behalf of the GDAL/OGR development team, I am pleased to announce the
release of the GDAL/OGR 3.8.4 bug fix version.

Consult the release notes for the list of issues addressed:
 ??? https://github.com/OSGeo/gdal/blob/v3.8.4/NEWS.md

The sources are available at:

 ??? https://download.osgeo.org/gdal/3.8.4/gdal-3.8.4.tar.xz
 ??? https://download.osgeo.org/gdal/3.8.4/gdal-3.8.4.tar.xz.md5
 ??? https://download.osgeo.org/gdal/3.8.4/gdal-3.8.4.tar.xz.sig

or

 ??? https://download.osgeo.org/gdal/3.8.4/gdal-3.8.4.tar.gz
 ??? https://download.osgeo.org/gdal/3.8.4/gdal-3.8.4.tar.gz.md5
 ??? https://download.osgeo.org/gdal/3.8.4/gdal-3.8.4.tar.gz.sig

or

 ??? https://download.osgeo.org/gdal/3.8.4/gdal384.zip
 ??? https://download.osgeo.org/gdal/3.8.4/gdal384.zip.md5
 ??? https://download.osgeo.org/gdal/3.8.4/gdal384.zip.sig

Best regards,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Sun Feb 18 09:35:16 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 18 Feb 2024 18:35:16 +0100
Subject: [gdal-dev] VSI sidecar and sibling file lookup
In-Reply-To: <CAOodmJq6BVe9=_cyTGGOH5CLOF4gXtzzPqoNyZ4jyjAP3qMZvQ@mail.gmail.com>
References: <CAOodmJo3ngjDEh9rDN7EmFyGoJ_OesGBNDDn3j8vu-HAMwuH0g@mail.gmail.com>
 <CAOM3y2jmLQ67KtxGF-wtQPZyVh-TGGBQq7P_5QHa45FCsiF+NQ@mail.gmail.com>
 <CAOodmJogPUgS8uvXHeJYZ1KTjKRrW2A9mLJm80ngYNa2qzO-Gw@mail.gmail.com>
 <CAOodmJq6BVe9=_cyTGGOH5CLOF4gXtzzPqoNyZ4jyjAP3qMZvQ@mail.gmail.com>
Message-ID: <558540e4-24c6-4a69-83b6-9e6300e6075c@spatialys.com>

Sean,

did you implement the Stat() method ? From gdalpamdataset.cpp lines 921 
to 940, for .aux.xml to be used, you either need to implement 
ReadDir()/VSISiblingFiles or Stat(). Actually, I'd strongly recommend 
implementing Stat() as a lot of places will assume it to be working. As 
you can skip establishing the directory listing with 
GDAL_DISABLE_READDIR_ON_OPEN, all code should be robust to an empty 
readdir() result, but it will then assume Stat() to work.

The .aux file is a different story, since it is actually attempted to be 
opened with GDALOpen(), which first tries a Open(), and doesn't require 
Stat() to succeed.

.ovr files are only attempted to be opened if you do a RasterIO() call 
that involves subsampling.? A plain GDALOpen() on a .tif doesn't involve 
sidecar file loading. The GTiff reader implements a on-demand logic to 
try to open them

Even

Le 17/02/2024 ? 00:00, Sean Gillies via gdal-dev a ?crit?:
> Update... It looks like there are at least two different kinds of 
> logic around sidecar/sibling files.
>
> My Rasterio VSI plugin currently implements only open, tell, seek, 
> read, write, and close. The mandatory methods. I can see GDAL probing 
> for .aux and .AUX files. But not .aux.xml files for some reason that I 
> don't understand. The dataset I'm exposing through this VSI plugin has 
> a .ovr file, but there's no attempt to find it. It looks like .aux.xml 
> and .ovr require VSI sibling files and/or readdir support, but that 
> .aux file support does not? I'm deducing this from the behavior of the 
> system. It would be hard to figure it out just by reading the code.
>
> On Fri, Feb 16, 2024 at 8:29?AM Sean Gillies <sean.gillies at gmail.com> 
> wrote:
>
>     Thanks for the tip, Thomas!
>
>     On Thu, Feb 15, 2024 at 9:45?AM thomas bonfort
>     <thomas.bonfort at gmail.com> wrote:
>
>         Hi Sean,
>         I believe/recall this is very driver dependent. Some drivers
>         will look for their sidecars in the provided sibling files
>         list returned by VSISiblingFiles, whereas others will
>         unconditionally try to open well-known sidecar names they will
>         have computed from their own name. IIRC I added
>         VSISiblingFiles so that some vsi backends (namely object
>         storage based ones) could explicitly return an empty list of
>         sibling files in order to prevent drivers to emit a subsequent
>         Readdir() (which might break drivers that require sidecar
>         files to work, but speeds up those where sidecar files are
>         optional and not used in a cloud-storage environment (namely
>         cogs) )
>
>         On Tue, Feb 13, 2024 at 6:12?PM Sean Gillies via gdal-dev
>         <gdal-dev at lists.osgeo.org> wrote:
>
>             Hi all,
>
>             It's not clear to me from reading
>             https://gdal.org/user/virtual_file_systems.html if VSI
>             sidecar and sibling file lookup works in general, by
>             design, or whether it's an implementation detail of the
>             standard VSI filesystems ("vsizip", "vsicurl", etc.).
>
>             More specifically: if I have a "/vsipyopener/foo.tif"
>             object, do drivers always look for other files at paths
>             precisely relative to that one? Does this vary among drivers?
>
>
>
>     -- 
>     Sean Gillies
>
>
>
> -- 
> Sean Gillies
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240218/8dd88bdf/attachment.htm>

From even.rouault at spatialys.com  Sun Feb 18 09:57:51 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 18 Feb 2024 18:57:51 +0100
Subject: [gdal-dev] GDAL does not support gpkg files generated by
 GeoServer
In-Reply-To: <ca764ecc-af1c-4c97-8735-b0cdb6e81baf@terglobo.nl>
References: <ca764ecc-af1c-4c97-8735-b0cdb6e81baf@terglobo.nl>
Message-ID: <bd7d3b20-f4d4-4270-b241-52c1034b2d41@spatialys.com>

Hi,

http://www.geopackage.org/spec/#_sqlite_container "Table 1. GeoPackage 
Data Types" is pretty clear on which data types are valid in a 
GeoPackage vector table, and INT4, VARCHAR(...) or FLOAT8 are not.

You can also use the 
https://github.com/OSGeo/gdal/blob/master/swig/python/gdal-utils/osgeo_utils/samples/validate_gpkg.py 
script although it is not official, but hopefully should be faithful to 
the spec. Otherwise you can use the official validator at 
https://cite.opengeospatial.org/teamengine/

Even

Le 14/02/2024 ? 14:51, Raymond Nijssen via gdal-dev a ?crit?:
> Some fields in geopackages generated by GeoServer are not supported by 
> GDAL. I have already made a ticket for GeoServer, but I'm unsure where 
> the problem lies.
>
> More info in the GeoServer ticket here:
> https://osgeo-org.atlassian.net/browse/GEOS-11292
>
> ---
> Gpkg output can contain fields of type INT4, VARCHAR(255) and FLOAT8 
> which are not supported by GDAL/OGR. For this reason, QGIS, GRASS and 
> FME ignore those fields on import.
>
> ray at fw13:~/Downloads$ ogrinfo ext_nat_nbp.gpkg
> Warning 1: GPKG: unrecognized user_version=0x00000000 (0) on 
> 'ext_nat_nbp.gpkg'
> INFO: Open of ext_nat_nbp.gpkg'?????? using driver GPKG' successful.
> Warning 1: Field format 'INT4' not supported. Interpreted as INT
> Warning 1: Field format 'VARCHAR(255)' not supported
> Warning 1: geometry column 'deelgebied' of type 'VARCHAR(255)' ignored
> Warning 1: Field format 'FLOAT8' not supported
> Warning 1: geometry column 'oppervlakte_hectare' of type 'FLOAT8' ignored
> Warning 1: Field format 'VARCHAR(255)' not supported
> Warning 1: geometry column 'plan_naam' of type 'VARCHAR(255)' ignored
> 1: ext_nat_nbp (Multi Polygon)
>
>
> The INT4 fields are visible as INT, but all other other fields are 
> ignored. (There?s also an ?unrecognized user version?.)
> ---
>
> This also affects QGIS, GRASS and FME, cause they use GDAL for opening 
> the data source.
>
> Who's right and who's wrong here? :)
>
> Kind regards,
> Raymond
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Sun Feb 18 10:00:55 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 18 Feb 2024 19:00:55 +0100
Subject: [gdal-dev] CPLCalloc() used for small memory allocations. And
 for big ones?
In-Reply-To: <24d5b072-6eac-42a5-8075-67f1d5c36f82@betaapp.fastmail.com>
References: <PAXPR07MB7775F53C2CF2C04576DCD88DA24E2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <24d5b072-6eac-42a5-8075-67f1d5c36f82@betaapp.fastmail.com>
Message-ID: <67c3d6f0-bbce-40f0-b962-734010fb3865@spatialys.com>


Le 14/02/2024 ? 10:00, Lauren?iu Nicola via gdal-dev a ?crit?:
> Hi,
>
> On Wed, Feb 14, 2024, at 10:53, Abel Pau via gdal-dev wrote:
>>
>> Hi,
>>
>> I am currently working on a driver and have been utilizing 
>> CPL_calloc(). However, when attempting to pass the Actions, I 
>> encounter errors such as:
>>
>> warning C4244: 'function': conversion from 'MM_INTERNAL_FID' to 
>> 'size_t', possible loss of data
>>
>> This issue can be addressed by casting 'MM_INTERNAL_FID' (which is a 
>> GUInt64, essentially an unsigned long long) to 'size_t' (also 
>> essentially an unsigned long long). So, utilizing a cast is not 
>> problematic in this context.
>>
> The warning makes sense on 32-bit platforms, where that cast will be 
> problematic.
>
> However, while I didn't check what MM_INTERNAL_FID is, it doesn't 
> sound like something calloc() would take.
Agreed: if a cast to size_t is done, a range check should be done first 
if the value might be larger than std::numeric_limits<size_t>::max(), 
which might be true on 32-bit builds
>
>> However, I noticed in the function description it states "used for 
>> small memory allocations," which prompts me to inquire if there is an 
>> alternative calloc function for larger memory allocations
>>
> "Small" probably means "infallible" here. If you want a fallible 
> allocation (which you're supposed to handle), you can use VSICalloc(), 
> VSIMalloc() etc.
Agreed
>
> Laurentiu
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240218/cf462540/attachment-0001.htm>

From even.rouault at spatialys.com  Sun Feb 18 10:04:12 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 18 Feb 2024 19:04:12 +0100
Subject: [gdal-dev] Delete untagged containers
In-Reply-To: <8ff8de37-4390-4426-8ca8-0e0d9c859d48@betaapp.fastmail.com>
References: <PAXPR07MB777532C5FF1BDC9803E1C41EA2482@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <8ff8de37-4390-4426-8ca8-0e0d9c859d48@betaapp.fastmail.com>
Message-ID: <0218addc-6526-4654-8571-504b227bf1ce@spatialys.com>


Le 12/02/2024 ? 17:18, Lauren?iu Nicola via gdal-dev a ?crit?:
> Hi,
>
> That's related to the ghcr.io container registry, it's failing on your 
> fork because you're missing an access token. Don't worry about it.

confirmed it can be safely ignored. fixed per 
https://github.com/OSGeo/gdal/commit/32f73d7bad039d1d10d9bc6db77c52a429ad6472

Even

>
> Laurentiu
>
> On Mon, Feb 12, 2024, at 12:40, Abel Pau via gdal-dev wrote:
>>
>> Hi,
>>
>> when passing ?actions? there is one that I think it?s not depending 
>> on me: Delete untagged containers
>>
>>
>> Anyone know if I have to do something special to pass this one?
>>
>>
>> Thanks
>>
>>
>> *Abel Pau Garcia*
>>
>> *GIS developer*
>>
>> 	
>>
>> https://www.creaf.cat/sites/default/files/creaf-signature.png
>>
>> *a.pau at creaf.uab.cat* <mailto:a.pau at creaf.uab.cat>
>>
>> *Let's chat on Teams!* 
>> <https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
>>
>> *Tel. +34 934814277*
>>
>> 	
>>
>> https://www.creaf.cat/sites/default/files/so-en-signature.png
>>
>> https://www.creaf.cat/sites/default/files/twitter-icon-signature.png 
>> <https://twitter.com/CREAF_ecologia>https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png 
>> <https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>https://www.creaf.cat/sites/default/files/youtube-icon-signature.png 
>> <https://www.youtube.com/c/creafecologia>https://www.creaf.cat/sites/default/files/instagram-icon-signature.png 
>> <https://www.instagram.com/CREAF_ecologia/>
>>
>> *www.creaf.cat* <http://www.creaf.cat>*| **http://blog.creaf.cat* 
>> <http://blog.creaf.cat>
>>
>> 	
>>
>> https://www.creaf.cat/sites/default/files/uab_logo_signatura.png
>>
>> CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)
>>
>>
>> Before printing this electronic message, think about the environment.
>>
>> http://www.creaf.uab.cat/_signatura/line.gif
>>
>>
>>
>> _______________________________________________
>> gdal-dev mailing list
>> gdal-dev at lists.osgeo.org
>> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240218/a2817a3e/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240218/a2817a3e/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240218/a2817a3e/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240218/a2817a3e/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240218/a2817a3e/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240218/a2817a3e/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240218/a2817a3e/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240218/a2817a3e/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240218/a2817a3e/attachment-0003.jpg>

From even.rouault at spatialys.com  Sun Feb 18 10:08:01 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 18 Feb 2024 19:08:01 +0100
Subject: [gdal-dev] 
 =?utf-8?q?A_q=C3=BCestion_about_ICreateLayer=28=29_an?=
 =?utf-8?q?d_it=27s_parameter_eType?=
In-Reply-To: <PAXPR07MB77755F1A3BD2EC3A70C15F6DA2482@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB7775BB646D27AF42E2277236A2482@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB77755F1A3BD2EC3A70C15F6DA2482@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <d7f3b3c5-4541-4f55-8d97-02e034a7643d@spatialys.com>


Le 12/02/2024 ? 11:05, Abel Pau via gdal-dev a ?crit?:
>
> Hi again,
>
> forget the question.
>
> I finally use the variable to inform that layers with measures will be 
> processed without Measures.
>
Otherwise you can just use the parameter type without its name (or by 
commenting out the name)

void foo(int /* ignored_parameter */)

You might also find the following more verbose version, but I'd tend to 
prefer the above on

void foo(CPL_UNUSED int ingored_parameter)


Most drivers don't warn if you provide a measured geometry type and they 
only support the 2D version. Actually drivers that support measured 
geometries should explicitly advertize the OLCMeasuredGeometries layer 
capability. Cf 
https://gdal.org/development/rfc/rfc61_support_for_measured_geometries.html#compatibility-issues

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240218/8486579e/attachment.htm>

From even.rouault at spatialys.com  Sun Feb 18 10:10:59 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 18 Feb 2024 19:10:59 +0100
Subject: [gdal-dev] Testing the driver
In-Reply-To: <4dbe78c2-def8-f5de-1aa7-cfa2ab9f0859@aitchison.me.uk>
References: <AS8PR07MB7766B7BD8750D12E3D01EC53A24B2@AS8PR07MB7766.eurprd07.prod.outlook.com>
 <3049631d-5857-4338-bd4f-e37abe88da50@spatialys.com>
 <1375f5b9-dd9b-4f04-a67e-8838fb7bf355@spatialys.com>
 <4dbe78c2-def8-f5de-1aa7-cfa2ab9f0859@aitchison.me.uk>
Message-ID: <3103b1e4-abd3-4053-abfb-a52624723d81@spatialys.com>


Le 10/02/2024 ? 18:34, Andrew C Aitchison via gdal-dev a ?crit?:
> On Sat, 10 Feb 2024, Even Rouault via gdal-dev wrote:
>
>>
>>> To test your own development, you may have a more pleasant 
>>> experience by directly running just the tests for your driver with 
>>> something like "pytest autotest/ogr/ogr_miramon.py"? (be careful on 
>>> Windows, the content of $build_dir/autotest is copied from 
>>> $source_dir/autotest each time "cmake" is run, so if you edit your 
>>> test .py file directly in the build directory, be super careful of 
>>> not accidentally losing your work, and make sure to copy its content 
>>> to the source directory first. That's admittedly an annoying point 
>>> of the current test setup on Windows, compared to Unix where we use 
>>> symbolic links)
>>>
>> Actually Dan figured out it was possible to run directly the tests 
>> against your test file from the source directory, and not the one 
>> that is copied. Cf https://github.com/OSGeo/gdal/pull/9224
>>
>> So you can actually do from the build directory:
>>
>> pytest -c autotest/pytest.ini ../autotest/ogr/ogr_gpx.py
>
> Recent tarball releases have cmake/template/pytest.ini.in
> but how do I genenerate autotest/pytest.ini ?
It is generated by cmake
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Sun Feb 18 10:28:12 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 18 Feb 2024 19:28:12 +0100
Subject: [gdal-dev] netcdf url : should lack of range support be the
 error?
In-Reply-To: <CAAcGz99sLqPwawx8my9p=2+jNbFgKqbHbMvXUSp6HyqMJ-EUyg@mail.gmail.com>
References: <CAAcGz99sLqPwawx8my9p=2+jNbFgKqbHbMvXUSp6HyqMJ-EUyg@mail.gmail.com>
Message-ID: <ce378bf7-5fb5-4865-945e-ac5712a978a6@spatialys.com>

Hi,

addressed per https://github.com/OSGeo/gdal/pull/9244

Even

Le 15/02/2024 ? 04:29, Michael Sumner via gdal-dev a ?crit?:
> on this URL I get an error, and as far as i understand - the server 
> doesn't support range downloading, the file otherwise works fine.
>
> gdalinfo failed - unable to open 
> '/vsicurl/https://erddap.emodnet.eu/erddap/files/biology_6640_benthos_NorthSea_e4af_0f0e_6a73/04_2021_6640_diva_benthos_erddap.nc'.
>
>
> Should this trigger "Range downloading is not supported by this server" ?
>
> Full output with debug messages on:
>
>
> gdalinfo --config CPL_DEBUG ON 
> /vsicurl/https://erddap.emodnet.eu/erddap/files/biology_6640_benthos_NorthSea_e4af_0f0e_6a73/04_2021_6640_diva_benthos_erddap.nc 
> -if NetCDF
>
>
> HTTP: libcurl/7.81.0 OpenSSL/3.0.2 zlib/1.2.11 brotli/1.0.9 zstd/1.4.8 
> libidn2/2.3.2 libpsl/0.21.0 (+libidn2/2.3.2) libssh/0.9.6/openssl/zlib 
> nghttp2/1.43.0 librtmp/2.3 OpenLDAP/2.5.16
> VSICURL: 
> GetFileSize(https://erddap.emodnet.eu/erddap/files/biology_6640_benthos_NorthSea_e4af_0f0e_6a73/04_2021_6640_diva_benthos_erddap.nc)=339890640 
> ?response_code=200
> VSICURL: Downloading 0-16383 
> (https://erddap.emodnet.eu/erddap/files/biology_6640_benthos_NorthSea_e4af_0f0e_6a73/04_2021_6640_diva_benthos_erddap.nc)...
> VSICURL: Got response_code=416
> ERROR 4: 
> `/vsicurl/https://erddap.emodnet.eu/erddap/files/biology_6640_benthos_NorthSea_e4af_0f0e_6a73/04_2021_6640_diva_benthos_erddap.nc' 
> not recognized as being in a supported file format.
>
>
> -- 
> Michael Sumner
> Software and Database Engineer
> Australian Antarctic Division
> Hobart, Australia
> e-mail: mdsumner at gmail.com
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240218/aa81473d/attachment.htm>

From andrew at aitchison.me.uk  Sun Feb 18 13:49:13 2024
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Sun, 18 Feb 2024 21:49:13 +0000 (GMT)
Subject: [gdal-dev] Testing the driver
In-Reply-To: <3103b1e4-abd3-4053-abfb-a52624723d81@spatialys.com>
References: <AS8PR07MB7766B7BD8750D12E3D01EC53A24B2@AS8PR07MB7766.eurprd07.prod.outlook.com>
 <3049631d-5857-4338-bd4f-e37abe88da50@spatialys.com>
 <1375f5b9-dd9b-4f04-a67e-8838fb7bf355@spatialys.com>
 <4dbe78c2-def8-f5de-1aa7-cfa2ab9f0859@aitchison.me.uk>
 <3103b1e4-abd3-4053-abfb-a52624723d81@spatialys.com>
Message-ID: <a5d97fb7-8c8b-a345-f9a2-90d9ff677e32@aitchison.me.uk>

On Sun, 18 Feb 2024, Even Rouault wrote:

> Le 10/02/2024 ? 18:34, Andrew C Aitchison via gdal-dev a ?crit?:
>> On Sat, 10 Feb 2024, Even Rouault via gdal-dev wrote:
>> 
>>>> To test your own development, you may have a more pleasant experience by 
>>>> directly running just the tests for your driver with something like 
>>>> "pytest autotest/ogr/ogr_miramon.py"? (be careful on Windows, the content 
>>>> of $build_dir/autotest is copied from $source_dir/autotest each time 
>>>> "cmake" is run, so if you edit your test .py file directly in the build 
>>>> directory, be super careful of not accidentally losing your work, and 
>>>> make sure to copy its content to the source directory first. That's 
>>>> admittedly an annoying point of the current test setup on Windows, 
>>>> compared to Unix where we use symbolic links)
>>>> 
>>> Actually Dan figured out it was possible to run directly the tests against 
>>> your test file from the source directory, and not the one that is copied. 
>>> Cf https://github.com/OSGeo/gdal/pull/9224
>>> 
>>> So you can actually do from the build directory:
>>> 
>>> pytest -c autotest/pytest.ini ../autotest/ogr/ogr_gpx.py
>> 
>> Recent tarball releases have cmake/template/pytest.ini.in
>> but how do I genenerate autotest/pytest.ini ?
> It is generated by cmake

Ah. If I do:
   tar Jxf gdal-3.8.4rc1.tar.xz
   tar zxf gdalautotest-3.8.4rc1.tar.gz
   ln -s ../gdalautotest-3.8.4 gdal-3.8.4/autotest
   cd gdal-3.8.4
   cmake -B build
build/autotest/pytest.ini is generated.

That link is not what I had expected -
   ln -s ../gdalautotest-3.8.4 gdal-3.8.4/gdalautotest
would have been more obvious to me, and I did try running cmake inside 
gdalautotest-3.8.4 first.

-- 
Andrew C. Aitchison                      Kendal, UK
                    andrew at aitchison.me.uk

From a.pau at creaf.uab.cat  Mon Feb 19 01:01:20 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Mon, 19 Feb 2024 09:01:20 +0000
Subject: [gdal-dev] 
 =?utf-8?q?A_q=C3=BCestion_about_ICreateLayer=28=29_an?=
 =?utf-8?q?d_it=27s_parameter_eType?=
In-Reply-To: <d7f3b3c5-4541-4f55-8d97-02e034a7643d@spatialys.com>
References: <PAXPR07MB7775BB646D27AF42E2277236A2482@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB77755F1A3BD2EC3A70C15F6DA2482@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <d7f3b3c5-4541-4f55-8d97-02e034a7643d@spatialys.com>
Message-ID: <PAXPR07MB7775DE9963A8EBF737DFEB75A2512@PAXPR07MB7775.eurprd07.prod.outlook.com>

Thanks,
I didn?t know that you can comment the name (but not the type) to explicity tell the compiler this parameter will not be used!


De: Even Rouault <even.rouault at spatialys.com>
Enviado el: diumenge, 18 de febrer de 2024 19:08
Para: Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] A q?estion about ICreateLayer() and it's parameter eType



Le 12/02/2024 ? 11:05, Abel Pau via gdal-dev a ?crit :
Hi again,
forget the question.
I finally use the variable to inform that layers with measures will be processed without Measures.
Otherwise you can just use the parameter type without its name (or by commenting out the name)

void foo(int /* ignored_parameter */)

You might also find the following more verbose version, but I'd tend to prefer the above on

void foo(CPL_UNUSED int ingored_parameter)



Most drivers don't warn if you provide a measured geometry type and they only support the 2D version. Actually drivers that support measured geometries should explicitly advertize the OLCMeasuredGeometries layer capability. Cf https://gdal.org/development/rfc/rfc61_support_for_measured_geometries.html#compatibility-issues

Even

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/d8ebab30/attachment.htm>

From a.pau at creaf.uab.cat  Mon Feb 19 04:11:41 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Mon, 19 Feb 2024 12:11:41 +0000
Subject: [gdal-dev] Building documentation on windows
Message-ID: <PAXPR07MB77752E8F9EF087C6BEC7AA55A2512@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi,
I'm trying to build documentation (I am using windows) following the instructions at https://gdal.org/development/dev_documentation.html .

When I do make html something is not working:

(gdal) D:\GitHub-repository\GDAL\doc>make html
mkdir -p build/xml && cd .. && ((cat Doxyfile | sed "s/PREDEFINED             = /PREDEFINED             = DOXYGEN_XML /"; printf "GENERATE_HTML=NO\nGENERATE_XML=YES\nXML_OUTPUT=doc/build/xml\nXML_PROGRAMLISTING=NO") | doxygen -)
La sintaxis del comando no es correcta.
make: *** [.doxygen_up_to_date] Error 1


"La sintaxis del comando no es correcta." means "syntax error".

Any idea of what I am loosing?
Thanks :)



Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/cd8aa0a7/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/cd8aa0a7/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/cd8aa0a7/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/cd8aa0a7/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/cd8aa0a7/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/cd8aa0a7/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/cd8aa0a7/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/cd8aa0a7/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/cd8aa0a7/attachment-0003.jpg>

From even.rouault at spatialys.com  Mon Feb 19 05:07:28 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 19 Feb 2024 14:07:28 +0100
Subject: [gdal-dev] Building documentation on windows
In-Reply-To: <PAXPR07MB77752E8F9EF087C6BEC7AA55A2512@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB77752E8F9EF087C6BEC7AA55A2512@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <a5788170-cc7a-4d09-9ade-b899c8173736@spatialys.com>


Le 19/02/2024 ? 13:11, Abel Pau via gdal-dev a ?crit?:
>
> Hi,
>
> I?m trying to build documentation (I am using windows) following the 
> instructions at https://gdal.org/development/dev_documentation.html .
>
Building the docs on Windows is unknown territory.? If you really want 
to do that, you'll probably need to spin up some Linux environment, 
perhaps through Vagrant: 
https://gdal.org/development/dev_environment.html#vagrant .

WSL2 with a Ubuntu image might also be an option. (You might probably 
also do that with a Cygwin / msys64 environment, but you'll be on your own.)

Even

> When I do make html something is not working:
>
> (gdal) D:\GitHub-repository\GDAL\doc>make html
>
> mkdir -p build/xml && cd .. && ((cat Doxyfile | sed 
> "s/PREDEFINED???????????? = /PREDEFINED???????????? = DOXYGEN_XML /"; 
> printf 
> "GENERATE_HTML=NO\nGENERATE_XML=YES\nXML_OUTPUT=doc/build/xml\nXML_PROGRAMLISTING=NO") 
> | doxygen -)
>
> La sintaxis del comando no es correcta.
>
> make: *** [.doxygen_up_to_date] Error 1
>
> ?La sintaxis del comando no es correcta.? means ?syntax error?.
>
> Any idea of what I am loosing?
>
> Thanks :)
>
> *Abel Pau Garcia*
>
> *GIS developer*
>
> 	
>
> https://www.creaf.cat/sites/default/files/creaf-signature.png
>
> *a.pau at creaf.uab.cat* <mailto:a.pau at creaf.uab.cat>
>
> *Let's chat on Teams!* 
> <https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
>
> *Tel. +34 934814277*
>
> 	
>
> https://www.creaf.cat/sites/default/files/so-en-signature.png
>
> https://www.creaf.cat/sites/default/files/twitter-icon-signature.png 
> <https://twitter.com/CREAF_ecologia>https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png 
> <https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>https://www.creaf.cat/sites/default/files/youtube-icon-signature.png 
> <https://www.youtube.com/c/creafecologia>https://www.creaf.cat/sites/default/files/instagram-icon-signature.png 
> <https://www.instagram.com/CREAF_ecologia/>
>
> *www.creaf.cat* <http://www.creaf.cat>*| **http://blog.creaf.cat* 
> <http://blog.creaf.cat>
>
> 	
>
> https://www.creaf.cat/sites/default/files/uab_logo_signatura.png
>
> CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)
>
>
> Before printing this electronic message, think about the environment.
>
> http://www.creaf.uab.cat/_signatura/line.gif
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/546f04b4/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/546f04b4/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/546f04b4/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/546f04b4/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/546f04b4/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/546f04b4/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/546f04b4/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/546f04b4/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/546f04b4/attachment-0003.jpg>

From a.pau at creaf.uab.cat  Mon Feb 19 07:02:49 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Mon, 19 Feb 2024 15:02:49 +0000
Subject: [gdal-dev] Building documentation on windows
In-Reply-To: <a5788170-cc7a-4d09-9ade-b899c8173736@spatialys.com>
References: <PAXPR07MB77752E8F9EF087C6BEC7AA55A2512@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <a5788170-cc7a-4d09-9ade-b899c8173736@spatialys.com>
Message-ID: <PAXPR07MB7775C7AB58C31B813A0A69AEA2512@PAXPR07MB7775.eurprd07.prod.outlook.com>

Ok, I think I can manage with that. I wanted to be sure if I was doing something wrong.
thanks!!

De: Even Rouault <even.rouault at spatialys.com>
Enviado el: dilluns, 19 de febrer de 2024 14:07
Para: Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Building documentation on windows



Le 19/02/2024 ? 13:11, Abel Pau via gdal-dev a ?crit :
Hi,
I?m trying to build documentation (I am using windows) following the instructions at https://gdal.org/development/dev_documentation.html .

Building the docs on Windows is unknown territory.  If you really want to do that, you'll probably need to spin up some Linux environment, perhaps through Vagrant: https://gdal.org/development/dev_environment.html#vagrant .

WSL2 with a Ubuntu image might also be an option. (You might probably also do that with a Cygwin / msys64 environment, but you'll be on your own.)

Even

When I do make html something is not working:

(gdal) D:\GitHub-repository\GDAL\doc>make html
mkdir -p build/xml && cd .. && ((cat Doxyfile | sed "s/PREDEFINED             = /PREDEFINED             = DOXYGEN_XML /"; printf "GENERATE_HTML=NO\nGENERATE_XML=YES\nXML_OUTPUT=doc/build/xml\nXML_PROGRAMLISTING=NO") | doxygen -)
La sintaxis del comando no es correcta.
make: *** [.doxygen_up_to_date] Error 1


?La sintaxis del comando no es correcta.? means ?syntax error?.

Any idea of what I am loosing?
Thanks :)



Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.






_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/aea0154a/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/aea0154a/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/aea0154a/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/aea0154a/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/aea0154a/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/aea0154a/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/aea0154a/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/aea0154a/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240219/aea0154a/attachment-0003.jpg>

From mirza.nawandish at haritaevi.com  Mon Feb 19 22:10:33 2024
From: mirza.nawandish at haritaevi.com (Shahrukh Mirza Nawandish)
Date: Tue, 20 Feb 2024 09:10:33 +0300
Subject: [gdal-dev] Inquiry about Elevation Values in DXF Conversion
 using ogr2ogr
In-Reply-To: <SYBPR01MB8011FA89EC9145515DCB45F8E07A2@SYBPR01MB8011.ausprd01.prod.outlook.com>
References: <282451706101868@mail.yandex.com.tr>
 <PAXPR07MB7775049065C6659F212C0384A27B2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <987771706105669@mail.yandex.com.tr>
 <PAXPR07MB7775DB1B9B0AE8C6F1ABAD18A27B2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKtqo0Afbwp6w=fd6KwgQqJ7fHCy+w8=7axnaGBQLO6NDA@mail.gmail.com>
 <839101706111558@mail.yandex.com>
 <SYBPR01MB8011FA89EC9145515DCB45F8E07A2@SYBPR01MB8011.ausprd01.prod.outlook.com>
Message-ID: <248231708409267@mail.yandex.com.tr>

An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/2f72ebcd/attachment-0001.htm>

From eruiz at aplitop.com  Tue Feb 20 02:15:21 2024
From: eruiz at aplitop.com (Elena Ruiz)
Date: Tue, 20 Feb 2024 10:15:21 +0000
Subject: [gdal-dev] GeoTiff with ColorInterp=Palette
Message-ID: <AS8P192MB2191E10B20C6F4C3DCA57D76BB502@AS8P192MB2191.EURP192.PROD.OUTLOOK.COM>

Hello, I have version 3.6.2 of GDAL and I need to crop an image using a contour from a GML file, so far there is no problem.

The problem begins when the original image is a GEOTIFF with transparency and it generates a cropped image, the information of both images is a little lower.

The color table changes from having 2 values to having 256, this causes it to lose transparency although it has the label "Mask Flags: PER_DATASET ALPHA" which indicates that it has an alpha channel.

My question is, why does the color table change?, and is there any parameter that can be used with gdalwarp or gdal_translate to avoid this and keep the image transparent?



I use this command:

gdalwarp.exe -cutline fichero.gml -crop_to_cutline -dstalpha ficheroIN ficheroOUT --config GDAL_DATA rutaGDAL


ORIGINAL IMAGE

Driver: GTiff/GeoTIFF

Size is 5616, 3655

?

Metadata:

  TIFFTAG_RESOLUTIONUNIT=2 (pixels/inch)

  TIFFTAG_XRESOLUTION=300

  TIFFTAG_YRESOLUTION=300

Image Structure Metadata:

  INTERLEAVE=BAND

Corner Coordinates:

?

Band 1 Block=5616x1493 Type=Byte, ColorInterp=Palette

  Image Structure Metadata:

    NBITS=1

  Color Table (RGB with 2 entries)

    0: 0,0,0,255

    1: 255,255,255,255



CROPPED IMAGE

Driver: GTiff/GeoTIFF

Size is 5605, 2689

?.

Metadata:

  TIFFTAG_DATETIME=2024:02:09 08:49:12

  TIFFTAG_RESOLUTIONUNIT=2 (pixels/inch)

  TIFFTAG_SOFTWARE=Microsoft Windows Photo Viewer 10.0.19041.1

  TIFFTAG_XRESOLUTION=300

  TIFFTAG_YRESOLUTION=300

Image Structure Metadata:

  COMPRESSION=LZW

  INTERLEAVE=PIXEL

Corner Coordinates:

?.

Band 1 Block=5605x1 Type=Byte, ColorInterp=Palette

  Mask Flags: PER_DATASET ALPHA

  Color Table (RGB with 256 entries)

    0: 0,0,0,255

    1: 255,255,255,255

    2: 0,0,0,255

    3: 0,0,0,255

?.

  252: 0,0,0,255

  253: 0,0,0,255

  254: 0,0,0,255

  255: 0,0,0,255



I await your response, thank you and regards.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/a893efcd/attachment-0001.htm>

From michael.otto at data-experts.de  Tue Feb 20 03:22:05 2024
From: michael.otto at data-experts.de (Michael Otto)
Date: Tue, 20 Feb 2024 12:22:05 +0100
Subject: [gdal-dev] Antwort: Re: Build static GDAL-Lib and static GDAL-Apps
In-Reply-To: <CAFLLRpLb8AfHASb2eTER2obpz7HxYdUWZnFwHQ+HKUqAr7oMBA@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAFLLRpLb8AfHASb2eTER2obpz7HxYdUWZnFwHQ+HKUqAr7oMBA@mail.gmail.com>
Message-ID: <OF1DE3314E.328DD35B-ONC1258AC9.003E3151-C1258AC9.003E71EB@data-experts.de>

Hi Robert,

because I'm not getting anywhere with the "standard" CMake solution, I've 
now used the vcpkg you mentioned and am using it in a Virtualbox VM with 
Linux Mint.

I got the installation instructions from here: 
https://github.com/microsoft/vcpkg?tab=readme-ov-file#quick-start-unix. I 
have installed the Linux developer tools (see instructions).

I have installed vcpkg under 
'root at vmuser-VirtualBox:/home/vmuser/Git/vcpkg'.

When installing the libraries, it seems that a lot of dependencies are 
also loaded, compiled and installed in the now large set of directories.

The directory './vcpkg/packages/<packageName>_x64-linux' now contains the 
compiled static versions of the libraries. But where can I find the GDAL 
apps? These are not contained in this directory. 

I am still new to the topic of "self-compiling".
Do you have any tips on what else I need to do?

Michael




Von:    "Robert Coup" <robert.coup at koordinates.com>
An:     "Michael Otto" <michael.otto at data-experts.de>
Kopie:  gdal-dev at lists.osgeo.org
Datum:  12.02.2024 15:43
Betreff:        Re: [gdal-dev] Build static GDAL-Lib and static GDAL-Apps



Hi Michael,

On Mon, 12 Feb 2024 at 12:02, Michael Otto via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

The goal is to cast GDAL and all its dependencies (PROJ / GEOS / all 
dependencies to system libraries / ...) into a static library and to 
create the GDAL apps as static executable programs. 

Which platform are you working on? If you need a fully static compilation 
of everything all the way down including openssl + zlib + zstd + libtiff + 
all the other libraries, using vcpkg[1] might be a reasonable approach. By 
default it does static compilation on macOS & Linux, and it has a static 
compilation option on Windows (the default on Windows is dynamic). It 
doesn't support every compile option though, but it's customisable and if 
you're after a reasonably vanilla GDAL it should work ok.
 

There should be no dynamic dependencies.

Note that GDAL + Proj (maybe others), have data files they rely on, so 
while you may be able to get a single executable, you'll still need to 
distribute these files. I can imagine ways around that, but they're 
getting fairly complex.
 
Unfortunately, I have not had any success so far. The library is created 
statically but the apps are not yet.
Does anyone have experience with this topic or possibly a procedure that 
leads to success?

Can you share the process you've currently got to?

Rob :) 

[1] https://github.com/microsoft/vcpkg



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/00c89f89/attachment.htm>

From even.rouault at spatialys.com  Tue Feb 20 04:04:12 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 20 Feb 2024 13:04:12 +0100
Subject: [gdal-dev] GeoTiff with ColorInterp=Palette
In-Reply-To: <AS8P192MB2191E10B20C6F4C3DCA57D76BB502@AS8P192MB2191.EURP192.PROD.OUTLOOK.COM>
References: <AS8P192MB2191E10B20C6F4C3DCA57D76BB502@AS8P192MB2191.EURP192.PROD.OUTLOOK.COM>
Message-ID: <2f117d92-cf08-46b8-9c7f-4deec2dcdbb7@spatialys.com>


Le 20/02/2024 ? 11:15, Elena Ruiz via gdal-dev a ?crit?:
> Hello, I have version 3.6.2 of GDAL and I need to crop an image using 
> a contour from a GML file, so far there is no problem.
>
> The problem begins when the original image is a GEOTIFF with 
> transparency and it generates a cropped image, the information of both 
> images is a little lower.
>
> The color table changes from having 2 values to having 256, this 
> causes it to lose transparency although it has the label "Mask Flags: 
> PER_DATASET ALPHA" which indicates that it has an alpha channel.
>
> My question is, why does the color table change?, and is there any 
> parameter that can be used with gdalwarp or gdal_translate to avoid 
> this and keep the image transparent?

Strictly speaking your input image has no transparency, just black & 
white colors. Not sure which one you interpret as transparent?


You could force a 1-bit output image (ie with a color palette of 2 
colors) by adding -co NBITS=1 . But that will likely won't play well 
with -dstalpha.? You'd then want to use instead -dstnodata 0 if black is 
the transparent color or -dstnodata 1 if white is the transparent color


Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/d214f770/attachment.htm>

From dg0yt at darc.de  Tue Feb 20 04:12:17 2024
From: dg0yt at darc.de (Kai Pastor, DG0YT)
Date: Tue, 20 Feb 2024 13:12:17 +0100
Subject: [gdal-dev] Antwort: Re: Build static GDAL-Lib and static
 GDAL-Apps
In-Reply-To: <OF1DE3314E.328DD35B-ONC1258AC9.003E3151-C1258AC9.003E71EB@data-experts.de>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAFLLRpLb8AfHASb2eTER2obpz7HxYdUWZnFwHQ+HKUqAr7oMBA@mail.gmail.com>
 <OF1DE3314E.328DD35B-ONC1258AC9.003E3151-C1258AC9.003E71EB@data-experts.de>
Message-ID: <60659c22-866c-4c31-9c45-5157e226445a@darc.de>

When you install gdal[tools], the apps are installed to 
`<install_root>/tools/gdal`.
(The vcpkg focus is on providing libs build from source.)

To explore port features, you can look at the port's vcpkg.json (aka 
manifest), or start from
https://vcpkg.link/ports/gdal

Regards,
Kai


Am 20.02.24 um 12:22 schrieb Michael Otto via gdal-dev:
> Hi Robert,
>
> because I'm not getting anywhere with the "standard" CMake solution, 
> I've now used the vcpkg you mentioned and am using it in a Virtualbox 
> VM with Linux Mint.
>
> I got the installation instructions from here: 
> https://github.com/microsoft/vcpkg?tab=readme-ov-file#quick-start-unix 
> <https://github.com/microsoft/vcpkg?tab=readme-ov-file#quick-start-unix>. 
> I have installed the Linux developer tools (see instructions).
>
> I have installed vcpkg under 
> 'root at vmuser-VirtualBox:/home/vmuser/Git/vcpkg'.
>
> When installing the libraries, it seems that a lot of dependencies are 
> also loaded, compiled and installed in the now large set of directories.
>
> The directory './vcpkg/packages/<packageName>_x64-linux' now contains 
> the compiled static versions of the libraries. But where can I find 
> the GDAL apps? These are not contained in this directory.
>
> I am still new to the topic of "self-compiling".
> Do you have any tips on what else I need to do?
>
> Michael
>
>
>
>
> Von: "Robert Coup" <robert.coup at koordinates.com>
> An: "Michael Otto" <michael.otto at data-experts.de>
> Kopie: gdal-dev at lists.osgeo.org
> Datum: 12.02.2024 15:43
> Betreff: Re: [gdal-dev] Build static GDAL-Lib and static GDAL-Apps
> ------------------------------------------------------------------------
>
>
>
> Hi Michael,
>
> On Mon, 12 Feb 2024 at 12:02, Michael Otto via gdal-dev 
> <_gdal-dev at lists.osgeo.org_ <mailto:gdal-dev at lists.osgeo.org>> wrote:
>
> The goal is to cast GDAL and all its dependencies (PROJ / GEOS / all 
> dependencies to system libraries / ...) into a static library and to 
> create the GDAL apps as static executable programs.
>
> Which platform are?you working on? If you need a fully static 
> compilation of everything /all/ the way down including openssl + zlib 
> + zstd + libtiff + all the other libraries, using vcpkg[1] might be a 
> reasonable approach. By default it does static compilation on macOS?& 
> Linux, and it has a static compilation option on Windows (the default 
> on Windows is dynamic). It doesn't support every compile option 
> though, but it's customisable and if you're after a reasonably vanilla 
> GDAL it should work ok.
>
>
> There should be no dynamic dependencies.
>
> Note that GDAL?+ Proj (maybe others), have data files they rely on, so 
> while you may be able to get a single executable, you'll still need to 
> distribute these files. I can imagine ways around that, but they're 
> getting fairly complex.
>
> Unfortunately, I have not had any success so far. The library is 
> created statically but the apps are not yet.
> Does anyone have experience with this topic or possibly a procedure 
> that leads to success?
>
> Can you share the process you've currently got to?
>
> Rob :)
>
> [1] _https://github.com/microsoft/vcpkg_ 
> <https://github.com/microsoft/vcpkg>
>
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/52fa219d/attachment.htm>

From robert.coup at koordinates.com  Tue Feb 20 04:18:43 2024
From: robert.coup at koordinates.com (Robert Coup)
Date: Tue, 20 Feb 2024 12:18:43 +0000
Subject: [gdal-dev] Build static GDAL-Lib and static GDAL-Apps
In-Reply-To: <OF1DE3314E.328DD35B-ONC1258AC9.003E3151-C1258AC9.003E71EB@data-experts.de>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAFLLRpLb8AfHASb2eTER2obpz7HxYdUWZnFwHQ+HKUqAr7oMBA@mail.gmail.com>
 <OF1DE3314E.328DD35B-ONC1258AC9.003E3151-C1258AC9.003E71EB@data-experts.de>
Message-ID: <CAFLLRpLkVcOn2b8or8FodPFrjDeytt9NN3L5BwN-YXkQp+o-PA@mail.gmail.com>

Hi Michael,

On Tue, 20 Feb 2024 at 11:22, Michael Otto <michael.otto at data-experts.de>
wrote:

> The directory './vcpkg/packages/<packageName>_x64-linux' now contains the
> compiled static versions of the libraries. But where can I find the GDAL
> apps? These are not contained in this directory.


Great! So if you change your vcpkg installation to use `gdal[tools]`
instead of `gdal`, it will build the applications too.

If you need other dependencies, see https://vcpkg.link/ports/gdal then you
can install eg: `gdal[tools,curl]` to add curl too. The options shown under
`default-features` are automatically installed.

Rob :)

>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/8ca7e219/attachment-0001.htm>

From dg0yt at darc.de  Tue Feb 20 04:36:22 2024
From: dg0yt at darc.de (dg0yt at darc.de)
Date: Tue, 20 Feb 2024 13:36:22 +0100 (CET)
Subject: [gdal-dev] Build static GDAL-Lib and static GDAL-Apps
In-Reply-To: <CAFLLRpLkVcOn2b8or8FodPFrjDeytt9NN3L5BwN-YXkQp+o-PA@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAFLLRpLb8AfHASb2eTER2obpz7HxYdUWZnFwHQ+HKUqAr7oMBA@mail.gmail.com>
 <OF1DE3314E.328DD35B-ONC1258AC9.003E3151-C1258AC9.003E71EB@data-experts.de>
 <CAFLLRpLkVcOn2b8or8FodPFrjDeytt9NN3L5BwN-YXkQp+o-PA@mail.gmail.com>
Message-ID: <1683620045.272495.1708432582226@office.mailbox.org>

> > The directory './vcpkg/packages/<packageName>_x64-linux' now contains the compiled static versions of the libraries. But where can I find the GDAL apps? These are not contained in this directory.

Ignore packages. It is a staging area. `installed` is the real thing.

Kai

From michael.otto at data-experts.de  Tue Feb 20 04:50:04 2024
From: michael.otto at data-experts.de (Michael Otto)
Date: Tue, 20 Feb 2024 13:50:04 +0100
Subject: [gdal-dev] Antwort: Re: Build static GDAL-Lib and static GDAL-Apps
In-Reply-To: <1683620045.272495.1708432582226@office.mailbox.org>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAFLLRpLb8AfHASb2eTER2obpz7HxYdUWZnFwHQ+HKUqAr7oMBA@mail.gmail.com>
 <OF1DE3314E.328DD35B-ONC1258AC9.003E3151-C1258AC9.003E71EB@data-experts.de>
 <CAFLLRpLkVcOn2b8or8FodPFrjDeytt9NN3L5BwN-YXkQp+o-PA@mail.gmail.com>
 <1683620045.272495.1708432582226@office.mailbox.org>
Message-ID: <OF605439F1.D2FE920B-ONC1258AC9.00462C35-C1258AC9.00467FF9@data-experts.de>

Thanks to all who have responded.

I have now tried it with 'vcpkg install gdal[tools]'. The tools/apps are 
there, but they are not statically linked!

See for example gdalinfo:

root at vmuser-VirtualBox:/home/vmuser/Git/vcpkg/installed/x64-linux/tools/gdal# 
ldd gdalinfo
        linux-vdso.so.1 (0x00007ffcc0fb3000)
        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007fe3a31ae000)
        libstdc++.so.6 => /lib/x86_64-linux-gnu/libstdc++.so.6 
(0x00007fe3a2f82000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007fe3a2d59000)
        /lib64/ld-linux-x86-64.so.2 (0x00007fe3a6b09000)
        libgcc_s.so.1 => /lib/x86_64-linux-gnu/libgcc_s.so.1 
(0x00007fe3a2d39000)

Michael


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/36ef14a3/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Tue Feb 20 06:37:35 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Tue, 20 Feb 2024 14:37:35 +0000
Subject: [gdal-dev] Question about PG_LIST_ALL_TABLES in the documentation
Message-ID: <DB9PR09MB6887677F2C8FEB5D69F5412BFD502@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

I don't undestand this part of the PosgGIS driver documentation https://gdal.org/drivers/vector/pg.html#faqs
"Permission issues on geometry_columns and/or spatial_ref_sys tables can be generally confirmed if you can see the tables by setting the configuration option PG_LIST_ALL_TABLES to YES. (e.g. ogrinfo - -config PG_LIST_ALL_TABLES YES PG:xxxxx)"

For the first, was the meaning to say the opposite, that there are permission issues if you cannot see the tables? And for the second, with current GDAL and PostGIS versions user does not see geometry_columns and spatial_ref_sys on the ogrinfo layer list even with this config option. It seems that they are filtered away from the result. I do see that the config option has an effect and for example raster_columns and raster_overviews are added to the layer list.

An easy way to check the permissions is to query those views/tables directly.
ogrinfo PG:xxxxx spatial_ref_sys
ogrinfo PG:xxxxx geometry_columns

If ogrinfo lists something else than an error, then permissions are OK. Is this method good enough so I could edit the documentation?

-Jukka Rahkonen-


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/a949d46f/attachment.htm>

From even.rouault at spatialys.com  Tue Feb 20 06:55:35 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 20 Feb 2024 15:55:35 +0100
Subject: [gdal-dev] Question about PG_LIST_ALL_TABLES in the
 documentation
In-Reply-To: <DB9PR09MB6887677F2C8FEB5D69F5412BFD502@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <DB9PR09MB6887677F2C8FEB5D69F5412BFD502@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <ff59bfa9-73c3-4e00-b8f2-80f84a40ffa5@spatialys.com>

Jukka,

I would probably completely remove that paragraph, or at least remove 
the wrong hint on how to check if permissions are correct. Correct 
permission settings of a PostgreSQL/PostGIS database is probably out of 
scope of the driver documentation. But your suggestion for an alternate 
method sounds OK too.

spatial_ref_sys and geometry_columns table/views are always removed from 
the listing due 
https://github.com/OSGeo/gdal/blob/e7f14b7ff025bea54b9fd2363cda5eeae6d5ade6/ogr/ogrsf_frmts/pg/ogrpgdatasource.cpp#L1357 
. The weird thing is that looking in the history that filtering was 
already done before the FAQ entry was written, so I'm not sure to 
remember what I had in mind 16 years ago when I wrote it :-)

Even

Le 20/02/2024 ? 15:37, Rahkonen Jukka via gdal-dev a ?crit?:
>
> Hi,
>
> I don?t undestand this part of the PosgGIS driver documentation 
> https://gdal.org/drivers/vector/pg.html#faqs
>
> ?Permission issues on geometry_columns and/or spatial_ref_sys tables 
> can be generally confirmed if you can see the tables by setting the 
> configuration option PG_LIST_ALL_TABLES to YES. (e.g. ogrinfo - 
> -config PG_LIST_ALL_TABLES YES PG:xxxxx)?
>
> For the first, was the meaning to say the opposite, that there are 
> permission issues if you cannot see the tables? And for the second, 
> with current GDAL and PostGIS versions user does not see 
> geometry_columns and spatial_ref_sys on the ogrinfo layer list even 
> with this config option. It seems that they are filtered away from the 
> result. I do see that the config option has an effect and for example 
> raster_columns and raster_overviews are added to the layer list.
>
> An easy way to check the permissions is to query those views/tables 
> directly.
> ogrinfo PG:xxxxx spatial_ref_sys
>
> ogrinfo PG:xxxxx geometry_columns
>
> If ogrinfo lists something else than an error, then permissions are 
> OK. Is this method good enough so I could edit the documentation?
>
> -Jukka Rahkonen-
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/41dd9c14/attachment-0001.htm>

From robert.coup at koordinates.com  Tue Feb 20 07:26:09 2024
From: robert.coup at koordinates.com (Robert Coup)
Date: Tue, 20 Feb 2024 15:26:09 +0000
Subject: [gdal-dev] Build static GDAL-Lib and static GDAL-Apps
In-Reply-To: <OF605439F1.D2FE920B-ONC1258AC9.00462C35-C1258AC9.00467FF9@data-experts.de>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAFLLRpLb8AfHASb2eTER2obpz7HxYdUWZnFwHQ+HKUqAr7oMBA@mail.gmail.com>
 <OF1DE3314E.328DD35B-ONC1258AC9.003E3151-C1258AC9.003E71EB@data-experts.de>
 <CAFLLRpLkVcOn2b8or8FodPFrjDeytt9NN3L5BwN-YXkQp+o-PA@mail.gmail.com>
 <1683620045.272495.1708432582226@office.mailbox.org>
 <OF605439F1.D2FE920B-ONC1258AC9.00462C35-C1258AC9.00467FF9@data-experts.de>
Message-ID: <CAFLLRpJdY-0ek4_2mEu3avkH1KDnCAZCHiyMe1cKN3zKYdrXFA@mail.gmail.com>

Hi,

On Tue, 20 Feb 2024 at 12:50, Michael Otto <michael.otto at data-experts.de>
wrote:

>
> I have now tried it with 'vcpkg install gdal[tools]'. The tools/apps are
> there, but they are not statically linked!
>
> See for example gdalinfo:
>
> root at vmuser-VirtualBox:/home/vmuser/Git/vcpkg/installed/x64-linux/tools/gdal#
> ldd gdalinfo
>         linux-vdso.so.1 (0x00007ffcc0fb3000)
>         libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007fe3a31ae000)
>         libstdc++.so.6 => /lib/x86_64-linux-gnu/libstdc++.so.6
> (0x00007fe3a2f82000)
>         libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007fe3a2d59000)
>         /lib64/ld-linux-x86-64.so.2 (0x00007fe3a6b09000)
>         libgcc_s.so.1 => /lib/x86_64-linux-gnu/libgcc_s.so.1
> (0x00007fe3a2d39000)


You're closer! GDAL itself is statically linked into those executables, as
are its dependencies...

So, I did a test, and I think this is what you need:

$ mkdir custom-triplets
$ cp vcpkg/triplets/x64-linux.cmake custom-triplets/x64-linux-static.cmake

(a "triplet" is a vcpkg configuration for a particular system/cpu/build
configuration ? linux vs windows vs android, static vs dynamic, x64 vs arm,
etc)

Then edit custom-triplets/x64-linux-static.cmake and change the following
to tell it to statically link the system libraries as well:

- set(VCPKG_CRT_LINKAGE dynamic)
+ set(VCPKG_CRT_LINKAGE static)

Then build GDAL using your new triplet:

$ vcpkg/vcpkg --overlay-triplets=custom-triplets --triplet=x64-linux-static
install gdal[tools]

But of course it's not quite that simple... libtiff needs a fix too:

$ mkdir custom-ports
$ cp -a vcpkg/ports/tiff custom-ports/tiff

Then edit custom-ports/tiff/FindCMath.patch and change the following line:

- +find_library(CMath_LIBRARY NAMES m PATHS
${CMAKE_C_IMPLICIT_LINK_DIRECTORIES})
+ +find_library(CMath_LIBRARY NAMES libm.a m PATHS
${CMAKE_C_IMPLICIT_LINK_DIRECTORIES})

(this is super-hacky, there will definitely be a cleaner fix than this, but
it works for this purpose right now)

And there's a static linking issue with something SQLite-plugin-related in
GDAL. So lets reduce GDAL to just the core dependencies and the tools:

$ vcpkg/vcpkg --overlay-triplets=custom-triplets --triplet=x64-linux-static
--overlay-ports=custom-ports install gdal[core,tools]
... go and play in the sunshine ...
$ vcpkg/installed/x64-linux-static/tools/gdal/gdalinfo --version
GDAL 3.8.3, released 2024/01/04
$ ldd vcpkg/installed/x64-linux-static/tools/gdal/gdalinfo
not a dynamic executable

Victory! Now you can hopefully add any other GDAL features/dependencies via
the gdal[core,tools,...] vcpkg feature options. *Fully* static binaries
aren't really a normal tested output, so you might run into further issues.

Hope that helps,

Rob :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/e7324fe4/attachment.htm>

From simon.eves at heavy.ai  Tue Feb 20 10:58:27 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Tue, 20 Feb 2024 10:58:27 -0800
Subject: [gdal-dev] Build static GDAL-Lib and static GDAL-Apps
In-Reply-To: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
Message-ID: <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>

One of our build variants is a fully-static (or as-static-as-possible) done
on CentOS 7 for old-Linux compatibility.

In reverse-dependency order we have static builds of

SQLite 3450100
Expat 2.5.0
KML 1.2.0
HDF5 1.12.1
NetCDF 4.8.1
TIFF 4.5.1
Proj 9.3.0
GeoTIFF 1.7.1
LittleCMS 2.15
WebP 1.3.2
Zstd 1.4.8
OpenJPEG 2.5.0
GDAL 3.7.3

We use GEOS as well, but directly, not linked into GDAL.

We do our own builds of TIFF and GeoTIFF since they are also dependencies
of other libs we use (e.g. pdal for LIDAR import) and the rest are to
activate desirable GDAL drivers.

LittleCMS, WebP, Zstd, and OpenJPEG were added recently in order to
activate the GDAL JPEG2000 driver (for Sentinel2 satellite raster data) and
it took some time to get all the options right so the static stack would
work.

I can provide the build options we use for the static, if that would be
helpful.

I never got the GDAL tools compiling as full-static, but that's not
important for us, as we don't bundle those with our product. Our
development systems are Ubuntu with more conventional dynamic builds.

We still have one VERY strange issue whereby FlatGeoBuf export fails in a
very consistent and reproducible form down in the flatbuffer code, but only
in the static build, and only in the full system. I have written a simple
test harness that links the very same static libgdal and does a simple GDAL
startup and FGB export of a single feature and that works fine. It's some
kind of data/stack corruption when it first tries to write to the
flatbuffer on the first feature, which results in a pointer member of the
buffer class becoming 0x100000000000 (always) instead of null, and then it
stops on an assert. There is also one private function in the
vector_downward class which the debugger won't even step into in that
build.  I can even put printfs in that function and they don't come out.
I've tried it on CentOS and on Ubuntu, with GCC and Clang, and it's always
the same. Everything else in GDAL works just fine (we have LOTS of
import/export unit tests). This makes zero sense as all the FGB code is
internal to GDAL and compiled together. I've been poking at it for over a
week and it's doing my head in.

Not meaning to derail this thread, but just wondering if anyone else had
encountered any strange run-time behavior with static builds.


On Mon, Feb 12, 2024 at 4:02?AM Michael Otto via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hello,
>
> I have been trying for some time to compile GDAL and the GDAL apps as a
> static library / executable programs.
>
> The goal is to cast GDAL and all its dependencies (PROJ / GEOS / all
> dependencies to system libraries / ...) into a static library and to create
> the GDAL apps as static executable programs.
> There should be no dynamic dependencies.
>
> Unfortunately, I have not had any success so far. The library is created
> statically but the apps are not yet.
> Does anyone have experience with this topic or possibly a procedure that
> leads to success?
>
> Best regards.
> Michael Otto
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/99066b2e/attachment.htm>

From robert.coup at koordinates.com  Tue Feb 20 12:33:19 2024
From: robert.coup at koordinates.com (Robert Coup)
Date: Tue, 20 Feb 2024 20:33:19 +0000
Subject: [gdal-dev] Build static GDAL-Lib and static GDAL-Apps
In-Reply-To: <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
Message-ID: <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>

Hi Simon,

On Tue, 20 Feb 2024 at 18:58, Simon Eves via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> We still have one VERY strange issue whereby FlatGeoBuf export fails in a
> very consistent and reproducible form down in the flatbuffer code, but only
> in the static build, and only in the full system. I have written a simple
> test harness that links the very same static libgdal and does a simple GDAL
> startup and FGB export of a single feature and that works fine. It's some
> kind of data/stack corruption when it first tries to write to the
> flatbuffer on the first feature, which results in a pointer member of the
> buffer class becoming 0x100000000000 (always) instead of null, and then it
> stops on an assert. There is also one private function in the
> vector_downward class which the debugger won't even step into in that
> build.  I can even put printfs in that function and they don't come out.
> I've tried it on CentOS and on Ubuntu, with GCC and Clang, and it's always
> the same. Everything else in GDAL works just fine (we have LOTS of
> import/export unit tests). This makes zero sense as all the FGB code is
> internal to GDAL and compiled together. I've been poking at it for over a
> week and it's doing my head in.
>

One cause of this sort of crash is a header/library mismatch somewhere
where a function is expecting different parameters/types than the caller is
actually providing. Otherwise, maybe a bug in glibc/libstdc++/gcc/something
that's been fixed in the intervening ten years since CentOS 7 was released?

If you run your *build* on a modern distro/libc/gcc/etc does it change
things? If it's the same, maybe hints more towards the former.

ASAN (https://github.com/google/sanitizers/wiki/AddressSanitizer) might
help track down stack/heap corruption.

Rob :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/ab59ddc9/attachment.htm>

From simon.eves at heavy.ai  Tue Feb 20 13:05:32 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Tue, 20 Feb 2024 13:05:32 -0800
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
Message-ID: <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>

(starting a new thread to avoid derailing the static-build one any further)

Totally agreed on the mismatch idea, but the code in question is all
self-contained down in *ogr/ogrsf_frmts/flatgeobuf* and the *flatbuffers*
sub-project (which is a snapshot of a Google OSS project) so I'm struggling
to see how there could be a mismatch.

Also, although we're building on CentOS 7, we're using relatively new
compilers (GCC 11.4 and Clang 14.0.6), and we bundle the matching newer
runtimes.

We don't have a full static build stack on our normal dev platform (Ubuntu
22.04) so I haven't been able to repro the problem there.

I should have mentioned the first time that we have tried using ASAN, and
it definitely catches something wrong, but the behavior is different, and
varies if you add more debug printfs. For example:

DEBUG: vector_downward::push() num = 16
DEBUG: about to reallocate, buf_ = 0, cur_ = 0, scratch = 0
DEBUG: reallocated, buf_ = 0x61900062d380, cur_ = 0x61900062cf80, scratch =
0
DEBUG: vector_downward::push() ptr = 0x61900062cf70, about to do memcpy
=================================================================
==25459==ERROR: AddressSanitizer: heap-buffer-overflow on address
0x61900062cf70 at pc 0x7f8933eb87f6 bp 0x7fffa7aa0e70 sp 0x7fffa7aa0620
WRITE of size 16 at 0x61900062cf70 thread T0

...but it's still not obvious what exactly is going wrong. The code and
data flow makes perfect sense when you step through it in a dynamic build
that doesn't fail.

Like I said, the frustrating part is that a simple test program (attached)
compiled against the same set of static libs works fine.

S

On Tue, Feb 20, 2024 at 12:33?PM Robert Coup <robert.coup at koordinates.com>
wrote:

> Hi Simon,
>
> On Tue, 20 Feb 2024 at 18:58, Simon Eves via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
>> We still have one VERY strange issue whereby FlatGeoBuf export fails in a
>> very consistent and reproducible form down in the flatbuffer code, but only
>> in the static build, and only in the full system. I have written a simple
>> test harness that links the very same static libgdal and does a simple GDAL
>> startup and FGB export of a single feature and that works fine. It's some
>> kind of data/stack corruption when it first tries to write to the
>> flatbuffer on the first feature, which results in a pointer member of the
>> buffer class becoming 0x100000000000 (always) instead of null, and then it
>> stops on an assert. There is also one private function in the
>> vector_downward class which the debugger won't even step into in that
>> build.  I can even put printfs in that function and they don't come out.
>> I've tried it on CentOS and on Ubuntu, with GCC and Clang, and it's always
>> the same. Everything else in GDAL works just fine (we have LOTS of
>> import/export unit tests). This makes zero sense as all the FGB code is
>> internal to GDAL and compiled together. I've been poking at it for over a
>> week and it's doing my head in.
>>
>
> One cause of this sort of crash is a header/library mismatch somewhere
> where a function is expecting different parameters/types than the caller is
> actually providing. Otherwise, maybe a bug in glibc/libstdc++/gcc/something
> that's been fixed in the intervening ten years since CentOS 7 was released?
>
>
> If you run your *build* on a modern distro/libc/gcc/etc does it change
> things? If it's the same, maybe hints more towards the former.
>
> ASAN (https://github.com/google/sanitizers/wiki/AddressSanitizer) might
> help track down stack/heap corruption.
>
> Rob :)
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/d508b290/attachment.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: gdal_export_test.cpp
Type: text/x-c++src
Size: 3341 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/d508b290/attachment.cpp>

From simon.eves at heavy.ai  Tue Feb 20 13:10:51 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Tue, 20 Feb 2024 13:10:51 -0800
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
 <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
Message-ID: <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>

Here's the stack trace for the original assert. Something is stepping on
scratch_ to make it 0x1000000000 instead of null, which it starts out as
when the flatbuffer object is created, but by the time it gets to
allocating memory, it's broken.

On Tue, Feb 20, 2024 at 1:05?PM Simon Eves <simon.eves at heavy.ai> wrote:

> (starting a new thread to avoid derailing the static-build one any further)
>
> Totally agreed on the mismatch idea, but the code in question is all
> self-contained down in *ogr/ogrsf_frmts/flatgeobuf* and the *flatbuffers*
> sub-project (which is a snapshot of a Google OSS project) so I'm struggling
> to see how there could be a mismatch.
>
> Also, although we're building on CentOS 7, we're using relatively new
> compilers (GCC 11.4 and Clang 14.0.6), and we bundle the matching newer
> runtimes.
>
> We don't have a full static build stack on our normal dev platform (Ubuntu
> 22.04) so I haven't been able to repro the problem there.
>
> I should have mentioned the first time that we have tried using ASAN, and
> it definitely catches something wrong, but the behavior is different, and
> varies if you add more debug printfs. For example:
>
> DEBUG: vector_downward::push() num = 16
> DEBUG: about to reallocate, buf_ = 0, cur_ = 0, scratch = 0
> DEBUG: reallocated, buf_ = 0x61900062d380, cur_ = 0x61900062cf80, scratch
> = 0
> DEBUG: vector_downward::push() ptr = 0x61900062cf70, about to do memcpy
> =================================================================
> ==25459==ERROR: AddressSanitizer: heap-buffer-overflow on address
> 0x61900062cf70 at pc 0x7f8933eb87f6 bp 0x7fffa7aa0e70 sp 0x7fffa7aa0620
> WRITE of size 16 at 0x61900062cf70 thread T0
>
> ...but it's still not obvious what exactly is going wrong. The code and
> data flow makes perfect sense when you step through it in a dynamic build
> that doesn't fail.
>
> Like I said, the frustrating part is that a simple test program (attached)
> compiled against the same set of static libs works fine.
>
> S
>
> On Tue, Feb 20, 2024 at 12:33?PM Robert Coup <robert.coup at koordinates.com>
> wrote:
>
>> Hi Simon,
>>
>> On Tue, 20 Feb 2024 at 18:58, Simon Eves via gdal-dev <
>> gdal-dev at lists.osgeo.org> wrote:
>>
>>> We still have one VERY strange issue whereby FlatGeoBuf export fails in
>>> a very consistent and reproducible form down in the flatbuffer code, but
>>> only in the static build, and only in the full system. I have written a
>>> simple test harness that links the very same static libgdal and does a
>>> simple GDAL startup and FGB export of a single feature and that works fine.
>>> It's some kind of data/stack corruption when it first tries to write to the
>>> flatbuffer on the first feature, which results in a pointer member of the
>>> buffer class becoming 0x100000000000 (always) instead of null, and then it
>>> stops on an assert. There is also one private function in the
>>> vector_downward class which the debugger won't even step into in that
>>> build.  I can even put printfs in that function and they don't come out.
>>> I've tried it on CentOS and on Ubuntu, with GCC and Clang, and it's always
>>> the same. Everything else in GDAL works just fine (we have LOTS of
>>> import/export unit tests). This makes zero sense as all the FGB code is
>>> internal to GDAL and compiled together. I've been poking at it for over a
>>> week and it's doing my head in.
>>>
>>
>> One cause of this sort of crash is a header/library mismatch somewhere
>> where a function is expecting different parameters/types than the caller is
>> actually providing. Otherwise, maybe a bug in glibc/libstdc++/gcc/something
>> that's been fixed in the intervening ten years since CentOS 7 was released?
>>
>>
>> If you run your *build* on a modern distro/libc/gcc/etc does it change
>> things? If it's the same, maybe hints more towards the former.
>>
>> ASAN (https://github.com/google/sanitizers/wiki/AddressSanitizer) might
>> help track down stack/heap corruption.
>>
>> Rob :)
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/9b1457f5/attachment-0001.htm>
-------------- next part --------------
Thread 1 "ImportExportTes" received signal SIGABRT, Aborted.
__GI_raise (sig=sig at entry=6) at ../sysdeps/unix/sysv/linux/raise.c:50
50  ../sysdeps/unix/sysv/linux/raise.c: No such file or directory.
(gdb) where
#0  __GI_raise (sig=sig at entry=6) at ../sysdeps/unix/sysv/linux/raise.c:50
#1  0x00007ffff5ec6859 in __GI_abort () at abort.c:79
#2  0x00007ffff5ec6729 in __assert_fail_base (fmt=0x7ffff605c588 "%s%s%s:%u: %s%sAssertion `%s' failed.\n%n", assertion=0x13bf5a98 "cur_ >= scratch_ && scratch_ >= buf_", 
    file=0x13bf5a40 "/build/scripts/gdal-3.7.3/ogr/ogrsf_frmts/flatgeobuf/flatbuffers/vector_downward.h", line=136, function=<optimized out>) at assert.c:92
#3  0x00007ffff5ed7fd6 in __GI___assert_fail (assertion=0x13bf5a98 "cur_ >= scratch_ && scratch_ >= buf_", 
    file=0x13bf5a40 "/build/scripts/gdal-3.7.3/ogr/ogrsf_frmts/flatgeobuf/flatbuffers/vector_downward.h", line=136, 
    function=0x13bf5a00 "size_t flatbuffers::vector_downward::ensure_space(size_t)") at assert.c:101
#4  0x000000000a240bec in flatbuffers::vector_downward::ensure_space (this=0x7fffffff9070, len=16) at /build/scripts/gdal-3.7.3/ogr/ogrsf_frmts/flatgeobuf/flatbuffers/vector_downward.h:136
#5  0x000000000a240c8c in flatbuffers::vector_downward::make_space (this=0x7fffffff9070, len=16) at /build/scripts/gdal-3.7.3/ogr/ogrsf_frmts/flatgeobuf/flatbuffers/vector_downward.h:146
#6  0x000000000a240e38 in flatbuffers::vector_downward::push (this=0x7fffffff9070, bytes=0x1bfc2a70 "", num=16)
    at /build/scripts/gdal-3.7.3/ogr/ogrsf_frmts/flatgeobuf/flatbuffers/vector_downward.h:182
#7  0x000000000a241153 in flatbuffers::FlatBufferBuilder::PushBytes (this=0x7fffffff9070, bytes=0x1bfc2a70 "", size=16)
    at /build/scripts/gdal-3.7.3/ogr/ogrsf_frmts/flatgeobuf/flatbuffers/flatbuffer_builder.h:262
#8  0x000000000a245f50 in flatbuffers::FlatBufferBuilder::CreateVector<double> (this=0x7fffffff9070, v=0x1bfc2a70, len=2)
    at /build/scripts/gdal-3.7.3/ogr/ogrsf_frmts/flatgeobuf/flatbuffers/flatbuffer_builder.h:634
#9  0x000000000a2445c5 in flatbuffers::FlatBufferBuilder::CreateVector<double, std::allocator<double> > (this=0x7fffffff9070, v=...)
    at /build/scripts/gdal-3.7.3/ogr/ogrsf_frmts/flatgeobuf/flatbuffers/flatbuffer_builder.h:684
#10 0x000000000a259152 in FlatGeobuf::CreateGeometryDirect (_fbb=..., ends=0x0, xy=0x7fffffff8f88, z=0x0, m=0x0, t=0x0, tm=0x0, type=FlatGeobuf::GeometryType::Unknown, parts=0x0)
    at /build/scripts/gdal-3.7.3/ogr/ogrsf_frmts/flatgeobuf/feature_generated.h:182
#11 0x000000000a258d44 in ogr_flatgeobuf::GeometryWriter::write (this=0x7fffffff8f70, depth=0) at /build/scripts/gdal-3.7.3/ogr/ogrsf_frmts/flatgeobuf/geometrywriter.cpp:243
#12 0x000000000a23b51d in OGRFlatGeobufLayer::ICreateFeature (this=0x1bd2a160, poNewFeature=0x1b9b94d0) at /build/scripts/gdal-3.7.3/ogr/ogrsf_frmts/flatgeobuf/ogrflatgeobuflayer.cpp:2159
#13 0x000000000a2d799b in OGRLayer::CreateFeature (this=0x1bd2a160, poFeature=0x1b9b94d0) at /build/scripts/gdal-3.7.3/ogr/ogrsf_frmts/generic/ogrlayer.cpp:642
#14 0x0000000006d9ae95 in import_export::QueryExporterGDAL::exportResults (this=0x1c9c8d70, query_results=...)
    at /home/simon.eves/work/master/heavydb-internal/ImportExport/QueryExporterGDAL.cpp:716
#15 0x0000000006bde00c in Parser::ExportQueryStmt::execute (this=0x7fffffff9d30, session=..., read_only_mode=false) at /home/simon.eves/work/master/heavydb-internal/Parser/ParserNode.cpp:6601

From simon.eves at heavy.ai  Tue Feb 20 13:12:23 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Tue, 20 Feb 2024 13:12:23 -0800
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
 <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
 <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
Message-ID: <CAJf0KTSJYDwYf7LFw6f=1p9E3Mq8WPUQ0MrvfwyShdS+iAG=Cw@mail.gmail.com>

gdb) p m_fbb
$5 = (flatbuffers::FlatBufferBuilder &) @0x7fffffff9070: {static
kFileIdentifierLength = 4, buf_ = {allocator_ = 0x0, own_allocator_ =
false, initial_size_ = 1024, buffer_minalign_ = 8, reserved_ = 0, size_ =
0, buf_ = 0x0, cur_ = 0x0,
    scratch_ = 0x1000000000000 <error: Cannot access memory at address
0x1000000000000>}, num_field_loc = 8, max_voffset_ = 0, nested = false,
finished = false, minalign_ = 8, force_defaults_ = false, dedup_vtables_ =
true, string_pool = 0x0}

On Tue, Feb 20, 2024 at 1:10?PM Simon Eves <simon.eves at heavy.ai> wrote:

> Here's the stack trace for the original assert. Something is stepping on
> scratch_ to make it 0x1000000000 instead of null, which it starts out as
> when the flatbuffer object is created, but by the time it gets to
> allocating memory, it's broken.
>
> On Tue, Feb 20, 2024 at 1:05?PM Simon Eves <simon.eves at heavy.ai> wrote:
>
>> (starting a new thread to avoid derailing the static-build one any
>> further)
>>
>> Totally agreed on the mismatch idea, but the code in question is all
>> self-contained down in *ogr/ogrsf_frmts/flatgeobuf* and the *flatbuffers*
>> sub-project (which is a snapshot of a Google OSS project) so I'm struggling
>> to see how there could be a mismatch.
>>
>> Also, although we're building on CentOS 7, we're using relatively new
>> compilers (GCC 11.4 and Clang 14.0.6), and we bundle the matching newer
>> runtimes.
>>
>> We don't have a full static build stack on our normal dev platform
>> (Ubuntu 22.04) so I haven't been able to repro the problem there.
>>
>> I should have mentioned the first time that we have tried using ASAN, and
>> it definitely catches something wrong, but the behavior is different, and
>> varies if you add more debug printfs. For example:
>>
>> DEBUG: vector_downward::push() num = 16
>> DEBUG: about to reallocate, buf_ = 0, cur_ = 0, scratch = 0
>> DEBUG: reallocated, buf_ = 0x61900062d380, cur_ = 0x61900062cf80, scratch
>> = 0
>> DEBUG: vector_downward::push() ptr = 0x61900062cf70, about to do memcpy
>> =================================================================
>> ==25459==ERROR: AddressSanitizer: heap-buffer-overflow on address
>> 0x61900062cf70 at pc 0x7f8933eb87f6 bp 0x7fffa7aa0e70 sp 0x7fffa7aa0620
>> WRITE of size 16 at 0x61900062cf70 thread T0
>>
>> ...but it's still not obvious what exactly is going wrong. The code and
>> data flow makes perfect sense when you step through it in a dynamic build
>> that doesn't fail.
>>
>> Like I said, the frustrating part is that a simple test program
>> (attached) compiled against the same set of static libs works fine.
>>
>> S
>>
>> On Tue, Feb 20, 2024 at 12:33?PM Robert Coup <robert.coup at koordinates.com>
>> wrote:
>>
>>> Hi Simon,
>>>
>>> On Tue, 20 Feb 2024 at 18:58, Simon Eves via gdal-dev <
>>> gdal-dev at lists.osgeo.org> wrote:
>>>
>>>> We still have one VERY strange issue whereby FlatGeoBuf export fails in
>>>> a very consistent and reproducible form down in the flatbuffer code, but
>>>> only in the static build, and only in the full system. I have written a
>>>> simple test harness that links the very same static libgdal and does a
>>>> simple GDAL startup and FGB export of a single feature and that works fine.
>>>> It's some kind of data/stack corruption when it first tries to write to the
>>>> flatbuffer on the first feature, which results in a pointer member of the
>>>> buffer class becoming 0x100000000000 (always) instead of null, and then it
>>>> stops on an assert. There is also one private function in the
>>>> vector_downward class which the debugger won't even step into in that
>>>> build.  I can even put printfs in that function and they don't come out.
>>>> I've tried it on CentOS and on Ubuntu, with GCC and Clang, and it's always
>>>> the same. Everything else in GDAL works just fine (we have LOTS of
>>>> import/export unit tests). This makes zero sense as all the FGB code is
>>>> internal to GDAL and compiled together. I've been poking at it for over a
>>>> week and it's doing my head in.
>>>>
>>>
>>> One cause of this sort of crash is a header/library mismatch somewhere
>>> where a function is expecting different parameters/types than the caller is
>>> actually providing. Otherwise, maybe a bug in glibc/libstdc++/gcc/something
>>> that's been fixed in the intervening ten years since CentOS 7 was released?
>>>
>>>
>>> If you run your *build* on a modern distro/libc/gcc/etc does it change
>>> things? If it's the same, maybe hints more towards the former.
>>>
>>> ASAN (https://github.com/google/sanitizers/wiki/AddressSanitizer) might
>>> help track down stack/heap corruption.
>>>
>>> Rob :)
>>>
>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/b62d557f/attachment.htm>

From robert.coup at koordinates.com  Tue Feb 20 13:49:15 2024
From: robert.coup at koordinates.com (Robert Coup)
Date: Tue, 20 Feb 2024 21:49:15 +0000
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <CAFLLRp+8+1MwLZPJMVFa17dOp_5G1e_Jz2O10zV4J5FiGvhbdA@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
 <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
 <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
 <CAFLLRp+8+1MwLZPJMVFa17dOp_5G1e_Jz2O10zV4J5FiGvhbdA@mail.gmail.com>
Message-ID: <CAFLLRp+MqLP2rqywpjVNjhP_jmhqT2-fVG+UTVMSKR-4277s-w@mail.gmail.com>

Hi,

On Tue, 20 Feb 2024 at 21:44, Robert Coup <robert.coup at koordinates.com>
wrote:

> Hi Simon,
>
> On Tue, 20 Feb 2024 at 21:11, Simon Eves <simon.eves at heavy.ai> wrote:
>
>> Here's the stack trace for the original assert. Something is stepping on
>> scratch_ to make it 0x1000000000 instead of null, which it starts out as
>> when the flatbuffer object is created, but by the time it gets to
>> allocating memory, it's broken.
>>
>
> What happens if you set a watchpoint in gdb when the flatbuffer is created?
>
> watch -l myfb->scratch
> or watch *0x1234c0ffee
>

Or I've also had success with Mozilla's rr: https://rr-project.org/ ? you
can run to a point where scratch is wrong, set a watchpoint on it, and then
run the program backwards to find out what touched it.

Rob :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240220/e314a9c9/attachment.htm>

From a.pau at creaf.uab.cat  Tue Feb 20 22:03:29 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Wed, 21 Feb 2024 06:03:29 +0000
Subject: [gdal-dev] Some Tests fail in Actions tab of my branch
Message-ID: <PAXPR07MB777511EB772A0F4F3B4BBFDBA2572@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi,
lately I've been solving some issues in my code to finally do a pull request of the MiraMon vector driver.

There some things about test in the action I don't understand. I haven't commit any test yet. So I assume it's not my fault.
Anyone knows why some of them are failing?

At macos_build action:
https://github.com/AbelPau/gdal/actions/runs/7978287443/job/21783093990#step:6:2449
There are some =================================== FAILURES ===================================


At build-linux-ubuntu-focal
The following tests FAILED:
https://github.com/AbelPau/gdal/actions/runs/7978287434/job/21783086492#step:15:5119
54 - autotest_ogr (Failed)  <-- Remember: there are no tests on my side already.

At build-windows-msys2-mingw
Final version 1 * AbelPau/gdal at 3a8d91e (github.com)<https://github.com/AbelPau/gdal/actions/runs/7978287434/job/21783088167#step:12:6039>

There are other but I think that all are in the same problem.

[cid:image009.png at 01DA6494.12729ED0]


Thanks for any clarification!!

Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/fbe93bec/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/fbe93bec/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/fbe93bec/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/fbe93bec/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/fbe93bec/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/fbe93bec/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/fbe93bec/attachment-0012.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/fbe93bec/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/fbe93bec/attachment-0003.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image009.png
Type: image/png
Size: 14780 bytes
Desc: image009.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/fbe93bec/attachment-0013.png>

From michael.otto at data-experts.de  Wed Feb 21 03:18:41 2024
From: michael.otto at data-experts.de (Michael Otto)
Date: Wed, 21 Feb 2024 12:18:41 +0100
Subject: [gdal-dev] Antwort: Re: Re: Build static GDAL-Lib and static
 GDAL-Apps
In-Reply-To: <CAFLLRpJdY-0ek4_2mEu3avkH1KDnCAZCHiyMe1cKN3zKYdrXFA@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAFLLRpLb8AfHASb2eTER2obpz7HxYdUWZnFwHQ+HKUqAr7oMBA@mail.gmail.com>
 <OF1DE3314E.328DD35B-ONC1258AC9.003E3151-C1258AC9.003E71EB@data-experts.de>
 <CAFLLRpLkVcOn2b8or8FodPFrjDeytt9NN3L5BwN-YXkQp+o-PA@mail.gmail.com>
 <1683620045.272495.1708432582226@office.mailbox.org>
 <OF605439F1.D2FE920B-ONC1258AC9.00462C35-C1258AC9.00467FF9@data-experts.de>
 <CAFLLRpJdY-0ek4_2mEu3avkH1KDnCAZCHiyMe1cKN3zKYdrXFA@mail.gmail.com>
Message-ID: <OFEC530CF4.991A126F-ONC1258ACA.003DE6A4-C1258ACA.003E222C@data-experts.de>

Hello Robert,

I've also tried the problem with libtiff, but couldn't solve it. Thanks 
for the tip!

With "gdal[core,tools]" the apps are now static. 
BUT I want to use exactly what is still causing problems: SQLite for the 
creation of MBTiles (possibly GPKG) .

That doesn't seem to work then :o( ?

Is there perhaps still a possibility to use SQLite3 in the static apps if 
I continue my first attempt without vcpkg?

Michael




Von:    "Robert Coup" <robert.coup at koordinates.com>
An:     "Michael Otto" <michael.otto at data-experts.de>
Kopie:  dg0yt at darc.de, gdal-dev at lists.osgeo.org
Datum:  20.02.2024 16:26
Betreff:        Re: Re: [gdal-dev] Build static GDAL-Lib and static 
GDAL-Apps



Hi,

On Tue, 20 Feb 2024 at 12:50, Michael Otto <michael.otto at data-experts.de> 
wrote:

I have now tried it with 'vcpkg install gdal[tools]'. The tools/apps are 
there, but they are not statically linked!

See for example gdalinfo:

root at vmuser-VirtualBox:/home/vmuser/Git/vcpkg/installed/x64-linux/tools/gdal# 
ldd gdalinfo
        linux-vdso.so.1 (0x00007ffcc0fb3000)
        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007fe3a31ae000)
        libstdc++.so.6 => /lib/x86_64-linux-gnu/libstdc++.so.6 
(0x00007fe3a2f82000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007fe3a2d59000)
        /lib64/ld-linux-x86-64.so.2 (0x00007fe3a6b09000)
        libgcc_s.so.1 => /lib/x86_64-linux-gnu/libgcc_s.so.1 
(0x00007fe3a2d39000)

You're closer! GDAL itself is statically linked into those executables, as 
are its dependencies...

So, I did a test, and I think this is what you need:

$ mkdir custom-triplets
$ cp vcpkg/triplets/x64-linux.cmake custom-triplets/x64-linux-static.cmake

(a "triplet" is a vcpkg configuration for a particular system/cpu/build 
configuration ? linux vs windows vs android, static vs dynamic, x64 vs 
arm, etc)

Then edit custom-triplets/x64-linux-static.cmake and change the following 
to tell it to statically link the system libraries as well:

- set(VCPKG_CRT_LINKAGE dynamic)
+ set(VCPKG_CRT_LINKAGE static)

Then build GDAL using your new triplet:

$ vcpkg/vcpkg --overlay-triplets=custom-triplets 
--triplet=x64-linux-static install gdal[tools]

But of course it's not quite that simple... libtiff needs a fix too:

$ mkdir custom-ports
$ cp -a vcpkg/ports/tiff custom-ports/tiff

Then edit custom-ports/tiff/FindCMath.patch and change the following line:

- +find_library(CMath_LIBRARY NAMES m PATHS 
${CMAKE_C_IMPLICIT_LINK_DIRECTORIES})
+ +find_library(CMath_LIBRARY NAMES libm.a m PATHS 
${CMAKE_C_IMPLICIT_LINK_DIRECTORIES})

(this is super-hacky, there will definitely be a cleaner fix than this, 
but it works for this purpose right now)

And there's a static linking issue with something SQLite-plugin-related in 
GDAL. So lets reduce GDAL to just the core dependencies and the tools:

$ vcpkg/vcpkg --overlay-triplets=custom-triplets 
--triplet=x64-linux-static --overlay-ports=custom-ports install 
gdal[core,tools]
... go and play in the sunshine ...
$ vcpkg/installed/x64-linux-static/tools/gdal/gdalinfo --version
GDAL 3.8.3, released 2024/01/04
$ ldd vcpkg/installed/x64-linux-static/tools/gdal/gdalinfo
not a dynamic executable

Victory! Now you can hopefully add any other GDAL features/dependencies 
via the gdal[core,tools,...] vcpkg feature options. Fully static binaries 
aren't really a normal tested output, so you might run into further 
issues.

Hope that helps,

Rob :)



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/ce9f3a34/attachment.htm>

From even.rouault at spatialys.com  Wed Feb 21 03:34:14 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 21 Feb 2024 12:34:14 +0100
Subject: [gdal-dev] Some Tests fail in Actions tab of my branch
In-Reply-To: <PAXPR07MB777511EB772A0F4F3B4BBFDBA2572@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB777511EB772A0F4F3B4BBFDBA2572@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <538776ab-3595-4055-a0a8-7cac786ee63d@spatialys.com>

Abel,

> Hi,
>
> lately I?ve been solving some issues in my code to finally do a pull 
> request of the MiraMon vector driver.
>
> There some things about test in the action I don?t understand. I 
> haven?t commit any test yet. So I assume it?s not my fault.
>
> Anyone knows why some of them are failing?
>
You can see in the logs that it fails on 
autotest/ogr/ogr_basic_test.py::test_ogr_basic_10, and this test runs 
"test_ogrsf -all_drivers". As the name suggests, this test does some 
very minimal testing of all OGR drivers. I assume it must crash when 
running on the Miramon driver

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/b8b79c98/attachment.htm>

From a.pau at creaf.uab.cat  Wed Feb 21 03:36:07 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Wed, 21 Feb 2024 11:36:07 +0000
Subject: [gdal-dev] Some Tests fail in Actions tab of my branch
In-Reply-To: <538776ab-3595-4055-a0a8-7cac786ee63d@spatialys.com>
References: <PAXPR07MB777511EB772A0F4F3B4BBFDBA2572@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <538776ab-3595-4055-a0a8-7cac786ee63d@spatialys.com>
Message-ID: <PAXPR07MB7775A372F7B9F85034D5B281A2572@PAXPR07MB7775.eurprd07.prod.outlook.com>

Ah ok!! Thanks Even.
I?ll review that, then! I didn?t though in that way

De: Even Rouault <even.rouault at spatialys.com>
Enviado el: dimecres, 21 de febrer de 2024 12:34
Para: Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Some Tests fail in Actions tab of my branch


Abel,
Hi,
lately I?ve been solving some issues in my code to finally do a pull request of the MiraMon vector driver.

There some things about test in the action I don?t understand. I haven?t commit any test yet. So I assume it?s not my fault.
Anyone knows why some of them are failing?

You can see in the logs that it fails on autotest/ogr/ogr_basic_test.py::test_ogr_basic_10, and this test runs "test_ogrsf -all_drivers". As the name suggests, this test does some very minimal testing of all OGR drivers. I assume it must crash when running on the Miramon driver
Even

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/1edb3174/attachment-0001.htm>

From robert.coup at koordinates.com  Wed Feb 21 03:42:04 2024
From: robert.coup at koordinates.com (Robert Coup)
Date: Wed, 21 Feb 2024 11:42:04 +0000
Subject: [gdal-dev] Build static GDAL-Lib and static GDAL-Apps
In-Reply-To: <OFEC530CF4.991A126F-ONC1258ACA.003DE6A4-C1258ACA.003E222C@data-experts.de>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAFLLRpLb8AfHASb2eTER2obpz7HxYdUWZnFwHQ+HKUqAr7oMBA@mail.gmail.com>
 <OF1DE3314E.328DD35B-ONC1258AC9.003E3151-C1258AC9.003E71EB@data-experts.de>
 <CAFLLRpLkVcOn2b8or8FodPFrjDeytt9NN3L5BwN-YXkQp+o-PA@mail.gmail.com>
 <1683620045.272495.1708432582226@office.mailbox.org>
 <OF605439F1.D2FE920B-ONC1258AC9.00462C35-C1258AC9.00467FF9@data-experts.de>
 <CAFLLRpJdY-0ek4_2mEu3avkH1KDnCAZCHiyMe1cKN3zKYdrXFA@mail.gmail.com>
 <OFEC530CF4.991A126F-ONC1258ACA.003DE6A4-C1258ACA.003E222C@data-experts.de>
Message-ID: <CAFLLRpLMG4b9LM6OwBE-2oQDEnXnU19d7gW-s2xHBZa2scJXrA@mail.gmail.com>

Hi,

On Wed, 21 Feb 2024 at 11:18, Michael Otto <michael.otto at data-experts.de>
wrote:

>
> I've also tried the problem with libtiff, but couldn't solve it. Thanks
> for the tip!



With "gdal[core,tools]" the apps are now static.


Excellent.


> BUT I want to use exactly what is still causing problems: SQLite for the
> creation of MBTiles (possibly GPKG) .


Inevitably!


> Is there perhaps still a possibility to use SQLite3 in the static apps if
> I continue my first attempt without vcpkg?


I think it's possible: I chucked away my test container, but I vaguely
recall it was in something in the sqlite ogr driver labelled "test"?
There's a couple defined at the end of
ogr/ogrsf_frmts/sqlite/CMakeLists.txt ? it's possible commenting those
blocks out will make the compile complete with [core,tools,sqlite3].  There
may be some downsides: I don't know off the top of my head how the GDAL
SQLite/GPKG integration works wrt exposing the necessary GDAL functions
into SQLite. It might just work though :-)

You'll need to:
* copy the vcpkg/ports/gdal/ dir to custom-ports/gdal/
* add a patch with the change to the sqlite CMakeLists.txt file
* add your patch name to the top of custom-ports/gdal/portfile.cmake

You *probably* want to add [geos,png] as well. That might throw up some
more fun.

Rob :)

>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/27b60165/attachment.htm>

From even.rouault at spatialys.com  Wed Feb 21 03:48:43 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 21 Feb 2024 12:48:43 +0100
Subject: [gdal-dev] Some Tests fail in Actions tab of my branch
In-Reply-To: <PAXPR07MB7775A372F7B9F85034D5B281A2572@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB777511EB772A0F4F3B4BBFDBA2572@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <538776ab-3595-4055-a0a8-7cac786ee63d@spatialys.com>
 <PAXPR07MB7775A372F7B9F85034D5B281A2572@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <3462f26d-166b-4938-9a92-3dc513fe11c1@spatialys.com>

I've skimmed *very quickly* over the code (by the way you should create 
a dedicated git branch and not hack into the master branch. cf 
https://gdal.org/development/dev_practices.html#working-with-a-feature-branch), 
so in no means a code review,? but I noticed there's a LGPL license 
file. This is going to be a blocker if you want to submit your code for 
upstream GDAL inclusion as we can't accept LGPL in the core library. If 
the code subject to LGPL is under your control, please relicense to MIT.

Even

Le 21/02/2024 ? 12:36, Abel Pau a ?crit?:
>
> Ah ok!! Thanks Even.
>
> I?ll review that, then! I didn?t though in that way
>
> *De:*Even Rouault <even.rouault at spatialys.com>
> *Enviado el:* dimecres, 21 de febrer de 2024 12:34
> *Para:* Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some Tests fail in Actions tab of my branch
>
> Abel,
>
>     Hi,
>
>     lately I?ve been solving some issues in my code to finally do a
>     pull request of the MiraMon vector driver.
>
>     There some things about test in the action I don?t understand. I
>     haven?t commit any test yet. So I assume it?s not my fault.
>
>     Anyone knows why some of them are failing?
>
> You can see in the logs that it fails on 
> autotest/ogr/ogr_basic_test.py::test_ogr_basic_10, and this test runs 
> "test_ogrsf -all_drivers". As the name suggests, this test does some 
> very minimal testing of all OGR drivers. I assume it must crash when 
> running on the Miramon driver
>
> Even
>
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/ce824d6e/attachment.htm>

From even.rouault at spatialys.com  Wed Feb 21 04:20:01 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 21 Feb 2024 13:20:01 +0100
Subject: [gdal-dev] Build static GDAL-Lib and static GDAL-Apps
In-Reply-To: <CAFLLRpLMG4b9LM6OwBE-2oQDEnXnU19d7gW-s2xHBZa2scJXrA@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAFLLRpLb8AfHASb2eTER2obpz7HxYdUWZnFwHQ+HKUqAr7oMBA@mail.gmail.com>
 <OF1DE3314E.328DD35B-ONC1258AC9.003E3151-C1258AC9.003E71EB@data-experts.de>
 <CAFLLRpLkVcOn2b8or8FodPFrjDeytt9NN3L5BwN-YXkQp+o-PA@mail.gmail.com>
 <1683620045.272495.1708432582226@office.mailbox.org>
 <OF605439F1.D2FE920B-ONC1258AC9.00462C35-C1258AC9.00467FF9@data-experts.de>
 <CAFLLRpJdY-0ek4_2mEu3avkH1KDnCAZCHiyMe1cKN3zKYdrXFA@mail.gmail.com>
 <OFEC530CF4.991A126F-ONC1258ACA.003DE6A4-C1258ACA.003E222C@data-experts.de>
 <CAFLLRpLMG4b9LM6OwBE-2oQDEnXnU19d7gW-s2xHBZa2scJXrA@mail.gmail.com>
Message-ID: <9c80c238-294e-4a4c-bea0-b3227203955f@spatialys.com>


> I think it's possible: I chucked away my test container, but I vaguely 
> recall it was in something in the sqlite ogr driver labelled "test"? 
> There's a couple defined at the end of 
> ogr/ogrsf_frmts/sqlite/CMakeLists.txt ? it's possible commenting those 
> blocks out will make the compile complete with [core,tools,sqlite3].? 
> There may be some downsides: I don't know off the top of my head how 
> the GDAL SQLite/GPKG integration works wrt exposing the necessary GDAL 
> functions into SQLite. It might just work though :-)
>
test_load_virtual_ogr and my_test_sqlite3_ext in 
ogr/ogrsf_frmts/sqlite/CMakeLists.txt can be safely disabled. Patch 
welcome to build them only under a "if (BUILD_SHARED_LIBS)", if that may 
help. Although I don't see why they wouldn't build with static linking. 
That would mean that SQLite::SQLite3 doesn't fully capture its 
dependencies for static builds, which may be well possible

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/1579cfd5/attachment.htm>

From a.pau at creaf.uab.cat  Wed Feb 21 04:44:24 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Wed, 21 Feb 2024 12:44:24 +0000
Subject: [gdal-dev] Some Tests fail in Actions tab of my branch
In-Reply-To: <3462f26d-166b-4938-9a92-3dc513fe11c1@spatialys.com>
References: <PAXPR07MB777511EB772A0F4F3B4BBFDBA2572@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <538776ab-3595-4055-a0a8-7cac786ee63d@spatialys.com>
 <PAXPR07MB7775A372F7B9F85034D5B281A2572@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <3462f26d-166b-4938-9a92-3dc513fe11c1@spatialys.com>
Message-ID: <PAXPR07MB7775689F7975942AA15D84ABA2572@PAXPR07MB7775.eurprd07.prod.outlook.com>

I think there?ll be no problem about changing to MIT the code we want to add to GDAL.
I just copied it from other place like ogr\ogrsf_frmts\mem\ogrmemlayer.cpp

Or this is specified somewhere else I don?t know?

Thanks for the branch advise. I?ll started a long time ago. I am learning by the time. Thanks :)

De: Even Rouault <even.rouault at spatialys.com>
Enviado el: dimecres, 21 de febrer de 2024 12:49
Para: Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Some Tests fail in Actions tab of my branch


I've skimmed *very quickly* over the code (by the way you should create a dedicated git branch and not hack into the master branch. cf https://gdal.org/development/dev_practices.html#working-with-a-feature-branch), so in no means a code review,  but I noticed there's a LGPL license file. This is going to be a blocker if you want to submit your code for upstream GDAL inclusion as we can't accept LGPL in the core library. If the code subject to LGPL is under your control, please relicense to MIT.

Even
Le 21/02/2024 ? 12:36, Abel Pau a ?crit :
Ah ok!! Thanks Even.
I?ll review that, then! I didn?t though in that way

De: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>
Enviado el: dimecres, 21 de febrer de 2024 12:34
Para: Abel Pau <a.pau at creaf.uab.cat><mailto:a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some Tests fail in Actions tab of my branch


Abel,
Hi,
lately I?ve been solving some issues in my code to finally do a pull request of the MiraMon vector driver.

There some things about test in the action I don?t understand. I haven?t commit any test yet. So I assume it?s not my fault.
Anyone knows why some of them are failing?

You can see in the logs that it fails on autotest/ogr/ogr_basic_test.py::test_ogr_basic_10, and this test runs "test_ogrsf -all_drivers". As the name suggests, this test does some very minimal testing of all OGR drivers. I assume it must crash when running on the Miramon driver
Even

--

http://www.spatialys.com

My software is free, but my time generally not.

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/42d911e7/attachment-0001.htm>

From even.rouault at spatialys.com  Wed Feb 21 04:53:17 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 21 Feb 2024 13:53:17 +0100
Subject: [gdal-dev] Some Tests fail in Actions tab of my branch
In-Reply-To: <PAXPR07MB7775689F7975942AA15D84ABA2572@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB777511EB772A0F4F3B4BBFDBA2572@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <538776ab-3595-4055-a0a8-7cac786ee63d@spatialys.com>
 <PAXPR07MB7775A372F7B9F85034D5B281A2572@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <3462f26d-166b-4938-9a92-3dc513fe11c1@spatialys.com>
 <PAXPR07MB7775689F7975942AA15D84ABA2572@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <492214ea-0519-40a6-9a5a-5908939df983@spatialys.com>


Le 21/02/2024 ? 13:44, Abel Pau a ?crit?:
>
> I think there?ll be no problem about changing to MIT the code we want 
> to add to GDAL.
>
I was talking about 
https://github.com/AbelPau/gdal/blob/master/ogr/ogrsf_frmts/miramon/COPYING
>
> I just copied it from other place like ogr\ogrsf_frmts\mem\ogrmemlayer.cpp
>
There's no such file in the MEM driver. But perhaps you meant 
ogr/ogrsf_frmts/shape/COPYING . This is an old story with shapelib being 
*dual* licensed as LGPL or MIT at the option of the user. We should 
probably just opt for the MIT option for the shapelib copy in GDAL and 
remove the COPYING file from there. Actually just doing that per 
https://github.com/OSGeo/gdal/pull/9273.

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/9cee5d52/attachment.htm>

From a.pau at creaf.uab.cat  Wed Feb 21 05:44:20 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Wed, 21 Feb 2024 13:44:20 +0000
Subject: [gdal-dev] Some Tests fail in Actions tab of my branch
In-Reply-To: <492214ea-0519-40a6-9a5a-5908939df983@spatialys.com>
References: <PAXPR07MB777511EB772A0F4F3B4BBFDBA2572@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <538776ab-3595-4055-a0a8-7cac786ee63d@spatialys.com>
 <PAXPR07MB7775A372F7B9F85034D5B281A2572@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <3462f26d-166b-4938-9a92-3dc513fe11c1@spatialys.com>
 <PAXPR07MB7775689F7975942AA15D84ABA2572@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <492214ea-0519-40a6-9a5a-5908939df983@spatialys.com>
Message-ID: <PAXPR07MB777529160DA7AEA63B0F42BAA2572@PAXPR07MB7775.eurprd07.prod.outlook.com>

Oh, you meant that!!
I?m gonna delete that file as it never existed :)



De: Even Rouault <even.rouault at spatialys.com>
Enviado el: dimecres, 21 de febrer de 2024 13:53
Para: Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Some Tests fail in Actions tab of my branch



Le 21/02/2024 ? 13:44, Abel Pau a ?crit :
I think there?ll be no problem about changing to MIT the code we want to add to GDAL.
I was talking about https://github.com/AbelPau/gdal/blob/master/ogr/ogrsf_frmts/miramon/COPYING

I just copied it from other place like ogr\ogrsf_frmts\mem\ogrmemlayer.cpp
There's no such file in the MEM driver. But perhaps you meant ogr/ogrsf_frmts/shape/COPYING . This is an old story with shapelib being *dual* licensed as LGPL or MIT at the option of the user. We should probably just opt for the MIT option for the shapelib copy in GDAL and remove the COPYING file from there. Actually just doing that per https://github.com/OSGeo/gdal/pull/9273.

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240221/7fc2f491/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Feb 22 11:22:17 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 22 Feb 2024 19:22:17 +0000
Subject: [gdal-dev] GeoJSON: json as string
Message-ID: <DB9PR09MB68876C75684C2B950735DC60FD562@DB9PR09MB6887.eurprd09.prod.outlook.com>

Hi,

I am looking at a question in gis.stackexchange https://gis.stackexchange.com/questions/476489/geojson-item-considered-a-json-instead-of-a-string. I thought that open option ARRAY_AS_STRING would have some effect on opening the test data, but it does not. Ogrinfo returns String(JSON) with both YES and NO
key (String(JSON)) = { "start": "2000-01-01", "end": "2023-11-30" }
Have I understood something wrong?
I was testing with GDAL 3.9.0dev (OSGeo4W) on Windows.

-Jukka Rahkonen-

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240222/0c0b0c53/attachment.htm>

From even.rouault at spatialys.com  Thu Feb 22 11:32:11 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 22 Feb 2024 20:32:11 +0100
Subject: [gdal-dev] GeoJSON: json as string
In-Reply-To: <DB9PR09MB68876C75684C2B950735DC60FD562@DB9PR09MB6887.eurprd09.prod.outlook.com>
References: <DB9PR09MB68876C75684C2B950735DC60FD562@DB9PR09MB6887.eurprd09.prod.outlook.com>
Message-ID: <feddaf86-aec4-43d1-b2f4-ce33de1e08f0@spatialys.com>

Jukka,
>
> I am looking at a question in gis.stackexchange 
> https://gis.stackexchange.com/questions/476489/geojson-item-considered-a-json-instead-of-a-string. 
> I thought that open option ARRAY_AS_STRING would have some effect on 
> opening the test data, but it does not. Ogrinfo returns String(JSON) 
> with both YES and NO
> key (String(JSON)) = { "start": "2000-01-01", "end": "2023-11-30" }
>
> Have I understood something wrong?
>
{ "start": "2000-01-01", "end": "2023-11-30" } is not a JSON array, but 
a JSON object/dict, hence the ARRAY_AS_STRING has no effect on that 
property.

It would only affect something like [ "2000-01-01", "2023-11-30" ]

Even

-- 

http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240222/af260a8e/attachment.htm>

From jukka.rahkonen at maanmittauslaitos.fi  Thu Feb 22 12:04:28 2024
From: jukka.rahkonen at maanmittauslaitos.fi (Rahkonen Jukka)
Date: Thu, 22 Feb 2024 20:04:28 +0000
Subject: [gdal-dev] GeoJSON: json as string
In-Reply-To: <feddaf86-aec4-43d1-b2f4-ce33de1e08f0@spatialys.com>
References: <DB9PR09MB68876C75684C2B950735DC60FD562@DB9PR09MB6887.eurprd09.prod.outlook.com>
 <feddaf86-aec4-43d1-b2f4-ce33de1e08f0@spatialys.com>
Message-ID: <DB9PR09MB6887340544B8B6666FA0E074FD562@DB9PR09MB6887.eurprd09.prod.outlook.com>

Thanks,

So maybe the following SQL with the OGR SQL dialect is then the easiest method for getting the desired result with GDAL:

ogrinfo jsonjson.json -sql "select * EXCEPT (key), cast(key as character) from file" jsonjson.json
...
key (String) = { "start": "2000-01-01", "end": "2023-11-30" }

However, that trick is not exposed to QGIS but maybe there is some other workaround for QGIS.

-Jukka-



L?hett?j?: Even Rouault <even.rouault at spatialys.com>
L?hetetty: torstai 22. helmikuuta 2024 21.32
Vastaanottaja: Rahkonen Jukka <jukka.rahkonen at maanmittauslaitos.fi>; 'gdal-dev at lists.osgeo.org' (gdal-dev at lists.osgeo.org) <gdal-dev at lists.osgeo.org>
Aihe: Re: [gdal-dev] GeoJSON: json as string

Jukka,

I am looking at a question in gis.stackexchange https://gis.stackexchange.com/questions/476489/geojson-item-considered-a-json-instead-of-a-string. I thought that open option ARRAY_AS_STRING would have some effect on opening the test data, but it does not. Ogrinfo returns String(JSON) with both YES and NO
key (String(JSON)) = { "start": "2000-01-01", "end": "2023-11-30" }
Have I understood something wrong?

{ "start": "2000-01-01", "end": "2023-11-30" } is not a JSON array, but a JSON object/dict, hence the ARRAY_AS_STRING has no effect on that property.

It would only affect something like [ "2000-01-01", "2023-11-30" ]

Even

--

http://www.spatialys.com<http://www.spatialys.com/>

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240222/de62cde1/attachment.htm>

From patrick.mckendree.young at gmail.com  Thu Feb 22 21:54:00 2024
From: patrick.mckendree.young at gmail.com (Patrick Young)
Date: Thu, 22 Feb 2024 22:54:00 -0700
Subject: [gdal-dev] Reading PMTiles With Missing Tiles
Message-ID: <CADXYQQ59yqNi3Ts2aEK+xHhd5He3pwnio84Y3YTCwtcJr0Zy9A@mail.gmail.com>

Hello,

I've been exploring the pmtiles driver a bit, what a great way to read
giant blobs of tiles off of cloud storage, really impressed by how fast
this is.

I've been encountering a "Non increasing tile_id" when attempting to read
from coarser zoom levels for a large (~300GB) pmtile file:

https://github.com/OSGeo/gdal/blob/48ddaf28db2826c635243abd469e7c7d2e749bdc/ogr/ogrsf_frmts/pmtiles/ogrpmtilestileiterator.cpp#L329

For example, this fails for me:

ds = gdal.OpenEx("</vsis3/...", gdal.OF_VECTOR | gdal.OF_READONLY,
open_options=["ZOOM_LEVEL=0"])
lyr = ds.GetLayer()
for feat in lyr:
    *** raises RuntimeError: Non increasing tile_id ***

Things seem good when I specify higher zooms (e.g. Z12 or not specified at
all), but I can't get features out of the coarser ones.  Using the
"pmtiles tiles" command, I can access the 0/0/0 tile just fine though.

Any thoughts on what could be wrong?  The file was translated from a
mbtiles file via the "pmtiles convert" tool.  ogrinfo is happy with it as
well:

INFO: Open of `/vsis3/.../tileset.pmtiles'
      using driver `PMTiles' successful.
Metadata:
  description=mvts for landcover layer
  format=pbf
  maxzoom=16
  minzoom=0
  name=mvts
  scheme=tms
  type=overlay
  version=2
  ZOOM_LEVEL=16
1: landcover

Thanks,
Patrick
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240222/4386d4ff/attachment.htm>

From simon.eves at heavy.ai  Thu Feb 22 22:22:44 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Thu, 22 Feb 2024 22:22:44 -0800
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <CAFLLRp+MqLP2rqywpjVNjhP_jmhqT2-fVG+UTVMSKR-4277s-w@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
 <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
 <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
 <CAFLLRp+8+1MwLZPJMVFa17dOp_5G1e_Jz2O10zV4J5FiGvhbdA@mail.gmail.com>
 <CAFLLRp+MqLP2rqywpjVNjhP_jmhqT2-fVG+UTVMSKR-4277s-w@mail.gmail.com>
Message-ID: <CAJf0KTRxxJ1-LFhS0ZevbikYe0zRoHR+4pOZ4pSsURC2s0qAfQ@mail.gmail.com>

Thank you, Robert, for the RR tip. I shall try it.

I have new findings to report, however.

First of all, I confirmed that a build against GDAL 3.4.1 (the version we
were on before) still works. I also confirmed that builds against 3.7.3 and
3.8.4 still failed even with no additional library dependencies (just
sqlite3 and proj), in case it was a side-effect of us also adding more of
those. I then tried 3.5.3, with the CMake build (same config as we use for
3.7.3) and that worked. I then tried 3.6.4 (again, same CMake config) and
that failed. These were all from bundles.

I then started delving through the GDAL repo itself. I found the common
root commit of 3.5.3 and 3.6.4, and all the commits in the
*ogr/ogrsf_frmts/flatgeobuf* sub-project between that one and the final of
each. For 3.5.3, this was only two. I built and tested both, and they were
fine. I then tried the very first one that was new in the 3.6.4 chain (not
in the history of 3.5.3), which was actually a bulk update to the
*flatbuffers* sub-library, committed by Bjorn Harrtell on May 8 2022 (SHA
f7d8876). That one had the issue. I then tried the immediately-preceding
commit (an unrelated docs change) and that one was fine.

My current hypothesis, therefore, is that the *flatbuffers* update
introduced the issue, or at least, the susceptibility of the issue.

I still cannot explain why it only occurs in an all-static build, and even
less able to explain why it only occurs in our full system and not with the
simple test program against the very same static lib build that does the
very same sequence of GDAL API calls, but I repeated the build tests of the
commits either side and a few other random ones a bit further away in each
direction, and the results were consistent. Again, it happens with both GCC
11 and Clang 14 builds, Debug or Release.

I will continue tomorrow to look at the actual changes to *flatbuffers* in
that update, although they are quite significant. Certainly, the
*vector_downward* class, which is directly involved, was a new file in that
update (although on inspection of that file's history in the
*google/flatbuffers* repo, it seems it was just split out of another
header).

Bjorn, I don't mean to call you out directly, but I am CC'ing you to ensure
you see this, as you appear to be a significant contributor to the
*flatbuffers* project itself. Any insight you may have would be very
welcome. I am of course happy to describe my debugging findings in more
detail, privately if you wish, rather than spamming the list.

Simon






On Tue, Feb 20, 2024 at 1:49?PM Robert Coup <robert.coup at koordinates.com>
wrote:

> Hi,
>
> On Tue, 20 Feb 2024 at 21:44, Robert Coup <robert.coup at koordinates.com>
> wrote:
>
>> Hi Simon,
>>
>> On Tue, 20 Feb 2024 at 21:11, Simon Eves <simon.eves at heavy.ai> wrote:
>>
>>> Here's the stack trace for the original assert. Something is stepping on
>>> scratch_ to make it 0x1000000000 instead of null, which it starts out as
>>> when the flatbuffer object is created, but by the time it gets to
>>> allocating memory, it's broken.
>>>
>>
>> What happens if you set a watchpoint in gdb when the flatbuffer is
>> created?
>>
>> watch -l myfb->scratch
>> or watch *0x1234c0ffee
>>
>
> Or I've also had success with Mozilla's rr: https://rr-project.org/ ? you
> can run to a point where scratch is wrong, set a watchpoint on it, and then
> run the program backwards to find out what touched it.
>
> Rob :)
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240222/0bd608f0/attachment-0001.htm>

From even.rouault at spatialys.com  Fri Feb 23 00:37:37 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 23 Feb 2024 09:37:37 +0100
Subject: [gdal-dev] Reading PMTiles With Missing Tiles
In-Reply-To: <CADXYQQ59yqNi3Ts2aEK+xHhd5He3pwnio84Y3YTCwtcJr0Zy9A@mail.gmail.com>
References: <CADXYQQ59yqNi3Ts2aEK+xHhd5He3pwnio84Y3YTCwtcJr0Zy9A@mail.gmail.com>
Message-ID: <5cf67608-cdb3-4e2c-b7fe-b84dfb3ec448@spatialys.com>

Hi,

this is likely a bug. I would need access to the file to investigate, 
ideally through /vsicurl, /vsis3, etc. . I don't have storage to host 
300 GB. And possibly try to reduce the file size by removing upper zoom 
levels

Even

Le 23/02/2024 ? 06:54, Patrick Young via gdal-dev a ?crit?:
> Hello,
>
> I've been exploring the pmtiles?driver a bit, what a great way to read 
> giant blobs of tiles off of cloud storage, really impressed by how 
> fast this is.
>
> I've been encountering?a "Non increasing tile_id" when attempting to 
> read from coarser zoom levels for a large (~300GB) pmtile file:
>
> https://github.com/OSGeo/gdal/blob/48ddaf28db2826c635243abd469e7c7d2e749bdc/ogr/ogrsf_frmts/pmtiles/ogrpmtilestileiterator.cpp#L329
>
> For example, this fails for me:
>
> ds = gdal.OpenEx("</vsis3/...", gdal.OF_VECTOR | gdal.OF_READONLY, 
> open_options=["ZOOM_LEVEL=0"])
> lyr = ds.GetLayer()
> for feat in lyr:
> ? ? *** raises?RuntimeError: Non increasing tile_id ***
>
> Things seem good when I specify higher zooms (e.g. Z12 or not 
> specified at all), but I can't get features out of the coarser ones.? 
> Using the "pmtiles?tiles" command, I can access the 0/0/0 tile just 
> fine though.
>
> Any thoughts on what could be wrong?? The file was translated from a 
> mbtiles file via the "pmtiles?convert" tool.? ogrinfo is happy with it 
> as well:
>
> INFO: Open of `/vsis3/.../tileset.pmtiles'
> ? ? ? using driver `PMTiles' successful.
> Metadata:
> ? description=mvts for landcover layer
> ? format=pbf
> ? maxzoom=16
> ? minzoom=0
> ? name=mvts
> ? scheme=tms
> ? type=overlay
> ? version=2
> ? ZOOM_LEVEL=16
> 1: landcover
>
> Thanks,
> Patrick
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From a.pau at creaf.uab.cat  Fri Feb 23 01:34:38 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Fri, 23 Feb 2024 09:34:38 +0000
Subject: [gdal-dev] the /vsistdout mistery and the Update question
Message-ID: <PAXPR07MB7775A0A768660C9138FA0689A2552@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi,
after reading https://gdal.org/user/virtual_file_systems.html#vsistdout-standard-output-streaming I have to say I don't understand what it means.

I which cases it's used? Some example to consider?
In the driver I have to do something with that?

I have, copied from other,
if (!STARTS_WITH(pszFilename, "/vsistdout")) and then I open the file as usual.
But, what I have to do if the name starts with that?


On the other hand, I am confused about the Update concept.
My driver is capable of creating from zero a layer from other formats.
But I haven't programmed the capacity to insert a feature in a pre-existent layer (I cannot simply add at the end of the file because de format description is a little more complicated).

What I do now is

OGRMiraMonLayer() <-- if Update is true, I open from zero and create a new MiraMon layer
If not, I read the layer.

But, there is something to take in consideration about the capacity of inserting a feature in a pre-existent layer?

Thanks.

Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/70acd99e/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/70acd99e/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/70acd99e/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/70acd99e/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/70acd99e/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/70acd99e/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/70acd99e/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/70acd99e/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/70acd99e/attachment-0003.jpg>

From even.rouault at spatialys.com  Fri Feb 23 07:49:55 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 23 Feb 2024 16:49:55 +0100
Subject: [gdal-dev] the /vsistdout mistery and the Update question
In-Reply-To: <PAXPR07MB7775A0A768660C9138FA0689A2552@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB7775A0A768660C9138FA0689A2552@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <cb0f2c75-4065-4a65-baae-ee15f131df91@spatialys.com>

Abel,

Le 23/02/2024 ? 10:34, Abel Pau via gdal-dev a ?crit?:
>
> Hi,
>
> after reading 
> https://gdal.org/user/virtual_file_systems.html#vsistdout-standard-output-streaming 
> <https://gdal.org/user/virtual_file_systems.html#vsistdout-standard-output-streaming>I 
> have to say I don?t understand what it means.
>
> I which cases it?s used? Some example to consider?
>
/vsistdout/ also makes sense for formats that can be streamed in 
writing, that is you can generate the content as data flows in the 
driver and don't have to seek back to edit something in the header. So 
only a small subset of formats/drivers can natively support that. The 
canonical example is a CSV file. So I'd say don't worry about that use 
case for your driver.

> On the other hand, I am confused about the Update concept.
>
> My driver is capable of creating from zero a layer from other formats.
>
> But I haven?t programmed the capacity to insert a feature in a 
> pre-existent layer (I cannot simply add at the end of the file because 
> de format description is a little more complicated).
>
Same thing as above. A lot of drivers can only create + add features in 
the newly features, but can't (at least easily) edit or append to an 
existing file. So just return nullptr when Open() is called with the 
update flag with a CPLError() message.

Something like

 ??? if (poDS != nullptr && poOpenInfo->eAccess == GA_Update)
 ??? {
 ??????? CPLError(CE_Failure, CPLE_OpenFailed,
 ???????????????? "SDTS Driver doesn't support update.");
 ??????? delete poDS;
 ??????? poDS = nullptr;
 ??? }

You have been in a "development black hole" for a long time now, so I'd 
suggest you limit the functionality to what you've already implemented, 
and make it in good shape for review. The more code, the harder & longer 
effort for reviewers. You can always add new functionality in follow-up 
pull requests once a base has already been integrated.

Even

-- 

http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/9d3678a6/attachment.htm>

From a.pau at creaf.uab.cat  Fri Feb 23 08:13:23 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Fri, 23 Feb 2024 16:13:23 +0000
Subject: [gdal-dev] the /vsistdout mistery and the Update question
In-Reply-To: <cb0f2c75-4065-4a65-baae-ee15f131df91@spatialys.com>
References: <PAXPR07MB7775A0A768660C9138FA0689A2552@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <cb0f2c75-4065-4a65-baae-ee15f131df91@spatialys.com>
Message-ID: <PAXPR07MB7775EC0B2DF906FD4D6439D0A2552@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi Even,
thanks for your answer.

ok with /vsistdout/

I?m sure trying to finish the job. I?ve been documenting that, going through actions errors. But I?m not trying to incorporate anything new but only trying to let it clean from doubts I have from the beginning and I left for later. Now is this later :)

Tests in windows are resisting to be passed because there are some problems with python and windows (I?m new al python) but I hope I can confront them from Monday.

Soon I?ll create the mentioned feature branch and I?ll put all modifications there and I?ll pool request.
I?m willing to do that!

Have a nice weekend


De: Even Rouault <even.rouault at spatialys.com>
Enviado el: divendres, 23 de febrer de 2024 16:50
Para: Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] the /vsistdout mistery and the Update question


Abel,
Le 23/02/2024 ? 10:34, Abel Pau via gdal-dev a ?crit :
Hi,
after reading https://gdal.org/user/virtual_file_systems.html#vsistdout-standard-output-streaming I have to say I don?t understand what it means.

I which cases it?s used? Some example to consider?

/vsistdout/ also makes sense for formats that can be streamed in writing, that is you can generate the content as data flows in the driver and don't have to seek back to edit something in the header. So only a small subset of formats/drivers can natively support that. The canonical example is a CSV file. So I'd say don't worry about that use case for your driver.


On the other hand, I am confused about the Update concept.
My driver is capable of creating from zero a layer from other formats.
But I haven?t programmed the capacity to insert a feature in a pre-existent layer (I cannot simply add at the end of the file because de format description is a little more complicated).

Same thing as above. A lot of drivers can only create + add features in the newly features, but can't (at least easily) edit or append to an existing file. So just return nullptr when Open() is called with the update flag with a CPLError() message.

Something like

    if (poDS != nullptr && poOpenInfo->eAccess == GA_Update)
    {
        CPLError(CE_Failure, CPLE_OpenFailed,
                 "SDTS Driver doesn't support update.");
        delete poDS;
        poDS = nullptr;
    }

You have been in a "development black hole" for a long time now, so I'd suggest you limit the functionality to what you've already implemented, and make it in good shape for review. The more code, the harder & longer effort for reviewers. You can always add new functionality in follow-up pull requests once a base has already been integrated.

Even

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/16ebe7a2/attachment-0001.htm>

From patrick.mckendree.young at gmail.com  Fri Feb 23 08:15:22 2024
From: patrick.mckendree.young at gmail.com (Patrick Young)
Date: Fri, 23 Feb 2024 09:15:22 -0700
Subject: [gdal-dev] Reading PMTiles With Missing Tiles
In-Reply-To: <5cf67608-cdb3-4e2c-b7fe-b84dfb3ec448@spatialys.com>
References: <CADXYQQ59yqNi3Ts2aEK+xHhd5He3pwnio84Y3YTCwtcJr0Zy9A@mail.gmail.com>
 <5cf67608-cdb3-4e2c-b7fe-b84dfb3ec448@spatialys.com>
Message-ID: <CADXYQQ4mUuivpOnWfjVtDYE5uL661J959unRjycRNXbMNh93dA@mail.gmail.com>

Thanks Even!

I got a much smaller reproduce case with data ready at
https://github.com/OSGeo/gdal/issues/9288

I created the test case with `pmtiles extract --maxzoom 7 ...`,
interestingly enough using a coarser zoom didn't surface the issue!

Patrick

On Fri, Feb 23, 2024 at 1:37?AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> this is likely a bug. I would need access to the file to investigate,
> ideally through /vsicurl, /vsis3, etc. . I don't have storage to host
> 300 GB. And possibly try to reduce the file size by removing upper zoom
> levels
>
> Even
>
> Le 23/02/2024 ? 06:54, Patrick Young via gdal-dev a ?crit :
> > Hello,
> >
> > I've been exploring the pmtiles driver a bit, what a great way to read
> > giant blobs of tiles off of cloud storage, really impressed by how
> > fast this is.
> >
> > I've been encountering a "Non increasing tile_id" when attempting to
> > read from coarser zoom levels for a large (~300GB) pmtile file:
> >
> >
> https://github.com/OSGeo/gdal/blob/48ddaf28db2826c635243abd469e7c7d2e749bdc/ogr/ogrsf_frmts/pmtiles/ogrpmtilestileiterator.cpp#L329
> >
> > For example, this fails for me:
> >
> > ds = gdal.OpenEx("</vsis3/...", gdal.OF_VECTOR | gdal.OF_READONLY,
> > open_options=["ZOOM_LEVEL=0"])
> > lyr = ds.GetLayer()
> > for feat in lyr:
> >     *** raises RuntimeError: Non increasing tile_id ***
> >
> > Things seem good when I specify higher zooms (e.g. Z12 or not
> > specified at all), but I can't get features out of the coarser ones.
> > Using the "pmtiles tiles" command, I can access the 0/0/0 tile just
> > fine though.
> >
> > Any thoughts on what could be wrong?  The file was translated from a
> > mbtiles file via the "pmtiles convert" tool.  ogrinfo is happy with it
> > as well:
> >
> > INFO: Open of `/vsis3/.../tileset.pmtiles'
> >       using driver `PMTiles' successful.
> > Metadata:
> >   description=mvts for landcover layer
> >   format=pbf
> >   maxzoom=16
> >   minzoom=0
> >   name=mvts
> >   scheme=tms
> >   type=overlay
> >   version=2
> >   ZOOM_LEVEL=16
> > 1: landcover
> >
> > Thanks,
> > Patrick
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/372be5c9/attachment.htm>

From aborruso at gmail.com  Fri Feb 23 09:05:28 2024
From: aborruso at gmail.com (andy)
Date: Fri, 23 Feb 2024 18:05:28 +0100
Subject: [gdal-dev] gdalinfo and WMS: is there a way to pass credentials via
 CLI?
Message-ID: <CAHEdGZPgp8khM6DdYy1ARea43c_R8ddrYHtRV=0eFamZ7OooeA@mail.gmail.com>

Hi,
is there a way to pass UserPwd parameter via a gdalinfo command?
Is there a way to pass it, without creating an XML file?

Something like this

gdalinfo "WMS:http://wms.geobase.ca/wms-bin/cubeserv.cgi"
-UserPwd user:password

Thank you

-- 
___________________

Andrea Borruso
website: https://medium.com/tantotanto
38? 7' 48" N, 13? 21' 9" E, EPSG:4326
___________________

"cercare e saper riconoscere chi e cosa,
 in mezzo all?inferno, non ? inferno,
e farlo durare, e dargli spazio"

Italo Calvino
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/05ace223/attachment.htm>

From even.rouault at spatialys.com  Fri Feb 23 09:27:50 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 23 Feb 2024 18:27:50 +0100
Subject: [gdal-dev] gdalinfo and WMS: is there a way to pass credentials
 via CLI?
In-Reply-To: <CAHEdGZPgp8khM6DdYy1ARea43c_R8ddrYHtRV=0eFamZ7OooeA@mail.gmail.com>
References: <CAHEdGZPgp8khM6DdYy1ARea43c_R8ddrYHtRV=0eFamZ7OooeA@mail.gmail.com>
Message-ID: <5c29ee60-7ad2-400f-8232-399e57c3fa37@spatialys.com>

Hi,

I haven't tested but you should be able to use any of the env variable 
listed for CPLHTTPFetch() at 
https://gdal.org/api/cpl.html#_CPPv412CPLHTTPFetchPKc12CSLConstList

so here GDAL_HTTP_USERPWD

gdalinfo "WMS:http://wms.geobase.ca/wms-bin/cubeserv.cgi" --config 
GDAL_HTTP_USERPWD user:password

And probably that just incorporating it in the URL should work:

gdalinfo "WMS:http://user:password at wms.geobase.ca/wms-bin/cubeserv.cgi"

Even

Le 23/02/2024 ? 18:05, andy via gdal-dev a ?crit?:
> Hi,
> is there a way to pass?UserPwd parameter via a gdalinfo command?
> Is there a way to pass it, without creating an XML file?
>
> Something like this
>
> gdalinfo "WMS:http://wms.geobase.ca/wms-bin/cubeserv.cgi" 
> -UserPwd?user:password
>
> Thank you
>
> -- 
> ___________________
>
> Andrea Borruso
> website: https://medium.com/tantotanto
> 38? 7' 48" N, 13? 21' 9" E, EPSG:4326
> ___________________
>
> "cercare e saper riconoscere chi e cosa,
> ?in mezzo all?inferno, non ? inferno,
> e farlo durare, e dargli spazio"
>
> Italo Calvino
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/9b060783/attachment.htm>

From aborruso at gmail.com  Fri Feb 23 09:42:41 2024
From: aborruso at gmail.com (andy)
Date: Fri, 23 Feb 2024 18:42:41 +0100
Subject: [gdal-dev] gdalinfo and WMS: is there a way to pass credentials
 via CLI?
In-Reply-To: <5c29ee60-7ad2-400f-8232-399e57c3fa37@spatialys.com>
References: <CAHEdGZPgp8khM6DdYy1ARea43c_R8ddrYHtRV=0eFamZ7OooeA@mail.gmail.com>
 <5c29ee60-7ad2-400f-8232-399e57c3fa37@spatialys.com>
Message-ID: <CAHEdGZP2ahXaOO+g6HzpNvu1fvgrKeyqFKJ=qH7-3A+E8KCusg@mail.gmail.com>

Thank you, it works great

On Fri, 23 Feb 2024 at 18:27, Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> I haven't tested but you should be able to use any of the env variable
> listed for CPLHTTPFetch() at
> https://gdal.org/api/cpl.html#_CPPv412CPLHTTPFetchPKc12CSLConstList
>
> so here GDAL_HTTP_USERPWD
>
> gdalinfo "WMS:http://wms.geobase.ca/wms-bin/cubeserv.cgi" --config
> GDAL_HTTP_USERPWD user:password
>
> And probably that just incorporating it in the URL should work:
>
> gdalinfo "WMS:http://user:password at wms.geobase.ca/wms-bin/cubeserv.cgi"
>
> Even
> Le 23/02/2024 ? 18:05, andy via gdal-dev a ?crit :
>
> Hi,
> is there a way to pass UserPwd parameter via a gdalinfo command?
> Is there a way to pass it, without creating an XML file?
>
> Something like this
>
> gdalinfo "WMS:http://wms.geobase.ca/wms-bin/cubeserv.cgi"
> -UserPwd user:password
>
> Thank you
>
> --
> ___________________
>
> Andrea Borruso
> website: https://medium.com/tantotanto
> 38? 7' 48" N, 13? 21' 9" E, EPSG:4326
> ___________________
>
> "cercare e saper riconoscere chi e cosa,
>  in mezzo all?inferno, non ? inferno,
> e farlo durare, e dargli spazio"
>
> Italo Calvino
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>

-- 
___________________

Andrea Borruso
website: https://medium.com/tantotanto
38? 7' 48" N, 13? 21' 9" E, EPSG:4326
___________________

"cercare e saper riconoscere chi e cosa,
 in mezzo all?inferno, non ? inferno,
e farlo durare, e dargli spazio"

Italo Calvino
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/2dac9945/attachment-0001.htm>

From simon.eves at heavy.ai  Fri Feb 23 14:54:28 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Fri, 23 Feb 2024 14:54:28 -0800
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <CAJf0KTRxxJ1-LFhS0ZevbikYe0zRoHR+4pOZ4pSsURC2s0qAfQ@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
 <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
 <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
 <CAFLLRp+8+1MwLZPJMVFa17dOp_5G1e_Jz2O10zV4J5FiGvhbdA@mail.gmail.com>
 <CAFLLRp+MqLP2rqywpjVNjhP_jmhqT2-fVG+UTVMSKR-4277s-w@mail.gmail.com>
 <CAJf0KTRxxJ1-LFhS0ZevbikYe0zRoHR+4pOZ4pSsURC2s0qAfQ@mail.gmail.com>
Message-ID: <CAJf0KTSrA_Pod7EK3Cd4SYDZiHqdtXGUadWSGEEcx_G_NZn9eA@mail.gmail.com>

I was able to create a fork of 3.7.3 with just the *flatbuffers* replaced
with the pre-3.6.x version (2.0.0).

This seemed to only require changes to the version asserts and adding an
*align* parameter to *Table::VerifyField()* to match the newer API.

https://github.com/heavyai/gdal/tree/simon.eves/release/3.7/downgrade_to_flatbuffers_2.0.0

Our system works correctly and passes all GDAL I/O tests with that version.
Obviously this isn't an ideal solution, but this is otherwise a release
blocker for us.

I would still very much like to discuss the original problem more deeply,
and hopefully come up with a better solution.

Yours hopefully,

Simon



On Thu, Feb 22, 2024 at 10:22?PM Simon Eves <simon.eves at heavy.ai> wrote:

> Thank you, Robert, for the RR tip. I shall try it.
>
> I have new findings to report, however.
>
> First of all, I confirmed that a build against GDAL 3.4.1 (the version we
> were on before) still works. I also confirmed that builds against 3.7.3 and
> 3.8.4 still failed even with no additional library dependencies (just
> sqlite3 and proj), in case it was a side-effect of us also adding more of
> those. I then tried 3.5.3, with the CMake build (same config as we use for
> 3.7.3) and that worked. I then tried 3.6.4 (again, same CMake config) and
> that failed. These were all from bundles.
>
> I then started delving through the GDAL repo itself. I found the common
> root commit of 3.5.3 and 3.6.4, and all the commits in the
> *ogr/ogrsf_frmts/flatgeobuf* sub-project between that one and the final
> of each. For 3.5.3, this was only two. I built and tested both, and they
> were fine. I then tried the very first one that was new in the 3.6.4 chain
> (not in the history of 3.5.3), which was actually a bulk update to the
> *flatbuffers* sub-library, committed by Bjorn Harrtell on May 8 2022 (SHA
> f7d8876). That one had the issue. I then tried the immediately-preceding
> commit (an unrelated docs change) and that one was fine.
>
> My current hypothesis, therefore, is that the *flatbuffers* update
> introduced the issue, or at least, the susceptibility of the issue.
>
> I still cannot explain why it only occurs in an all-static build, and even
> less able to explain why it only occurs in our full system and not with the
> simple test program against the very same static lib build that does the
> very same sequence of GDAL API calls, but I repeated the build tests of the
> commits either side and a few other random ones a bit further away in each
> direction, and the results were consistent. Again, it happens with both GCC
> 11 and Clang 14 builds, Debug or Release.
>
> I will continue tomorrow to look at the actual changes to *flatbuffers* in
> that update, although they are quite significant. Certainly, the
> *vector_downward* class, which is directly involved, was a new file in
> that update (although on inspection of that file's history in the
> *google/flatbuffers* repo, it seems it was just split out of another
> header).
>
> Bjorn, I don't mean to call you out directly, but I am CC'ing you to
> ensure you see this, as you appear to be a significant contributor to the
> *flatbuffers* project itself. Any insight you may have would be very
> welcome. I am of course happy to describe my debugging findings in more
> detail, privately if you wish, rather than spamming the list.
>
> Simon
>
>
>
>
>
>
> On Tue, Feb 20, 2024 at 1:49?PM Robert Coup <robert.coup at koordinates.com>
> wrote:
>
>> Hi,
>>
>> On Tue, 20 Feb 2024 at 21:44, Robert Coup <robert.coup at koordinates.com>
>> wrote:
>>
>>> Hi Simon,
>>>
>>> On Tue, 20 Feb 2024 at 21:11, Simon Eves <simon.eves at heavy.ai> wrote:
>>>
>>>> Here's the stack trace for the original assert. Something is stepping
>>>> on scratch_ to make it 0x1000000000 instead of null, which it starts out as
>>>> when the flatbuffer object is created, but by the time it gets to
>>>> allocating memory, it's broken.
>>>>
>>>
>>> What happens if you set a watchpoint in gdb when the flatbuffer is
>>> created?
>>>
>>> watch -l myfb->scratch
>>> or watch *0x1234c0ffee
>>>
>>
>> Or I've also had success with Mozilla's rr: https://rr-project.org/ ?
>> you can run to a point where scratch is wrong, set a watchpoint on it, and
>> then run the program backwards to find out what touched it.
>>
>> Rob :)
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/585441bb/attachment.htm>

From simon.eves at heavy.ai  Fri Feb 23 15:42:28 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Fri, 23 Feb 2024 15:42:28 -0800
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <CAJf0KTSrA_Pod7EK3Cd4SYDZiHqdtXGUadWSGEEcx_G_NZn9eA@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
 <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
 <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
 <CAFLLRp+8+1MwLZPJMVFa17dOp_5G1e_Jz2O10zV4J5FiGvhbdA@mail.gmail.com>
 <CAFLLRp+MqLP2rqywpjVNjhP_jmhqT2-fVG+UTVMSKR-4277s-w@mail.gmail.com>
 <CAJf0KTRxxJ1-LFhS0ZevbikYe0zRoHR+4pOZ4pSsURC2s0qAfQ@mail.gmail.com>
 <CAJf0KTSrA_Pod7EK3Cd4SYDZiHqdtXGUadWSGEEcx_G_NZn9eA@mail.gmail.com>
Message-ID: <CAJf0KTSzEfTga-++ZCPf-AGkodcQ2htHpzgAjvAcPzuqPBse9w@mail.gmail.com>

I'm also testing a build that uses the latest *flatbuffers* 23.5.26, which
is a drop-in replacement and does not require the *VerifyField* change,
just in case the issue has been fixed since 2.0.6.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/bac737cd/attachment.htm>

From even.rouault at spatialys.com  Fri Feb 23 15:42:40 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 24 Feb 2024 00:42:40 +0100
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <CAJf0KTSrA_Pod7EK3Cd4SYDZiHqdtXGUadWSGEEcx_G_NZn9eA@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
 <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
 <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
 <CAFLLRp+8+1MwLZPJMVFa17dOp_5G1e_Jz2O10zV4J5FiGvhbdA@mail.gmail.com>
 <CAFLLRp+MqLP2rqywpjVNjhP_jmhqT2-fVG+UTVMSKR-4277s-w@mail.gmail.com>
 <CAJf0KTRxxJ1-LFhS0ZevbikYe0zRoHR+4pOZ4pSsURC2s0qAfQ@mail.gmail.com>
 <CAJf0KTSrA_Pod7EK3Cd4SYDZiHqdtXGUadWSGEEcx_G_NZn9eA@mail.gmail.com>
Message-ID: <72c655aa-0579-47e1-be7c-813f85a021b5@spatialys.com>

Simon,

did you try to update to the latest 
https://github.com/google/flatbuffers/releases to see if that would 
solve the issue ? If that worked, that would be the best way forward...

Otherwise if the issue persists with the latest flatbuffers release, a 
(admitedly rather tedious) option would be to do a git bisect on the 
flatbuffers code to identify the culprit commit. With some luck, the 
root cause might be obvious if a single culptrit commit can be exhibited 
(perhaps some subtle C++ undefined behaviour triggered? also it is a bit 
mysterious that it hits only for static builds), or otherwise raise to 
the upstream flatbuffers project to ask for their expertise

Even

Le 23/02/2024 ? 23:54, Simon Eves via gdal-dev a ?crit?:
> I was able to create a fork of 3.7.3 with just the *flatbuffers* 
> replaced with the pre-3.6.x version (2.0.0).
>
> This seemed to only?require?changes to the version?asserts and adding 
> an *align* parameter to *Table::VerifyField()*?to match the newer API.
>
> https://github.com/heavyai/gdal/tree/simon.eves/release/3.7/downgrade_to_flatbuffers_2.0.0
>
> Our system works correctly and passes all GDAL I/O tests with that 
> version. Obviously this isn't an ideal solution, but this is otherwise 
> a release blocker for us.
>
> I would still?very much like to discuss the original problem more 
> deeply, and hopefully come up with a better solution.
>
> Yours hopefully,
>
> Simon
>
>
>
> On Thu, Feb 22, 2024 at 10:22?PM Simon Eves <simon.eves at heavy.ai> wrote:
>
>     Thank you, Robert, for the RR tip. I shall try it.
>
>     I have new?findings to report,?however.
>
>     First of all, I confirmed that a build against GDAL 3.4.1 (the
>     version we were on before) still works. I also confirmed that
>     builds against 3.7.3 and 3.8.4 still failed even with no
>     additional library dependencies (just sqlite3 and proj), in case
>     it?was a side-effect of us also adding more of those. I then tried
>     3.5.3, with the CMake build (same config as we use for 3.7.3) and
>     that worked. I then tried 3.6.4 (again, same CMake config) and
>     that failed. These were all from bundles.
>
>     I then started delving through the GDAL repo itself. I found the
>     common root commit of 3.5.3 and 3.6.4, and all the commits in the
>     *ogr/ogrsf_frmts/flatgeobuf*?sub-project between that one and the
>     final of each. For 3.5.3, this was only two. I built and tested
>     both, and they were fine. I then tried the very first one that was
>     new in the 3.6.4 chain (not in the history of 3.5.3), which was
>     actually a bulk update to the *flatbuffers* sub-library,
>     committed?by Bjorn Harrtell on May 8 2022 (SHA f7d8876). That one
>     had the issue. I then tried the immediately-preceding commit (an
>     unrelated docs change) and that one was fine.
>
>     My current hypothesis, therefore, is that the *flatbuffers* update
>     introduced the issue,?or at least, the susceptibility of the issue.
>
>     I still cannot explain why it only occurs in an all-static build,
>     and even less able to explain why it only occurs in our full
>     system and not with the simple test program against the very same
>     static lib build that does the very same sequence of GDAL API
>     calls, but I repeated the build tests of the commits either side
>     and a few other random ones a bit further away in each direction,
>     and the results were consistent. Again, it happens with both GCC
>     11 and Clang 14 builds, Debug or Release.
>
>     I will continue tomorrow to look at the actual changes to
>     *flatbuffers*?in that update, although they are quite significant.
>     Certainly, the *vector_downward* class, which is directly
>     involved, was a new file in that update (although on inspection of
>     that file's history in the *google/flatbuffers* repo, it seems it
>     was just split out of another header).
>
>     Bjorn, I don't mean to call you out directly, but I am CC'ing you
>     to ensure you see this, as you appear to be a significant
>     contributor to the *flatbuffers* project itself. Any insight you
>     may have would be very welcome. I am of course happy to describe
>     my debugging findings in more detail, privately if you wish,
>     rather than spamming the list.
>
>     Simon
>
>
>
>
>
>
>     On Tue, Feb 20, 2024 at 1:49?PM Robert Coup
>     <robert.coup at koordinates.com> wrote:
>
>         Hi,
>
>         On Tue, 20 Feb 2024 at 21:44, Robert Coup
>         <robert.coup at koordinates.com> wrote:
>
>             Hi Simon,
>
>             On Tue, 20 Feb 2024 at 21:11, Simon Eves
>             <simon.eves at heavy.ai> wrote:
>
>                 Here's the stack trace for the original assert.
>                 Something is stepping on scratch_ to make it
>                 0x1000000000 instead of null, which it starts out as
>                 when?the flatbuffer object is created, but by the time
>                 it gets to allocating memory, it's broken.
>
>
>             What happens if you set a watchpoint in gdb when?the
>             flatbuffer is created?
>
>             watch -l myfb->scratch
>             or watch *0x1234c0ffee
>
>
>         Or I've also had success with Mozilla's rr:
>         https://rr-project.org/ ? you can run to a point where scratch
>         is?wrong, set a watchpoint on it, and then run the program
>         backwards to find out what touched it.
>
>         Rob :)
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240224/e377e58d/attachment-0001.htm>

From simon.eves at heavy.ai  Fri Feb 23 15:46:00 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Fri, 23 Feb 2024 15:46:00 -0800
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <72c655aa-0579-47e1-be7c-813f85a021b5@spatialys.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
 <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
 <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
 <CAFLLRp+8+1MwLZPJMVFa17dOp_5G1e_Jz2O10zV4J5FiGvhbdA@mail.gmail.com>
 <CAFLLRp+MqLP2rqywpjVNjhP_jmhqT2-fVG+UTVMSKR-4277s-w@mail.gmail.com>
 <CAJf0KTRxxJ1-LFhS0ZevbikYe0zRoHR+4pOZ4pSsURC2s0qAfQ@mail.gmail.com>
 <CAJf0KTSrA_Pod7EK3Cd4SYDZiHqdtXGUadWSGEEcx_G_NZn9eA@mail.gmail.com>
 <72c655aa-0579-47e1-be7c-813f85a021b5@spatialys.com>
Message-ID: <CAJf0KTRiJPvz-ank4LdUFsNvHvr7fUi-VmULeLPLp8BBv8BOZw@mail.gmail.com>

Our emails crossed. I am indeed testing with the latest flatbuffers now too.

Agreed on the rest.

On Fri, Feb 23, 2024 at 3:42?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Simon,
>
> did you try to update to the latest
> https://github.com/google/flatbuffers/releases to see if that would solve
> the issue ? If that worked, that would be the best way forward...
>
> Otherwise if the issue persists with the latest flatbuffers release, a
> (admitedly rather tedious) option would be to do a git bisect on the
> flatbuffers code to identify the culprit commit. With some luck, the root
> cause might be obvious if a single culptrit commit can be exhibited
> (perhaps some subtle C++ undefined behaviour triggered? also it is a bit
> mysterious that it hits only for static builds), or otherwise raise to the
> upstream flatbuffers project to ask for their expertise
>
> Even
> Le 23/02/2024 ? 23:54, Simon Eves via gdal-dev a ?crit :
>
> I was able to create a fork of 3.7.3 with just the *flatbuffers* replaced
> with the pre-3.6.x version (2.0.0).
>
> This seemed to only require changes to the version asserts and adding an
> *align* parameter to *Table::VerifyField()* to match the newer API.
>
>
> https://github.com/heavyai/gdal/tree/simon.eves/release/3.7/downgrade_to_flatbuffers_2.0.0
>
> Our system works correctly and passes all GDAL I/O tests with that
> version. Obviously this isn't an ideal solution, but this is otherwise a
> release blocker for us.
>
> I would still very much like to discuss the original problem more deeply,
> and hopefully come up with a better solution.
>
> Yours hopefully,
>
> Simon
>
>
>
> On Thu, Feb 22, 2024 at 10:22?PM Simon Eves <simon.eves at heavy.ai> wrote:
>
>> Thank you, Robert, for the RR tip. I shall try it.
>>
>> I have new findings to report, however.
>>
>> First of all, I confirmed that a build against GDAL 3.4.1 (the version we
>> were on before) still works. I also confirmed that builds against 3.7.3 and
>> 3.8.4 still failed even with no additional library dependencies (just
>> sqlite3 and proj), in case it was a side-effect of us also adding more of
>> those. I then tried 3.5.3, with the CMake build (same config as we use for
>> 3.7.3) and that worked. I then tried 3.6.4 (again, same CMake config) and
>> that failed. These were all from bundles.
>>
>> I then started delving through the GDAL repo itself. I found the common
>> root commit of 3.5.3 and 3.6.4, and all the commits in the
>> *ogr/ogrsf_frmts/flatgeobuf* sub-project between that one and the final
>> of each. For 3.5.3, this was only two. I built and tested both, and they
>> were fine. I then tried the very first one that was new in the 3.6.4 chain
>> (not in the history of 3.5.3), which was actually a bulk update to the
>> *flatbuffers* sub-library, committed by Bjorn Harrtell on May 8 2022
>> (SHA f7d8876). That one had the issue. I then tried the
>> immediately-preceding commit (an unrelated docs change) and that one was
>> fine.
>>
>> My current hypothesis, therefore, is that the *flatbuffers* update
>> introduced the issue, or at least, the susceptibility of the issue.
>>
>> I still cannot explain why it only occurs in an all-static build, and
>> even less able to explain why it only occurs in our full system and not
>> with the simple test program against the very same static lib build that
>> does the very same sequence of GDAL API calls, but I repeated the build
>> tests of the commits either side and a few other random ones a bit further
>> away in each direction, and the results were consistent. Again, it happens
>> with both GCC 11 and Clang 14 builds, Debug or Release.
>>
>> I will continue tomorrow to look at the actual changes to *flatbuffers* in
>> that update, although they are quite significant. Certainly, the
>> *vector_downward* class, which is directly involved, was a new file in
>> that update (although on inspection of that file's history in the
>> *google/flatbuffers* repo, it seems it was just split out of another
>> header).
>>
>> Bjorn, I don't mean to call you out directly, but I am CC'ing you to
>> ensure you see this, as you appear to be a significant contributor to the
>> *flatbuffers* project itself. Any insight you may have would be very
>> welcome. I am of course happy to describe my debugging findings in more
>> detail, privately if you wish, rather than spamming the list.
>>
>> Simon
>>
>>
>>
>>
>>
>>
>> On Tue, Feb 20, 2024 at 1:49?PM Robert Coup <robert.coup at koordinates.com>
>> wrote:
>>
>>> Hi,
>>>
>>> On Tue, 20 Feb 2024 at 21:44, Robert Coup <robert.coup at koordinates.com>
>>> wrote:
>>>
>>>> Hi Simon,
>>>>
>>>> On Tue, 20 Feb 2024 at 21:11, Simon Eves <simon.eves at heavy.ai> wrote:
>>>>
>>>>> Here's the stack trace for the original assert. Something is stepping
>>>>> on scratch_ to make it 0x1000000000 instead of null, which it starts out as
>>>>> when the flatbuffer object is created, but by the time it gets to
>>>>> allocating memory, it's broken.
>>>>>
>>>>
>>>> What happens if you set a watchpoint in gdb when the flatbuffer is
>>>> created?
>>>>
>>>> watch -l myfb->scratch
>>>> or watch *0x1234c0ffee
>>>>
>>>
>>> Or I've also had success with Mozilla's rr: https://rr-project.org/ ?
>>> you can run to a point where scratch is wrong, set a watchpoint on it, and
>>> then run the program backwards to find out what touched it.
>>>
>>> Rob :)
>>>
>>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240223/b90f058d/attachment.htm>

From jan.heckman at gmail.com  Sat Feb 24 03:15:46 2024
From: jan.heckman at gmail.com (Jan Heckman)
Date: Sat, 24 Feb 2024 12:15:46 +0100
Subject: [gdal-dev] layer creation option shapefile when converting arcs in
 dxf
Message-ID: <CAKMUAtBSErw8YR3U58qzZE-oSVVSzzKGoQnkuQ2YMZRPpLEtjQ@mail.gmail.com>

Hi All,
I am looking for a way to influence the (density of the) linestrings which
are produced by converting a circle segment in dxf (to a linestring in
shapefile format); the aim, ideally, is to limit the angle(s) between the
chords produced.
If not available, a setting of the number of vertices for a circle would
also help.
I searched docs, and if I overlooked, apologies in advance.
I am hoping for a setting for ogr2ogr, but also interested in a solution
using the (C++) api/library.
thanks, Jan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240224/b59b774c/attachment.htm>

From even.rouault at spatialys.com  Sat Feb 24 03:19:59 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sat, 24 Feb 2024 12:19:59 +0100
Subject: [gdal-dev] layer creation option shapefile when converting arcs
 in dxf
In-Reply-To: <CAKMUAtBSErw8YR3U58qzZE-oSVVSzzKGoQnkuQ2YMZRPpLEtjQ@mail.gmail.com>
References: <CAKMUAtBSErw8YR3U58qzZE-oSVVSzzKGoQnkuQ2YMZRPpLEtjQ@mail.gmail.com>
Message-ID: <4f074c67-b17c-4a39-968f-20df6a5ca951@spatialys.com>

Hi,

perhaps the?OGR_ARC_STEPSIZE configuration option: 
https://gdal.org/user/configoptions.html#config-OGR_ARC_STEPSIZE ?

Even

Le 24/02/2024 ? 12:15, Jan Heckman via gdal-dev a ?crit?:
> Hi All,
> I am looking for a way to influence the (density of the) linestrings 
> which are produced by converting a circle segment in dxf (to a 
> linestring in shapefile format); the aim, ideally, is to limit the 
> angle(s) between the chords produced.
> If not available, a setting of the number of vertices for a circle 
> would also help.
> I searched docs, and if I overlooked, apologies in advance.
> I am hoping for a setting for ogr2ogr, but also interested in a 
> solution using the (C++) api/library.
> thanks, Jan
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From jan.heckman at gmail.com  Sat Feb 24 11:21:57 2024
From: jan.heckman at gmail.com (Jan Heckman)
Date: Sat, 24 Feb 2024 20:21:57 +0100
Subject: [gdal-dev] layer creation option shapefile when converting arcs
 in dxf
In-Reply-To: <4f074c67-b17c-4a39-968f-20df6a5ca951@spatialys.com>
References: <CAKMUAtBSErw8YR3U58qzZE-oSVVSzzKGoQnkuQ2YMZRPpLEtjQ@mail.gmail.com>
 <4f074c67-b17c-4a39-968f-20df6a5ca951@spatialys.com>
Message-ID: <CAKMUAtAEBL3S7FTGa9cNf=O69jYVQNymnzu27e4iTC=+bi=42A@mail.gmail.com>

Even,
Thanks, that does the job.
I'll lookup configuration options first next time!
Jan

On Sat, Feb 24, 2024 at 12:20?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> perhaps the OGR_ARC_STEPSIZE configuration option:
> https://gdal.org/user/configoptions.html#config-OGR_ARC_STEPSIZE ?
>
> Even
>
> Le 24/02/2024 ? 12:15, Jan Heckman via gdal-dev a ?crit :
> > Hi All,
> > I am looking for a way to influence the (density of the) linestrings
> > which are produced by converting a circle segment in dxf (to a
> > linestring in shapefile format); the aim, ideally, is to limit the
> > angle(s) between the chords produced.
> > If not available, a setting of the number of vertices for a circle
> > would also help.
> > I searched docs, and if I overlooked, apologies in advance.
> > I am hoping for a setting for ogr2ogr, but also interested in a
> > solution using the (C++) api/library.
> > thanks, Jan
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240224/11275c6b/attachment-0001.htm>

From simon.eves at heavy.ai  Sat Feb 24 17:27:44 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Sat, 24 Feb 2024 17:27:44 -0800
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <CAJf0KTRiJPvz-ank4LdUFsNvHvr7fUi-VmULeLPLp8BBv8BOZw@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
 <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
 <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
 <CAFLLRp+8+1MwLZPJMVFa17dOp_5G1e_Jz2O10zV4J5FiGvhbdA@mail.gmail.com>
 <CAFLLRp+MqLP2rqywpjVNjhP_jmhqT2-fVG+UTVMSKR-4277s-w@mail.gmail.com>
 <CAJf0KTRxxJ1-LFhS0ZevbikYe0zRoHR+4pOZ4pSsURC2s0qAfQ@mail.gmail.com>
 <CAJf0KTSrA_Pod7EK3Cd4SYDZiHqdtXGUadWSGEEcx_G_NZn9eA@mail.gmail.com>
 <72c655aa-0579-47e1-be7c-813f85a021b5@spatialys.com>
 <CAJf0KTRiJPvz-ank4LdUFsNvHvr7fUi-VmULeLPLp8BBv8BOZw@mail.gmail.com>
Message-ID: <CAJf0KTQ=2sN7Ws-c9_ZCFXdtqFU2+iBoCoqRY4wOxGRMM1noDg@mail.gmail.com>

OK, so I tried a custom build of 3.7.3 with the latest *flatbuffers*
(23.5.26), which was a drop-in replacement for 2.0.6 other than the version
asserts.

This does not exhibit the original problem either.

However, while it produces files which the stock static build, the static
build with the older *flatbuffers* (2.0.0), and the Ubuntu dynamic build,
can all read just fine, it is unable to read ANY files back in again (in
the context of our server geo importer, anyway).

GDAL throws a *CE_Failure* of *Header failed consistency verification
(1), *which
is from *OGRFlatGeobufLayer::Open(),* and the dataset reports no layers (or
at least, no vector layers).

This also appears to be a side-effect of it being a static build, as
*ogrinfo* built from the same source (with *flatbuffers* 2.0.0), but in
regular shared libs mode, can read all three files just fine. I have been
unable to achieve a full-static tools build, so I can't try that right now.

This either means that the problem is still there in some form in the
latest *flatbuffers*, but has moved, or that the higher-level FGB file
schema verification can be affected by the *flatbuffers* version. Both are
equally concerning.

Anyway, the build with the older *flatbuffers* 2.0.0 extracted from the
v3.5.3 tree (with the *Table::VerifyField* mod) seems to work fine in all
ways, so we're probably gonna go with that, in the absence of anything else.

One other weirdness is that, of the three files, the two produced by the
static builds (*flatbuffers* 2.0.0 and *flatbuffers* 23.5.26) are 16 bytes
longer than the one from the Ubuntu dynamic build. All three read just fine
with *ogrinfo* and our server geo importer, and result in the same table.
Here is a link to a bundle with all three files plus the GeoJSON equivalent
(*MULTIPOLYGON* US states with some metadata).

https://drive.google.com/file/d/1ETRuV63gvUL4aNAT_4KvjrtK1uiCrFun/view?usp=sharing

As ever, happy to get into the weeds with more details of the original
problem, but pretty sure that 95% of the readers of this list don't want
this thread to get any longer! :)

Simon


On Fri, Feb 23, 2024 at 3:46?PM Simon Eves <simon.eves at heavy.ai> wrote:

> Our emails crossed. I am indeed testing with the latest flatbuffers now
> too.
>
> Agreed on the rest.
>
> On Fri, Feb 23, 2024 at 3:42?PM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Simon,
>>
>> did you try to update to the latest
>> https://github.com/google/flatbuffers/releases to see if that would
>> solve the issue ? If that worked, that would be the best way forward...
>>
>> Otherwise if the issue persists with the latest flatbuffers release, a
>> (admitedly rather tedious) option would be to do a git bisect on the
>> flatbuffers code to identify the culprit commit. With some luck, the root
>> cause might be obvious if a single culptrit commit can be exhibited
>> (perhaps some subtle C++ undefined behaviour triggered? also it is a bit
>> mysterious that it hits only for static builds), or otherwise raise to the
>> upstream flatbuffers project to ask for their expertise
>>
>> Even
>> Le 23/02/2024 ? 23:54, Simon Eves via gdal-dev a ?crit :
>>
>> I was able to create a fork of 3.7.3 with just the *flatbuffers*
>> replaced with the pre-3.6.x version (2.0.0).
>>
>> This seemed to only require changes to the version asserts and adding an
>> *align* parameter to *Table::VerifyField()* to match the newer API.
>>
>>
>> https://github.com/heavyai/gdal/tree/simon.eves/release/3.7/downgrade_to_flatbuffers_2.0.0
>>
>> Our system works correctly and passes all GDAL I/O tests with that
>> version. Obviously this isn't an ideal solution, but this is otherwise a
>> release blocker for us.
>>
>> I would still very much like to discuss the original problem more deeply,
>> and hopefully come up with a better solution.
>>
>> Yours hopefully,
>>
>> Simon
>>
>>
>>
>> On Thu, Feb 22, 2024 at 10:22?PM Simon Eves <simon.eves at heavy.ai> wrote:
>>
>>> Thank you, Robert, for the RR tip. I shall try it.
>>>
>>> I have new findings to report, however.
>>>
>>> First of all, I confirmed that a build against GDAL 3.4.1 (the version
>>> we were on before) still works. I also confirmed that builds against 3.7.3
>>> and 3.8.4 still failed even with no additional library dependencies (just
>>> sqlite3 and proj), in case it was a side-effect of us also adding more of
>>> those. I then tried 3.5.3, with the CMake build (same config as we use for
>>> 3.7.3) and that worked. I then tried 3.6.4 (again, same CMake config) and
>>> that failed. These were all from bundles.
>>>
>>> I then started delving through the GDAL repo itself. I found the common
>>> root commit of 3.5.3 and 3.6.4, and all the commits in the
>>> *ogr/ogrsf_frmts/flatgeobuf* sub-project between that one and the final
>>> of each. For 3.5.3, this was only two. I built and tested both, and they
>>> were fine. I then tried the very first one that was new in the 3.6.4 chain
>>> (not in the history of 3.5.3), which was actually a bulk update to the
>>> *flatbuffers* sub-library, committed by Bjorn Harrtell on May 8 2022
>>> (SHA f7d8876). That one had the issue. I then tried the
>>> immediately-preceding commit (an unrelated docs change) and that one was
>>> fine.
>>>
>>> My current hypothesis, therefore, is that the *flatbuffers* update
>>> introduced the issue, or at least, the susceptibility of the issue.
>>>
>>> I still cannot explain why it only occurs in an all-static build, and
>>> even less able to explain why it only occurs in our full system and not
>>> with the simple test program against the very same static lib build that
>>> does the very same sequence of GDAL API calls, but I repeated the build
>>> tests of the commits either side and a few other random ones a bit further
>>> away in each direction, and the results were consistent. Again, it happens
>>> with both GCC 11 and Clang 14 builds, Debug or Release.
>>>
>>> I will continue tomorrow to look at the actual changes to *flatbuffers* in
>>> that update, although they are quite significant. Certainly, the
>>> *vector_downward* class, which is directly involved, was a new file in
>>> that update (although on inspection of that file's history in the
>>> *google/flatbuffers* repo, it seems it was just split out of another
>>> header).
>>>
>>> Bjorn, I don't mean to call you out directly, but I am CC'ing you to
>>> ensure you see this, as you appear to be a significant contributor to the
>>> *flatbuffers* project itself. Any insight you may have would be very
>>> welcome. I am of course happy to describe my debugging findings in more
>>> detail, privately if you wish, rather than spamming the list.
>>>
>>> Simon
>>>
>>>
>>>
>>>
>>>
>>>
>>> On Tue, Feb 20, 2024 at 1:49?PM Robert Coup <robert.coup at koordinates.com>
>>> wrote:
>>>
>>>> Hi,
>>>>
>>>> On Tue, 20 Feb 2024 at 21:44, Robert Coup <robert.coup at koordinates.com>
>>>> wrote:
>>>>
>>>>> Hi Simon,
>>>>>
>>>>> On Tue, 20 Feb 2024 at 21:11, Simon Eves <simon.eves at heavy.ai> wrote:
>>>>>
>>>>>> Here's the stack trace for the original assert. Something is stepping
>>>>>> on scratch_ to make it 0x1000000000 instead of null, which it starts out as
>>>>>> when the flatbuffer object is created, but by the time it gets to
>>>>>> allocating memory, it's broken.
>>>>>>
>>>>>
>>>>> What happens if you set a watchpoint in gdb when the flatbuffer is
>>>>> created?
>>>>>
>>>>> watch -l myfb->scratch
>>>>> or watch *0x1234c0ffee
>>>>>
>>>>
>>>> Or I've also had success with Mozilla's rr: https://rr-project.org/ ?
>>>> you can run to a point where scratch is wrong, set a watchpoint on it, and
>>>> then run the program backwards to find out what touched it.
>>>>
>>>> Rob :)
>>>>
>>>
>> _______________________________________________
>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240224/3a03d7c1/attachment.htm>

From adam.stewart at tum.de  Sun Feb 25 03:58:43 2024
From: adam.stewart at tum.de (Adam Stewart)
Date: Sun, 25 Feb 2024 11:58:43 +0000
Subject: [gdal-dev] Official dataset for benchmarking GDAL I/O?
Message-ID: <9239DC13-93D4-4E8B-B362-96D87662D98C@tum.de>

Hi,

Background: I'm the developer of the TorchGeo<https://github.com/microsoft/torchgeo> software library. TorchGeo is a machine learning library that heavily relies on GDAL (via rasterio/fiona) for satellite imagery I/O.

One of our primary concerns is ensuring that we can load data from disk fast enough to keep the GPU busy during model training. Of course, satellite imagery is often distributed in large files that make this challenging. We use various tricks to optimize performance (COGs, windowed reading, caching, compression, parallel workers, etc.). In our initial paper<https://arxiv.org/abs/2111.08872>, we chose to create our own arbitrary I/O benchmarking dataset composed of 100 Landsat scenes and 1 CDL map. See Figure 3 for the results, and Appendix A for the experiment details.

Question: is there an official dataset that the GDAL developers use to benchmark GDAL itself? For example, if someone makes a change to how GDAL handles certain I/O operations, I assume the GDAL developers will benchmark it to see if I/O is now faster or slower. I'm envisioning experiments similar to https://kokoalberti.com/articles/geotiff-compression-optimization-guide/ for various file formats, compression levels, block sizes, etc.

If such a dataset doesn't yet exist, I would be interested in creating one and publishing a paper on how this can be used to develop libraries like GDAL and TorchGeo.

Dr. Adam J. Stewart
Technical University of Munich
School of Engineering and Design
Data Science in Earth Observation

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240225/515dccb4/attachment-0001.htm>

From even.rouault at spatialys.com  Sun Feb 25 04:25:44 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 25 Feb 2024 13:25:44 +0100
Subject: [gdal-dev] Official dataset for benchmarking GDAL I/O?
In-Reply-To: <9239DC13-93D4-4E8B-B362-96D87662D98C@tum.de>
References: <9239DC13-93D4-4E8B-B362-96D87662D98C@tum.de>
Message-ID: <1bded831-7752-4dbd-9fa8-7d0b67b49435@spatialys.com>

Adam,

Automated performance regression testing is probably one of the aspect 
of testing that could be enhanced. While the GDAL autotest suite is 
quite comprehensive functionally wise, performance testing has 
traditionally been a bit lagging. That said, this is an aspect we have 
improved lately with the addition of a benchmark component to the 
autotest suite 
https://github.com/OSGeo/gdal/tree/master/autotest/benchmark . This is 
admitedly quite minimalistic for now, but testing some scenarios 
involving the GTiff driver and gdalwarp.

To test non-regression for a pull request, we have a CI benchmark 
configuration 
(https://github.com/OSGeo/gdal/blob/master/.github/workflows/linux_build.yml#L111 
+ 
https://github.com/OSGeo/gdal/tree/master/.github/workflows/benchmarks) 
that runs the benchmarks first against master, and then with the pull 
request (during the same run of the same worker). But we need to allow a 
quite large tolerance threshold (up to +20%) to take into account that 
accurate timing measurements are extremely hard to get on CI 
infrastructure (even locally, on microbenchmarks this is very 
challenging). So this will mostly catch up big regressions, not subtle ones.

One of the difficulty with benchmark testing is that we don't want the 
tests to run for hours, especially for pull requests, so they need to be 
written in a careful way to still trigger the relevant code paths & 
mechanisms of the code base that are exercised by real-world large 
datasets while running in a few seconds each at most. Typically those 
tests autogenerate their test data too, to avoid the test suite 
depending on too large datasets and keep the repository size as small as 
possible.

As you mention GPUs, we have had private contacts from a couple GPU 
makers in recent years about potential GPU'ification of GDAL, but this 
has lead to nowhere for now. Some mentioned that moving data acquisition 
to the GPU could be interesting performance wise, but that seems to be a 
huge undertaking, basically moving the GTiff driver, libtiff and its 
codecs as GPU code. And even if done, how to manage the resulting code 
duplication... We aren't even able to properly keep up the OpenCL warper 
contributing many years ago in sync with the CPU warping code. We also 
lack GPU expertise in the current team to do that.

Even

Le 25/02/2024 ? 12:58, Adam Stewart via gdal-dev a ?crit?:
> Hi,
>
> *Background*: I'm the developer of the TorchGeo 
> <https://github.com/microsoft/torchgeo>?software library. TorchGeo is 
> a machine learning library that heavily relies on GDAL (via 
> rasterio/fiona) for satellite imagery I/O.
>
> One of our primary concerns is ensuring that we can load data from 
> disk fast enough to keep the GPU busy during model training. Of 
> course, satellite imagery is often distributed in large files that 
> make this challenging. We use various tricks to optimize performance 
> (COGs, windowed reading, caching, compression, parallel workers, 
> etc.). In our initial paper <https://arxiv.org/abs/2111.08872>, we 
> chose to create our own arbitrary I/O benchmarking dataset composed of 
> 100 Landsat scenes and 1 CDL map. See Figure 3 for the results, and 
> Appendix A for the experiment details.
>
> *Question*: is there an official dataset that the GDAL developers use 
> to benchmark GDAL itself? For example, if someone makes a change to 
> how GDAL handles certain I/O operations, I assume the GDAL developers 
> will benchmark it to see if I/O is now faster or slower. I'm 
> envisioning experiments similar to 
> https://kokoalberti.com/articles/geotiff-compression-optimization-guide/ 
> for various file formats, compression levels, block sizes, etc.
>
> If such a dataset doesn't yet exist, I would be interested in creating 
> one and publishing a paper on how this can be used to develop 
> libraries like GDAL and TorchGeo.
>
> *Dr. Adam J. Stewart*
> Technical University of Munich
> School of Engineering and Design
> Data Science in Earth Observation
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240225/3fde13b3/attachment.htm>

From jan.heckman at gmail.com  Sun Feb 25 04:32:36 2024
From: jan.heckman at gmail.com (Jan Heckman)
Date: Sun, 25 Feb 2024 13:32:36 +0100
Subject: [gdal-dev] Possible error in orientation of converted arcs from dxf
Message-ID: <CAKMUAtArYK2wA5fwHjazikhBJdLG5ci-qnYV1XG6EY=wg2y_1Q@mail.gmail.com>

Hi all,
Sorry for a somewhat long post, but here we go:
I am converting a .dxf having a sequence of simple lines and arcs which
form a continuous (poly)line, (correctly) ordered by EntityHandle. The arcs
are converted (to shp) as well as displayed (Qgis) in the opposite
direction as the simple lines. Checking the codes and docs, this appears
wrong.
Below the minimal relevant information, I can add the complete .dxf, but I
think attached files are frowned upon?

Docs cited:
https://help.autodesk.com/view/OARX/2024/ENU/?guid=GUID-0B14D8F1-0EBA-44BF-9108-57D8CE614BC8
ARC (DXF)
The following group codes apply to arc entities.
Arc group codes
Group code Description
100 Subclass marker (AcDbCircle)
39 Thickness (optional; default = 0)
10 Center point (in OCS) DXF: X value; APP: 3D point
20, 30 DXF: Y and Z values of center point (in OCS)
40 Radius
100 Subclass marker (AcDbArc)
50 Start angle
51 End angle
210 Extrusion direction (optional; default = 0, 0, 1) DXF: X value; APP: 3D
vector
220, 230 DXF: Y and Z values of extrusion direction (optional)

https://ezdxf.readthedocs.io/en/stable/tutorials/dxf_primitives.html
The arc goes always in counter-clockwise orientation around the z-axis more
precisely the extrusion vector of OCS, but this is beyond the scope of this
tutorial.

The case (extracted, whole .dxf file available):
AcDbEntity
  8
0000-001_09_AND1N
  6
Continuous
 62
    18
100
AcDbCircle
 10
130974.661837
 20
497502.478468
 30
0.0
 40
7576.094430000001
100
AcDbArc
 50
305.5444330000001
 51
344.795475
  0
LINE
  5
2E
330
1A0
100

The arc is converted (.shp) and drawn (qgis) from end angle to start angle,
without a 210 code to alter default behavior, which obviously is the other
way around, noting counter clock around (positive) Z-axis.
The applicability of this convention also follows from the (correct)
position of the arc in the conversion and drawing.
Only begin- and endpoints are interchanged.

Please advice,
Thanks in advance,
Jan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240225/c7d1fb97/attachment.htm>

From even.rouault at spatialys.com  Sun Feb 25 05:08:39 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 25 Feb 2024 14:08:39 +0100
Subject: [gdal-dev] Possible error in orientation of converted arcs from
 dxf
In-Reply-To: <CAKMUAtArYK2wA5fwHjazikhBJdLG5ci-qnYV1XG6EY=wg2y_1Q@mail.gmail.com>
References: <CAKMUAtArYK2wA5fwHjazikhBJdLG5ci-qnYV1XG6EY=wg2y_1Q@mail.gmail.com>
Message-ID: <742d1d66-7aea-46d6-8a83-b58926e9d83a@spatialys.com>

Hi,

I'm wondering if there woulnd't be a connection with 
https://github.com/OSGeo/gdal/issues/1839#issuecomment-537185826 ?

Even

Le 25/02/2024 ? 13:32, Jan Heckman via gdal-dev a ?crit?:
> Hi all,
> Sorry for a somewhat long post, but here we go:
> I am converting a .dxf having a sequence of simple lines and arcs 
> which form a continuous (poly)line, (correctly) ordered by 
> EntityHandle. The arcs are converted (to shp) as well as displayed 
> (Qgis) in the opposite direction as the simple lines. Checking the 
> codes and docs, this appears wrong.
> Below the minimal relevant information, I can add the complete .dxf, 
> but I think attached files are frowned upon?
>
> Docs cited:
> https://help.autodesk.com/view/OARX/2024/ENU/?guid=GUID-0B14D8F1-0EBA-44BF-9108-57D8CE614BC8
> ARC (DXF)
> The following group codes apply to arc entities.
> Arc group codes
> Group code Description
> 100 Subclass marker (AcDbCircle)
> 39 Thickness (optional; default = 0)
> 10 Center point (in OCS) DXF: X value; APP: 3D point
> 20, 30 DXF: Y and Z values of center point (in OCS)
> 40 Radius
> 100 Subclass marker (AcDbArc)
> 50 Start angle
> 51 End angle
> 210 Extrusion direction (optional; default = 0, 0, 1) DXF: X value; 
> APP: 3D vector
> 220, 230 DXF: Y and Z values of extrusion direction (optional)
>
> https://ezdxf.readthedocs.io/en/stable/tutorials/dxf_primitives.html
> The arc goes always in counter-clockwise orientation around the z-axis 
> more precisely the extrusion vector of OCS, but this is beyond the 
> scope of this tutorial.
>
> The case (extracted, whole .dxf file available):
> AcDbEntity
> ? 8
> 0000-001_09_AND1N
> ? 6
> Continuous
> ?62
> ? ? 18
> 100
> AcDbCircle
> ?10
> 130974.661837
> ?20
> 497502.478468
> ?30
> 0.0
> ?40
> 7576.094430000001
> 100
> AcDbArc
> ?50
> 305.5444330000001
> ?51
> 344.795475
> ? 0
> LINE
> ? 5
> 2E
> 330
> 1A0
> 100
>
> The arc is converted (.shp) and drawn (qgis) from end angle to start 
> angle, without a 210 code to alter default behavior, which obviously 
> is the other way around, noting counter clock around (positive) Z-axis.
> The applicability of this convention also follows from the (correct) 
> position of the arc in the conversion and drawing.
> Only begin- and endpoints are interchanged.
>
> Please advice,
> Thanks in advance,
> Jan
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From adam.stewart at tum.de  Sun Feb 25 05:27:03 2024
From: adam.stewart at tum.de (Adam Stewart)
Date: Sun, 25 Feb 2024 13:27:03 +0000
Subject: [gdal-dev] Official dataset for benchmarking GDAL I/O?
In-Reply-To: <1bded831-7752-4dbd-9fa8-7d0b67b49435@spatialys.com>
References: <9239DC13-93D4-4E8B-B362-96D87662D98C@tum.de>
 <1bded831-7752-4dbd-9fa8-7d0b67b49435@spatialys.com>
Message-ID: <C91B4DFA-5884-43C3-A3A1-D1D5B041F8D2@tum.de>

Thanks Even,

I think what I'm envisioning is more of an integration test than a unit test. We don't intend to use this in TorchGeo CI on every commit, only on PRs that we know may impact I/O (much less frequent than in GDAL). We would also run it before each release and publish performance metrics to prevent regressions. Since it's run infrequently and manually, we wouldn't suffer from the same issues of 20% buffering and could actually run multiple times and average.

For TorchGeo, we definitely want to consider full-sized tiles/scenes, not small synthetic patches. Many of our sampling strategies and design decisions require multiple large scenes to accurately validate.

Unless someone chimes in with different opinions, it sounds like there is room for a research paper on this topic. Would love to include some GDAL developers on such a paper if anyone has interest. Will talk this over with my own research group.

P.S. We've also been thinking about how to improve GPU support in GDAL. The lowest hanging fruit is anything that can be formulated as matrix multiplication, such as affine transformations in gdalwarp. Unfortunately, I don't know anything about CUDA/ROCm. If we were to do this in TorchGeo, we would just use PyTorch, which has a lot of overhead you won't need in GDAL. But let's discuss this in a different thread, don't want to derail this conversation.

Dr. Adam J. Stewart
Technical University of Munich
School of Engineering and Design
Data Science in Earth Observation

On Feb 25, 2024, at 13:25, Even Rouault <even.rouault at spatialys.com> wrote:


Adam,

Automated performance regression testing is probably one of the aspect of testing that could be enhanced. While the GDAL autotest suite is quite comprehensive functionally wise, performance testing has traditionally been a bit lagging. That said, this is an aspect we have improved lately with the addition of a benchmark component to the autotest suite https://github.com/OSGeo/gdal/tree/master/autotest/benchmark . This is admitedly quite minimalistic for now, but testing some scenarios involving the GTiff driver and gdalwarp.

To test non-regression for a pull request, we have a CI benchmark configuration (https://github.com/OSGeo/gdal/blob/master/.github/workflows/linux_build.yml#L111 + https://github.com/OSGeo/gdal/tree/master/.github/workflows/benchmarks) that runs the benchmarks first against master, and then with the pull request (during the same run of the same worker). But we need to allow a quite large tolerance threshold (up to +20%) to take into account that accurate timing measurements are extremely hard to get on CI infrastructure (even locally, on microbenchmarks this is very challenging). So this will mostly catch up big regressions, not subtle ones.

One of the difficulty with benchmark testing is that we don't want the tests to run for hours, especially for pull requests, so they need to be written in a careful way to still trigger the relevant code paths & mechanisms of the code base that are exercised by real-world large datasets while running in a few seconds each at most. Typically those tests autogenerate their test data too, to avoid the test suite depending on too large datasets and keep the repository size as small as possible.

As you mention GPUs, we have had private contacts from a couple GPU makers in recent years about potential GPU'ification of GDAL, but this has lead to nowhere for now. Some mentioned that moving data acquisition to the GPU could be interesting performance wise, but that seems to be a huge undertaking, basically moving the GTiff driver, libtiff and its codecs as GPU code. And even if done, how to manage the resulting code duplication... We aren't even able to properly keep up the OpenCL warper contributing many years ago in sync with the CPU warping code. We also lack GPU expertise in the current team to do that.

Even

Le 25/02/2024 ? 12:58, Adam Stewart via gdal-dev a ?crit :
Hi,

Background: I'm the developer of the TorchGeo<https://github.com/microsoft/torchgeo> software library. TorchGeo is a machine learning library that heavily relies on GDAL (via rasterio/fiona) for satellite imagery I/O.

One of our primary concerns is ensuring that we can load data from disk fast enough to keep the GPU busy during model training. Of course, satellite imagery is often distributed in large files that make this challenging. We use various tricks to optimize performance (COGs, windowed reading, caching, compression, parallel workers, etc.). In our initial paper<https://arxiv.org/abs/2111.08872>, we chose to create our own arbitrary I/O benchmarking dataset composed of 100 Landsat scenes and 1 CDL map. See Figure 3 for the results, and Appendix A for the experiment details.

Question: is there an official dataset that the GDAL developers use to benchmark GDAL itself? For example, if someone makes a change to how GDAL handles certain I/O operations, I assume the GDAL developers will benchmark it to see if I/O is now faster or slower. I'm envisioning experiments similar to https://kokoalberti.com/articles/geotiff-compression-optimization-guide/ for various file formats, compression levels, block sizes, etc.

If such a dataset doesn't yet exist, I would be interested in creating one and publishing a paper on how this can be used to develop libraries like GDAL and TorchGeo.

Dr. Adam J. Stewart
Technical University of Munich
School of Engineering and Design
Data Science in Earth Observation




_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev


--
http://www.spatialys.com<http://www.spatialys.com/>
My software is free, but my time generally not.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240225/7bb126b1/attachment-0001.htm>

From jan.heckman at gmail.com  Sun Feb 25 13:05:55 2024
From: jan.heckman at gmail.com (Jan Heckman)
Date: Sun, 25 Feb 2024 22:05:55 +0100
Subject: [gdal-dev] Possible error in orientation of converted arcs from
 dxf
In-Reply-To: <742d1d66-7aea-46d6-8a83-b58926e9d83a@spatialys.com>
References: <CAKMUAtArYK2wA5fwHjazikhBJdLG5ci-qnYV1XG6EY=wg2y_1Q@mail.gmail.com>
 <742d1d66-7aea-46d6-8a83-b58926e9d83a@spatialys.com>
Message-ID: <CAKMUAtDMPDqYZQZ5u=HFA8geTfeJ_t7wtdzGOLya1wfa34ct4Q@mail.gmail.com>

Hi Even, all,
There might be a slight connection, but my case imo does not involve either
a bulgefactor or a smoothing routine;
it is the basic conversion/render of a circular arc where apparently start-
and endangle are interchanged sofar without apparent cause.
Possibly the dxf has, earlier on, something which influences (rightly or
wrongly) the clockwise setting/bool seen in this type of driver function.
So I'll first try to find any global setting in the dxf which might
encourage clockwise circle handling instead of default anti-clockwise.
As an afterthought, this cannot be the case as then the arc would have been
drawn in the other direction, giving a very large arc instead of a smallish
one.
As I said earlier, the correct arc is used but with the (imo) wrong
orientation/sequence of the vertices.
Jan


On Sun, Feb 25, 2024 at 2:08?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> I'm wondering if there woulnd't be a connection with
> https://github.com/OSGeo/gdal/issues/1839#issuecomment-537185826 ?
>
> Even
>
> Le 25/02/2024 ? 13:32, Jan Heckman via gdal-dev a ?crit :
> > Hi all,
> > Sorry for a somewhat long post, but here we go:
> > I am converting a .dxf having a sequence of simple lines and arcs
> > which form a continuous (poly)line, (correctly) ordered by
> > EntityHandle. The arcs are converted (to shp) as well as displayed
> > (Qgis) in the opposite direction as the simple lines. Checking the
> > codes and docs, this appears wrong.
> > Below the minimal relevant information, I can add the complete .dxf,
> > but I think attached files are frowned upon?
> >
> > Docs cited:
> >
> https://help.autodesk.com/view/OARX/2024/ENU/?guid=GUID-0B14D8F1-0EBA-44BF-9108-57D8CE614BC8
> > ARC (DXF)
> > The following group codes apply to arc entities.
> > Arc group codes
> > Group code Description
> > 100 Subclass marker (AcDbCircle)
> > 39 Thickness (optional; default = 0)
> > 10 Center point (in OCS) DXF: X value; APP: 3D point
> > 20, 30 DXF: Y and Z values of center point (in OCS)
> > 40 Radius
> > 100 Subclass marker (AcDbArc)
> > 50 Start angle
> > 51 End angle
> > 210 Extrusion direction (optional; default = 0, 0, 1) DXF: X value;
> > APP: 3D vector
> > 220, 230 DXF: Y and Z values of extrusion direction (optional)
> >
> > https://ezdxf.readthedocs.io/en/stable/tutorials/dxf_primitives.html
> > The arc goes always in counter-clockwise orientation around the z-axis
> > more precisely the extrusion vector of OCS, but this is beyond the
> > scope of this tutorial.
> >
> > The case (extracted, whole .dxf file available):
> > AcDbEntity
> >   8
> > 0000-001_09_AND1N
> >   6
> > Continuous
> >  62
> >     18
> > 100
> > AcDbCircle
> >  10
> > 130974.661837
> >  20
> > 497502.478468
> >  30
> > 0.0
> >  40
> > 7576.094430000001
> > 100
> > AcDbArc
> >  50
> > 305.5444330000001
> >  51
> > 344.795475
> >   0
> > LINE
> >   5
> > 2E
> > 330
> > 1A0
> > 100
> >
> > The arc is converted (.shp) and drawn (qgis) from end angle to start
> > angle, without a 210 code to alter default behavior, which obviously
> > is the other way around, noting counter clock around (positive) Z-axis.
> > The applicability of this convention also follows from the (correct)
> > position of the arc in the conversion and drawing.
> > Only begin- and endpoints are interchanged.
> >
> > Please advice,
> > Thanks in advance,
> > Jan
> >
> > _______________________________________________
> > gdal-dev mailing list
> > gdal-dev at lists.osgeo.org
> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240225/098872d3/attachment.htm>

From even.rouault at spatialys.com  Sun Feb 25 13:13:34 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 25 Feb 2024 22:13:34 +0100
Subject: [gdal-dev] Possible error in orientation of converted arcs from
 dxf
In-Reply-To: <CAKMUAtDMPDqYZQZ5u=HFA8geTfeJ_t7wtdzGOLya1wfa34ct4Q@mail.gmail.com>
References: <CAKMUAtArYK2wA5fwHjazikhBJdLG5ci-qnYV1XG6EY=wg2y_1Q@mail.gmail.com>
 <742d1d66-7aea-46d6-8a83-b58926e9d83a@spatialys.com>
 <CAKMUAtDMPDqYZQZ5u=HFA8geTfeJ_t7wtdzGOLya1wfa34ct4Q@mail.gmail.com>
Message-ID: <11e8694d-4dca-4849-b86d-9f4413220d0e@spatialys.com>

Please file an issue with a (as small as possible) .dxf file reproducing 
the issue

Even

Le 25/02/2024 ? 22:05, Jan Heckman a ?crit?:
> Hi Even, all,
> There might be a slight connection, but my case imo does not involve 
> either a bulgefactor or a smoothing routine;
> it is the basic conversion/render of a circular arc where apparently 
> start- and endangle are interchanged sofar without apparent cause.
> Possibly the dxf has, earlier on, something which influences (rightly 
> or wrongly) the clockwise setting/bool seen in this type of driver 
> function.
> So I'll first try to find any global setting in the dxf which might 
> encourage clockwise circle handling instead of default anti-clockwise.
> As an afterthought, this cannot be the case as then the arc would have 
> been drawn in the other direction, giving a very large arc instead of 
> a smallish one.
> As I said earlier, the correct arc is used but with the (imo) wrong 
> orientation/sequence of the vertices.
> Jan
>
>
> On Sun, Feb 25, 2024 at 2:08?PM Even Rouault 
> <even.rouault at spatialys.com> wrote:
>
>     Hi,
>
>     I'm wondering if there woulnd't be a connection with
>     https://github.com/OSGeo/gdal/issues/1839#issuecomment-537185826 ?
>
>     Even
>
>     Le 25/02/2024 ? 13:32, Jan Heckman via gdal-dev a ?crit?:
>     > Hi all,
>     > Sorry for a somewhat long post, but here we go:
>     > I am converting a .dxf having a sequence of simple lines and arcs
>     > which form a continuous (poly)line, (correctly) ordered by
>     > EntityHandle. The arcs are converted (to shp) as well as displayed
>     > (Qgis) in the opposite direction as the simple lines. Checking the
>     > codes and docs, this appears wrong.
>     > Below the minimal relevant information, I can add the complete
>     .dxf,
>     > but I think attached files are frowned upon?
>     >
>     > Docs cited:
>     >
>     https://help.autodesk.com/view/OARX/2024/ENU/?guid=GUID-0B14D8F1-0EBA-44BF-9108-57D8CE614BC8
>     > ARC (DXF)
>     > The following group codes apply to arc entities.
>     > Arc group codes
>     > Group code Description
>     > 100 Subclass marker (AcDbCircle)
>     > 39 Thickness (optional; default = 0)
>     > 10 Center point (in OCS) DXF: X value; APP: 3D point
>     > 20, 30 DXF: Y and Z values of center point (in OCS)
>     > 40 Radius
>     > 100 Subclass marker (AcDbArc)
>     > 50 Start angle
>     > 51 End angle
>     > 210 Extrusion direction (optional; default = 0, 0, 1) DXF: X value;
>     > APP: 3D vector
>     > 220, 230 DXF: Y and Z values of extrusion direction (optional)
>     >
>     > https://ezdxf.readthedocs.io/en/stable/tutorials/dxf_primitives.html
>     > The arc goes always in counter-clockwise orientation around the
>     z-axis
>     > more precisely the extrusion vector of OCS, but this is beyond the
>     > scope of this tutorial.
>     >
>     > The case (extracted, whole .dxf file available):
>     > AcDbEntity
>     > ? 8
>     > 0000-001_09_AND1N
>     > ? 6
>     > Continuous
>     > ?62
>     > ? ? 18
>     > 100
>     > AcDbCircle
>     > ?10
>     > 130974.661837
>     > ?20
>     > 497502.478468
>     > ?30
>     > 0.0
>     > ?40
>     > 7576.094430000001
>     > 100
>     > AcDbArc
>     > ?50
>     > 305.5444330000001
>     > ?51
>     > 344.795475
>     > ? 0
>     > LINE
>     > ? 5
>     > 2E
>     > 330
>     > 1A0
>     > 100
>     >
>     > The arc is converted (.shp) and drawn (qgis) from end angle to
>     start
>     > angle, without a 210 code to alter default behavior, which
>     obviously
>     > is the other way around, noting counter clock around (positive)
>     Z-axis.
>     > The applicability of this convention also follows from the
>     (correct)
>     > position of the arc in the conversion and drawing.
>     > Only begin- and endpoints are interchanged.
>     >
>     > Please advice,
>     > Thanks in advance,
>     > Jan
>     >
>     > _______________________________________________
>     > gdal-dev mailing list
>     > gdal-dev at lists.osgeo.org
>     > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>     -- 
>     http://www.spatialys.com
>     My software is free, but my time generally not.
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240225/06d5e861/attachment.htm>

From even.rouault at spatialys.com  Sun Feb 25 13:19:49 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 25 Feb 2024 22:19:49 +0100
Subject: [gdal-dev] MacOSX arm64 builds available on gdal-master Conda
 channel
Message-ID: <118b1d16-cb52-4b36-b547-ac3d25a06b80@spatialys.com>

Hi,

The gdal-master Conda channel (cf 
https://gdal.org/download.html#gdal-master-conda-builds) now provides 
MacOSX arm64 builds of GDAL master.

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From simon.eves at heavy.ai  Sun Feb 25 15:03:46 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Sun, 25 Feb 2024 15:03:46 -0800
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <CAJf0KTQ=2sN7Ws-c9_ZCFXdtqFU2+iBoCoqRY4wOxGRMM1noDg@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
 <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
 <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
 <CAFLLRp+8+1MwLZPJMVFa17dOp_5G1e_Jz2O10zV4J5FiGvhbdA@mail.gmail.com>
 <CAFLLRp+MqLP2rqywpjVNjhP_jmhqT2-fVG+UTVMSKR-4277s-w@mail.gmail.com>
 <CAJf0KTRxxJ1-LFhS0ZevbikYe0zRoHR+4pOZ4pSsURC2s0qAfQ@mail.gmail.com>
 <CAJf0KTSrA_Pod7EK3Cd4SYDZiHqdtXGUadWSGEEcx_G_NZn9eA@mail.gmail.com>
 <72c655aa-0579-47e1-be7c-813f85a021b5@spatialys.com>
 <CAJf0KTRiJPvz-ank4LdUFsNvHvr7fUi-VmULeLPLp8BBv8BOZw@mail.gmail.com>
 <CAJf0KTQ=2sN7Ws-c9_ZCFXdtqFU2+iBoCoqRY4wOxGRMM1noDg@mail.gmail.com>
Message-ID: <CAJf0KTSd7jDh1VGqeDE5srtxkABHH2_5U6DhwrTWXuTsr6TZmg@mail.gmail.com>

I went ahead and did a bisect on the *flatbuffers* code itself. Turns out
there were only 63 commits that touched *include/flatbuffers*
between the versions that GDAL 3.5.x and 3.6.x use.

This is the commit that breaks it, specifically the change to
*vector_downward.h*

https://github.com/google/flatbuffers/commit/9e4ca857b6dadf116703f612187e33b7d4bb6688

If I undo just those changes in the version in GDAL 3.7.3, all is good. I
can even undo the same changes in my GDAL fork branch that has had their
latest v23.5.26 dropped in, and that's fine too.

The change is seemingly an optimization to the *size()* method, although it
only seems to avoid a couple of subtractions. I guess it must get called a
lot.

Not obvious why that change would have broken anything, and certainly still
absolutely no idea why it only happens in a full static build.

Simon



On Sat, Feb 24, 2024 at 5:27?PM Simon Eves <simon.eves at heavy.ai> wrote:

> OK, so I tried a custom build of 3.7.3 with the latest *flatbuffers*
> (23.5.26), which was a drop-in replacement for 2.0.6 other than the version
> asserts.
>
> This does not exhibit the original problem either.
>
> However, while it produces files which the stock static build, the static
> build with the older *flatbuffers* (2.0.0), and the Ubuntu dynamic build,
> can all read just fine, it is unable to read ANY files back in again (in
> the context of our server geo importer, anyway).
>
> GDAL throws a *CE_Failure* of *Header failed consistency verification
> (1), *which is from *OGRFlatGeobufLayer::Open(),* and the dataset reports
> no layers (or at least, no vector layers).
>
> This also appears to be a side-effect of it being a static build, as
> *ogrinfo* built from the same source (with *flatbuffers* 2.0.0), but in
> regular shared libs mode, can read all three files just fine. I have been
> unable to achieve a full-static tools build, so I can't try that right now.
>
> This either means that the problem is still there in some form in the
> latest *flatbuffers*, but has moved, or that the higher-level FGB file
> schema verification can be affected by the *flatbuffers* version. Both
> are equally concerning.
>
> Anyway, the build with the older *flatbuffers* 2.0.0 extracted from the
> v3.5.3 tree (with the *Table::VerifyField* mod) seems to work fine in all
> ways, so we're probably gonna go with that, in the absence of anything else.
>
> One other weirdness is that, of the three files, the two produced by the
> static builds (*flatbuffers* 2.0.0 and *flatbuffers* 23.5.26) are 16
> bytes longer than the one from the Ubuntu dynamic build. All three read
> just fine with *ogrinfo* and our server geo importer, and result in the
> same table. Here is a link to a bundle with all three files plus the
> GeoJSON equivalent (*MULTIPOLYGON* US states with some metadata).
>
>
> https://drive.google.com/file/d/1ETRuV63gvUL4aNAT_4KvjrtK1uiCrFun/view?usp=sharing
>
> As ever, happy to get into the weeds with more details of the original
> problem, but pretty sure that 95% of the readers of this list don't want
> this thread to get any longer! :)
>
> Simon
>
>
> On Fri, Feb 23, 2024 at 3:46?PM Simon Eves <simon.eves at heavy.ai> wrote:
>
>> Our emails crossed. I am indeed testing with the latest flatbuffers now
>> too.
>>
>> Agreed on the rest.
>>
>> On Fri, Feb 23, 2024 at 3:42?PM Even Rouault <even.rouault at spatialys.com>
>> wrote:
>>
>>> Simon,
>>>
>>> did you try to update to the latest
>>> https://github.com/google/flatbuffers/releases to see if that would
>>> solve the issue ? If that worked, that would be the best way forward...
>>>
>>> Otherwise if the issue persists with the latest flatbuffers release, a
>>> (admitedly rather tedious) option would be to do a git bisect on the
>>> flatbuffers code to identify the culprit commit. With some luck, the root
>>> cause might be obvious if a single culptrit commit can be exhibited
>>> (perhaps some subtle C++ undefined behaviour triggered? also it is a bit
>>> mysterious that it hits only for static builds), or otherwise raise to the
>>> upstream flatbuffers project to ask for their expertise
>>>
>>> Even
>>> Le 23/02/2024 ? 23:54, Simon Eves via gdal-dev a ?crit :
>>>
>>> I was able to create a fork of 3.7.3 with just the *flatbuffers*
>>> replaced with the pre-3.6.x version (2.0.0).
>>>
>>> This seemed to only require changes to the version asserts and adding an
>>> *align* parameter to *Table::VerifyField()* to match the newer API.
>>>
>>>
>>> https://github.com/heavyai/gdal/tree/simon.eves/release/3.7/downgrade_to_flatbuffers_2.0.0
>>>
>>> Our system works correctly and passes all GDAL I/O tests with that
>>> version. Obviously this isn't an ideal solution, but this is otherwise a
>>> release blocker for us.
>>>
>>> I would still very much like to discuss the original problem more
>>> deeply, and hopefully come up with a better solution.
>>>
>>> Yours hopefully,
>>>
>>> Simon
>>>
>>>
>>>
>>> On Thu, Feb 22, 2024 at 10:22?PM Simon Eves <simon.eves at heavy.ai> wrote:
>>>
>>>> Thank you, Robert, for the RR tip. I shall try it.
>>>>
>>>> I have new findings to report, however.
>>>>
>>>> First of all, I confirmed that a build against GDAL 3.4.1 (the version
>>>> we were on before) still works. I also confirmed that builds against 3.7.3
>>>> and 3.8.4 still failed even with no additional library dependencies (just
>>>> sqlite3 and proj), in case it was a side-effect of us also adding more of
>>>> those. I then tried 3.5.3, with the CMake build (same config as we use for
>>>> 3.7.3) and that worked. I then tried 3.6.4 (again, same CMake config) and
>>>> that failed. These were all from bundles.
>>>>
>>>> I then started delving through the GDAL repo itself. I found the common
>>>> root commit of 3.5.3 and 3.6.4, and all the commits in the
>>>> *ogr/ogrsf_frmts/flatgeobuf* sub-project between that one and the
>>>> final of each. For 3.5.3, this was only two. I built and tested both, and
>>>> they were fine. I then tried the very first one that was new in the 3.6.4
>>>> chain (not in the history of 3.5.3), which was actually a bulk update to
>>>> the *flatbuffers* sub-library, committed by Bjorn Harrtell on May 8
>>>> 2022 (SHA f7d8876). That one had the issue. I then tried the
>>>> immediately-preceding commit (an unrelated docs change) and that one was
>>>> fine.
>>>>
>>>> My current hypothesis, therefore, is that the *flatbuffers* update
>>>> introduced the issue, or at least, the susceptibility of the issue.
>>>>
>>>> I still cannot explain why it only occurs in an all-static build, and
>>>> even less able to explain why it only occurs in our full system and not
>>>> with the simple test program against the very same static lib build that
>>>> does the very same sequence of GDAL API calls, but I repeated the build
>>>> tests of the commits either side and a few other random ones a bit further
>>>> away in each direction, and the results were consistent. Again, it happens
>>>> with both GCC 11 and Clang 14 builds, Debug or Release.
>>>>
>>>> I will continue tomorrow to look at the actual changes to *flatbuffers* in
>>>> that update, although they are quite significant. Certainly, the
>>>> *vector_downward* class, which is directly involved, was a new file in
>>>> that update (although on inspection of that file's history in the
>>>> *google/flatbuffers* repo, it seems it was just split out of another
>>>> header).
>>>>
>>>> Bjorn, I don't mean to call you out directly, but I am CC'ing you to
>>>> ensure you see this, as you appear to be a significant contributor to the
>>>> *flatbuffers* project itself. Any insight you may have would be very
>>>> welcome. I am of course happy to describe my debugging findings in more
>>>> detail, privately if you wish, rather than spamming the list.
>>>>
>>>> Simon
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> On Tue, Feb 20, 2024 at 1:49?PM Robert Coup <
>>>> robert.coup at koordinates.com> wrote:
>>>>
>>>>> Hi,
>>>>>
>>>>> On Tue, 20 Feb 2024 at 21:44, Robert Coup <robert.coup at koordinates.com>
>>>>> wrote:
>>>>>
>>>>>> Hi Simon,
>>>>>>
>>>>>> On Tue, 20 Feb 2024 at 21:11, Simon Eves <simon.eves at heavy.ai> wrote:
>>>>>>
>>>>>>> Here's the stack trace for the original assert. Something is
>>>>>>> stepping on scratch_ to make it 0x1000000000 instead of null, which it
>>>>>>> starts out as when the flatbuffer object is created, but by the time it
>>>>>>> gets to allocating memory, it's broken.
>>>>>>>
>>>>>>
>>>>>> What happens if you set a watchpoint in gdb when the flatbuffer is
>>>>>> created?
>>>>>>
>>>>>> watch -l myfb->scratch
>>>>>> or watch *0x1234c0ffee
>>>>>>
>>>>>
>>>>> Or I've also had success with Mozilla's rr: https://rr-project.org/ ?
>>>>> you can run to a point where scratch is wrong, set a watchpoint on it, and
>>>>> then run the program backwards to find out what touched it.
>>>>>
>>>>> Rob :)
>>>>>
>>>>
>>> _______________________________________________
>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>> -- http://www.spatialys.com
>>> My software is free, but my time generally not.
>>>
>>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240225/82c29fbe/attachment-0001.htm>

From even.rouault at spatialys.com  Sun Feb 25 15:42:59 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 26 Feb 2024 00:42:59 +0100
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <CAJf0KTSd7jDh1VGqeDE5srtxkABHH2_5U6DhwrTWXuTsr6TZmg@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
 <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
 <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
 <CAFLLRp+8+1MwLZPJMVFa17dOp_5G1e_Jz2O10zV4J5FiGvhbdA@mail.gmail.com>
 <CAFLLRp+MqLP2rqywpjVNjhP_jmhqT2-fVG+UTVMSKR-4277s-w@mail.gmail.com>
 <CAJf0KTRxxJ1-LFhS0ZevbikYe0zRoHR+4pOZ4pSsURC2s0qAfQ@mail.gmail.com>
 <CAJf0KTSrA_Pod7EK3Cd4SYDZiHqdtXGUadWSGEEcx_G_NZn9eA@mail.gmail.com>
 <72c655aa-0579-47e1-be7c-813f85a021b5@spatialys.com>
 <CAJf0KTRiJPvz-ank4LdUFsNvHvr7fUi-VmULeLPLp8BBv8BOZw@mail.gmail.com>
 <CAJf0KTQ=2sN7Ws-c9_ZCFXdtqFU2+iBoCoqRY4wOxGRMM1noDg@mail.gmail.com>
 <CAJf0KTSd7jDh1VGqeDE5srtxkABHH2_5U6DhwrTWXuTsr6TZmg@mail.gmail.com>
Message-ID: <42e52baf-1005-4b6a-93ba-0af438d2360b@spatialys.com>


>
> Not obvious why that change would have broken anything, and certainly 
> still absolutely no idea why it only happens in a full static build.

At that point, I would slightly bet on the fact that your whole 
application would have another component using flatbuffers at a 
different version, which wouldn't have the new vector_downward::size_ 
member. Although I would expect that static linking would be in a better 
position to detect duplicated symbols than dynamic linking...

One thing we didn't do in GDAL is to add a GDAL specific namespace 
around its flatbuffers component (we did that in MapServer to avoid 
potential conflicts between MapServer's flatbuffers copy with the GDAL one)

An interesting experiment would be to revert 
https://github.com/google/flatbuffers/commit/9e4ca857b6dadf116703f612187e33b7d4bb6688 
but add a unused size_ member to see if that's enough to break things.? 
Or just scrumble a bit the order of members of vector_downward.

Or try replacing the "flatbuffers" namespace by something like 
"gdal_flatbuffers"


> Simon
>
>
>
> On Sat, Feb 24, 2024 at 5:27?PM Simon Eves <simon.eves at heavy.ai> wrote:
>
>     OK, so I tried a custom build of 3.7.3 with the latest
>     *flatbuffers* (23.5.26), which was a drop-in replacement?for 2.0.6
>     other than the version asserts.
>
>     This?does not exhibit the original problem either.
>
>     However, while it produces files which the stock static build, the
>     static build with the older *flatbuffers* (2.0.0), and the Ubuntu
>     dynamic build, can all read just fine, it is unable to read ANY
>     files back in again (in the context of our server geo importer,
>     anyway).
>
>     GDAL throws a *CE_Failure* of *Header failed consistency
>     verification (1), *which is from *OGRFlatGeobufLayer::Open(),*?and
>     the dataset reports no layers (or at least, no vector?layers).
>
>     This also appears to be a side-effect of it being a static build,
>     as *ogrinfo* built from the same source (with *flatbuffers*
>     2.0.0), but in regular shared libs mode, can read all three files
>     just fine. I have been unable to achieve?a full-static tools
>     build, so I can't try that right now.
>
>     This either means that the problem is still there in some form in
>     the latest *flatbuffers*, but has moved, or that the higher-level
>     FGB file schema verification can be affected by the *flatbuffers*
>     version. Both are equally concerning.
>
>     Anyway, the build with the older *flatbuffers* 2.0.0 extracted
>     from the v3.5.3 tree (with the *Table::VerifyField* mod) seems to
>     work fine in all ways, so we're probably gonna go with that, in
>     the absence of anything else.
>
>     One other weirdness is that, of the three files, the two produced
>     by the static builds (*flatbuffers* 2.0.0 and *flatbuffers*
>     23.5.26) are 16 bytes longer than the one from the Ubuntu dynamic
>     build. All three read just fine with *ogrinfo* and our server geo
>     importer, and result in the same table. Here is a link to a bundle
>     with all three files plus the GeoJSON equivalent (*MULTIPOLYGON*
>     US states with some metadata).
>
>     https://drive.google.com/file/d/1ETRuV63gvUL4aNAT_4KvjrtK1uiCrFun/view?usp=sharing
>
>     As ever, happy to get into the weeds with more details of the
>     original problem, but pretty sure that 95% of the readers of this
>     list don't want this thread to get any longer! :)
>
>     Simon
>
>
>     On Fri, Feb 23, 2024 at 3:46?PM Simon Eves <simon.eves at heavy.ai>
>     wrote:
>
>         Our emails crossed. I am indeed testing with the latest
>         flatbuffers now too.
>
>         Agreed on the rest.
>
>         On Fri, Feb 23, 2024 at 3:42?PM Even Rouault
>         <even.rouault at spatialys.com> wrote:
>
>             Simon,
>
>             did you try to update to the latest
>             https://github.com/google/flatbuffers/releases to see if
>             that would solve the issue ? If that worked, that would be
>             the best way forward...
>
>             Otherwise if the issue persists with the latest
>             flatbuffers release, a (admitedly rather tedious) option
>             would be to do a git bisect on the flatbuffers code to
>             identify the culprit commit. With some luck, the root
>             cause might be obvious if a single culptrit commit can be
>             exhibited (perhaps some subtle C++ undefined behaviour
>             triggered? also it is a bit mysterious that it hits only
>             for static builds), or otherwise raise to the upstream
>             flatbuffers project to ask for their expertise
>
>             Even
>
>             Le 23/02/2024 ? 23:54, Simon Eves via gdal-dev a ?crit?:
>>             I was able to create a fork of 3.7.3 with just the
>>             *flatbuffers* replaced with the pre-3.6.x version (2.0.0).
>>
>>             This seemed to only?require?changes to the
>>             version?asserts and adding an *align* parameter to
>>             *Table::VerifyField()*?to match the newer API.
>>
>>             https://github.com/heavyai/gdal/tree/simon.eves/release/3.7/downgrade_to_flatbuffers_2.0.0
>>
>>             Our system works correctly and passes all GDAL I/O tests
>>             with that version. Obviously this isn't an ideal
>>             solution, but this is otherwise a release blocker for us.
>>
>>             I would still?very much like to discuss the original
>>             problem more deeply, and hopefully come up with a better
>>             solution.
>>
>>             Yours hopefully,
>>
>>             Simon
>>
>>
>>
>>             On Thu, Feb 22, 2024 at 10:22?PM Simon Eves
>>             <simon.eves at heavy.ai> wrote:
>>
>>                 Thank you, Robert, for the RR tip. I shall try it.
>>
>>                 I have new?findings to report,?however.
>>
>>                 First of all, I confirmed that a build against GDAL
>>                 3.4.1 (the version we were on before) still works. I
>>                 also confirmed that builds against 3.7.3 and 3.8.4
>>                 still failed even with no additional library
>>                 dependencies (just sqlite3 and proj), in case it?was
>>                 a side-effect of us also adding more of those. I then
>>                 tried 3.5.3, with the CMake build (same config as we
>>                 use for 3.7.3) and that worked. I then tried 3.6.4
>>                 (again, same CMake config) and that failed. These
>>                 were all from bundles.
>>
>>                 I then started delving through the GDAL repo itself.
>>                 I found the common root commit of 3.5.3 and 3.6.4,
>>                 and all the commits in the
>>                 *ogr/ogrsf_frmts/flatgeobuf*?sub-project between that
>>                 one and the final of each. For 3.5.3, this was only
>>                 two. I built and tested both, and they were fine. I
>>                 then tried the very first one that was new in the
>>                 3.6.4 chain (not in the history of 3.5.3), which was
>>                 actually a bulk update to the *flatbuffers*
>>                 sub-library, committed?by Bjorn Harrtell on May 8
>>                 2022 (SHA f7d8876). That one had the issue. I then
>>                 tried the immediately-preceding commit (an unrelated
>>                 docs change) and that one was fine.
>>
>>                 My current hypothesis, therefore, is that the
>>                 *flatbuffers* update introduced the issue,?or at
>>                 least, the susceptibility of the issue.
>>
>>                 I still cannot explain why it only occurs in an
>>                 all-static build, and even less able to explain why
>>                 it only occurs in our full system and not with the
>>                 simple test program against the very same static lib
>>                 build that does the very same sequence of GDAL API
>>                 calls, but I repeated the build tests of the commits
>>                 either side and a few other random ones a bit further
>>                 away in each direction, and the results were
>>                 consistent. Again, it happens with both GCC 11 and
>>                 Clang 14 builds, Debug or Release.
>>
>>                 I will continue tomorrow to look at the actual
>>                 changes to *flatbuffers*?in that update, although
>>                 they are quite significant. Certainly, the
>>                 *vector_downward* class, which is directly involved,
>>                 was a new file in that update (although on inspection
>>                 of that file's history in the *google/flatbuffers*
>>                 repo, it seems it was just split out of another header).
>>
>>                 Bjorn, I don't mean to call you out directly, but I
>>                 am CC'ing you to ensure you see this, as you appear
>>                 to be a significant contributor to the *flatbuffers*
>>                 project itself. Any insight you may have would be
>>                 very welcome. I am of course happy to describe my
>>                 debugging findings in more detail, privately if you
>>                 wish, rather than spamming the list.
>>
>>                 Simon
>>
>>
>>
>>
>>
>>
>>                 On Tue, Feb 20, 2024 at 1:49?PM Robert Coup
>>                 <robert.coup at koordinates.com> wrote:
>>
>>                     Hi,
>>
>>                     On Tue, 20 Feb 2024 at 21:44, Robert Coup
>>                     <robert.coup at koordinates.com> wrote:
>>
>>                         Hi Simon,
>>
>>                         On Tue, 20 Feb 2024 at 21:11, Simon Eves
>>                         <simon.eves at heavy.ai> wrote:
>>
>>                             Here's the stack trace for the original
>>                             assert. Something is stepping on scratch_
>>                             to make it 0x1000000000 instead of null,
>>                             which it starts out as when?the
>>                             flatbuffer object is created, but by the
>>                             time it gets to allocating memory, it's
>>                             broken.
>>
>>
>>                         What happens if you set a watchpoint in gdb
>>                         when?the flatbuffer is created?
>>
>>                         watch -l myfb->scratch
>>                         or watch *0x1234c0ffee
>>
>>
>>                     Or I've also had success with Mozilla's rr:
>>                     https://rr-project.org/ ? you can run to a point
>>                     where scratch is?wrong, set a watchpoint on it,
>>                     and then run the program backwards to find out
>>                     what touched it.
>>
>>                     Rob :)
>>
>>
>>             _______________________________________________
>>             gdal-dev mailing list
>>             gdal-dev at lists.osgeo.org
>>             https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>             -- 
>             http://www.spatialys.com
>             My software is free, but my time generally not.
>
-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/225a4413/attachment-0001.htm>

From simon.eves at heavy.ai  Sun Feb 25 17:26:01 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Sun, 25 Feb 2024 17:26:01 -0800
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <42e52baf-1005-4b6a-93ba-0af438d2360b@spatialys.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
 <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
 <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
 <CAFLLRp+8+1MwLZPJMVFa17dOp_5G1e_Jz2O10zV4J5FiGvhbdA@mail.gmail.com>
 <CAFLLRp+MqLP2rqywpjVNjhP_jmhqT2-fVG+UTVMSKR-4277s-w@mail.gmail.com>
 <CAJf0KTRxxJ1-LFhS0ZevbikYe0zRoHR+4pOZ4pSsURC2s0qAfQ@mail.gmail.com>
 <CAJf0KTSrA_Pod7EK3Cd4SYDZiHqdtXGUadWSGEEcx_G_NZn9eA@mail.gmail.com>
 <72c655aa-0579-47e1-be7c-813f85a021b5@spatialys.com>
 <CAJf0KTRiJPvz-ank4LdUFsNvHvr7fUi-VmULeLPLp8BBv8BOZw@mail.gmail.com>
 <CAJf0KTQ=2sN7Ws-c9_ZCFXdtqFU2+iBoCoqRY4wOxGRMM1noDg@mail.gmail.com>
 <CAJf0KTSd7jDh1VGqeDE5srtxkABHH2_5U6DhwrTWXuTsr6TZmg@mail.gmail.com>
 <42e52baf-1005-4b6a-93ba-0af438d2360b@spatialys.com>
Message-ID: <CAJf0KTQ4BhRQzq-UbVhuF4rmu70rLE2P3KAFO6s+-Ap8N1jY6g@mail.gmail.com>

Ooh, good call!

That also corresponds with what I just tried, which was to leave the change
in, but have the *size()* method return a value derived the old way instead
of just returning *size_*, and also compare the two and log any mismatch.
This also fails, which would seem to discount my thought that perhaps the
math wasn't equivalent, and something else was getting confused by a
different value returned from size() and then trampling on memory. However,
no value mismatch is reported before it fails.

(pause for search)

So I scanned all the static libs in our dependency bundle with *nm*, and
whaddya know... Apache Arrow (9.0.0) also uses *flatbuffers* and also with
no namespace! I pulled the source, and it's v1.12.0... the *vector_downward*
class has the same data members as the v2.0.0 in GDAL, without *size_*,
which was inserted in the middle.

The latest Arrow 15.0 uses the latest *flatbuffers* 23.5.26, but with a
custom namespace. I'll look through to see when they did that. 9.0.0 is
only 18 months old, but we could probably stand to upgrade that too.

namespace arrow_vendored_private::flatbuffers {}
namespace flatbuffers = arrow_vendored_private::flatbuffers;

This also, of course, explains why we only hit the problem in the full
server build, and I was unable to reproduce it with the simple test
program, because that only linked GDAL and not Arrow too.

OK, so I guess we might be able to avoid it by upgrading Arrow, as long as
that doesn't break something else. I guess you need to do the custom
namespace thing too, though.

I hate computers.

Simon


On Sun, Feb 25, 2024 at 3:43?PM Even Rouault <even.rouault at spatialys.com>
wrote:

>
>
> Not obvious why that change would have broken anything, and certainly
> still absolutely no idea why it only happens in a full static build.
>
> At that point, I would slightly bet on the fact that your whole
> application would have another component using flatbuffers at a different
> version, which wouldn't have the new vector_downward::size_ member.
> Although I would expect that static linking would be in a better position
> to detect duplicated symbols than dynamic linking...
>
> One thing we didn't do in GDAL is to add a GDAL specific namespace around
> its flatbuffers component (we did that in MapServer to avoid potential
> conflicts between MapServer's flatbuffers copy with the GDAL one)
>
> An interesting experiment would be to revert
> https://github.com/google/flatbuffers/commit/9e4ca857b6dadf116703f612187e33b7d4bb6688
> but add a unused size_ member to see if that's enough to break things.  Or
> just scrumble a bit the order of members of vector_downward.
>
> Or try replacing the "flatbuffers" namespace by something like
> "gdal_flatbuffers"
>
> Simon
>
>
>
> On Sat, Feb 24, 2024 at 5:27?PM Simon Eves <simon.eves at heavy.ai> wrote:
>
>> OK, so I tried a custom build of 3.7.3 with the latest *flatbuffers*
>> (23.5.26), which was a drop-in replacement for 2.0.6 other than the version
>> asserts.
>>
>> This does not exhibit the original problem either.
>>
>> However, while it produces files which the stock static build, the static
>> build with the older *flatbuffers* (2.0.0), and the Ubuntu dynamic
>> build, can all read just fine, it is unable to read ANY files back in again
>> (in the context of our server geo importer, anyway).
>>
>> GDAL throws a *CE_Failure* of *Header failed consistency verification
>> (1), *which is from *OGRFlatGeobufLayer::Open(),* and the dataset
>> reports no layers (or at least, no vector layers).
>>
>> This also appears to be a side-effect of it being a static build, as
>> *ogrinfo* built from the same source (with *flatbuffers* 2.0.0), but in
>> regular shared libs mode, can read all three files just fine. I have been
>> unable to achieve a full-static tools build, so I can't try that right now.
>>
>> This either means that the problem is still there in some form in the
>> latest *flatbuffers*, but has moved, or that the higher-level FGB file
>> schema verification can be affected by the *flatbuffers* version. Both
>> are equally concerning.
>>
>> Anyway, the build with the older *flatbuffers* 2.0.0 extracted from the
>> v3.5.3 tree (with the *Table::VerifyField* mod) seems to work fine in
>> all ways, so we're probably gonna go with that, in the absence of anything
>> else.
>>
>> One other weirdness is that, of the three files, the two produced by the
>> static builds (*flatbuffers* 2.0.0 and *flatbuffers* 23.5.26) are 16
>> bytes longer than the one from the Ubuntu dynamic build. All three read
>> just fine with *ogrinfo* and our server geo importer, and result in the
>> same table. Here is a link to a bundle with all three files plus the
>> GeoJSON equivalent (*MULTIPOLYGON* US states with some metadata).
>>
>>
>> https://drive.google.com/file/d/1ETRuV63gvUL4aNAT_4KvjrtK1uiCrFun/view?usp=sharing
>>
>> As ever, happy to get into the weeds with more details of the original
>> problem, but pretty sure that 95% of the readers of this list don't want
>> this thread to get any longer! :)
>>
>> Simon
>>
>>
>> On Fri, Feb 23, 2024 at 3:46?PM Simon Eves <simon.eves at heavy.ai> wrote:
>>
>>> Our emails crossed. I am indeed testing with the latest flatbuffers now
>>> too.
>>>
>>> Agreed on the rest.
>>>
>>> On Fri, Feb 23, 2024 at 3:42?PM Even Rouault <even.rouault at spatialys.com>
>>> wrote:
>>>
>>>> Simon,
>>>>
>>>> did you try to update to the latest
>>>> https://github.com/google/flatbuffers/releases to see if that would
>>>> solve the issue ? If that worked, that would be the best way forward...
>>>>
>>>> Otherwise if the issue persists with the latest flatbuffers release, a
>>>> (admitedly rather tedious) option would be to do a git bisect on the
>>>> flatbuffers code to identify the culprit commit. With some luck, the root
>>>> cause might be obvious if a single culptrit commit can be exhibited
>>>> (perhaps some subtle C++ undefined behaviour triggered? also it is a bit
>>>> mysterious that it hits only for static builds), or otherwise raise to the
>>>> upstream flatbuffers project to ask for their expertise
>>>>
>>>> Even
>>>> Le 23/02/2024 ? 23:54, Simon Eves via gdal-dev a ?crit :
>>>>
>>>> I was able to create a fork of 3.7.3 with just the *flatbuffers*
>>>> replaced with the pre-3.6.x version (2.0.0).
>>>>
>>>> This seemed to only require changes to the version asserts and adding
>>>> an *align* parameter to *Table::VerifyField()* to match the newer API.
>>>>
>>>>
>>>> https://github.com/heavyai/gdal/tree/simon.eves/release/3.7/downgrade_to_flatbuffers_2.0.0
>>>>
>>>> Our system works correctly and passes all GDAL I/O tests with that
>>>> version. Obviously this isn't an ideal solution, but this is otherwise a
>>>> release blocker for us.
>>>>
>>>> I would still very much like to discuss the original problem more
>>>> deeply, and hopefully come up with a better solution.
>>>>
>>>> Yours hopefully,
>>>>
>>>> Simon
>>>>
>>>>
>>>>
>>>> On Thu, Feb 22, 2024 at 10:22?PM Simon Eves <simon.eves at heavy.ai>
>>>> wrote:
>>>>
>>>>> Thank you, Robert, for the RR tip. I shall try it.
>>>>>
>>>>> I have new findings to report, however.
>>>>>
>>>>> First of all, I confirmed that a build against GDAL 3.4.1 (the version
>>>>> we were on before) still works. I also confirmed that builds against 3.7.3
>>>>> and 3.8.4 still failed even with no additional library dependencies (just
>>>>> sqlite3 and proj), in case it was a side-effect of us also adding more of
>>>>> those. I then tried 3.5.3, with the CMake build (same config as we use for
>>>>> 3.7.3) and that worked. I then tried 3.6.4 (again, same CMake config) and
>>>>> that failed. These were all from bundles.
>>>>>
>>>>> I then started delving through the GDAL repo itself. I found the
>>>>> common root commit of 3.5.3 and 3.6.4, and all the commits in the
>>>>> *ogr/ogrsf_frmts/flatgeobuf* sub-project between that one and the
>>>>> final of each. For 3.5.3, this was only two. I built and tested both, and
>>>>> they were fine. I then tried the very first one that was new in the 3.6.4
>>>>> chain (not in the history of 3.5.3), which was actually a bulk update to
>>>>> the *flatbuffers* sub-library, committed by Bjorn Harrtell on May 8
>>>>> 2022 (SHA f7d8876). That one had the issue. I then tried the
>>>>> immediately-preceding commit (an unrelated docs change) and that one was
>>>>> fine.
>>>>>
>>>>> My current hypothesis, therefore, is that the *flatbuffers* update
>>>>> introduced the issue, or at least, the susceptibility of the issue.
>>>>>
>>>>> I still cannot explain why it only occurs in an all-static build, and
>>>>> even less able to explain why it only occurs in our full system and not
>>>>> with the simple test program against the very same static lib build that
>>>>> does the very same sequence of GDAL API calls, but I repeated the build
>>>>> tests of the commits either side and a few other random ones a bit further
>>>>> away in each direction, and the results were consistent. Again, it happens
>>>>> with both GCC 11 and Clang 14 builds, Debug or Release.
>>>>>
>>>>> I will continue tomorrow to look at the actual changes to
>>>>> *flatbuffers* in that update, although they are quite significant.
>>>>> Certainly, the *vector_downward* class, which is directly involved,
>>>>> was a new file in that update (although on inspection of that file's
>>>>> history in the *google/flatbuffers* repo, it seems it was just split
>>>>> out of another header).
>>>>>
>>>>> Bjorn, I don't mean to call you out directly, but I am CC'ing you to
>>>>> ensure you see this, as you appear to be a significant contributor to the
>>>>> *flatbuffers* project itself. Any insight you may have would be very
>>>>> welcome. I am of course happy to describe my debugging findings in more
>>>>> detail, privately if you wish, rather than spamming the list.
>>>>>
>>>>> Simon
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> On Tue, Feb 20, 2024 at 1:49?PM Robert Coup <
>>>>> robert.coup at koordinates.com> wrote:
>>>>>
>>>>>> Hi,
>>>>>>
>>>>>> On Tue, 20 Feb 2024 at 21:44, Robert Coup <
>>>>>> robert.coup at koordinates.com> wrote:
>>>>>>
>>>>>>> Hi Simon,
>>>>>>>
>>>>>>> On Tue, 20 Feb 2024 at 21:11, Simon Eves <simon.eves at heavy.ai>
>>>>>>> wrote:
>>>>>>>
>>>>>>>> Here's the stack trace for the original assert. Something is
>>>>>>>> stepping on scratch_ to make it 0x1000000000 instead of null, which it
>>>>>>>> starts out as when the flatbuffer object is created, but by the time it
>>>>>>>> gets to allocating memory, it's broken.
>>>>>>>>
>>>>>>>
>>>>>>> What happens if you set a watchpoint in gdb when the flatbuffer is
>>>>>>> created?
>>>>>>>
>>>>>>> watch -l myfb->scratch
>>>>>>> or watch *0x1234c0ffee
>>>>>>>
>>>>>>
>>>>>> Or I've also had success with Mozilla's rr: https://rr-project.org/
>>>>>> ? you can run to a point where scratch is wrong, set a watchpoint on it,
>>>>>> and then run the program backwards to find out what touched it.
>>>>>>
>>>>>> Rob :)
>>>>>>
>>>>>
>>>> _______________________________________________
>>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>
>>>> -- http://www.spatialys.com
>>>> My software is free, but my time generally not.
>>>>
>>>> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240225/d7f493d0/attachment-0001.htm>

From simon.eves at heavy.ai  Sun Feb 25 17:39:40 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Sun, 25 Feb 2024 17:39:40 -0800
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <CAJf0KTQ4BhRQzq-UbVhuF4rmu70rLE2P3KAFO6s+-Ap8N1jY6g@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTRO7HGrXsstBoHGn7zS2nJYCL9COUph0xQHtgphRbk3vw@mail.gmail.com>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
 <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
 <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
 <CAFLLRp+8+1MwLZPJMVFa17dOp_5G1e_Jz2O10zV4J5FiGvhbdA@mail.gmail.com>
 <CAFLLRp+MqLP2rqywpjVNjhP_jmhqT2-fVG+UTVMSKR-4277s-w@mail.gmail.com>
 <CAJf0KTRxxJ1-LFhS0ZevbikYe0zRoHR+4pOZ4pSsURC2s0qAfQ@mail.gmail.com>
 <CAJf0KTSrA_Pod7EK3Cd4SYDZiHqdtXGUadWSGEEcx_G_NZn9eA@mail.gmail.com>
 <72c655aa-0579-47e1-be7c-813f85a021b5@spatialys.com>
 <CAJf0KTRiJPvz-ank4LdUFsNvHvr7fUi-VmULeLPLp8BBv8BOZw@mail.gmail.com>
 <CAJf0KTQ=2sN7Ws-c9_ZCFXdtqFU2+iBoCoqRY4wOxGRMM1noDg@mail.gmail.com>
 <CAJf0KTSd7jDh1VGqeDE5srtxkABHH2_5U6DhwrTWXuTsr6TZmg@mail.gmail.com>
 <42e52baf-1005-4b6a-93ba-0af438d2360b@spatialys.com>
 <CAJf0KTQ4BhRQzq-UbVhuF4rmu70rLE2P3KAFO6s+-Ap8N1jY6g@mail.gmail.com>
Message-ID: <CAJf0KTTz585D06sDjYnWCWPTRjA1akmqAdBYmQUeEDOfALn+rQ@mail.gmail.com>

Arrow moved to using a custom namespace in v10.0.0

On Sun, Feb 25, 2024 at 5:26?PM Simon Eves <simon.eves at heavy.ai> wrote:

> Ooh, good call!
>
> That also corresponds with what I just tried, which was to leave the
> change in, but have the *size()* method return a value derived the old
> way instead of just returning *size_*, and also compare the two and log
> any mismatch. This also fails, which would seem to discount my thought that
> perhaps the math wasn't equivalent, and something else was getting confused
> by a different value returned from size() and then trampling on memory.
> However, no value mismatch is reported before it fails.
>
> (pause for search)
>
> So I scanned all the static libs in our dependency bundle with *nm*, and
> whaddya know... Apache Arrow (9.0.0) also uses *flatbuffers* and also
> with no namespace! I pulled the source, and it's v1.12.0... the
> *vector_downward* class has the same data members as the v2.0.0 in GDAL,
> without *size_*, which was inserted in the middle.
>
> The latest Arrow 15.0 uses the latest *flatbuffers* 23.5.26, but with a
> custom namespace. I'll look through to see when they did that. 9.0.0 is
> only 18 months old, but we could probably stand to upgrade that too.
>
> namespace arrow_vendored_private::flatbuffers {}
> namespace flatbuffers = arrow_vendored_private::flatbuffers;
>
> This also, of course, explains why we only hit the problem in the full
> server build, and I was unable to reproduce it with the simple test
> program, because that only linked GDAL and not Arrow too.
>
> OK, so I guess we might be able to avoid it by upgrading Arrow, as long as
> that doesn't break something else. I guess you need to do the custom
> namespace thing too, though.
>
> I hate computers.
>
> Simon
>
>
> On Sun, Feb 25, 2024 at 3:43?PM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>>
>>
>> Not obvious why that change would have broken anything, and certainly
>> still absolutely no idea why it only happens in a full static build.
>>
>> At that point, I would slightly bet on the fact that your whole
>> application would have another component using flatbuffers at a different
>> version, which wouldn't have the new vector_downward::size_ member.
>> Although I would expect that static linking would be in a better position
>> to detect duplicated symbols than dynamic linking...
>>
>> One thing we didn't do in GDAL is to add a GDAL specific namespace around
>> its flatbuffers component (we did that in MapServer to avoid potential
>> conflicts between MapServer's flatbuffers copy with the GDAL one)
>>
>> An interesting experiment would be to revert
>> https://github.com/google/flatbuffers/commit/9e4ca857b6dadf116703f612187e33b7d4bb6688
>> but add a unused size_ member to see if that's enough to break things.  Or
>> just scrumble a bit the order of members of vector_downward.
>>
>> Or try replacing the "flatbuffers" namespace by something like
>> "gdal_flatbuffers"
>>
>> Simon
>>
>>
>>
>> On Sat, Feb 24, 2024 at 5:27?PM Simon Eves <simon.eves at heavy.ai> wrote:
>>
>>> OK, so I tried a custom build of 3.7.3 with the latest *flatbuffers*
>>> (23.5.26), which was a drop-in replacement for 2.0.6 other than the version
>>> asserts.
>>>
>>> This does not exhibit the original problem either.
>>>
>>> However, while it produces files which the stock static build, the
>>> static build with the older *flatbuffers* (2.0.0), and the Ubuntu
>>> dynamic build, can all read just fine, it is unable to read ANY files back
>>> in again (in the context of our server geo importer, anyway).
>>>
>>> GDAL throws a *CE_Failure* of *Header failed consistency verification
>>> (1), *which is from *OGRFlatGeobufLayer::Open(),* and the dataset
>>> reports no layers (or at least, no vector layers).
>>>
>>> This also appears to be a side-effect of it being a static build, as
>>> *ogrinfo* built from the same source (with *flatbuffers* 2.0.0), but in
>>> regular shared libs mode, can read all three files just fine. I have been
>>> unable to achieve a full-static tools build, so I can't try that right now.
>>>
>>> This either means that the problem is still there in some form in the
>>> latest *flatbuffers*, but has moved, or that the higher-level FGB file
>>> schema verification can be affected by the *flatbuffers* version. Both
>>> are equally concerning.
>>>
>>> Anyway, the build with the older *flatbuffers* 2.0.0 extracted from the
>>> v3.5.3 tree (with the *Table::VerifyField* mod) seems to work fine in
>>> all ways, so we're probably gonna go with that, in the absence of anything
>>> else.
>>>
>>> One other weirdness is that, of the three files, the two produced by the
>>> static builds (*flatbuffers* 2.0.0 and *flatbuffers* 23.5.26) are 16
>>> bytes longer than the one from the Ubuntu dynamic build. All three read
>>> just fine with *ogrinfo* and our server geo importer, and result in the
>>> same table. Here is a link to a bundle with all three files plus the
>>> GeoJSON equivalent (*MULTIPOLYGON* US states with some metadata).
>>>
>>>
>>> https://drive.google.com/file/d/1ETRuV63gvUL4aNAT_4KvjrtK1uiCrFun/view?usp=sharing
>>>
>>> As ever, happy to get into the weeds with more details of the original
>>> problem, but pretty sure that 95% of the readers of this list don't want
>>> this thread to get any longer! :)
>>>
>>> Simon
>>>
>>>
>>> On Fri, Feb 23, 2024 at 3:46?PM Simon Eves <simon.eves at heavy.ai> wrote:
>>>
>>>> Our emails crossed. I am indeed testing with the latest flatbuffers now
>>>> too.
>>>>
>>>> Agreed on the rest.
>>>>
>>>> On Fri, Feb 23, 2024 at 3:42?PM Even Rouault <
>>>> even.rouault at spatialys.com> wrote:
>>>>
>>>>> Simon,
>>>>>
>>>>> did you try to update to the latest
>>>>> https://github.com/google/flatbuffers/releases to see if that would
>>>>> solve the issue ? If that worked, that would be the best way forward...
>>>>>
>>>>> Otherwise if the issue persists with the latest flatbuffers release, a
>>>>> (admitedly rather tedious) option would be to do a git bisect on the
>>>>> flatbuffers code to identify the culprit commit. With some luck, the root
>>>>> cause might be obvious if a single culptrit commit can be exhibited
>>>>> (perhaps some subtle C++ undefined behaviour triggered? also it is a bit
>>>>> mysterious that it hits only for static builds), or otherwise raise to the
>>>>> upstream flatbuffers project to ask for their expertise
>>>>>
>>>>> Even
>>>>> Le 23/02/2024 ? 23:54, Simon Eves via gdal-dev a ?crit :
>>>>>
>>>>> I was able to create a fork of 3.7.3 with just the *flatbuffers*
>>>>> replaced with the pre-3.6.x version (2.0.0).
>>>>>
>>>>> This seemed to only require changes to the version asserts and adding
>>>>> an *align* parameter to *Table::VerifyField()* to match the newer
>>>>> API.
>>>>>
>>>>>
>>>>> https://github.com/heavyai/gdal/tree/simon.eves/release/3.7/downgrade_to_flatbuffers_2.0.0
>>>>>
>>>>> Our system works correctly and passes all GDAL I/O tests with that
>>>>> version. Obviously this isn't an ideal solution, but this is otherwise a
>>>>> release blocker for us.
>>>>>
>>>>> I would still very much like to discuss the original problem more
>>>>> deeply, and hopefully come up with a better solution.
>>>>>
>>>>> Yours hopefully,
>>>>>
>>>>> Simon
>>>>>
>>>>>
>>>>>
>>>>> On Thu, Feb 22, 2024 at 10:22?PM Simon Eves <simon.eves at heavy.ai>
>>>>> wrote:
>>>>>
>>>>>> Thank you, Robert, for the RR tip. I shall try it.
>>>>>>
>>>>>> I have new findings to report, however.
>>>>>>
>>>>>> First of all, I confirmed that a build against GDAL 3.4.1 (the
>>>>>> version we were on before) still works. I also confirmed that builds
>>>>>> against 3.7.3 and 3.8.4 still failed even with no additional library
>>>>>> dependencies (just sqlite3 and proj), in case it was a side-effect of us
>>>>>> also adding more of those. I then tried 3.5.3, with the CMake build (same
>>>>>> config as we use for 3.7.3) and that worked. I then tried 3.6.4 (again,
>>>>>> same CMake config) and that failed. These were all from bundles.
>>>>>>
>>>>>> I then started delving through the GDAL repo itself. I found the
>>>>>> common root commit of 3.5.3 and 3.6.4, and all the commits in the
>>>>>> *ogr/ogrsf_frmts/flatgeobuf* sub-project between that one and the
>>>>>> final of each. For 3.5.3, this was only two. I built and tested both, and
>>>>>> they were fine. I then tried the very first one that was new in the 3.6.4
>>>>>> chain (not in the history of 3.5.3), which was actually a bulk update to
>>>>>> the *flatbuffers* sub-library, committed by Bjorn Harrtell on May 8
>>>>>> 2022 (SHA f7d8876). That one had the issue. I then tried the
>>>>>> immediately-preceding commit (an unrelated docs change) and that one was
>>>>>> fine.
>>>>>>
>>>>>> My current hypothesis, therefore, is that the *flatbuffers* update
>>>>>> introduced the issue, or at least, the susceptibility of the issue.
>>>>>>
>>>>>> I still cannot explain why it only occurs in an all-static build, and
>>>>>> even less able to explain why it only occurs in our full system and not
>>>>>> with the simple test program against the very same static lib build that
>>>>>> does the very same sequence of GDAL API calls, but I repeated the build
>>>>>> tests of the commits either side and a few other random ones a bit further
>>>>>> away in each direction, and the results were consistent. Again, it happens
>>>>>> with both GCC 11 and Clang 14 builds, Debug or Release.
>>>>>>
>>>>>> I will continue tomorrow to look at the actual changes to
>>>>>> *flatbuffers* in that update, although they are quite significant.
>>>>>> Certainly, the *vector_downward* class, which is directly involved,
>>>>>> was a new file in that update (although on inspection of that file's
>>>>>> history in the *google/flatbuffers* repo, it seems it was just split
>>>>>> out of another header).
>>>>>>
>>>>>> Bjorn, I don't mean to call you out directly, but I am CC'ing you to
>>>>>> ensure you see this, as you appear to be a significant contributor to the
>>>>>> *flatbuffers* project itself. Any insight you may have would be very
>>>>>> welcome. I am of course happy to describe my debugging findings in more
>>>>>> detail, privately if you wish, rather than spamming the list.
>>>>>>
>>>>>> Simon
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> On Tue, Feb 20, 2024 at 1:49?PM Robert Coup <
>>>>>> robert.coup at koordinates.com> wrote:
>>>>>>
>>>>>>> Hi,
>>>>>>>
>>>>>>> On Tue, 20 Feb 2024 at 21:44, Robert Coup <
>>>>>>> robert.coup at koordinates.com> wrote:
>>>>>>>
>>>>>>>> Hi Simon,
>>>>>>>>
>>>>>>>> On Tue, 20 Feb 2024 at 21:11, Simon Eves <simon.eves at heavy.ai>
>>>>>>>> wrote:
>>>>>>>>
>>>>>>>>> Here's the stack trace for the original assert. Something is
>>>>>>>>> stepping on scratch_ to make it 0x1000000000 instead of null, which it
>>>>>>>>> starts out as when the flatbuffer object is created, but by the time it
>>>>>>>>> gets to allocating memory, it's broken.
>>>>>>>>>
>>>>>>>>
>>>>>>>> What happens if you set a watchpoint in gdb when the flatbuffer is
>>>>>>>> created?
>>>>>>>>
>>>>>>>> watch -l myfb->scratch
>>>>>>>> or watch *0x1234c0ffee
>>>>>>>>
>>>>>>>
>>>>>>> Or I've also had success with Mozilla's rr: https://rr-project.org/
>>>>>>> ? you can run to a point where scratch is wrong, set a watchpoint on it,
>>>>>>> and then run the program backwards to find out what touched it.
>>>>>>>
>>>>>>> Rob :)
>>>>>>>
>>>>>>
>>>>> _______________________________________________
>>>>> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>>>
>>>>> -- http://www.spatialys.com
>>>>> My software is free, but my time generally not.
>>>>>
>>>>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240225/4c802f54/attachment-0001.htm>

From even.rouault at spatialys.com  Sun Feb 25 17:52:38 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 26 Feb 2024 02:52:38 +0100
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <CAJf0KTQ4BhRQzq-UbVhuF4rmu70rLE2P3KAFO6s+-Ap8N1jY6g@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
 <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
 <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
 <CAFLLRp+8+1MwLZPJMVFa17dOp_5G1e_Jz2O10zV4J5FiGvhbdA@mail.gmail.com>
 <CAFLLRp+MqLP2rqywpjVNjhP_jmhqT2-fVG+UTVMSKR-4277s-w@mail.gmail.com>
 <CAJf0KTRxxJ1-LFhS0ZevbikYe0zRoHR+4pOZ4pSsURC2s0qAfQ@mail.gmail.com>
 <CAJf0KTSrA_Pod7EK3Cd4SYDZiHqdtXGUadWSGEEcx_G_NZn9eA@mail.gmail.com>
 <72c655aa-0579-47e1-be7c-813f85a021b5@spatialys.com>
 <CAJf0KTRiJPvz-ank4LdUFsNvHvr7fUi-VmULeLPLp8BBv8BOZw@mail.gmail.com>
 <CAJf0KTQ=2sN7Ws-c9_ZCFXdtqFU2+iBoCoqRY4wOxGRMM1noDg@mail.gmail.com>
 <CAJf0KTSd7jDh1VGqeDE5srtxkABHH2_5U6DhwrTWXuTsr6TZmg@mail.gmail.com>
 <42e52baf-1005-4b6a-93ba-0af438d2360b@spatialys.com>
 <CAJf0KTQ4BhRQzq-UbVhuF4rmu70rLE2P3KAFO6s+-Ap8N1jY6g@mail.gmail.com>
Message-ID: <d24d7bda-bb74-4805-9ce2-e75b7b45572c@spatialys.com>


>
> OK, so I guess we might be able to avoid it by?upgrading Arrow, as 
> long as that?doesn't?break something else. I guess you need to do 
> the?custom namespace thing too, though.
(ab)use of preprocessor functionality makes it easy: 
https://github.com/OSGeo/gdal/pull/9313 ...
>
> I hate computers.

:-) :-)


-- 
http://www.spatialys.com
My software is free, but my time generally not.


From simon.eves at heavy.ai  Sun Feb 25 20:46:49 2024
From: simon.eves at heavy.ai (Simon Eves)
Date: Sun, 25 Feb 2024 20:46:49 -0800
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <d24d7bda-bb74-4805-9ce2-e75b7b45572c@spatialys.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAFLLRp+Hzh2f4SAdAi6u5+fkwgwWZZdudeQtFgdgJf2u=aVgfQ@mail.gmail.com>
 <CAJf0KTQy7AmBZZcrscZCR3vnJW_2dq9W2a_J8+9E5u237bViMg@mail.gmail.com>
 <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
 <CAFLLRp+8+1MwLZPJMVFa17dOp_5G1e_Jz2O10zV4J5FiGvhbdA@mail.gmail.com>
 <CAFLLRp+MqLP2rqywpjVNjhP_jmhqT2-fVG+UTVMSKR-4277s-w@mail.gmail.com>
 <CAJf0KTRxxJ1-LFhS0ZevbikYe0zRoHR+4pOZ4pSsURC2s0qAfQ@mail.gmail.com>
 <CAJf0KTSrA_Pod7EK3Cd4SYDZiHqdtXGUadWSGEEcx_G_NZn9eA@mail.gmail.com>
 <72c655aa-0579-47e1-be7c-813f85a021b5@spatialys.com>
 <CAJf0KTRiJPvz-ank4LdUFsNvHvr7fUi-VmULeLPLp8BBv8BOZw@mail.gmail.com>
 <CAJf0KTQ=2sN7Ws-c9_ZCFXdtqFU2+iBoCoqRY4wOxGRMM1noDg@mail.gmail.com>
 <CAJf0KTSd7jDh1VGqeDE5srtxkABHH2_5U6DhwrTWXuTsr6TZmg@mail.gmail.com>
 <42e52baf-1005-4b6a-93ba-0af438d2360b@spatialys.com>
 <CAJf0KTQ4BhRQzq-UbVhuF4rmu70rLE2P3KAFO6s+-Ap8N1jY6g@mail.gmail.com>
 <d24d7bda-bb74-4805-9ce2-e75b7b45572c@spatialys.com>
Message-ID: <CAJf0KTT+GJMSOXcK3sLoaj3wxBnxEaFeM6D64xQ_qtGjYiN=yQ@mail.gmail.com>

As we're not ready to upgrade Arrow just yet, I also did the namespace
change as a pre-build code patch on the regular 3.7.3 bundle.

Apologies to Bjorn and anyone else on that team for any inference that this
was a flatbuffers bug. Not my intention. Glad we worked it out.

Simon

On Sun, Feb 25, 2024 at 5:52?PM Even Rouault <even.rouault at spatialys.com>
wrote:

>
> >
> > OK, so I guess we might be able to avoid it by upgrading Arrow, as
> > long as that doesn't break something else. I guess you need to do
> > the custom namespace thing too, though.
> (ab)use of preprocessor functionality makes it easy:
> https://github.com/OSGeo/gdal/pull/9313 ...
> >
> > I hate computers.
>
> :-) :-)
>
>
> --
> http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240225/0fd6fa9a/attachment.htm>

From schwehr at gmail.com  Sun Feb 25 21:02:22 2024
From: schwehr at gmail.com (Kurt Schwehr)
Date: Sun, 25 Feb 2024 21:02:22 -0800
Subject: [gdal-dev] Official dataset for benchmarking GDAL I/O?
In-Reply-To: <C91B4DFA-5884-43C3-A3A1-D1D5B041F8D2@tum.de>
References: <9239DC13-93D4-4E8B-B362-96D87662D98C@tum.de>
 <1bded831-7752-4dbd-9fa8-7d0b67b49435@spatialys.com>
 <C91B4DFA-5884-43C3-A3A1-D1D5B041F8D2@tum.de>
Message-ID: <CACmBxyuJqtBPho7UOhZNCzDLxAA615qOBcW5Zr7+cqyOpJ_v1A@mail.gmail.com>

As Even said, this is a really tough topic. I have tried some micro
benchmarking for small bits and for short term dev this is sort of ok. The
biggest problem is getting a stable test env for benchmarking. Even a
single user machine doing only benchmarking is all over the place. And if
you are benchmarking on a fleet, the difference in other tasks and exact
specs of the machines makes the data crazy noisy. Even with binary sizes
and ram usage I saw large run to run variance because of slight changes in
dependencies changing how the compiler's optimizers work. For timing, if I
end up with different hardware it's bad, but even within a hardware config,
bus contention, how hot the caches stay, ssd perf, network, and other
systems can be highly variable.

On Sun, Feb 25, 2024, 5:27?AM Adam Stewart via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Thanks Even,
>
> I think what I'm envisioning is more of an integration test than a unit
> test. We don't intend to use this in TorchGeo CI on every commit, only on
> PRs that we know may impact I/O (much less frequent than in GDAL). We would
> also run it before each release and publish performance metrics to prevent
> regressions. Since it's run infrequently and manually, we wouldn't suffer
> from the same issues of 20% buffering and could actually run multiple times
> and average.
>
> For TorchGeo, we definitely want to consider full-sized tiles/scenes, not
> small synthetic patches. Many of our sampling strategies and design
> decisions require multiple large scenes to accurately validate.
>
> Unless someone chimes in with different opinions, it sounds like there is
> room for a research paper on this topic. Would love to include some GDAL
> developers on such a paper if anyone has interest. Will talk this over with
> my own research group.
>
> P.S. We've also been thinking about how to improve GPU support in GDAL.
> The lowest hanging fruit is anything that can be formulated as matrix
> multiplication, such as affine transformations in gdalwarp. Unfortunately,
> I don't know anything about CUDA/ROCm. If we were to do this in TorchGeo,
> we would just use PyTorch, which has a lot of overhead you won't need in
> GDAL. But let's discuss this in a different thread, don't want to derail
> this conversation.
>
> *Dr. Adam J. Stewart*
> Technical University of Munich
> School of Engineering and Design
> Data Science in Earth Observation
>
> On Feb 25, 2024, at 13:25, Even Rouault <even.rouault at spatialys.com>
> wrote:
>
> Adam,
>
> Automated performance regression testing is probably one of the aspect of
> testing that could be enhanced. While the GDAL autotest suite is quite
> comprehensive functionally wise, performance testing has traditionally been
> a bit lagging. That said, this is an aspect we have improved lately with
> the addition of a benchmark component to the autotest suite
> https://github.com/OSGeo/gdal/tree/master/autotest/benchmark . This is
> admitedly quite minimalistic for now, but testing some scenarios involving
> the GTiff driver and gdalwarp.
>
> To test non-regression for a pull request, we have a CI benchmark
> configuration (
> https://github.com/OSGeo/gdal/blob/master/.github/workflows/linux_build.yml#L111
> + https://github.com/OSGeo/gdal/tree/master/.github/workflows/benchmarks)
> that runs the benchmarks first against master, and then with the pull
> request (during the same run of the same worker). But we need to allow a
> quite large tolerance threshold (up to +20%) to take into account that
> accurate timing measurements are extremely hard to get on CI infrastructure
> (even locally, on microbenchmarks this is very challenging). So this will
> mostly catch up big regressions, not subtle ones.
>
> One of the difficulty with benchmark testing is that we don't want the
> tests to run for hours, especially for pull requests, so they need to be
> written in a careful way to still trigger the relevant code paths &
> mechanisms of the code base that are exercised by real-world large datasets
> while running in a few seconds each at most. Typically those tests
> autogenerate their test data too, to avoid the test suite depending on too
> large datasets and keep the repository size as small as possible.
>
> As you mention GPUs, we have had private contacts from a couple GPU makers
> in recent years about potential GPU'ification of GDAL, but this has lead to
> nowhere for now. Some mentioned that moving data acquisition to the GPU
> could be interesting performance wise, but that seems to be a huge
> undertaking, basically moving the GTiff driver, libtiff and its codecs as
> GPU code. And even if done, how to manage the resulting code duplication...
> We aren't even able to properly keep up the OpenCL warper contributing many
> years ago in sync with the CPU warping code. We also lack GPU expertise in
> the current team to do that.
>
> Even
> Le 25/02/2024 ? 12:58, Adam Stewart via gdal-dev a ?crit :
>
> Hi,
>
> *Background*: I'm the developer of the TorchGeo
> <https://github.com/microsoft/torchgeo> software library. TorchGeo is a
> machine learning library that heavily relies on GDAL (via rasterio/fiona)
> for satellite imagery I/O.
>
> One of our primary concerns is ensuring that we can load data from disk
> fast enough to keep the GPU busy during model training. Of course,
> satellite imagery is often distributed in large files that make this
> challenging. We use various tricks to optimize performance (COGs, windowed
> reading, caching, compression, parallel workers, etc.). In our initial
> paper <https://arxiv.org/abs/2111.08872>, we chose to create our own
> arbitrary I/O benchmarking dataset composed of 100 Landsat scenes and 1 CDL
> map. See Figure 3 for the results, and Appendix A for the experiment
> details.
>
> *Question*: is there an official dataset that the GDAL developers use to
> benchmark GDAL itself? For example, if someone makes a change to how GDAL
> handles certain I/O operations, I assume the GDAL developers will benchmark
> it to see if I/O is now faster or slower. I'm envisioning experiments
> similar to
> https://kokoalberti.com/articles/geotiff-compression-optimization-guide/
> for various file formats, compression levels, block sizes, etc.
>
> If such a dataset doesn't yet exist, I would be interested in creating one
> and publishing a paper on how this can be used to develop libraries like
> GDAL and TorchGeo.
>
> *Dr. Adam J. Stewart*
> Technical University of Munich
> School of Engineering and Design
> Data Science in Earth Observation
>
>
> _______________________________________________
> gdal-dev mailing listgdal-dev at lists.osgeo.orghttps://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240225/cd1dcdd3/attachment.htm>

From even.rouault at spatialys.com  Mon Feb 26 04:14:57 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 26 Feb 2024 13:14:57 +0100
Subject: [gdal-dev] Call for discussion on RFC99: Geometry coordinate
 precision
Message-ID: <c2708bea-db40-451b-afeb-42d0fb3ca67d@spatialys.com>

Hi,

I've drafted https://github.com/OSGeo/gdal/pull/9300 (rendered text at 
https://github.com/rouault/gdal/blob/rfc99_text/doc/source/development/rfc/rfc99_geometry_coordinate_precision.rst)

Summary:

This RFC aims at introducing optional metadata to specify the coordinate 
precision of geometries, to be able to round appropriately coordinates 
and limit the number of decimals when exporting to text-based formats or 
nullify least-significant bits for binary formats. That metadata will be 
stored into and read from formats that can support it.

Note that this is not backed by an implementation yet (except a 
prototype done one year or so for the nullification of least-significant 
bits in WKB), so there might be changes/additions to the exposed plan, 
but the document exposes the general directions

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From even.rouault at spatialys.com  Mon Feb 26 06:40:35 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 26 Feb 2024 15:40:35 +0100
Subject: [gdal-dev] OpenJPEG 2.5.1 released
Message-ID: <17f4463c-1fff-4094-aa2f-e97695c0807f@spatialys.com>

Hi,

OpenJPEG 2.5.1 is released: 
https://github.com/uclouvain/openjpeg/releases/tag/v2.5.1

Summary:

* No API/ABI break compared to v2.5.0
* CMake: drop support for cmake < 3.5
* Several bugfixes, including 
https://github.com/uclouvain/openjpeg/pull/1509 for CVE-2021-3575
* Significant speed-up rate allocation by rate/distoratio ratio 
[\#1440](https://github.com/uclouvain/openjpeg/pull/1440)

More info:
News: https://github.com/uclouvain/openjpeg/blob/v2.5.1/NEWS.md
Changelog: https://github.com/uclouvain/openjpeg/blob/v2.5.1/CHANGELOG.md
Full Changelog: 
https://github.com/uclouvain/openjpeg/compare/v2.5.0...v2.5.1

Enjoy,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


From a.pau at creaf.uab.cat  Mon Feb 26 08:20:36 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Mon, 26 Feb 2024 16:20:36 +0000
Subject: [gdal-dev] Some problems after updating
Message-ID: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi,

usually (and always works) I call this two sentences from command line in Windows:

cmake -B D:\GitHub-repository\GDAL\build -S . -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
cmake --build D:\GitHub-repository\GDAL\build

The first one generates all projects that I can open with Visual Studio
The second one compilates all files, and it ens with no problems.

To test is works I've been using lots of line commands, for example this one (using the program ogr2ogr):

D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco Version=V1.1 --config CPL_DEBUG ON

It's been working untiel today when next error appears:
---------------------------
ogr2ogr.exe - No se encuentra el punto de entrada
---------------------------
No se encuentra el punto de entrada del procedimiento ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z en la biblioteca de v?nculos din?micos D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
---------------------------
D'acord
---------------------------

What is the diference between today and yesterday?
I've done 2 things:

?         Download and Install VCPKG (the method that worked for me)

?         .\vcpkg\bootstrap-vcpkg.bat

?         .\vcpkg integrate install

?         .\vcpkg install gdal --triplet=x64-windows

And, of course, download lasts codes from GDAL to be on date before finishing the job I'm doing.

So, can anyone put some light to this mistery? What I am doing wrong this time?
There is some dependence I am using wrong?

I am a little desperate with that kind of errors.

Thanks a lot!



Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/5911e9c6/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/5911e9c6/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/5911e9c6/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/5911e9c6/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/5911e9c6/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/5911e9c6/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/5911e9c6/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/5911e9c6/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/5911e9c6/attachment-0003.jpg>

From even.rouault at spatialys.com  Mon Feb 26 08:29:48 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 26 Feb 2024 17:29:48 +0100
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>

hi,

perhaps make sure that your PATH environment variable includes a 
directory that contains the gdal.dll of *your* build (should likely be 
D:\GitHub-repository\GDAL\build\Debug) before the one potentially coming 
from vcpkg

Even

Le 26/02/2024 ? 17:20, Abel Pau via gdal-dev a ?crit?:
>
> Hi,
>
> usually (and always works) I call this two sentences from command line 
> in Windows:
>
> cmake -B D:\GitHub-repository\GDAL\build -S . 
> -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
>
> cmake --build D:\GitHub-repository\GDAL\build
>
> The first one generates all projects that I can open with Visual Studio
>
> The second one compilates all files, and it ens with no problems.
>
> To test is works I?ve been using lots of line commands, for example 
> this one (using the program ogr2ogr):
>
> D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe 
> D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol 
> D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco 
> Version=V1.1 --config CPL_DEBUG ON
>
> It?s been working untiel today when next error appears:
>
> ---------------------------
>
> ogr2ogr.exe - No se encuentra el punto de entrada
>
> ---------------------------
>
> No se encuentra el punto de entrada del procedimiento 
> ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z 
> en la biblioteca de v?nculos din?micos 
> D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
>
> ---------------------------
>
> D'acord
>
> ---------------------------
>
> What is the diference between today and yesterday?
> I?ve done 2 things:
>
> ?Download and Install VCPKG (the method that worked for me)
>
> ?.\vcpkg\bootstrap-vcpkg.bat
>
> ?.\vcpkg integrate install
>
> ?.\vcpkg install gdal --triplet=x64-windows
>
> And, of course, download lasts codes from GDAL to be on date before 
> finishing the job I?m doing.
>
> So, can anyone put some light to this mistery? What I am doing wrong 
> this time?
>
> There is some dependence I am using wrong?
>
> I am a little desperate with that kind of errors.
>
> Thanks a lot!
>
> *Abel Pau Garcia*
>
> *GIS developer*
>
> 	
>
> https://www.creaf.cat/sites/default/files/creaf-signature.png
>
> *a.pau at creaf.uab.cat* <mailto:a.pau at creaf.uab.cat>
>
> *Let's chat on Teams!* 
> <https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
>
> *Tel. +34 934814277*
>
> 	
>
> https://www.creaf.cat/sites/default/files/so-en-signature.png
>
> https://www.creaf.cat/sites/default/files/twitter-icon-signature.png 
> <https://twitter.com/CREAF_ecologia>https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png 
> <https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>https://www.creaf.cat/sites/default/files/youtube-icon-signature.png 
> <https://www.youtube.com/c/creafecologia>https://www.creaf.cat/sites/default/files/instagram-icon-signature.png 
> <https://www.instagram.com/CREAF_ecologia/>
>
> *www.creaf.cat* <http://www.creaf.cat>*| **http://blog.creaf.cat* 
> <http://blog.creaf.cat>
>
> 	
>
> https://www.creaf.cat/sites/default/files/uab_logo_signatura.png
>
> CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)
>
>
> Before printing this electronic message, think about the environment.
>
> http://www.creaf.uab.cat/_signatura/line.gif
>
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/0a835046/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/0a835046/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/0a835046/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/0a835046/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/0a835046/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/0a835046/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/0a835046/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/0a835046/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/0a835046/attachment-0003.jpg>

From a.pau at creaf.uab.cat  Mon Feb 26 08:42:02 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Mon, 26 Feb 2024 16:42:02 +0000
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
Message-ID: <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi Even, thanks for your answer.

I paste here some of my variables:
After too many months perhaps there are things that are not necessary, but the one you sais is there:

GDAL_DATA
D:\GitHub-repository\GDAL\build\data

PATH
PATH%;
D:\GitHub-repository\GDAL\build\Debug;
C:\Users\a.pau\AppData\Local\GitHubDesktop\bin;
C:\Program Files\Graphviz\bin;
D:\GitHub-repository\odbc-cpp-wrapper\build\src\odbc\Release;
D:\mapes\programes\make-3.81-bin\bin;

But same error appears :(


De: Even Rouault <even.rouault at spatialys.com>
Enviado el: dilluns, 26 de febrer de 2024 17:30
Para: Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Some problems after updating


hi,

perhaps make sure that your PATH environment variable includes a directory that contains the gdal.dll of *your* build (should likely be D:\GitHub-repository\GDAL\build\Debug) before the one potentially coming from vcpkg

Even
Le 26/02/2024 ? 17:20, Abel Pau via gdal-dev a ?crit :
Hi,

usually (and always works) I call this two sentences from command line in Windows:

cmake -B D:\GitHub-repository\GDAL\build -S . -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
cmake --build D:\GitHub-repository\GDAL\build

The first one generates all projects that I can open with Visual Studio
The second one compilates all files, and it ens with no problems.

To test is works I?ve been using lots of line commands, for example this one (using the program ogr2ogr):

D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco Version=V1.1 --config CPL_DEBUG ON

It?s been working untiel today when next error appears:
---------------------------
ogr2ogr.exe - No se encuentra el punto de entrada
---------------------------
No se encuentra el punto de entrada del procedimiento ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z en la biblioteca de v?nculos din?micos D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
---------------------------
D'acord
---------------------------

What is the diference between today and yesterday?
I?ve done 2 things:

1.       Download and Install VCPKG (the method that worked for me)

2.       .\vcpkg\bootstrap-vcpkg.bat

3.       .\vcpkg integrate install

4.       .\vcpkg install gdal --triplet=x64-windows

And, of course, download lasts codes from GDAL to be on date before finishing the job I?m doing.

So, can anyone put some light to this mistery? What I am doing wrong this time?
There is some dependence I am using wrong?

I am a little desperate with that kind of errors.

Thanks a lot!



Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.






_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/c057d084/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/c057d084/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/c057d084/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/c057d084/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/c057d084/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/c057d084/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/c057d084/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/c057d084/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/c057d084/attachment-0003.jpg>

From a.pau at creaf.uab.cat  Mon Feb 26 08:48:14 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Mon, 26 Feb 2024 16:48:14 +0000
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
 <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <PAXPR07MB77750D19A12C6E6B94B1D80FA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>

It even now doesn?t work from Visual Studio itself.
I don?t understand what have changed from yesterday to today (apart from updating vcpkg and gdal code itself).



De: gdal-dev <gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 17:42
Para: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Some problems after updating

Hi Even, thanks for your answer.

I paste here some of my variables:
After too many months perhaps there are things that are not necessary, but the one you sais is there:

GDAL_DATA
D:\GitHub-repository\GDAL\build\data

PATH
PATH%;
D:\GitHub-repository\GDAL\build\Debug;
C:\Users\a.pau\AppData\Local\GitHubDesktop\bin;
C:\Program Files\Graphviz\bin;
D:\GitHub-repository\odbc-cpp-wrapper\build\src\odbc\Release;
D:\mapes\programes\make-3.81-bin\bin;

But same error appears :(


De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:30
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


hi,

perhaps make sure that your PATH environment variable includes a directory that contains the gdal.dll of *your* build (should likely be D:\GitHub-repository\GDAL\build\Debug) before the one potentially coming from vcpkg

Even
Le 26/02/2024 ? 17:20, Abel Pau via gdal-dev a ?crit :
Hi,

usually (and always works) I call this two sentences from command line in Windows:

cmake -B D:\GitHub-repository\GDAL\build -S . -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
cmake --build D:\GitHub-repository\GDAL\build

The first one generates all projects that I can open with Visual Studio
The second one compilates all files, and it ens with no problems.

To test is works I?ve been using lots of line commands, for example this one (using the program ogr2ogr):

D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco Version=V1.1 --config CPL_DEBUG ON

It?s been working untiel today when next error appears:
---------------------------
ogr2ogr.exe - No se encuentra el punto de entrada
---------------------------
No se encuentra el punto de entrada del procedimiento ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z en la biblioteca de v?nculos din?micos D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
---------------------------
D'acord
---------------------------

What is the diference between today and yesterday?
I?ve done 2 things:

1.       Download and Install VCPKG (the method that worked for me)

2.       .\vcpkg\bootstrap-vcpkg.bat

3.       .\vcpkg integrate install

4.       .\vcpkg install gdal --triplet=x64-windows

And, of course, download lasts codes from GDAL to be on date before finishing the job I?m doing.

So, can anyone put some light to this mistery? What I am doing wrong this time?
There is some dependence I am using wrong?

I am a little desperate with that kind of errors.

Thanks a lot!



Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.





_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/bb0d656c/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/bb0d656c/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/bb0d656c/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/bb0d656c/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/bb0d656c/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/bb0d656c/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/bb0d656c/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/bb0d656c/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/bb0d656c/attachment-0003.jpg>

From even.rouault at spatialys.com  Mon Feb 26 08:54:48 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 26 Feb 2024 17:54:48 +0100
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <PAXPR07MB77750D19A12C6E6B94B1D80FA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
 <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB77750D19A12C6E6B94B1D80FA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <3c88271e-981e-4f1e-8fab-7c655f9aed75@spatialys.com>

Perhaps try the good old methods: run the "clean" target and do a full 
rebuild

Le 26/02/2024 ? 17:48, Abel Pau via gdal-dev a ?crit?:
>
> It even now doesn?t work from Visual Studio itself.
>
> I don?t understand what have changed from yesterday to today (apart 
> from updating vcpkg and gdal code itself).
>
> *De:*gdal-dev <gdal-dev-bounces at lists.osgeo.org> *En nombre de *Abel 
> Pau via gdal-dev
> *Enviado el:* dilluns, 26 de febrer de 2024 17:42
> *Para:* Even Rouault <even.rouault at spatialys.com>; 
> gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
> Hi Even, thanks for your answer.
>
> I paste here some of my variables:
>
> After too many months perhaps there are things that are not necessary, 
> but the one you sais is there:
>
> *GDAL_DATA *
>
> D:\GitHub-repository\GDAL\build\data
>
> *PATH *
>
> PATH%;
>
> D:\GitHub-repository\GDAL\build\Debug;
>
> C:\Users\a.pau\AppData\Local\GitHubDesktop\bin;
>
> C:\Program Files\Graphviz\bin;
>
> D:\GitHub-repository\odbc-cpp-wrapper\build\src\odbc\Release;
>
> D:\mapes\programes\make-3.81-bin\bin;
>
> But same error appears :(
>
> *De:*Even Rouault <even.rouault at spatialys.com>
> *Enviado el:* dilluns, 26 de febrer de 2024 17:30
> *Para:* Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
> hi,
>
> perhaps make sure that your PATH environment variable includes a 
> directory that contains the gdal.dll of *your* build (should likely be 
> D:\GitHub-repository\GDAL\build\Debug) before the one potentially 
> coming from vcpkg
>
> Even
>
> Le 26/02/2024 ? 17:20, Abel Pau via gdal-dev a ?crit?:
>
>     Hi,
>
>     usually (and always works) I call this two sentences from command
>     line in Windows:
>
>     cmake -B D:\GitHub-repository\GDAL\build -S .
>     -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
>
>     cmake --build D:\GitHub-repository\GDAL\build
>
>     The first one generates all projects that I can open with Visual
>     Studio
>
>     The second one compilates all files, and it ens with no problems.
>
>     To test is works I?ve been using lots of line commands, for
>     example this one (using the program ogr2ogr):
>
>     D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe
>     D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol
>     D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco
>     Version=V1.1 --config CPL_DEBUG ON
>
>     It?s been working untiel today when next error appears:
>
>     ---------------------------
>
>     ogr2ogr.exe - No se encuentra el punto de entrada
>
>     ---------------------------
>
>     No se encuentra el punto de entrada del procedimiento
>     ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z
>     en la biblioteca de v?nculos din?micos
>     D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
>
>     ---------------------------
>
>     D'acord
>
>     ---------------------------
>
>     What is the diference between today and yesterday?
>     I?ve done 2 things:
>
>     1.Download and Install VCPKG (the method that worked for me)
>
>     2..\vcpkg\bootstrap-vcpkg.bat
>
>     3..\vcpkg integrate install
>
>     4..\vcpkg install gdal --triplet=x64-windows
>
>     And, of course, download lasts codes from GDAL to be on date
>     before finishing the job I?m doing.
>
>     So, can anyone put some light to this mistery? What I am doing
>     wrong this time?
>
>     There is some dependence I am using wrong?
>
>     I am a little desperate with that kind of errors.
>
>     Thanks a lot!
>
>     *Abel Pau Garcia*
>
>     *GIS developer*
>
>     	
>
>     https://www.creaf.cat/sites/default/files/creaf-signature.png
>
>     *a.pau at creaf.uab.cat* <mailto:a.pau at creaf.uab.cat>
>
>     *Let's chat on Teams!*
>     <https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
>
>     *Tel. +34 934814277*
>
>     	
>
>     https://www.creaf.cat/sites/default/files/so-en-signature.png
>
>     https://www.creaf.cat/sites/default/files/twitter-icon-signature.png
>     <https://twitter.com/CREAF_ecologia>https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png
>     <https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>https://www.creaf.cat/sites/default/files/youtube-icon-signature.png
>     <https://www.youtube.com/c/creafecologia>https://www.creaf.cat/sites/default/files/instagram-icon-signature.png
>     <https://www.instagram.com/CREAF_ecologia/>
>
>     *www.creaf.cat* <http://www.creaf.cat>*| **http://blog.creaf.cat*
>     <http://blog.creaf.cat>
>
>     	
>
>     https://www.creaf.cat/sites/default/files/uab_logo_signatura.png
>
>     CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)
>
>
>     Before printing this electronic message, think about the environment.
>
>     http://www.creaf.uab.cat/_signatura/line.gif
>
>     _______________________________________________
>
>     gdal-dev mailing list
>
>     gdal-dev at lists.osgeo.org
>
>     https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> -- 
> http://www.spatialys.com
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/21dcd46c/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/21dcd46c/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/21dcd46c/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/21dcd46c/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/21dcd46c/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/21dcd46c/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/21dcd46c/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/21dcd46c/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/21dcd46c/attachment-0003.jpg>

From a.pau at creaf.uab.cat  Mon Feb 26 09:17:23 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Mon, 26 Feb 2024 17:17:23 +0000
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <3c88271e-981e-4f1e-8fab-7c655f9aed75@spatialys.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
 <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB77750D19A12C6E6B94B1D80FA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <3c88271e-981e-4f1e-8fab-7c655f9aed75@spatialys.com>
Message-ID: <PAXPR07MB77755EBDA32F91C5404B45E6A25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>

Done but it doesn?t work.
The error is the same.
Any other idea?

De: Even Rouault <even.rouault at spatialys.com>
Enviado el: dilluns, 26 de febrer de 2024 17:55
Para: Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Some problems after updating


Perhaps try the good old methods: run the "clean" target and do a full rebuild
Le 26/02/2024 ? 17:48, Abel Pau via gdal-dev a ?crit :
It even now doesn?t work from Visual Studio itself.
I don?t understand what have changed from yesterday to today (apart from updating vcpkg and gdal code itself).



De: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 17:42
Para: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Hi Even, thanks for your answer.

I paste here some of my variables:
After too many months perhaps there are things that are not necessary, but the one you sais is there:

GDAL_DATA
D:\GitHub-repository\GDAL\build\data

PATH
PATH%;
D:\GitHub-repository\GDAL\build\Debug;
C:\Users\a.pau\AppData\Local\GitHubDesktop\bin;
C:\Program Files\Graphviz\bin;
D:\GitHub-repository\odbc-cpp-wrapper\build\src\odbc\Release;
D:\mapes\programes\make-3.81-bin\bin;

But same error appears :(


De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:30
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


hi,

perhaps make sure that your PATH environment variable includes a directory that contains the gdal.dll of *your* build (should likely be D:\GitHub-repository\GDAL\build\Debug) before the one potentially coming from vcpkg

Even
Le 26/02/2024 ? 17:20, Abel Pau via gdal-dev a ?crit :
Hi,

usually (and always works) I call this two sentences from command line in Windows:

cmake -B D:\GitHub-repository\GDAL\build -S . -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
cmake --build D:\GitHub-repository\GDAL\build

The first one generates all projects that I can open with Visual Studio
The second one compilates all files, and it ens with no problems.

To test is works I?ve been using lots of line commands, for example this one (using the program ogr2ogr):

D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco Version=V1.1 --config CPL_DEBUG ON

It?s been working untiel today when next error appears:
---------------------------
ogr2ogr.exe - No se encuentra el punto de entrada
---------------------------
No se encuentra el punto de entrada del procedimiento ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z en la biblioteca de v?nculos din?micos D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
---------------------------
D'acord
---------------------------

What is the diference between today and yesterday?
I?ve done 2 things:

1.       Download and Install VCPKG (the method that worked for me)

2.       .\vcpkg\bootstrap-vcpkg.bat

3.       .\vcpkg integrate install

4.       .\vcpkg install gdal --triplet=x64-windows

And, of course, download lasts codes from GDAL to be on date before finishing the job I?m doing.

So, can anyone put some light to this mistery? What I am doing wrong this time?
There is some dependence I am using wrong?

I am a little desperate with that kind of errors.

Thanks a lot!



Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.





_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.



_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/ce4aa7c1/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/ce4aa7c1/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/ce4aa7c1/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/ce4aa7c1/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/ce4aa7c1/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/ce4aa7c1/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/ce4aa7c1/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/ce4aa7c1/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240226/ce4aa7c1/attachment-0003.jpg>

From a.pau at creaf.uab.cat  Tue Feb 27 00:15:21 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Tue, 27 Feb 2024 08:15:21 +0000
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <PAXPR07MB77755EBDA32F91C5404B45E6A25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
 <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB77750D19A12C6E6B94B1D80FA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <3c88271e-981e-4f1e-8fab-7c655f9aed75@spatialys.com>
 <PAXPR07MB77755EBDA32F91C5404B45E6A25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <PAXPR07MB7775B25A9FC47D7214791395A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi again,
I built and compiled the Gdal version in GitHub (without my changes) and the error is NOT gone.
Anyone has compiled very recently and is capable to call ogr2ogr with no problems?

Thanks

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 18:17
Para: Even Rouault <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Some problems after updating

Done but it doesn?t work.
The error is the same.
Any other idea?

De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:55
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


Perhaps try the good old methods: run the "clean" target and do a full rebuild
Le 26/02/2024 ? 17:48, Abel Pau via gdal-dev a ?crit :
It even now doesn?t work from Visual Studio itself.
I don?t understand what have changed from yesterday to today (apart from updating vcpkg and gdal code itself).



De: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 17:42
Para: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Hi Even, thanks for your answer.

I paste here some of my variables:
After too many months perhaps there are things that are not necessary, but the one you sais is there:

GDAL_DATA
D:\GitHub-repository\GDAL\build\data

PATH
PATH%;
D:\GitHub-repository\GDAL\build\Debug;
C:\Users\a.pau\AppData\Local\GitHubDesktop\bin;
C:\Program Files\Graphviz\bin;
D:\GitHub-repository\odbc-cpp-wrapper\build\src\odbc\Release;
D:\mapes\programes\make-3.81-bin\bin;

But same error appears :(


De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:30
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


hi,

perhaps make sure that your PATH environment variable includes a directory that contains the gdal.dll of *your* build (should likely be D:\GitHub-repository\GDAL\build\Debug) before the one potentially coming from vcpkg

Even
Le 26/02/2024 ? 17:20, Abel Pau via gdal-dev a ?crit :
Hi,

usually (and always works) I call this two sentences from command line in Windows:

cmake -B D:\GitHub-repository\GDAL\build -S . -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
cmake --build D:\GitHub-repository\GDAL\build

The first one generates all projects that I can open with Visual Studio
The second one compilates all files, and it ens with no problems.

To test is works I?ve been using lots of line commands, for example this one (using the program ogr2ogr):

D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco Version=V1.1 --config CPL_DEBUG ON

It?s been working untiel today when next error appears:
---------------------------
ogr2ogr.exe - No se encuentra el punto de entrada
---------------------------
No se encuentra el punto de entrada del procedimiento ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z en la biblioteca de v?nculos din?micos D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
---------------------------
D'acord
---------------------------

What is the diference between today and yesterday?
I?ve done 2 things:

1.       Download and Install VCPKG (the method that worked for me)

2.       .\vcpkg\bootstrap-vcpkg.bat

3.       .\vcpkg integrate install

4.       .\vcpkg install gdal --triplet=x64-windows

And, of course, download lasts codes from GDAL to be on date before finishing the job I?m doing.

So, can anyone put some light to this mistery? What I am doing wrong this time?
There is some dependence I am using wrong?

I am a little desperate with that kind of errors.

Thanks a lot!



Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.





_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/e8053999/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/e8053999/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/e8053999/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/e8053999/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/e8053999/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/e8053999/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/e8053999/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/e8053999/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/e8053999/attachment-0003.jpg>

From a.pau at creaf.uab.cat  Tue Feb 27 00:53:54 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Tue, 27 Feb 2024 08:53:54 +0000
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <PAXPR07MB7775B25A9FC47D7214791395A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
 <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB77750D19A12C6E6B94B1D80FA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <3c88271e-981e-4f1e-8fab-7c655f9aed75@spatialys.com>
 <PAXPR07MB77755EBDA32F91C5404B45E6A25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775B25A9FC47D7214791395A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <PAXPR07MB777552FE34EAFB305AC7FEE3A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi again,
when compiling with Visual Studio 2019 (C++17) in debug mode this error appears:
2>------ Build started: Project: ogr_VDV, Configuration: Debug x64 ------
2>LINK : fatal error LNK1104: cannot open file 'ogr_VDV.dir\Debug\ogr_VDV.lib'
2>Done building project "ogr_VDV.vcxproj" -- FAILED.

It could be related?


De: gdal-dev <gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau via gdal-dev
Enviado el: dimarts, 27 de febrer de 2024 9:15
Para: gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Some problems after updating

Hi again,
I built and compiled the Gdal version in GitHub (without my changes) and the error is NOT gone.
Anyone has compiled very recently and is capable to call ogr2ogr with no problems?

Thanks

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 18:17
Para: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Done but it doesn?t work.
The error is the same.
Any other idea?

De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:55
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


Perhaps try the good old methods: run the "clean" target and do a full rebuild
Le 26/02/2024 ? 17:48, Abel Pau via gdal-dev a ?crit :
It even now doesn?t work from Visual Studio itself.
I don?t understand what have changed from yesterday to today (apart from updating vcpkg and gdal code itself).



De: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 17:42
Para: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Hi Even, thanks for your answer.

I paste here some of my variables:
After too many months perhaps there are things that are not necessary, but the one you sais is there:

GDAL_DATA
D:\GitHub-repository\GDAL\build\data

PATH
PATH%;
D:\GitHub-repository\GDAL\build\Debug;
C:\Users\a.pau\AppData\Local\GitHubDesktop\bin;
C:\Program Files\Graphviz\bin;
D:\GitHub-repository\odbc-cpp-wrapper\build\src\odbc\Release;
D:\mapes\programes\make-3.81-bin\bin;

But same error appears :(


De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:30
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


hi,

perhaps make sure that your PATH environment variable includes a directory that contains the gdal.dll of *your* build (should likely be D:\GitHub-repository\GDAL\build\Debug) before the one potentially coming from vcpkg

Even
Le 26/02/2024 ? 17:20, Abel Pau via gdal-dev a ?crit :
Hi,

usually (and always works) I call this two sentences from command line in Windows:

cmake -B D:\GitHub-repository\GDAL\build -S . -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
cmake --build D:\GitHub-repository\GDAL\build

The first one generates all projects that I can open with Visual Studio
The second one compilates all files, and it ens with no problems.

To test is works I?ve been using lots of line commands, for example this one (using the program ogr2ogr):

D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco Version=V1.1 --config CPL_DEBUG ON

It?s been working untiel today when next error appears:
---------------------------
ogr2ogr.exe - No se encuentra el punto de entrada
---------------------------
No se encuentra el punto de entrada del procedimiento ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z en la biblioteca de v?nculos din?micos D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
---------------------------
D'acord
---------------------------

What is the diference between today and yesterday?
I?ve done 2 things:

1.       Download and Install VCPKG (the method that worked for me)

2.       .\vcpkg\bootstrap-vcpkg.bat

3.       .\vcpkg integrate install

4.       .\vcpkg install gdal --triplet=x64-windows

And, of course, download lasts codes from GDAL to be on date before finishing the job I?m doing.

So, can anyone put some light to this mistery? What I am doing wrong this time?
There is some dependence I am using wrong?

I am a little desperate with that kind of errors.

Thanks a lot!



Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.





_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/8c4ea2e3/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/8c4ea2e3/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/8c4ea2e3/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/8c4ea2e3/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/8c4ea2e3/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/8c4ea2e3/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/8c4ea2e3/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/8c4ea2e3/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/8c4ea2e3/attachment-0003.jpg>

From j1 at jimenezshaw.com  Tue Feb 27 00:57:29 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Tue, 27 Feb 2024 09:57:29 +0100
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <PAXPR07MB7775B25A9FC47D7214791395A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
 <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB77750D19A12C6E6B94B1D80FA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <3c88271e-981e-4f1e-8fab-7c655f9aed75@spatialys.com>
 <PAXPR07MB77755EBDA32F91C5404B45E6A25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775B25A9FC47D7214791395A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <CADRrdKupe0Td-Bmk98a4_cq7O2_feg7PMeJse0ONTy8=SVi_BA@mail.gmail.com>

Hi Abel,

If you have clear when it started happening, maybe you can try to find the
reason using https://git-scm.com/docs/git-bisect
specially as you are reproducing it in your computer (CI is working fine,
so that should be something related to your configuration).
Replicate it working fine with an older checkout from the repo, then
replicate it failing today, and look for the change that "breaks" it.
If you cannot replicate the correct behaviour with an older checkout...
then the problem is not the source code.

Cheers,
Javier.

On Tue, 27 Feb 2024 at 09:15, Abel Pau via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi again,
>
> I built and compiled the Gdal version in GitHub (without my changes) and
> the error is NOT gone.
>
> Anyone has compiled very recently and is capable to call ogr2ogr with no
> problems?
>
>
>
> Thanks
>
>
>
> *De:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *En nombre de *Abel Pau
> via gdal-dev
> *Enviado el:* dilluns, 26 de febrer de 2024 18:17
> *Para:* Even Rouault <even.rouault at spatialys.com>;
> gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> Done but it doesn?t work.
>
> The error is the same.
>
> Any other idea?
>
>
>
> *De:* Even Rouault <even.rouault at spatialys.com>
> *Enviado el:* dilluns, 26 de febrer de 2024 17:55
> *Para:* Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> Perhaps try the good old methods: run the "clean" target and do a full
> rebuild
>
> Le 26/02/2024 ? 17:48, Abel Pau via gdal-dev a ?crit :
>
> It even now doesn?t work from Visual Studio itself.
>
> I don?t understand what have changed from yesterday to today (apart from
> updating vcpkg and gdal code itself).
>
>
>
>
>
>
>
> *De:* gdal-dev <gdal-dev-bounces at lists.osgeo.org>
> <gdal-dev-bounces at lists.osgeo.org> *En nombre de *Abel Pau via gdal-dev
> *Enviado el:* dilluns, 26 de febrer de 2024 17:42
> *Para:* Even Rouault <even.rouault at spatialys.com>
> <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> Hi Even, thanks for your answer.
>
>
>
> I paste here some of my variables:
>
> After too many months perhaps there are things that are not necessary, but
> the one you sais is there:
>
>
>
> *GDAL_DATA *
>
> D:\GitHub-repository\GDAL\build\data
>
>
>
> *PATH *
>
> PATH%;
>
> D:\GitHub-repository\GDAL\build\Debug;
>
> C:\Users\a.pau\AppData\Local\GitHubDesktop\bin;
>
> C:\Program Files\Graphviz\bin;
>
> D:\GitHub-repository\odbc-cpp-wrapper\build\src\odbc\Release;
>
> D:\mapes\programes\make-3.81-bin\bin;
>
>
>
> But same error appears :(
>
>
>
>
>
> *De:* Even Rouault <even.rouault at spatialys.com>
> *Enviado el:* dilluns, 26 de febrer de 2024 17:30
> *Para:* Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> hi,
>
> perhaps make sure that your PATH environment variable includes a directory
> that contains the gdal.dll of *your* build (should likely be
> D:\GitHub-repository\GDAL\build\Debug) before the one potentially coming
> from vcpkg
>
> Even
>
> Le 26/02/2024 ? 17:20, Abel Pau via gdal-dev a ?crit :
>
> Hi,
>
>
>
> usually (and always works) I call this two sentences from command line in
> Windows:
>
>
>
> cmake -B D:\GitHub-repository\GDAL\build -S .
> -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
>
> cmake --build D:\GitHub-repository\GDAL\build
>
>
>
> The first one generates all projects that I can open with Visual Studio
>
> The second one compilates all files, and it ens with no problems.
>
>
>
> To test is works I?ve been using lots of line commands, for example this
> one (using the program ogr2ogr):
>
>
>
> D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe
> D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol
> D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco Version=V1.1
> --config CPL_DEBUG ON
>
>
>
> It?s been working untiel today when next error appears:
>
> ---------------------------
>
> ogr2ogr.exe - No se encuentra el punto de entrada
>
> ---------------------------
>
> No se encuentra el punto de entrada del procedimiento
> ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z
> en la biblioteca de v?nculos din?micos
> D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
>
> ---------------------------
>
> D'acord
>
> ---------------------------
>
>
>
> What is the diference between today and yesterday?
> I?ve done 2 things:
>
> 1.       Download and Install VCPKG (the method that worked for me)
>
> 2.       .\vcpkg\bootstrap-vcpkg.bat
>
> 3.       .\vcpkg integrate install
>
> 4.       .\vcpkg install gdal --triplet=x64-windows
>
>
>
> And, of course, download lasts codes from GDAL to be on date before
> finishing the job I?m doing.
>
>
>
> So, can anyone put some light to this mistery? What I am doing wrong this
> time?
>
> There is some dependence I am using wrong?
>
>
>
> I am a little desperate with that kind of errors.
>
>
>
> Thanks a lot!
>
>
>
>
>
>
>
> *Abel Pau Garcia*
>
> *GIS developer*
>
> [image: https://www.creaf.cat/sites/default/files/creaf-signature.png]
>
> *a.pau at creaf.uab.cat* <a.pau at creaf.uab.cat>
>
> *Let's chat on Teams!*
> <https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
>
> *Tel. +34 934814277*
>
> [image: https://www.creaf.cat/sites/default/files/so-en-signature.png]
>
> [image:
> https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]
> <https://twitter.com/CREAF_ecologia>[image:
> https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]
> <https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[image:
> https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]
> <https://www.youtube.com/c/creafecologia>[image:
> https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]
> <https://www.instagram.com/CREAF_ecologia/>
>
> *www.creaf.cat* <http://www.creaf.cat>* | **http://blog.creaf.cat*
> <http://blog.creaf.cat>
>
> [image: https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
>
> CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)
>
>
> Before printing this electronic message, think about the environment.
>
> [image: http://www.creaf.uab.cat/_signatura/line.gif]
>
>
>
>
>
>
>
> _______________________________________________
>
> gdal-dev mailing list
>
> gdal-dev at lists.osgeo.org
>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
>
>
> _______________________________________________
>
> gdal-dev mailing list
>
> gdal-dev at lists.osgeo.org
>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/0825bf7f/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/0825bf7f/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/0825bf7f/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/0825bf7f/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/0825bf7f/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/0825bf7f/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/0825bf7f/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/0825bf7f/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/0825bf7f/attachment-0003.jpg>

From a.pau at creaf.uab.cat  Tue Feb 27 01:06:12 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Tue, 27 Feb 2024 09:06:12 +0000
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <CADRrdKupe0Td-Bmk98a4_cq7O2_feg7PMeJse0ONTy8=SVi_BA@mail.gmail.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
 <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB77750D19A12C6E6B94B1D80FA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <3c88271e-981e-4f1e-8fab-7c655f9aed75@spatialys.com>
 <PAXPR07MB77755EBDA32F91C5404B45E6A25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775B25A9FC47D7214791395A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKupe0Td-Bmk98a4_cq7O2_feg7PMeJse0ONTy8=SVi_BA@mail.gmail.com>
Message-ID: <PAXPR07MB7775CD1A61D1BB9D580D3CEBA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi Javier,
I did two changes at the same time (bad  bad, never do that!): one updating the code from repo (as usual) and the other one updating vcpkg (cause there like 1000 changes in their Git and I though that was a good idea).
I suspect the code is good but I?ll make sure doing that bisection method.
Even though this error is rare:

3>LINK : fatal error LNK1104: cannot open file 'ogr_VDV.dir\Debug\ogr_VDV.lib'
3>Done building project "ogr_VDV.vcxproj" -- FAILED.

I wonder why it is not writing (ogr_VDV it?s the only one that have the error).
Thanks!

De: Javier Jimenez Shaw <j1 at jimenezshaw.com>
Enviado el: dimarts, 27 de febrer de 2024 9:57
Para: Abel Pau <a.pau at creaf.uab.cat>
CC: gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Some problems after updating

Hi Abel,

If you have clear when it started happening, maybe you can try to find the reason using https://git-scm.com/docs/git-bisect
specially as you are reproducing it in your computer (CI is working fine, so that should be something related to your configuration).
Replicate it working fine with an older checkout from the repo, then replicate it failing today, and look for the change that "breaks" it.
If you cannot replicate the correct behaviour with an older checkout... then the problem is not the source code.

Cheers,
Javier.

On Tue, 27 Feb 2024 at 09:15, Abel Pau via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
Hi again,
I built and compiled the Gdal version in GitHub (without my changes) and the error is NOT gone.
Anyone has compiled very recently and is capable to call ogr2ogr with no problems?

Thanks

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 18:17
Para: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Done but it doesn?t work.
The error is the same.
Any other idea?

De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:55
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


Perhaps try the good old methods: run the "clean" target and do a full rebuild
Le 26/02/2024 ? 17:48, Abel Pau via gdal-dev a ?crit :
It even now doesn?t work from Visual Studio itself.
I don?t understand what have changed from yesterday to today (apart from updating vcpkg and gdal code itself).



De: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 17:42
Para: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Hi Even, thanks for your answer.

I paste here some of my variables:
After too many months perhaps there are things that are not necessary, but the one you sais is there:

GDAL_DATA
D:\GitHub-repository\GDAL\build\data

PATH
PATH%;
D:\GitHub-repository\GDAL\build\Debug;
C:\Users\a.pau\AppData\Local\GitHubDesktop\bin;
C:\Program Files\Graphviz\bin;
D:\GitHub-repository\odbc-cpp-wrapper\build\src\odbc\Release;
D:\mapes\programes\make-3.81-bin\bin;

But same error appears :(


De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:30
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


hi,

perhaps make sure that your PATH environment variable includes a directory that contains the gdal.dll of *your* build (should likely be D:\GitHub-repository\GDAL\build\Debug) before the one potentially coming from vcpkg

Even
Le 26/02/2024 ? 17:20, Abel Pau via gdal-dev a ?crit :
Hi,

usually (and always works) I call this two sentences from command line in Windows:

cmake -B D:\GitHub-repository\GDAL\build -S . -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
cmake --build D:\GitHub-repository\GDAL\build

The first one generates all projects that I can open with Visual Studio
The second one compilates all files, and it ens with no problems.

To test is works I?ve been using lots of line commands, for example this one (using the program ogr2ogr):

D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco Version=V1.1 --config CPL_DEBUG ON

It?s been working untiel today when next error appears:
---------------------------
ogr2ogr.exe - No se encuentra el punto de entrada
---------------------------
No se encuentra el punto de entrada del procedimiento ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z en la biblioteca de v?nculos din?micos D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
---------------------------
D'acord
---------------------------

What is the diference between today and yesterday?
I?ve done 2 things:

1.       Download and Install VCPKG (the method that worked for me)

2.       .\vcpkg\bootstrap-vcpkg.bat

3.       .\vcpkg integrate install

4.       .\vcpkg install gdal --triplet=x64-windows

And, of course, download lasts codes from GDAL to be on date before finishing the job I?m doing.

So, can anyone put some light to this mistery? What I am doing wrong this time?
There is some dependence I am using wrong?

I am a little desperate with that kind of errors.

Thanks a lot!



Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.





_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/39e4e431/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/39e4e431/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/39e4e431/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/39e4e431/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/39e4e431/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/39e4e431/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/39e4e431/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/39e4e431/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/39e4e431/attachment-0003.jpg>

From j1 at jimenezshaw.com  Tue Feb 27 01:17:39 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Tue, 27 Feb 2024 10:17:39 +0100
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <PAXPR07MB7775CD1A61D1BB9D580D3CEBA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
 <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB77750D19A12C6E6B94B1D80FA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <3c88271e-981e-4f1e-8fab-7c655f9aed75@spatialys.com>
 <PAXPR07MB77755EBDA32F91C5404B45E6A25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775B25A9FC47D7214791395A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKupe0Td-Bmk98a4_cq7O2_feg7PMeJse0ONTy8=SVi_BA@mail.gmail.com>
 <PAXPR07MB7775CD1A61D1BB9D580D3CEBA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <CADRrdKvWFz4Hm6+K_6xqYWXpPLMhDyvfcH8nEiOEv0daPjPzKg@mail.gmail.com>

ohhhh, Windows debug. That was not easy (when I worked in Windows, more
than 10 years ago). It is using different names for libraries in debug and
release.

 'ogr_VDV.dir\Debug\ogr_VDV.lib':  could you check that is the content of
that directory? I wouldn't be surprised if the library file there has a
slightly different name.

On Tue, 27 Feb 2024 at 10:06, Abel Pau <a.pau at creaf.uab.cat> wrote:

> Hi Javier,
>
> I did two changes at the same time (bad  bad, never do that!): one
> updating the code from repo (as usual) and the other one updating vcpkg
> (cause there like 1000 changes in their Git and I though that was a good
> idea).
>
> I suspect the code is good but I?ll make sure doing that bisection method.
>
> Even though this error is rare:
>
>
>
> 3>LINK : fatal error LNK1104: cannot open file
> 'ogr_VDV.dir\Debug\ogr_VDV.lib'
>
> 3>Done building project "ogr_VDV.vcxproj" -- FAILED.
>
>
>
> I wonder why it is not writing (ogr_VDV it?s the only one that have the
> error).
>
> Thanks!
>
>
>
> *De:* Javier Jimenez Shaw <j1 at jimenezshaw.com>
> *Enviado el:* dimarts, 27 de febrer de 2024 9:57
> *Para:* Abel Pau <a.pau at creaf.uab.cat>
> *CC:* gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> Hi Abel,
>
>
>
> If you have clear when it started happening, maybe you can try to find the
> reason using https://git-scm.com/docs/git-bisect
>
> specially as you are reproducing it in your computer (CI is working fine,
> so that should be something related to your configuration).
>
> Replicate it working fine with an older checkout from the repo, then
> replicate it failing today, and look for the change that "breaks" it.
>
> If you cannot replicate the correct behaviour with an older checkout...
> then the problem is not the source code.
>
>
>
> Cheers,
>
> Javier.
>
>
>
> On Tue, 27 Feb 2024 at 09:15, Abel Pau via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
> Hi again,
>
> I built and compiled the Gdal version in GitHub (without my changes) and
> the error is NOT gone.
>
> Anyone has compiled very recently and is capable to call ogr2ogr with no
> problems?
>
>
>
> Thanks
>
>
>
> *De:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *En nombre de *Abel Pau
> via gdal-dev
> *Enviado el:* dilluns, 26 de febrer de 2024 18:17
> *Para:* Even Rouault <even.rouault at spatialys.com>;
> gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> Done but it doesn?t work.
>
> The error is the same.
>
> Any other idea?
>
>
>
> *De:* Even Rouault <even.rouault at spatialys.com>
> *Enviado el:* dilluns, 26 de febrer de 2024 17:55
> *Para:* Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> Perhaps try the good old methods: run the "clean" target and do a full
> rebuild
>
> Le 26/02/2024 ? 17:48, Abel Pau via gdal-dev a ?crit :
>
> It even now doesn?t work from Visual Studio itself.
>
> I don?t understand what have changed from yesterday to today (apart from
> updating vcpkg and gdal code itself).
>
>
>
>
>
>
>
> *De:* gdal-dev <gdal-dev-bounces at lists.osgeo.org>
> <gdal-dev-bounces at lists.osgeo.org> *En nombre de *Abel Pau via gdal-dev
> *Enviado el:* dilluns, 26 de febrer de 2024 17:42
> *Para:* Even Rouault <even.rouault at spatialys.com>
> <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> Hi Even, thanks for your answer.
>
>
>
> I paste here some of my variables:
>
> After too many months perhaps there are things that are not necessary, but
> the one you sais is there:
>
>
>
> *GDAL_DATA *
>
> D:\GitHub-repository\GDAL\build\data
>
>
>
> *PATH *
>
> PATH%;
>
> D:\GitHub-repository\GDAL\build\Debug;
>
> C:\Users\a.pau\AppData\Local\GitHubDesktop\bin;
>
> C:\Program Files\Graphviz\bin;
>
> D:\GitHub-repository\odbc-cpp-wrapper\build\src\odbc\Release;
>
> D:\mapes\programes\make-3.81-bin\bin;
>
>
>
> But same error appears :(
>
>
>
>
>
> *De:* Even Rouault <even.rouault at spatialys.com>
> *Enviado el:* dilluns, 26 de febrer de 2024 17:30
> *Para:* Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> hi,
>
> perhaps make sure that your PATH environment variable includes a directory
> that contains the gdal.dll of *your* build (should likely be
> D:\GitHub-repository\GDAL\build\Debug) before the one potentially coming
> from vcpkg
>
> Even
>
> Le 26/02/2024 ? 17:20, Abel Pau via gdal-dev a ?crit :
>
> Hi,
>
>
>
> usually (and always works) I call this two sentences from command line in
> Windows:
>
>
>
> cmake -B D:\GitHub-repository\GDAL\build -S .
> -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
>
> cmake --build D:\GitHub-repository\GDAL\build
>
>
>
> The first one generates all projects that I can open with Visual Studio
>
> The second one compilates all files, and it ens with no problems.
>
>
>
> To test is works I?ve been using lots of line commands, for example this
> one (using the program ogr2ogr):
>
>
>
> D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe
> D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol
> D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco Version=V1.1
> --config CPL_DEBUG ON
>
>
>
> It?s been working untiel today when next error appears:
>
> ---------------------------
>
> ogr2ogr.exe - No se encuentra el punto de entrada
>
> ---------------------------
>
> No se encuentra el punto de entrada del procedimiento
> ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z
> en la biblioteca de v?nculos din?micos
> D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
>
> ---------------------------
>
> D'acord
>
> ---------------------------
>
>
>
> What is the diference between today and yesterday?
> I?ve done 2 things:
>
> 1.       Download and Install VCPKG (the method that worked for me)
>
> 2.       .\vcpkg\bootstrap-vcpkg.bat
>
> 3.       .\vcpkg integrate install
>
> 4.       .\vcpkg install gdal --triplet=x64-windows
>
>
>
> And, of course, download lasts codes from GDAL to be on date before
> finishing the job I?m doing.
>
>
>
> So, can anyone put some light to this mistery? What I am doing wrong this
> time?
>
> There is some dependence I am using wrong?
>
>
>
> I am a little desperate with that kind of errors.
>
>
>
> Thanks a lot!
>
>
>
>
>
>
>
> *Abel Pau Garcia*
>
> *GIS developer*
>
> [image: https://www.creaf.cat/sites/default/files/creaf-signature.png]
>
> *a.pau at creaf.uab.cat* <a.pau at creaf.uab.cat>
>
> *Let's chat on Teams!*
> <https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
>
> *Tel. +34 934814277*
>
> [image: https://www.creaf.cat/sites/default/files/so-en-signature.png]
>
> [image:
> https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]
> <https://twitter.com/CREAF_ecologia>[image:
> https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]
> <https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[image:
> https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]
> <https://www.youtube.com/c/creafecologia>[image:
> https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]
> <https://www.instagram.com/CREAF_ecologia/>
>
> *www.creaf.cat* <http://www.creaf.cat>* | **http://blog.creaf.cat*
> <http://blog.creaf.cat>
>
> [image: https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
>
> CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)
>
>
> Before printing this electronic message, think about the environment.
>
> [image: http://www.creaf.uab.cat/_signatura/line.gif]
>
>
>
>
>
>
>
> _______________________________________________
>
> gdal-dev mailing list
>
> gdal-dev at lists.osgeo.org
>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
>
>
> _______________________________________________
>
> gdal-dev mailing list
>
> gdal-dev at lists.osgeo.org
>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/80e18edf/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/80e18edf/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/80e18edf/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/80e18edf/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/80e18edf/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/80e18edf/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/80e18edf/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/80e18edf/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/80e18edf/attachment-0003.jpg>

From rayg at daylongraphics.com  Tue Feb 27 00:48:33 2024
From: rayg at daylongraphics.com (Ray at Daylon)
Date: Tue, 27 Feb 2024 00:48:33 -0800
Subject: [gdal-dev] Assert due to stack corruption in FlatGeoBuf export
In-Reply-To: <CAJf0KTT+GJMSOXcK3sLoaj3wxBnxEaFeM6D64xQ_qtGjYiN=yQ@mail.gmail.com>
References: <OF9064A02F.92A260F0-ONC1258AC1.00417826-C1258AC1.0041AFBE@data-experts.de>
 <CAJf0KTR4TvCozJNTa9n8a_=Mp2AEOoy498WK73akSOTO59x9EQ@mail.gmail.com>
 <CAFLLRp+8+1MwLZPJMVFa17dOp_5G1e_Jz2O10zV4J5FiGvhbdA@mail.gmail.com>
 <CAFLLRp+MqLP2rqywpjVNjhP_jmhqT2-fVG+UTVMSKR-4277s-w@mail.gmail.com>
 <CAJf0KTRxxJ1-LFhS0ZevbikYe0zRoHR+4pOZ4pSsURC2s0qAfQ@mail.gmail.com>
 <CAJf0KTSrA_Pod7EK3Cd4SYDZiHqdtXGUadWSGEEcx_G_NZn9eA@mail.gmail.com>
 <72c655aa-0579-47e1-be7c-813f85a021b5@spatialys.com>
 <CAJf0KTRiJPvz-ank4LdUFsNvHvr7fUi-VmULeLPLp8BBv8BOZw@mail.gmail.com>
 <CAJf0KTQ=2sN7Ws-c9_ZCFXdtqFU2+iBoCoqRY4wOxGRMM1noDg@mail.gmail.com>
 <CAJf0KTSd7jDh1VGqeDE5srtxkABHH2_5U6DhwrTWXuTsr6TZmg@mail.gmail.com>
 <42e52baf-1005-4b6a-93ba-0af438d2360b@spatialys.com>
 <CAJf0KTQ4BhRQzq-UbVhuF4rmu70rLE2P3KAFO6s+-Ap8N1jY6g@mail.gmail.com>
 <d24d7bda-bb74-4805-9ce2-e75b7b45572c@spatialys.com>
 <CAJf0KTT+GJMSOXcK3sLoaj3wxBnxEaFeM6D64xQ_qtGjYiN=yQ@mail.gmail.com>
Message-ID: <7bbf8d21-9a77-40f8-96c1-5a40cc25b1cd@daylongraphics.com>

This may already be known, but the use of std::string in CPLString
can also cause problems e.g. building a program with a version of
a C++ stdlib that differs from the one that a prebuilt GDAL DLL
used. Visual Studio e.g. has afaik a 48-byte std::string in MSVC 2010
vs. 40 bytes in MSVC 2022. It's obvious in hindsight, but it's easy
to get lulled into using an old DLL for a long time not realizing
it too must be recompiled.

Ray


On 2/25/2024 8:46 PM, Simon Eves via gdal-dev wrote:
> As we're not ready to upgrade Arrow just yet, I also did the namespace 
> change as a pre-build code patch on the regular 3.7.3 bundle.
> 
> Apologies to Bjorn and anyone else on that team for any inference that 
> this was a flatbuffers bug. Not my intention. Glad we worked it out.
> 
> Simon
> 
> On Sun, Feb 25, 2024 at 5:52?PM Even Rouault <even.rouault at spatialys.com 
> <mailto:even.rouault at spatialys.com>> wrote:
> 
> 
>      >
>      > OK, so I guess we might be able to avoid it by?upgrading Arrow, as
>      > long as that?doesn't?break something else. I guess you need to do
>      > the?custom namespace thing too, though.
>     (ab)use of preprocessor functionality makes it easy:
>     https://github.com/OSGeo/gdal/pull/9313
>     <https://github.com/OSGeo/gdal/pull/9313> ...
>      >
>      > I hate computers.
> 
>     :-) :-)
> 
> 
>     -- 
>     http://www.spatialys.com <http://www.spatialys.com>
>     My software is free, but my time generally not.
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

From a.pau at creaf.uab.cat  Tue Feb 27 01:28:54 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Tue, 27 Feb 2024 09:28:54 +0000
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <CADRrdKvWFz4Hm6+K_6xqYWXpPLMhDyvfcH8nEiOEv0daPjPzKg@mail.gmail.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
 <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB77750D19A12C6E6B94B1D80FA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <3c88271e-981e-4f1e-8fab-7c655f9aed75@spatialys.com>
 <PAXPR07MB77755EBDA32F91C5404B45E6A25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775B25A9FC47D7214791395A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKupe0Td-Bmk98a4_cq7O2_feg7PMeJse0ONTy8=SVi_BA@mail.gmail.com>
 <PAXPR07MB7775CD1A61D1BB9D580D3CEBA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKvWFz4Hm6+K_6xqYWXpPLMhDyvfcH8nEiOEv0daPjPzKg@mail.gmail.com>
Message-ID: <PAXPR07MB77751C06354941407E34E775A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>

Ups, forget this compilation error (not the first one).
The directory exists and another program (by error) had it opened causing the compiler couldn?t delete it.
So, it was my mistake.

So, I?m going to proceed with that one:
[cid:image009.png at 01DA6967.C2884770]


De: Javier Jimenez Shaw <j1 at jimenezshaw.com>
Enviado el: dimarts, 27 de febrer de 2024 10:18
Para: Abel Pau <a.pau at creaf.uab.cat>
CC: gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Some problems after updating

ohhhh, Windows debug. That was not easy (when I worked in Windows, more than 10 years ago). It is using different names for libraries in debug and release.

 'ogr_VDV.dir\Debug\ogr_VDV.lib':  could you check that is the content of that directory? I wouldn't be surprised if the library file there has a slightly different name.

On Tue, 27 Feb 2024 at 10:06, Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>> wrote:
Hi Javier,
I did two changes at the same time (bad  bad, never do that!): one updating the code from repo (as usual) and the other one updating vcpkg (cause there like 1000 changes in their Git and I though that was a good idea).
I suspect the code is good but I?ll make sure doing that bisection method.
Even though this error is rare:

3>LINK : fatal error LNK1104: cannot open file 'ogr_VDV.dir\Debug\ogr_VDV.lib'
3>Done building project "ogr_VDV.vcxproj" -- FAILED.

I wonder why it is not writing (ogr_VDV it?s the only one that have the error).
Thanks!

De: Javier Jimenez Shaw <j1 at jimenezshaw.com<mailto:j1 at jimenezshaw.com>>
Enviado el: dimarts, 27 de febrer de 2024 9:57
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>
CC: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Hi Abel,

If you have clear when it started happening, maybe you can try to find the reason using https://git-scm.com/docs/git-bisect
specially as you are reproducing it in your computer (CI is working fine, so that should be something related to your configuration).
Replicate it working fine with an older checkout from the repo, then replicate it failing today, and look for the change that "breaks" it.
If you cannot replicate the correct behaviour with an older checkout... then the problem is not the source code.

Cheers,
Javier.

On Tue, 27 Feb 2024 at 09:15, Abel Pau via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
Hi again,
I built and compiled the Gdal version in GitHub (without my changes) and the error is NOT gone.
Anyone has compiled very recently and is capable to call ogr2ogr with no problems?

Thanks

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 18:17
Para: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Done but it doesn?t work.
The error is the same.
Any other idea?

De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:55
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


Perhaps try the good old methods: run the "clean" target and do a full rebuild
Le 26/02/2024 ? 17:48, Abel Pau via gdal-dev a ?crit :
It even now doesn?t work from Visual Studio itself.
I don?t understand what have changed from yesterday to today (apart from updating vcpkg and gdal code itself).



De: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 17:42
Para: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Hi Even, thanks for your answer.

I paste here some of my variables:
After too many months perhaps there are things that are not necessary, but the one you sais is there:

GDAL_DATA
D:\GitHub-repository\GDAL\build\data

PATH
PATH%;
D:\GitHub-repository\GDAL\build\Debug;
C:\Users\a.pau\AppData\Local\GitHubDesktop\bin;
C:\Program Files\Graphviz\bin;
D:\GitHub-repository\odbc-cpp-wrapper\build\src\odbc\Release;
D:\mapes\programes\make-3.81-bin\bin;

But same error appears :(


De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:30
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


hi,

perhaps make sure that your PATH environment variable includes a directory that contains the gdal.dll of *your* build (should likely be D:\GitHub-repository\GDAL\build\Debug) before the one potentially coming from vcpkg

Even
Le 26/02/2024 ? 17:20, Abel Pau via gdal-dev a ?crit :
Hi,

usually (and always works) I call this two sentences from command line in Windows:

cmake -B D:\GitHub-repository\GDAL\build -S . -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
cmake --build D:\GitHub-repository\GDAL\build

The first one generates all projects that I can open with Visual Studio
The second one compilates all files, and it ens with no problems.

To test is works I?ve been using lots of line commands, for example this one (using the program ogr2ogr):

D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco Version=V1.1 --config CPL_DEBUG ON

It?s been working untiel today when next error appears:
---------------------------
ogr2ogr.exe - No se encuentra el punto de entrada
---------------------------
No se encuentra el punto de entrada del procedimiento ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z en la biblioteca de v?nculos din?micos D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
---------------------------
D'acord
---------------------------

What is the diference between today and yesterday?
I?ve done 2 things:

1.       Download and Install VCPKG (the method that worked for me)

2.       .\vcpkg\bootstrap-vcpkg.bat

3.       .\vcpkg integrate install

4.       .\vcpkg install gdal --triplet=x64-windows

And, of course, download lasts codes from GDAL to be on date before finishing the job I?m doing.

So, can anyone put some light to this mistery? What I am doing wrong this time?
There is some dependence I am using wrong?

I am a little desperate with that kind of errors.

Thanks a lot!



Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.





_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/3664b3b9/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/3664b3b9/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/3664b3b9/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/3664b3b9/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/3664b3b9/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/3664b3b9/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/3664b3b9/attachment-0012.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/3664b3b9/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/3664b3b9/attachment-0003.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image009.png
Type: image/png
Size: 11623 bytes
Desc: image009.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/3664b3b9/attachment-0013.png>

From jan.heckman at gmail.com  Tue Feb 27 01:31:47 2024
From: jan.heckman at gmail.com (Jan Heckman)
Date: Tue, 27 Feb 2024 10:31:47 +0100
Subject: [gdal-dev] Possible error in orientation of converted arcs from
 dxf
In-Reply-To: <11e8694d-4dca-4849-b86d-9f4413220d0e@spatialys.com>
References: <CAKMUAtArYK2wA5fwHjazikhBJdLG5ci-qnYV1XG6EY=wg2y_1Q@mail.gmail.com>
 <742d1d66-7aea-46d6-8a83-b58926e9d83a@spatialys.com>
 <CAKMUAtDMPDqYZQZ5u=HFA8geTfeJ_t7wtdzGOLya1wfa34ct4Q@mail.gmail.com>
 <11e8694d-4dca-4849-b86d-9f4413220d0e@spatialys.com>
Message-ID: <CAKMUAtBR+cpuYhOHayZD-7avzDG=UUUWeAW3Po77A-ODqJdNMg@mail.gmail.com>

Hi,

I set up a case for an issue and had to conclude that this issue does not
help in solving my problem (finding the proper vertex sequence/need to
reverse in a series of lines and arcs).
Surprisingly at first, in the case I made, there were arcs with proper as
well as improper sequence which all had gone through the same procedure
during conversion with ogr2ogr.

When specifying an arc by startangle, endangle, orientation
(counterclockwise around the positive z axis, using radius and midpoint),
the order of the vertices cannot also be specified (differently) by the
same ingredients.

Not being very good at dxf, I looked at the optional specification of an
extrusion vector (in an arc) in the hope that this relates to the sweep of
the arc,
rather than the extrusion of a plane arc to a 3D surface, why else define
this vector in the context of an object rather than in the context of an
extrusion command?
I'm still unsure of the meaning of this thing. and haven't found docs to
support the notion that the sweep might be intended.
And even if it is, I haven't seen the codes in the dxf files I worked with
sofar.

Anyway:
The codes are 210, 220, 230 (x,y,z) and by default 0.0,0.0,1.0. Setting
this to 0.0,0.0,-1.0 made the arc invisible in Qgis and in the ogr2ogr
produced shapefile.
When I have time I'll look more into the gdal sources, but it looks like I
need to handle this problem where it arises using my own linestring
dissolve routine.

Thanks,
Jan


On Sun, Feb 25, 2024 at 10:13?PM Even Rouault <even.rouault at spatialys.com>
wrote:

> Please file an issue with a (as small as possible) .dxf file reproducing
> the issue
>
> Even
> Le 25/02/2024 ? 22:05, Jan Heckman a ?crit :
>
> Hi Even, all,
> There might be a slight connection, but my case imo does not involve
> either a bulgefactor or a smoothing routine;
> it is the basic conversion/render of a circular arc where apparently
> start- and endangle are interchanged sofar without apparent cause.
> Possibly the dxf has, earlier on, something which influences (rightly or
> wrongly) the clockwise setting/bool seen in this type of driver function.
> So I'll first try to find any global setting in the dxf which might
> encourage clockwise circle handling instead of default anti-clockwise.
> As an afterthought, this cannot be the case as then the arc would have
> been drawn in the other direction, giving a very large arc instead of a
> smallish one.
> As I said earlier, the correct arc is used but with the (imo) wrong
> orientation/sequence of the vertices.
> Jan
>
>
> On Sun, Feb 25, 2024 at 2:08?PM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Hi,
>>
>> I'm wondering if there woulnd't be a connection with
>> https://github.com/OSGeo/gdal/issues/1839#issuecomment-537185826 ?
>>
>> Even
>>
>> Le 25/02/2024 ? 13:32, Jan Heckman via gdal-dev a ?crit :
>> > Hi all,
>> > Sorry for a somewhat long post, but here we go:
>> > I am converting a .dxf having a sequence of simple lines and arcs
>> > which form a continuous (poly)line, (correctly) ordered by
>> > EntityHandle. The arcs are converted (to shp) as well as displayed
>> > (Qgis) in the opposite direction as the simple lines. Checking the
>> > codes and docs, this appears wrong.
>> > Below the minimal relevant information, I can add the complete .dxf,
>> > but I think attached files are frowned upon?
>> >
>> > Docs cited:
>> >
>> https://help.autodesk.com/view/OARX/2024/ENU/?guid=GUID-0B14D8F1-0EBA-44BF-9108-57D8CE614BC8
>> > ARC (DXF)
>> > The following group codes apply to arc entities.
>> > Arc group codes
>> > Group code Description
>> > 100 Subclass marker (AcDbCircle)
>> > 39 Thickness (optional; default = 0)
>> > 10 Center point (in OCS) DXF: X value; APP: 3D point
>> > 20, 30 DXF: Y and Z values of center point (in OCS)
>> > 40 Radius
>> > 100 Subclass marker (AcDbArc)
>> > 50 Start angle
>> > 51 End angle
>> > 210 Extrusion direction (optional; default = 0, 0, 1) DXF: X value;
>> > APP: 3D vector
>> > 220, 230 DXF: Y and Z values of extrusion direction (optional)
>> >
>> > https://ezdxf.readthedocs.io/en/stable/tutorials/dxf_primitives.html
>> > The arc goes always in counter-clockwise orientation around the z-axis
>> > more precisely the extrusion vector of OCS, but this is beyond the
>> > scope of this tutorial.
>> >
>> > The case (extracted, whole .dxf file available):
>> > AcDbEntity
>> >   8
>> > 0000-001_09_AND1N
>> >   6
>> > Continuous
>> >  62
>> >     18
>> > 100
>> > AcDbCircle
>> >  10
>> > 130974.661837
>> >  20
>> > 497502.478468
>> >  30
>> > 0.0
>> >  40
>> > 7576.094430000001
>> > 100
>> > AcDbArc
>> >  50
>> > 305.5444330000001
>> >  51
>> > 344.795475
>> >   0
>> > LINE
>> >   5
>> > 2E
>> > 330
>> > 1A0
>> > 100
>> >
>> > The arc is converted (.shp) and drawn (qgis) from end angle to start
>> > angle, without a 210 code to alter default behavior, which obviously
>> > is the other way around, noting counter clock around (positive) Z-axis.
>> > The applicability of this convention also follows from the (correct)
>> > position of the arc in the conversion and drawing.
>> > Only begin- and endpoints are interchanged.
>> >
>> > Please advice,
>> > Thanks in advance,
>> > Jan
>> >
>> > _______________________________________________
>> > gdal-dev mailing list
>> > gdal-dev at lists.osgeo.org
>> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>
>> --
>> http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>> -- http://www.spatialys.com
> My software is free, but my time generally not.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/9c056f19/attachment.htm>

From a.pau at creaf.uab.cat  Tue Feb 27 01:43:52 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Tue, 27 Feb 2024 09:43:52 +0000
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <PAXPR07MB77751C06354941407E34E775A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
 <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB77750D19A12C6E6B94B1D80FA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <3c88271e-981e-4f1e-8fab-7c655f9aed75@spatialys.com>
 <PAXPR07MB77755EBDA32F91C5404B45E6A25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775B25A9FC47D7214791395A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKupe0Td-Bmk98a4_cq7O2_feg7PMeJse0ONTy8=SVi_BA@mail.gmail.com>
 <PAXPR07MB7775CD1A61D1BB9D580D3CEBA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKvWFz4Hm6+K_6xqYWXpPLMhDyvfcH8nEiOEv0daPjPzKg@mail.gmail.com>
 <PAXPR07MB77751C06354941407E34E775A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <PAXPR07MB7775EE6D6F3BF2FF0375B58EA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>

In one month ago gdal code the error persists.
So I have to conclude that this error is related to my vcpkg update with, so I?m sad because it?s not something easy to solve.

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau via gdal-dev
Enviado el: dimarts, 27 de febrer de 2024 10:29
Para: Javier Jimenez Shaw <j1 at jimenezshaw.com>
CC: gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Some problems after updating

Ups, forget this compilation error (not the first one).
The directory exists and another program (by error) had it opened causing the compiler couldn?t delete it.
So, it was my mistake.
So, I?m going to proceed with that one:
[cid:image009.png at 01DA6969.D9D023B0]


De: Javier Jimenez Shaw <j1 at jimenezshaw.com<mailto:j1 at jimenezshaw.com>>
Enviado el: dimarts, 27 de febrer de 2024 10:18
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>
CC: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

ohhhh, Windows debug. That was not easy (when I worked in Windows, more than 10 years ago). It is using different names for libraries in debug and release.

 'ogr_VDV.dir\Debug\ogr_VDV.lib':  could you check that is the content of that directory? I wouldn't be surprised if the library file there has a slightly different name.

On Tue, 27 Feb 2024 at 10:06, Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>> wrote:
Hi Javier,
I did two changes at the same time (bad  bad, never do that!): one updating the code from repo (as usual) and the other one updating vcpkg (cause there like 1000 changes in their Git and I though that was a good idea).
I suspect the code is good but I?ll make sure doing that bisection method.
Even though this error is rare:

3>LINK : fatal error LNK1104: cannot open file 'ogr_VDV.dir\Debug\ogr_VDV.lib'
3>Done building project "ogr_VDV.vcxproj" -- FAILED.

I wonder why it is not writing (ogr_VDV it?s the only one that have the error).
Thanks!

De: Javier Jimenez Shaw <j1 at jimenezshaw.com<mailto:j1 at jimenezshaw.com>>
Enviado el: dimarts, 27 de febrer de 2024 9:57
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>
CC: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Hi Abel,

If you have clear when it started happening, maybe you can try to find the reason using https://git-scm.com/docs/git-bisect
specially as you are reproducing it in your computer (CI is working fine, so that should be something related to your configuration).
Replicate it working fine with an older checkout from the repo, then replicate it failing today, and look for the change that "breaks" it.
If you cannot replicate the correct behaviour with an older checkout... then the problem is not the source code.

Cheers,
Javier.

On Tue, 27 Feb 2024 at 09:15, Abel Pau via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
Hi again,
I built and compiled the Gdal version in GitHub (without my changes) and the error is NOT gone.
Anyone has compiled very recently and is capable to call ogr2ogr with no problems?

Thanks

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 18:17
Para: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Done but it doesn?t work.
The error is the same.
Any other idea?

De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:55
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


Perhaps try the good old methods: run the "clean" target and do a full rebuild
Le 26/02/2024 ? 17:48, Abel Pau via gdal-dev a ?crit :
It even now doesn?t work from Visual Studio itself.
I don?t understand what have changed from yesterday to today (apart from updating vcpkg and gdal code itself).



De: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 17:42
Para: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Hi Even, thanks for your answer.

I paste here some of my variables:
After too many months perhaps there are things that are not necessary, but the one you sais is there:

GDAL_DATA
D:\GitHub-repository\GDAL\build\data

PATH
PATH%;
D:\GitHub-repository\GDAL\build\Debug;
C:\Users\a.pau\AppData\Local\GitHubDesktop\bin;
C:\Program Files\Graphviz\bin;
D:\GitHub-repository\odbc-cpp-wrapper\build\src\odbc\Release;
D:\mapes\programes\make-3.81-bin\bin;

But same error appears :(


De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:30
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


hi,

perhaps make sure that your PATH environment variable includes a directory that contains the gdal.dll of *your* build (should likely be D:\GitHub-repository\GDAL\build\Debug) before the one potentially coming from vcpkg

Even
Le 26/02/2024 ? 17:20, Abel Pau via gdal-dev a ?crit :
Hi,

usually (and always works) I call this two sentences from command line in Windows:

cmake -B D:\GitHub-repository\GDAL\build -S . -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
cmake --build D:\GitHub-repository\GDAL\build

The first one generates all projects that I can open with Visual Studio
The second one compilates all files, and it ens with no problems.

To test is works I?ve been using lots of line commands, for example this one (using the program ogr2ogr):

D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco Version=V1.1 --config CPL_DEBUG ON

It?s been working untiel today when next error appears:
---------------------------
ogr2ogr.exe - No se encuentra el punto de entrada
---------------------------
No se encuentra el punto de entrada del procedimiento ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z en la biblioteca de v?nculos din?micos D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
---------------------------
D'acord
---------------------------

What is the diference between today and yesterday?
I?ve done 2 things:

1.       Download and Install VCPKG (the method that worked for me)

2.       .\vcpkg\bootstrap-vcpkg.bat

3.       .\vcpkg integrate install

4.       .\vcpkg install gdal --triplet=x64-windows

And, of course, download lasts codes from GDAL to be on date before finishing the job I?m doing.

So, can anyone put some light to this mistery? What I am doing wrong this time?
There is some dependence I am using wrong?

I am a little desperate with that kind of errors.

Thanks a lot!



Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.





_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/92bfc382/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image009.png
Type: image/png
Size: 11623 bytes
Desc: image009.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/92bfc382/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image010.png
Type: image/png
Size: 3657 bytes
Desc: image010.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/92bfc382/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image011.png
Type: image/png
Size: 2547 bytes
Desc: image011.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/92bfc382/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image012.png
Type: image/png
Size: 505 bytes
Desc: image012.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/92bfc382/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image013.png
Type: image/png
Size: 446 bytes
Desc: image013.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/92bfc382/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image014.png
Type: image/png
Size: 553 bytes
Desc: image014.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/92bfc382/attachment-0012.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image015.png
Type: image/png
Size: 582 bytes
Desc: image015.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/92bfc382/attachment-0013.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image016.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image016.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/92bfc382/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image017.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image017.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/92bfc382/attachment-0003.jpg>

From j1 at jimenezshaw.com  Tue Feb 27 02:15:10 2024
From: j1 at jimenezshaw.com (Javier Jimenez Shaw)
Date: Tue, 27 Feb 2024 11:15:10 +0100
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <PAXPR07MB7775EE6D6F3BF2FF0375B58EA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
 <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB77750D19A12C6E6B94B1D80FA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <3c88271e-981e-4f1e-8fab-7c655f9aed75@spatialys.com>
 <PAXPR07MB77755EBDA32F91C5404B45E6A25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775B25A9FC47D7214791395A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKupe0Td-Bmk98a4_cq7O2_feg7PMeJse0ONTy8=SVi_BA@mail.gmail.com>
 <PAXPR07MB7775CD1A61D1BB9D580D3CEBA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKvWFz4Hm6+K_6xqYWXpPLMhDyvfcH8nEiOEv0daPjPzKg@mail.gmail.com>
 <PAXPR07MB77751C06354941407E34E775A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775EE6D6F3BF2FF0375B58EA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <CADRrdKusO5FVoAtKhdZ9GW_exJBSzuZtWeTd_u-8-GSTJZmTVA@mail.gmail.com>

I am not an expert in Windows at all. But the message says that cannot find
"TransformWithErrorCodes...blablah" in ogr2gr.exe. Could it be that this
method is actually in a dll, and the dll is not found? can be a PATH
problem? There are tools to see the exported methods from a dll. Check that
it does exist, and that is findable by ogr2ogr.exe.

On Tue, 27 Feb 2024 at 10:43, Abel Pau <a.pau at creaf.uab.cat> wrote:

> In *one month* ago gdal code the error persists.
>
> So I have to conclude that this error is related to my vcpkg update with,
> so I?m sad because it?s not something easy to solve.
>
>
>
> *De:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *En nombre de *Abel Pau
> via gdal-dev
> *Enviado el:* dimarts, 27 de febrer de 2024 10:29
> *Para:* Javier Jimenez Shaw <j1 at jimenezshaw.com>
> *CC:* gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> Ups, forget this compilation error (not the first one).
>
> The directory exists and another program (by error) had it opened causing
> the compiler couldn?t delete it.
>
> So, it was my mistake.
>
> So, I?m going to proceed with that one:
>
>
>
>
>
>
> *De:* Javier Jimenez Shaw <j1 at jimenezshaw.com>
> *Enviado el:* dimarts, 27 de febrer de 2024 10:18
> *Para:* Abel Pau <a.pau at creaf.uab.cat>
> *CC:* gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> ohhhh, Windows debug. That was not easy (when I worked in Windows, more
> than 10 years ago). It is using different names for libraries in debug and
> release.
>
>
>
>  'ogr_VDV.dir\Debug\ogr_VDV.lib':  could you check that is the content of
> that directory? I wouldn't be surprised if the library file there has a
> slightly different name.
>
>
>
> On Tue, 27 Feb 2024 at 10:06, Abel Pau <a.pau at creaf.uab.cat> wrote:
>
> Hi Javier,
>
> I did two changes at the same time (bad  bad, never do that!): one
> updating the code from repo (as usual) and the other one updating vcpkg
> (cause there like 1000 changes in their Git and I though that was a good
> idea).
>
> I suspect the code is good but I?ll make sure doing that bisection method.
>
> Even though this error is rare:
>
>
>
> 3>LINK : fatal error LNK1104: cannot open file
> 'ogr_VDV.dir\Debug\ogr_VDV.lib'
>
> 3>Done building project "ogr_VDV.vcxproj" -- FAILED.
>
>
>
> I wonder why it is not writing (ogr_VDV it?s the only one that have the
> error).
>
> Thanks!
>
>
>
> *De:* Javier Jimenez Shaw <j1 at jimenezshaw.com>
> *Enviado el:* dimarts, 27 de febrer de 2024 9:57
> *Para:* Abel Pau <a.pau at creaf.uab.cat>
> *CC:* gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> Hi Abel,
>
>
>
> If you have clear when it started happening, maybe you can try to find the
> reason using https://git-scm.com/docs/git-bisect
>
> specially as you are reproducing it in your computer (CI is working fine,
> so that should be something related to your configuration).
>
> Replicate it working fine with an older checkout from the repo, then
> replicate it failing today, and look for the change that "breaks" it.
>
> If you cannot replicate the correct behaviour with an older checkout...
> then the problem is not the source code.
>
>
>
> Cheers,
>
> Javier.
>
>
>
> On Tue, 27 Feb 2024 at 09:15, Abel Pau via gdal-dev <
> gdal-dev at lists.osgeo.org> wrote:
>
> Hi again,
>
> I built and compiled the Gdal version in GitHub (without my changes) and
> the error is NOT gone.
>
> Anyone has compiled very recently and is capable to call ogr2ogr with no
> problems?
>
>
>
> Thanks
>
>
>
> *De:* gdal-dev <gdal-dev-bounces at lists.osgeo.org> *En nombre de *Abel Pau
> via gdal-dev
> *Enviado el:* dilluns, 26 de febrer de 2024 18:17
> *Para:* Even Rouault <even.rouault at spatialys.com>;
> gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> Done but it doesn?t work.
>
> The error is the same.
>
> Any other idea?
>
>
>
> *De:* Even Rouault <even.rouault at spatialys.com>
> *Enviado el:* dilluns, 26 de febrer de 2024 17:55
> *Para:* Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> Perhaps try the good old methods: run the "clean" target and do a full
> rebuild
>
> Le 26/02/2024 ? 17:48, Abel Pau via gdal-dev a ?crit :
>
> It even now doesn?t work from Visual Studio itself.
>
> I don?t understand what have changed from yesterday to today (apart from
> updating vcpkg and gdal code itself).
>
>
>
>
>
>
>
> *De:* gdal-dev <gdal-dev-bounces at lists.osgeo.org>
> <gdal-dev-bounces at lists.osgeo.org> *En nombre de *Abel Pau via gdal-dev
> *Enviado el:* dilluns, 26 de febrer de 2024 17:42
> *Para:* Even Rouault <even.rouault at spatialys.com>
> <even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> Hi Even, thanks for your answer.
>
>
>
> I paste here some of my variables:
>
> After too many months perhaps there are things that are not necessary, but
> the one you sais is there:
>
>
>
> *GDAL_DATA *
>
> D:\GitHub-repository\GDAL\build\data
>
>
>
> *PATH *
>
> PATH%;
>
> D:\GitHub-repository\GDAL\build\Debug;
>
> C:\Users\a.pau\AppData\Local\GitHubDesktop\bin;
>
> C:\Program Files\Graphviz\bin;
>
> D:\GitHub-repository\odbc-cpp-wrapper\build\src\odbc\Release;
>
> D:\mapes\programes\make-3.81-bin\bin;
>
>
>
> But same error appears :(
>
>
>
>
>
> *De:* Even Rouault <even.rouault at spatialys.com>
> *Enviado el:* dilluns, 26 de febrer de 2024 17:30
> *Para:* Abel Pau <a.pau at creaf.uab.cat>; gdal-dev at lists.osgeo.org
> *Asunto:* Re: [gdal-dev] Some problems after updating
>
>
>
> hi,
>
> perhaps make sure that your PATH environment variable includes a directory
> that contains the gdal.dll of *your* build (should likely be
> D:\GitHub-repository\GDAL\build\Debug) before the one potentially coming
> from vcpkg
>
> Even
>
> Le 26/02/2024 ? 17:20, Abel Pau via gdal-dev a ?crit :
>
> Hi,
>
>
>
> usually (and always works) I call this two sentences from command line in
> Windows:
>
>
>
> cmake -B D:\GitHub-repository\GDAL\build -S .
> -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
>
> cmake --build D:\GitHub-repository\GDAL\build
>
>
>
> The first one generates all projects that I can open with Visual Studio
>
> The second one compilates all files, and it ens with no problems.
>
>
>
> To test is works I?ve been using lots of line commands, for example this
> one (using the program ogr2ogr):
>
>
>
> D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe
> D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol
> D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco Version=V1.1
> --config CPL_DEBUG ON
>
>
>
> It?s been working untiel today when next error appears:
>
> ---------------------------
>
> ogr2ogr.exe - No se encuentra el punto de entrada
>
> ---------------------------
>
> No se encuentra el punto de entrada del procedimiento
> ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z
> en la biblioteca de v?nculos din?micos
> D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
>
> ---------------------------
>
> D'acord
>
> ---------------------------
>
>
>
> What is the diference between today and yesterday?
> I?ve done 2 things:
>
> 1.       Download and Install VCPKG (the method that worked for me)
>
> 2.       .\vcpkg\bootstrap-vcpkg.bat
>
> 3.       .\vcpkg integrate install
>
> 4.       .\vcpkg install gdal --triplet=x64-windows
>
>
>
> And, of course, download lasts codes from GDAL to be on date before
> finishing the job I?m doing.
>
>
>
> So, can anyone put some light to this mistery? What I am doing wrong this
> time?
>
> There is some dependence I am using wrong?
>
>
>
> I am a little desperate with that kind of errors.
>
>
>
> Thanks a lot!
>
>
>
>
>
>
>
> *Abel Pau Garcia*
>
> *GIS developer*
>
> [image: https://www.creaf.cat/sites/default/files/creaf-signature.png]
>
> *a.pau at creaf.uab.cat* <a.pau at creaf.uab.cat>
>
> *Let's chat on Teams!*
> <https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
>
> *Tel. +34 934814277*
>
> [image: https://www.creaf.cat/sites/default/files/so-en-signature.png]
>
> [image:
> https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]
> <https://twitter.com/CREAF_ecologia>[image:
> https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]
> <https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[image:
> https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]
> <https://www.youtube.com/c/creafecologia>[image:
> https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]
> <https://www.instagram.com/CREAF_ecologia/>
>
> *www.creaf.cat* <http://www.creaf.cat>* | **http://blog.creaf.cat*
> <http://blog.creaf.cat>
>
> [image: https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
>
> CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)
>
>
> Before printing this electronic message, think about the environment.
>
> [image: http://www.creaf.uab.cat/_signatura/line.gif]
>
>
>
>
>
>
>
> _______________________________________________
>
> gdal-dev mailing list
>
> gdal-dev at lists.osgeo.org
>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
>
>
> _______________________________________________
>
> gdal-dev mailing list
>
> gdal-dev at lists.osgeo.org
>
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
> --
>
> http://www.spatialys.com
>
> My software is free, but my time generally not.
>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/990aa90c/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image010.png
Type: image/png
Size: 3657 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/990aa90c/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image011.png
Type: image/png
Size: 2547 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/990aa90c/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image012.png
Type: image/png
Size: 505 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/990aa90c/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image013.png
Type: image/png
Size: 446 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/990aa90c/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image014.png
Type: image/png
Size: 553 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/990aa90c/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image015.png
Type: image/png
Size: 582 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/990aa90c/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image016.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/990aa90c/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image017.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/990aa90c/attachment-0003.jpg>

From a.pau at creaf.uab.cat  Tue Feb 27 02:34:54 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Tue, 27 Feb 2024 10:34:54 +0000
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <CADRrdKusO5FVoAtKhdZ9GW_exJBSzuZtWeTd_u-8-GSTJZmTVA@mail.gmail.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
 <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB77750D19A12C6E6B94B1D80FA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <3c88271e-981e-4f1e-8fab-7c655f9aed75@spatialys.com>
 <PAXPR07MB77755EBDA32F91C5404B45E6A25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775B25A9FC47D7214791395A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKupe0Td-Bmk98a4_cq7O2_feg7PMeJse0ONTy8=SVi_BA@mail.gmail.com>
 <PAXPR07MB7775CD1A61D1BB9D580D3CEBA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKvWFz4Hm6+K_6xqYWXpPLMhDyvfcH8nEiOEv0daPjPzKg@mail.gmail.com>
 <PAXPR07MB77751C06354941407E34E775A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775EE6D6F3BF2FF0375B58EA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKusO5FVoAtKhdZ9GW_exJBSzuZtWeTd_u-8-GSTJZmTVA@mail.gmail.com>
Message-ID: <PAXPR07MB7775338978B4A5D51B9D3163A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi,
sure it?s a good point going through that way.
Thanks!

De: Javier Jimenez Shaw <j1 at jimenezshaw.com>
Enviado el: dimarts, 27 de febrer de 2024 11:15
Para: Abel Pau <a.pau at creaf.uab.cat>
CC: gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Some problems after updating

I am not an expert in Windows at all. But the message says that cannot find "TransformWithErrorCodes...blablah" in ogr2gr.exe. Could it be that this method is actually in a dll, and the dll is not found? can be a PATH problem? There are tools to see the exported methods from a dll. Check that it does exist, and that is findable by ogr2ogr.exe.

On Tue, 27 Feb 2024 at 10:43, Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>> wrote:
In one month ago gdal code the error persists.
So I have to conclude that this error is related to my vcpkg update with, so I?m sad because it?s not something easy to solve.

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Abel Pau via gdal-dev
Enviado el: dimarts, 27 de febrer de 2024 10:29
Para: Javier Jimenez Shaw <j1 at jimenezshaw.com<mailto:j1 at jimenezshaw.com>>
CC: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Ups, forget this compilation error (not the first one).
The directory exists and another program (by error) had it opened causing the compiler couldn?t delete it.
So, it was my mistake.
So, I?m going to proceed with that one:



De: Javier Jimenez Shaw <j1 at jimenezshaw.com<mailto:j1 at jimenezshaw.com>>
Enviado el: dimarts, 27 de febrer de 2024 10:18
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>
CC: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

ohhhh, Windows debug. That was not easy (when I worked in Windows, more than 10 years ago). It is using different names for libraries in debug and release.

 'ogr_VDV.dir\Debug\ogr_VDV.lib':  could you check that is the content of that directory? I wouldn't be surprised if the library file there has a slightly different name.

On Tue, 27 Feb 2024 at 10:06, Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>> wrote:
Hi Javier,
I did two changes at the same time (bad  bad, never do that!): one updating the code from repo (as usual) and the other one updating vcpkg (cause there like 1000 changes in their Git and I though that was a good idea).
I suspect the code is good but I?ll make sure doing that bisection method.
Even though this error is rare:

3>LINK : fatal error LNK1104: cannot open file 'ogr_VDV.dir\Debug\ogr_VDV.lib'
3>Done building project "ogr_VDV.vcxproj" -- FAILED.

I wonder why it is not writing (ogr_VDV it?s the only one that have the error).
Thanks!

De: Javier Jimenez Shaw <j1 at jimenezshaw.com<mailto:j1 at jimenezshaw.com>>
Enviado el: dimarts, 27 de febrer de 2024 9:57
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>
CC: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Hi Abel,

If you have clear when it started happening, maybe you can try to find the reason using https://git-scm.com/docs/git-bisect
specially as you are reproducing it in your computer (CI is working fine, so that should be something related to your configuration).
Replicate it working fine with an older checkout from the repo, then replicate it failing today, and look for the change that "breaks" it.
If you cannot replicate the correct behaviour with an older checkout... then the problem is not the source code.

Cheers,
Javier.

On Tue, 27 Feb 2024 at 09:15, Abel Pau via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
Hi again,
I built and compiled the Gdal version in GitHub (without my changes) and the error is NOT gone.
Anyone has compiled very recently and is capable to call ogr2ogr with no problems?

Thanks

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 18:17
Para: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Done but it doesn?t work.
The error is the same.
Any other idea?

De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:55
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


Perhaps try the good old methods: run the "clean" target and do a full rebuild
Le 26/02/2024 ? 17:48, Abel Pau via gdal-dev a ?crit :
It even now doesn?t work from Visual Studio itself.
I don?t understand what have changed from yesterday to today (apart from updating vcpkg and gdal code itself).



De: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 17:42
Para: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Hi Even, thanks for your answer.

I paste here some of my variables:
After too many months perhaps there are things that are not necessary, but the one you sais is there:

GDAL_DATA
D:\GitHub-repository\GDAL\build\data

PATH
PATH%;
D:\GitHub-repository\GDAL\build\Debug;
C:\Users\a.pau\AppData\Local\GitHubDesktop\bin;
C:\Program Files\Graphviz\bin;
D:\GitHub-repository\odbc-cpp-wrapper\build\src\odbc\Release;
D:\mapes\programes\make-3.81-bin\bin;

But same error appears :(


De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:30
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


hi,

perhaps make sure that your PATH environment variable includes a directory that contains the gdal.dll of *your* build (should likely be D:\GitHub-repository\GDAL\build\Debug) before the one potentially coming from vcpkg

Even
Le 26/02/2024 ? 17:20, Abel Pau via gdal-dev a ?crit :
Hi,

usually (and always works) I call this two sentences from command line in Windows:

cmake -B D:\GitHub-repository\GDAL\build -S . -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
cmake --build D:\GitHub-repository\GDAL\build

The first one generates all projects that I can open with Visual Studio
The second one compilates all files, and it ens with no problems.

To test is works I?ve been using lots of line commands, for example this one (using the program ogr2ogr):

D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco Version=V1.1 --config CPL_DEBUG ON

It?s been working untiel today when next error appears:
---------------------------
ogr2ogr.exe - No se encuentra el punto de entrada
---------------------------
No se encuentra el punto de entrada del procedimiento ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z en la biblioteca de v?nculos din?micos D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
---------------------------
D'acord
---------------------------

What is the diference between today and yesterday?
I?ve done 2 things:

1.       Download and Install VCPKG (the method that worked for me)

2.       .\vcpkg\bootstrap-vcpkg.bat

3.       .\vcpkg integrate install

4.       .\vcpkg install gdal --triplet=x64-windows

And, of course, download lasts codes from GDAL to be on date before finishing the job I?m doing.

So, can anyone put some light to this mistery? What I am doing wrong this time?
There is some dependence I am using wrong?

I am a little desperate with that kind of errors.

Thanks a lot!



Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat> | http://blog.creaf.cat
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.





_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com

My software is free, but my time generally not.
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/c1ee30e4/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/c1ee30e4/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/c1ee30e4/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/c1ee30e4/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/c1ee30e4/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/c1ee30e4/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/c1ee30e4/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/c1ee30e4/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/c1ee30e4/attachment-0003.jpg>

From michael.otto at data-experts.de  Tue Feb 27 03:40:44 2024
From: michael.otto at data-experts.de (Michael Otto)
Date: Tue, 27 Feb 2024 12:40:44 +0100
Subject: [gdal-dev] Segmentation fault (core dumped) in gdal_translate &
 ogrinfo & ogr2ogr
Message-ID: <OF42961102.2BD1B79F-ONC1258AD0.00396C01-C1258AD0.004026FC@data-experts.de>

Hello,

with a lot of effort and support from this group I created a first static 
version of GDAL (incl. the apps) under Linux x64 using vcpkg.

For testing I copied the built apps and the data files to different target 
platforms and set the environment variables accordingly.
In a current Linux Mint VM and in an Alpine Linux 3.13 Docker container, 
the command line calls worked perfectly.

Under a Fedora Linux 39 Docker container (docker pull fedora, ...) an 
error occurs when executing ogrinfo, ogr2ogr and gdal_translate (the other 
tools were not tested):

>> Segmentation fault (core dumped)

Does anyone have an idea or know what the problem is?

Michael

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/a0ba82ba/attachment.htm>

From robert.coup at koordinates.com  Tue Feb 27 04:13:56 2024
From: robert.coup at koordinates.com (Robert Coup)
Date: Tue, 27 Feb 2024 12:13:56 +0000
Subject: [gdal-dev] Segmentation fault (core dumped) in gdal_translate &
 ogrinfo & ogr2ogr
In-Reply-To: <OF42961102.2BD1B79F-ONC1258AD0.00396C01-C1258AD0.004026FC@data-experts.de>
References: <OF42961102.2BD1B79F-ONC1258AD0.00396C01-C1258AD0.004026FC@data-experts.de>
Message-ID: <CAFLLRpJcKmc7mVyMnx5vb3DbE9b73PCmtGqecaTJZ9BHcgKzjw@mail.gmail.com>

Hi Michael,

On Tue, 27 Feb 2024 at 11:40, Michael Otto via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

>
> with a lot of effort and support from this group I created a first static
> version of GDAL (incl. the apps) under Linux x64 using vcpkg.


Yay


> For testing I copied the built apps and the data files to different target
> platforms and set the environment variables accordingly.
> In a current Linux Mint VM and in an Alpine Linux 3.13 Docker container,
> the command line calls worked perfectly.


What system did you build gdal on/under?


> Under a Fedora Linux 39 Docker container (docker pull fedora, ...) an
> error occurs when executing ogrinfo, ogr2ogr and gdal_translate (the other
> tools were not tested):


What's the host OS?


>
> >> Segmentation fault (core dumped)
>
> Does anyone have an idea or know what the problem is?


What does a backtrace from gdb produce?

$ gdb --args ogrinfo
... loading stuff
(gdb) run

...

Program received signal SIGSEGV, Segmentation fault.
0x12c0ffee in _a_function ()
(gdb) thread apply all backtrace

... the backtrace ...

(gdb) quit


Use the gdal tools from the installed/{platform}/tools/gdal/debug/ vcpkg
build folder, they're more likely to produce readable traces.

Rob :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/3e8f6808/attachment.htm>

From michael.otto at data-experts.de  Tue Feb 27 05:01:45 2024
From: michael.otto at data-experts.de (Michael Otto)
Date: Tue, 27 Feb 2024 14:01:45 +0100
Subject: [gdal-dev] Antwort: Re: Segmentation fault (core dumped) in
 gdal_translate & ogrinfo & ogr2ogr
In-Reply-To: <CAFLLRpJcKmc7mVyMnx5vb3DbE9b73PCmtGqecaTJZ9BHcgKzjw@mail.gmail.com>
References: <OF42961102.2BD1B79F-ONC1258AD0.00396C01-C1258AD0.004026FC@data-experts.de>
 <CAFLLRpJcKmc7mVyMnx5vb3DbE9b73PCmtGqecaTJZ9BHcgKzjw@mail.gmail.com>
Message-ID: <OF951CDF5A.1C53ECC0-ONC1258AD0.0046E5F7-C1258AD0.0047918D@data-experts.de>

Hello Robert,

I have now been able to find the error myself.

I forgot to set the proxy in the Docker container. After I added it, it 
also worked under Fedora.

Now I'm stuck under Ubuntu 20.04. There comes the next error :o( :

ERROR 1: error setting certificate file: 
/etc/ssl/certs/ca-certificates.crt
ERROR 1: Error returned by server : error setting certificate file: 
/etc/ssl/certs/ca-certificates.crt (77)
ogrinfo failed - unable to open 'WFS:https://........'.

Michael

PS:
I built Gdal under Linux Mint 21.3 (Virginia).
The host system for the Docker containers is Ubuntu 22.04.3 LTS (Jammy 
Jellyfish).




Von:    "Robert Coup" <robert.coup at koordinates.com>
An:     "Michael Otto" <michael.otto at data-experts.de>
Kopie:  gdal-dev at lists.osgeo.org
Datum:  27.02.2024 13:14
Betreff:        Re: [gdal-dev] Segmentation fault (core dumped) in 
gdal_translate & ogrinfo & ogr2ogr



Hi Michael,

On Tue, 27 Feb 2024 at 11:40, Michael Otto via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

with a lot of effort and support from this group I created a first static 
version of GDAL (incl. the apps) under Linux x64 using vcpkg.

Yay
 
For testing I copied the built apps and the data files to different target 
platforms and set the environment variables accordingly.
In a current Linux Mint VM and in an Alpine Linux 3.13 Docker container, 
the command line calls worked perfectly.

What system did you build gdal on/under?
 
Under a Fedora Linux 39 Docker container (docker pull fedora, ...) an 
error occurs when executing ogrinfo, ogr2ogr and gdal_translate (the other 
tools were not tested):

What's the host OS?
 

>> Segmentation fault (core dumped)

Does anyone have an idea or know what the problem is?

What does a backtrace from gdb produce?

$ gdb --args ogrinfo 
... loading stuff
(gdb) run
...
Program received signal SIGSEGV, Segmentation fault.
0x12c0ffee in _a_function ()
(gdb) thread apply all backtrace
... the backtrace ...
(gdb) quit

Use the gdal tools from the installed/{platform}/tools/gdal/debug/ vcpkg 
build folder, they're more likely to produce readable traces.

Rob :)




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/c661d810/attachment.htm>

From michael.otto at data-experts.de  Tue Feb 27 05:58:37 2024
From: michael.otto at data-experts.de (Michael Otto)
Date: Tue, 27 Feb 2024 14:58:37 +0100
Subject: [gdal-dev] Antwort: Antwort: Re: Segmentation fault (core dumped)
 in gdal_translate & ogrinfo & ogr2ogr
In-Reply-To: <OF951CDF5A.1C53ECC0-ONC1258AD0.0046E5F7-C1258AD0.0047918D@data-experts.de>
References: <OF42961102.2BD1B79F-ONC1258AD0.00396C01-C1258AD0.004026FC@data-experts.de>
 <CAFLLRpJcKmc7mVyMnx5vb3DbE9b73PCmtGqecaTJZ9BHcgKzjw@mail.gmail.com>
 <OF951CDF5A.1C53ECC0-ONC1258AD0.0046E5F7-C1258AD0.0047918D@data-experts.de>
Message-ID: <OFBB9BA553.E3CA8300-ONC1258AD0.004A0EB0-C1258AD0.004CC68A@data-experts.de>

Hello Robert,

I'm moving on.

I solved the problem with the missing certificates as follows.

$ apt update
$ apt upgrade

$ rm -f /etc/ssl/certs/ca-bundle.crt
$ apt reinstall ca-certificates
$ update-ca-certificates 

Now it also works under Ubuntu 20.04 ;o).

And the test continues.

Michael




Von:    "Michael Otto via gdal-dev" <gdal-dev at lists.osgeo.org>
An:     "Robert Coup" <robert.coup at koordinates.com>
Kopie:  gdal-dev at lists.osgeo.org
Datum:  27.02.2024 14:02
Betreff:        [gdal-dev] Antwort: Re: Segmentation fault (core dumped) 
in gdal_translate & ogrinfo & ogr2ogr
Gesendet von:   "gdal-dev" <gdal-dev-bounces at lists.osgeo.org>



Hello Robert,

I have now been able to find the error myself.

I forgot to set the proxy in the Docker container. After I added it, it 
also worked under Fedora.

Now I'm stuck under Ubuntu 20.04. There comes the next error :o( :

ERROR 1: error setting certificate file: 
/etc/ssl/certs/ca-certificates.crt
ERROR 1: Error returned by server : error setting certificate file: 
/etc/ssl/certs/ca-certificates.crt (77)
ogrinfo failed - unable to open 'WFS:https://........'.

Michael

PS:
I built Gdal under Linux Mint 21.3 (Virginia).
The host system for the Docker containers is Ubuntu 22.04.3 LTS (Jammy 
Jellyfish).




Von:        "Robert Coup" <robert.coup at koordinates.com>
An:        "Michael Otto" <michael.otto at data-experts.de>
Kopie:        gdal-dev at lists.osgeo.org
Datum:        27.02.2024 13:14
Betreff:        Re: [gdal-dev] Segmentation fault (core dumped) in 
gdal_translate & ogrinfo & ogr2ogr



Hi Michael,

On Tue, 27 Feb 2024 at 11:40, Michael Otto via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

with a lot of effort and support from this group I created a first static 
version of GDAL (incl. the apps) under Linux x64 using vcpkg.

Yay
 
For testing I copied the built apps and the data files to different target 
platforms and set the environment variables accordingly.
In a current Linux Mint VM and in an Alpine Linux 3.13 Docker container, 
the command line calls worked perfectly.

What system did you build gdal on/under?
 
Under a Fedora Linux 39 Docker container (docker pull fedora, ...) an 
error occurs when executing ogrinfo, ogr2ogr and gdal_translate (the other 
tools were not tested):

What's the host OS?
 

>> Segmentation fault (core dumped)

Does anyone have an idea or know what the problem is?

What does a backtrace from gdb produce?

$ gdb --args ogrinfo 
... loading stuff
(gdb) run
...
Program received signal SIGSEGV, Segmentation fault.
0x12c0ffee in _a_function ()
(gdb) thread apply all backtrace
... the backtrace ...
(gdb) quit

Use the gdal tools from the installed/{platform}/tools/gdal/debug/vcpkg 
build folder, they're more likely to produce readable traces.

Rob :)


_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/f593edcc/attachment-0001.htm>

From Huzaifa.Kamran at amt-sybex.com  Tue Feb 27 06:39:17 2024
From: Huzaifa.Kamran at amt-sybex.com (Huzaifa Kamran)
Date: Tue, 27 Feb 2024 14:39:17 +0000
Subject: [gdal-dev] Fw: GDAL iOS
In-Reply-To: <LO3P265MB217040ADB541FFB72B305D6BC9592@LO3P265MB2170.GBRP265.PROD.OUTLOOK.COM>
References: <LO3P265MB217040ADB541FFB72B305D6BC9592@LO3P265MB2170.GBRP265.PROD.OUTLOOK.COM>
Message-ID: <LO3P265MB21702DAC3C937B615EA4E451C9592@LO3P265MB2170.GBRP265.PROD.OUTLOOK.COM>



________________________________
How can I use Gdal with iOS if I compile it statically, I don't get C# binding, but when I compile it as shared library (dynamic library) I get the bindings and it works but I can't upload the app to App Store then because dylibs are not allowed by apple store.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/4db31dbb/attachment.htm>

From Huzaifa.Kamran at amt-sybex.com  Tue Feb 27 06:40:39 2024
From: Huzaifa.Kamran at amt-sybex.com (Huzaifa Kamran)
Date: Tue, 27 Feb 2024 14:40:39 +0000
Subject: [gdal-dev] GDAL iOS
Message-ID: <LO3P265MB21709C24A913BB997668B629C9592@LO3P265MB2170.GBRP265.PROD.OUTLOOK.COM>

Hi Team,

How can I use Gdal with iOS if I compile it statically, I don't get C# binding, but when I compile it as shared library (dynamic library) I get the bindings and it works but I can't upload the app to App Store then because dylibs are not allowed by apple store.

Thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/ae6a1e0f/attachment.htm>

From stefan.uhrig at sap.com  Tue Feb 27 07:49:31 2024
From: stefan.uhrig at sap.com (Uhrig, Stefan)
Date: Tue, 27 Feb 2024 15:49:31 +0000
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <PAXPR07MB7775338978B4A5D51B9D3163A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
 <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB77750D19A12C6E6B94B1D80FA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <3c88271e-981e-4f1e-8fab-7c655f9aed75@spatialys.com>
 <PAXPR07MB77755EBDA32F91C5404B45E6A25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775B25A9FC47D7214791395A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKupe0Td-Bmk98a4_cq7O2_feg7PMeJse0ONTy8=SVi_BA@mail.gmail.com>
 <PAXPR07MB7775CD1A61D1BB9D580D3CEBA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKvWFz4Hm6+K_6xqYWXpPLMhDyvfcH8nEiOEv0daPjPzKg@mail.gmail.com>
 <PAXPR07MB77751C06354941407E34E775A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775EE6D6F3BF2FF0375B58EA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKusO5FVoAtKhdZ9GW_exJBSzuZtWeTd_u-8-GSTJZmTVA@mail.gmail.com>
 <PAXPR07MB7775338978B4A5D51B9D3163A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <AM0PR02MB577733F7B0F4119D3F0AA3FC93592@AM0PR02MB5777.eurprd02.prod.outlook.com>

Hi Abel,

I did a Windows Debug build from scratch using the current GDAL head and the current vcpkg head. I could execute ogr2ogr without a problem, but I had to copy it over from build/apps/Debug to build/Debug where the gdald.dll is located.

My guess is that your ogr2ogr is not loading the gdald.dll you built but another gdald.dll, maybe the one that vcpkg built. In the directory in which ogr2ogr.exe is located, execute the following command to find out which gdald.dll is actually loaded by ogr2ogr:

where gdald.dll

This should point to the gdald you built, but I?d assume that it points to another gdald.dll.

Best regards,
Stefan

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> On Behalf Of Abel Pau via gdal-dev
Sent: Tuesday, February 27, 2024 11:35 AM
To: Javier Jimenez Shaw <j1 at jimenezshaw.com>
Cc: gdal-dev at lists.osgeo.org
Subject: Re: [gdal-dev] Some problems after updating

Hi,
sure it?s a good point going through that way.
Thanks!

De: Javier Jimenez Shaw <j1 at jimenezshaw.com<mailto:j1 at jimenezshaw.com>>
Enviado el: dimarts, 27 de febrer de 2024 11:15
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>
CC: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

I am not an expert in Windows at all. But the message says that cannot find "TransformWithErrorCodes...blablah" in ogr2gr.exe. Could it be that this method is actually in a dll, and the dll is not found? can be a PATH problem? There are tools to see the exported methods from a dll. Check that it does exist, and that is findable by ogr2ogr.exe.

On Tue, 27 Feb 2024 at 10:43, Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>> wrote:
In one month ago gdal code the error persists.
So I have to conclude that this error is related to my vcpkg update with, so I?m sad because it?s not something easy to solve.

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Abel Pau via gdal-dev
Enviado el: dimarts, 27 de febrer de 2024 10:29
Para: Javier Jimenez Shaw <j1 at jimenezshaw.com<mailto:j1 at jimenezshaw.com>>
CC: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Ups, forget this compilation error (not the first one).
The directory exists and another program (by error) had it opened causing the compiler couldn?t delete it.
So, it was my mistake.
So, I?m going to proceed with that one:



De: Javier Jimenez Shaw <j1 at jimenezshaw.com<mailto:j1 at jimenezshaw.com>>
Enviado el: dimarts, 27 de febrer de 2024 10:18
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>
CC: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

ohhhh, Windows debug. That was not easy (when I worked in Windows, more than 10 years ago). It is using different names for libraries in debug and release.

 'ogr_VDV.dir\Debug\ogr_VDV.lib':  could you check that is the content of that directory? I wouldn't be surprised if the library file there has a slightly different name.

On Tue, 27 Feb 2024 at 10:06, Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>> wrote:
Hi Javier,
I did two changes at the same time (bad  bad, never do that!): one updating the code from repo (as usual) and the other one updating vcpkg (cause there like 1000 changes in their Git and I though that was a good idea).
I suspect the code is good but I?ll make sure doing that bisection method.
Even though this error is rare:

3>LINK : fatal error LNK1104: cannot open file 'ogr_VDV.dir\Debug\ogr_VDV.lib'
3>Done building project "ogr_VDV.vcxproj" -- FAILED.

I wonder why it is not writing (ogr_VDV it?s the only one that have the error).
Thanks!

De: Javier Jimenez Shaw <j1 at jimenezshaw.com<mailto:j1 at jimenezshaw.com>>
Enviado el: dimarts, 27 de febrer de 2024 9:57
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>
CC: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Hi Abel,

If you have clear when it started happening, maybe you can try to find the reason using https://git-scm.com/docs/git-bisect
specially as you are reproducing it in your computer (CI is working fine, so that should be something related to your configuration).
Replicate it working fine with an older checkout from the repo, then replicate it failing today, and look for the change that "breaks" it.
If you cannot replicate the correct behaviour with an older checkout... then the problem is not the source code.

Cheers,
Javier.

On Tue, 27 Feb 2024 at 09:15, Abel Pau via gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>> wrote:
Hi again,
I built and compiled the Gdal version in GitHub (without my changes) and the error is NOT gone.
Anyone has compiled very recently and is capable to call ogr2ogr with no problems?

Thanks

De: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 18:17
Para: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Done but it doesn?t work.
The error is the same.
Any other idea?

De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:55
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


Perhaps try the good old methods: run the "clean" target and do a full rebuild
Le 26/02/2024 ? 17:48, Abel Pau via gdal-dev a ?crit :
It even now doesn?t work from Visual Studio itself.
I don?t understand what have changed from yesterday to today (apart from updating vcpkg and gdal code itself).



De: gdal-dev <gdal-dev-bounces at lists.osgeo.org><mailto:gdal-dev-bounces at lists.osgeo.org> En nombre de Abel Pau via gdal-dev
Enviado el: dilluns, 26 de febrer de 2024 17:42
Para: Even Rouault <even.rouault at spatialys.com><mailto:even.rouault at spatialys.com>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating

Hi Even, thanks for your answer.

I paste here some of my variables:
After too many months perhaps there are things that are not necessary, but the one you sais is there:

GDAL_DATA
D:\GitHub-repository\GDAL\build\data

PATH
PATH%;
D:\GitHub-repository\GDAL\build\Debug;
C:\Users\a.pau\AppData\Local\GitHubDesktop\bin;
C:\Program Files\Graphviz\bin;
D:\GitHub-repository\odbc-cpp-wrapper\build\src\odbc\Release;
D:\mapes\programes\make-3.81-bin\bin;

But same error appears :(


De: Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>>
Enviado el: dilluns, 26 de febrer de 2024 17:30
Para: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>; gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
Asunto: Re: [gdal-dev] Some problems after updating


hi,

perhaps make sure that your PATH environment variable includes a directory that contains the gdal.dll of *your* build (should likely be D:\GitHub-repository\GDAL\build\Debug) before the one potentially coming from vcpkg

Even
Le 26/02/2024 ? 17:20, Abel Pau via gdal-dev a ?crit :
Hi,

usually (and always works) I call this two sentences from command line in Windows:

cmake -B D:\GitHub-repository\GDAL\build -S . -DCMAKE_TOOLCHAIN_FILE=C:/dev/vcpkg/vcpkg/scripts/buildsystems/vcpkg.cmake
cmake --build D:\GitHub-repository\GDAL\build

The first one generates all projects that I can open with Visual Studio
The second one compilates all files, and it ens with no problems.

To test is works I?ve been using lots of line commands, for example this one (using the program ogr2ogr):

D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe D:\mapes\2023\GDAL\Versions\Misteri_V20_a_V11.pol D:\mapes\2023\GDAL\Versions\Misteri_V20.pol -progress -lco Version=V1.1 --config CPL_DEBUG ON

It?s been working untiel today when next error appears:
---------------------------
ogr2ogr.exe - No se encuentra el punto de entrada
---------------------------
No se encuentra el punto de entrada del procedimiento ?TransformWithErrorCodes at OGRCoordinateTransformation@@UEAAH_KPEAN111PEAH at Z en la biblioteca de v?nculos din?micos D:\GitHub-repository\GDAL\build\apps\Debug\ogr2ogr.exe.
---------------------------
D'acord
---------------------------

What is the diference between today and yesterday?
I?ve done 2 things:

1.       Download and Install VCPKG (the method that worked for me)

2.       .\vcpkg\bootstrap-vcpkg.bat

3.       .\vcpkg integrate install

4.       .\vcpkg install gdal --triplet=x64-windows

And, of course, download lasts codes from GDAL to be on date before finishing the job I?m doing.

So, can anyone put some light to this mistery? What I am doing wrong this time?
There is some dependence I am using wrong?

I am a little desperate with that kind of errors.

Thanks a lot!



Abel Pau Garcia
GIS developer
[https://www.creaf.cat/sites/default/files/creaf-signature.png]
a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>
Let's chat on Teams!<https://teams.microsoft.com/l/chat/0/0?users=a.pau at creaf.uab.cat>
Tel. +34 934814277
[https://www.creaf.cat/sites/default/files/so-en-signature.png]
[https://www.creaf.cat/sites/default/files/twitter-icon-signature.png]<https://twitter.com/CREAF_ecologia>[https://www.creaf.cat/sites/default/files/linkedin-icon-signature.png]<https://www.linkedin.com/company/1363052?trk=tyah&trkInfo=clickedVertical:company,clickedEntityId:1363052,idx:2-1-2,tarId:1465807877789,tas:creaf>[https://www.creaf.cat/sites/default/files/youtube-icon-signature.png]<https://www.youtube.com/c/creafecologia>[https://www.creaf.cat/sites/default/files/instagram-icon-signature.png]<https://www.instagram.com/CREAF_ecologia/>
www.creaf.cat<http://www.creaf.cat/> | http://blog.creaf.cat<http://blog.creaf.cat/>
[https://www.creaf.cat/sites/default/files/uab_logo_signatura.png]
CREAF. Campus UAB. Edifici C. 08193 Bellaterra (Barcelona)

Before printing this electronic message, think about the environment.





_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com<http://www.spatialys.com/>

My software is free, but my time generally not.


_______________________________________________

gdal-dev mailing list

gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>

https://lists.osgeo.org/mailman/listinfo/gdal-dev

--

http://www.spatialys.com<http://www.spatialys.com/>

My software is free, but my time generally not.
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/9f819f4f/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 3657 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/9f819f4f/attachment-0006.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 2547 bytes
Desc: image002.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/9f819f4f/attachment-0007.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image003.png
Type: image/png
Size: 505 bytes
Desc: image003.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/9f819f4f/attachment-0008.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image004.png
Type: image/png
Size: 446 bytes
Desc: image004.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/9f819f4f/attachment-0009.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image005.png
Type: image/png
Size: 553 bytes
Desc: image005.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/9f819f4f/attachment-0010.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image006.png
Type: image/png
Size: 582 bytes
Desc: image006.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/9f819f4f/attachment-0011.png>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image007.jpg
Type: image/jpeg
Size: 2208 bytes
Desc: image007.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/9f819f4f/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image008.jpg
Type: image/jpeg
Size: 1111 bytes
Desc: image008.jpg
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/9f819f4f/attachment-0003.jpg>

From bdezonia at gmail.com  Tue Feb 27 09:01:50 2024
From: bdezonia at gmail.com (Barry DeZonia)
Date: Tue, 27 Feb 2024 11:01:50 -0600
Subject: [gdal-dev] Possible error in orientation of converted arcs from
 dxf
In-Reply-To: <CAKMUAtBR+cpuYhOHayZD-7avzDG=UUUWeAW3Po77A-ODqJdNMg@mail.gmail.com>
References: <CAKMUAtArYK2wA5fwHjazikhBJdLG5ci-qnYV1XG6EY=wg2y_1Q@mail.gmail.com>
 <742d1d66-7aea-46d6-8a83-b58926e9d83a@spatialys.com>
 <CAKMUAtDMPDqYZQZ5u=HFA8geTfeJ_t7wtdzGOLya1wfa34ct4Q@mail.gmail.com>
 <11e8694d-4dca-4849-b86d-9f4413220d0e@spatialys.com>
 <CAKMUAtBR+cpuYhOHayZD-7avzDG=UUUWeAW3Po77A-ODqJdNMg@mail.gmail.com>
Message-ID: <CAKcvfuRGzw2C62T4hx_U=Ng2HBGiqtNaVrJhzQ-fVOpBk6iYbg@mail.gmail.com>

I have not worked with DXF files since the early 90s so my info might be
wrong. But check if any of your transformations are ending up with negative
start/end angles. That used to be able to reverse the direction of the arc.
Again this is old info and I don't quite understand your problem so I'm
sorry if this is noise.

On Tue, Feb 27, 2024 at 3:32?AM Jan Heckman via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

> Hi,
>
> I set up a case for an issue and had to conclude that this issue does not
> help in solving my problem (finding the proper vertex sequence/need to
> reverse in a series of lines and arcs).
> Surprisingly at first, in the case I made, there were arcs with proper as
> well as improper sequence which all had gone through the same procedure
> during conversion with ogr2ogr.
>
> When specifying an arc by startangle, endangle, orientation
> (counterclockwise around the positive z axis, using radius and midpoint),
> the order of the vertices cannot also be specified (differently) by the
> same ingredients.
>
> Not being very good at dxf, I looked at the optional specification of an
> extrusion vector (in an arc) in the hope that this relates to the sweep of
> the arc,
> rather than the extrusion of a plane arc to a 3D surface, why else define
> this vector in the context of an object rather than in the context of an
> extrusion command?
> I'm still unsure of the meaning of this thing. and haven't found docs to
> support the notion that the sweep might be intended.
> And even if it is, I haven't seen the codes in the dxf files I worked with
> sofar.
>
> Anyway:
> The codes are 210, 220, 230 (x,y,z) and by default 0.0,0.0,1.0. Setting
> this to 0.0,0.0,-1.0 made the arc invisible in Qgis and in the ogr2ogr
> produced shapefile.
> When I have time I'll look more into the gdal sources, but it looks like I
> need to handle this problem where it arises using my own linestring
> dissolve routine.
>
> Thanks,
> Jan
>
>
> On Sun, Feb 25, 2024 at 10:13?PM Even Rouault <even.rouault at spatialys.com>
> wrote:
>
>> Please file an issue with a (as small as possible) .dxf file reproducing
>> the issue
>>
>> Even
>> Le 25/02/2024 ? 22:05, Jan Heckman a ?crit :
>>
>> Hi Even, all,
>> There might be a slight connection, but my case imo does not involve
>> either a bulgefactor or a smoothing routine;
>> it is the basic conversion/render of a circular arc where apparently
>> start- and endangle are interchanged sofar without apparent cause.
>> Possibly the dxf has, earlier on, something which influences (rightly or
>> wrongly) the clockwise setting/bool seen in this type of driver function.
>> So I'll first try to find any global setting in the dxf which might
>> encourage clockwise circle handling instead of default anti-clockwise.
>> As an afterthought, this cannot be the case as then the arc would have
>> been drawn in the other direction, giving a very large arc instead of a
>> smallish one.
>> As I said earlier, the correct arc is used but with the (imo) wrong
>> orientation/sequence of the vertices.
>> Jan
>>
>>
>> On Sun, Feb 25, 2024 at 2:08?PM Even Rouault <even.rouault at spatialys.com>
>> wrote:
>>
>>> Hi,
>>>
>>> I'm wondering if there woulnd't be a connection with
>>> https://github.com/OSGeo/gdal/issues/1839#issuecomment-537185826 ?
>>>
>>> Even
>>>
>>> Le 25/02/2024 ? 13:32, Jan Heckman via gdal-dev a ?crit :
>>> > Hi all,
>>> > Sorry for a somewhat long post, but here we go:
>>> > I am converting a .dxf having a sequence of simple lines and arcs
>>> > which form a continuous (poly)line, (correctly) ordered by
>>> > EntityHandle. The arcs are converted (to shp) as well as displayed
>>> > (Qgis) in the opposite direction as the simple lines. Checking the
>>> > codes and docs, this appears wrong.
>>> > Below the minimal relevant information, I can add the complete .dxf,
>>> > but I think attached files are frowned upon?
>>> >
>>> > Docs cited:
>>> >
>>> https://help.autodesk.com/view/OARX/2024/ENU/?guid=GUID-0B14D8F1-0EBA-44BF-9108-57D8CE614BC8
>>> > ARC (DXF)
>>> > The following group codes apply to arc entities.
>>> > Arc group codes
>>> > Group code Description
>>> > 100 Subclass marker (AcDbCircle)
>>> > 39 Thickness (optional; default = 0)
>>> > 10 Center point (in OCS) DXF: X value; APP: 3D point
>>> > 20, 30 DXF: Y and Z values of center point (in OCS)
>>> > 40 Radius
>>> > 100 Subclass marker (AcDbArc)
>>> > 50 Start angle
>>> > 51 End angle
>>> > 210 Extrusion direction (optional; default = 0, 0, 1) DXF: X value;
>>> > APP: 3D vector
>>> > 220, 230 DXF: Y and Z values of extrusion direction (optional)
>>> >
>>> > https://ezdxf.readthedocs.io/en/stable/tutorials/dxf_primitives.html
>>> > The arc goes always in counter-clockwise orientation around the z-axis
>>> > more precisely the extrusion vector of OCS, but this is beyond the
>>> > scope of this tutorial.
>>> >
>>> > The case (extracted, whole .dxf file available):
>>> > AcDbEntity
>>> >   8
>>> > 0000-001_09_AND1N
>>> >   6
>>> > Continuous
>>> >  62
>>> >     18
>>> > 100
>>> > AcDbCircle
>>> >  10
>>> > 130974.661837
>>> >  20
>>> > 497502.478468
>>> >  30
>>> > 0.0
>>> >  40
>>> > 7576.094430000001
>>> > 100
>>> > AcDbArc
>>> >  50
>>> > 305.5444330000001
>>> >  51
>>> > 344.795475
>>> >   0
>>> > LINE
>>> >   5
>>> > 2E
>>> > 330
>>> > 1A0
>>> > 100
>>> >
>>> > The arc is converted (.shp) and drawn (qgis) from end angle to start
>>> > angle, without a 210 code to alter default behavior, which obviously
>>> > is the other way around, noting counter clock around (positive) Z-axis.
>>> > The applicability of this convention also follows from the (correct)
>>> > position of the arc in the conversion and drawing.
>>> > Only begin- and endpoints are interchanged.
>>> >
>>> > Please advice,
>>> > Thanks in advance,
>>> > Jan
>>> >
>>> > _______________________________________________
>>> > gdal-dev mailing list
>>> > gdal-dev at lists.osgeo.org
>>> > https://lists.osgeo.org/mailman/listinfo/gdal-dev
>>>
>>> --
>>> http://www.spatialys.com
>>> My software is free, but my time generally not.
>>>
>>> -- http://www.spatialys.com
>> My software is free, but my time generally not.
>>
>> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/4df7d436/attachment.htm>

From a.pau at creaf.uab.cat  Tue Feb 27 11:44:58 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Tue, 27 Feb 2024 19:44:58 +0000
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <PAXPR07MB7775D5DE5BF61014F88199ECA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <81432c48-c54e-4d25-8772-8032995d6043@spatialys.com>
 <PAXPR07MB777587346A024CF0CD98ACFBA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB77750D19A12C6E6B94B1D80FA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <3c88271e-981e-4f1e-8fab-7c655f9aed75@spatialys.com>
 <PAXPR07MB77755EBDA32F91C5404B45E6A25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775B25A9FC47D7214791395A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKupe0Td-Bmk98a4_cq7O2_feg7PMeJse0ONTy8=SVi_BA@mail.gmail.com>
 <PAXPR07MB7775CD1A61D1BB9D580D3CEBA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKvWFz4Hm6+K_6xqYWXpPLMhDyvfcH8nEiOEv0daPjPzKg@mail.gmail.com>
 <PAXPR07MB77751C06354941407E34E775A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775EE6D6F3BF2FF0375B58EA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKusO5FVoAtKhdZ9GW_exJBSzuZtWeTd_u-8-GSTJZmTVA@mail.gmail.com>
 <PAXPR07MB7775338978B4A5D51B9D3163A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <AM0PR02MB577733F7B0F4119D3F0AA3FC93592@AM0PR02MB5777.eurprd02.prod.outlook.com>
 <PAXPR07MB7775FA584E53631E8DFD6ED4A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775747F8CDEAB9B2ABFA8EAA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775D5DE5BF61014F88199ECA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <PAXPR07MB7775A976760E9E6BEF156D6DA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>

Hi Stefan,
thanks for the answer.

In my case the gdald.dll with the recent date from my last compilation is created directly to build\Debug and not to build\apps\Debug (the date it?s older, but not much older, it?s from this morning (??)).
Are you sure that your sense of copy is FROM build\apps\Debug  TO build\Debug?

And ogr2ogr.exe is loading the one in apps as you can see looking at this dependencies view (using a simple program called depends.exe).

[cid:image001.png at 01DA69BD.D2F814E0]

Once I copy this gdald.dll FROM ?no app? to ?app? directory IT WORKS.
So, your clue has make it work!

So, now my question is ?why are there two directories where gdald.dll is??.

Today, you've really helped me out of a tight spot. Thanks a lot! And thanks to the other that read and answered!!!


De: Uhrig, Stefan <stefan.uhrig at sap.com<mailto:stefan.uhrig at sap.com>>
Enviado el: dimarts, 27 de febrer de 2024 16:50
Para: gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
CC: Abel Pau <a.pau at creaf.uab.cat<mailto:a.pau at creaf.uab.cat>>
Asunto: RE: [gdal-dev] Some problems after updating

Hi Abel,

I did a Windows Debug build from scratch using the current GDAL head and the current vcpkg head. I could execute ogr2ogr without a problem, but I had to copy it over from build/apps/Debug to build/Debug where the gdald.dll is located.

My guess is that your ogr2ogr is not loading the gdald.dll you built but another gdald.dll, maybe the one that vcpkg built. In the directory in which ogr2ogr.exe is located, execute the following command to find out which gdald.dll is actually loaded by ogr2ogr:

where gdald.dll

This should point to the gdald you built, but I?d assume that it points to another gdald.dll.

Best regards,
Stefan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/d6cdf37c/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.png
Type: image/png
Size: 6995 bytes
Desc: image001.png
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/d6cdf37c/attachment-0001.png>

From even.rouault at spatialys.com  Tue Feb 27 11:48:17 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 27 Feb 2024 20:48:17 +0100
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <PAXPR07MB7775A976760E9E6BEF156D6DA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775CD1A61D1BB9D580D3CEBA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKvWFz4Hm6+K_6xqYWXpPLMhDyvfcH8nEiOEv0daPjPzKg@mail.gmail.com>
 <PAXPR07MB77751C06354941407E34E775A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775EE6D6F3BF2FF0375B58EA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKusO5FVoAtKhdZ9GW_exJBSzuZtWeTd_u-8-GSTJZmTVA@mail.gmail.com>
 <PAXPR07MB7775338978B4A5D51B9D3163A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <AM0PR02MB577733F7B0F4119D3F0AA3FC93592@AM0PR02MB5777.eurprd02.prod.outlook.com>
 <PAXPR07MB7775FA584E53631E8DFD6ED4A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775747F8CDEAB9B2ABFA8EAA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775D5DE5BF61014F88199ECA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775A976760E9E6BEF156D6DA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
Message-ID: <1e1359fa-d2ea-4a75-932a-45eb393fb20d@spatialys.com>


Le 27/02/2024 ? 20:44, Abel Pau via gdal-dev a ?crit?:
>
> Hi Stefan,
>
> thanks for the answer.
>
> In my case the gdald.dll with the recent date from my last compilation 
> is created directly to build\Debug and not to build\apps\Debug (the 
> date it?s older, but not much older, it?s from this morning (??)).
>
I don't think that a gdal[d].dll file in apps\Debug would be produced by 
the GDAL build process itself. That was probably a manual stalled copy 
from previous builds. I'd recommend avoiding copying files manually as 
that's prone to get out of control and just adjust the PATH.

-- 
http://www.spatialys.com
My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/b4fa8a54/attachment.htm>

From a.pau at creaf.uab.cat  Tue Feb 27 11:52:44 2024
From: a.pau at creaf.uab.cat (Abel Pau)
Date: Tue, 27 Feb 2024 19:52:44 +0000
Subject: [gdal-dev] Some problems after updating
In-Reply-To: <1e1359fa-d2ea-4a75-932a-45eb393fb20d@spatialys.com>
References: <PAXPR07MB77756048B2FB463C6A0E2B5AA25A2@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775CD1A61D1BB9D580D3CEBA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKvWFz4Hm6+K_6xqYWXpPLMhDyvfcH8nEiOEv0daPjPzKg@mail.gmail.com>
 <PAXPR07MB77751C06354941407E34E775A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775EE6D6F3BF2FF0375B58EA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <CADRrdKusO5FVoAtKhdZ9GW_exJBSzuZtWeTd_u-8-GSTJZmTVA@mail.gmail.com>
 <PAXPR07MB7775338978B4A5D51B9D3163A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <AM0PR02MB577733F7B0F4119D3F0AA3FC93592@AM0PR02MB5777.eurprd02.prod.outlook.com>
 <PAXPR07MB7775FA584E53631E8DFD6ED4A2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775747F8CDEAB9B2ABFA8EAA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775D5DE5BF61014F88199ECA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <PAXPR07MB7775A976760E9E6BEF156D6DA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>
 <1e1359fa-d2ea-4a75-932a-45eb393fb20d@spatialys.com>
Message-ID: <PAXPR07MB77753675F0E9DAE8C0607BDBA2592@PAXPR07MB7775.eurprd07.prod.outlook.com>

HI,
I?m pretty sure (perhaps I?m wrong) that before building the project I?ve deleted the folder buid.
But later I?ll do it again taking care of that and adjusting the PATH from D:\GitHub-repository\GDAL\build\Debug to D:\GitHub-repository\GDAL\build\apps\Debug

A good clue also this wrong PATH! Thanks again!

De: Even Rouault <even.rouault at spatialys.com>
Enviado el: dimarts, 27 de febrer de 2024 20:48
Para: Abel Pau <a.pau at creaf.uab.cat>; Uhrig, Stefan <stefan.uhrig at sap.com>; gdal-dev at lists.osgeo.org
Asunto: Re: [gdal-dev] Some problems after updating



Le 27/02/2024 ? 20:44, Abel Pau via gdal-dev a ?crit :
Hi Stefan,
thanks for the answer.

In my case the gdald.dll with the recent date from my last compilation is created directly to build\Debug and not to build\apps\Debug (the date it?s older, but not much older, it?s from this morning (??)).

I don't think that a gdal[d].dll file in apps\Debug would be produced by the GDAL build process itself. That was probably a manual stalled copy from previous builds. I'd recommend avoiding copying files manually as that's prone to get out of control and just adjust the PATH.

--

http://www.spatialys.com

My software is free, but my time generally not.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240227/d9c36320/attachment-0001.htm>

From howard at hobu.co  Tue Feb 27 13:29:53 2024
From: howard at hobu.co (Howard Butler)
Date: Tue, 27 Feb 2024 15:29:53 -0600
Subject: [gdal-dev] GDAL Maintainers Meeting Minutes
Message-ID: <AA2E542D-0BB0-4CB2-BA6F-2BEFC83B750F@hobu.co>

Howard Butler, Even Rouault, Dan Baston, Javier Jiminez Shaw, and Alessandro Pasotti held the monthly GDAL Maintainers Meeting on 02/22/2024. The following items were discussed and reported upon:

Sponsorship Updates
-------------------------------

* Google's Silver sponsorship was applied to NumFOCUS again for 2024 in January
* Satelligence joined at Supporter level

Discussion Items
----------------------------

* GDAL 3.9.0 is expected in May 2024
* Migration of gdal.org <http://gdal.org/> to ReadTheDocs ? proj.org <http://proj.org/> has migrated to RTD, and it would be beneficial for gdal.org <http://gdal.org/> to follow. The biggest benefit would be convenient multi-version docs. Some kind of coordinated DNS move and outage would be required, with no timeline set to start at this time.

Maintenance activities update
------------------------------------------

Dan

* Fixed derived raster bands in VRTs
* Documentation improvements ? docstrings in Python bindings , added contribution instructions
* Reorganized Python API docs
* More work on Python test order independence (tantalizingly close)
* Automating of test semi-private or unknown provenance test data ? around 30 data sets are not publicly available but are pointed at in tests.

Alessandro

* GDAL PR reviews
* Primarily QGIS release preparation

Even

* OGDI 4.1.1 was released (the first in nearly five years!) See https://github.com/libogdi/ogdi/releases/tag/ogdi_4_1_1 for more information
* GDAL 3.8.4 was released. See https://github.com/OSGeo/gdal/blob/v3.8.4/NEWS.md for more information. 
* Wrote RFC99 and provided preliminary implementation to address management and bookkeeping of coordinate precision in OGR drivers that can leverage it. See https://github.com/rouault/gdal/blob/rfc99_text/doc/source/development/rfc/rfc99_geometry_coordinate_precision.rst for discussion
* Facilitated the release of OpenJPEG 2.5.1. See https://github.com/uclouvain/openjpeg/releases/tag/v2.5.1 for more information
* Action on over 40 tickets and PRs

The next GDAL Maintainers Meeting is 03/28/2024 at 9:00 EDT. Any PSC members are welcome to join by reaching out to me for an invite.

Howard

From michael.otto at data-experts.de  Wed Feb 28 01:51:45 2024
From: michael.otto at data-experts.de (Michael Otto)
Date: Wed, 28 Feb 2024 10:51:45 +0100
Subject: [gdal-dev] Antwort: Antwort: Antwort: Re: Segmentation fault (core
 dumped) in gdal_translate & ogrinfo & ogr2ogr
In-Reply-To: <OFBB9BA553.E3CA8300-ONC1258AD0.004A0EB0-C1258AD0.004CC68A@data-experts.de>
References: <OF42961102.2BD1B79F-ONC1258AD0.00396C01-C1258AD0.004026FC@data-experts.de>
 <CAFLLRpJcKmc7mVyMnx5vb3DbE9b73PCmtGqecaTJZ9BHcgKzjw@mail.gmail.com>
 <OF951CDF5A.1C53ECC0-ONC1258AD0.0046E5F7-C1258AD0.0047918D@data-experts.de>
 <OFBB9BA553.E3CA8300-ONC1258AD0.004A0EB0-C1258AD0.004CC68A@data-experts.de>
Message-ID: <OF079B5D43.01223A5F-ONC1258AD1.0034C814-C1258AD1.00362C49@data-experts.de>

Hello,

I have now tested the static GDAL tools under Oracle 9, RHEL 9 and SLES 
15. 
Under all distributions there were problems with the certificates when 
using ogrinfo.

ERROR 1: error setting certificate file: 
/etc/ssl/certs/ca-certificates.crt
ERROR 1: Error returned by server : error setting certificate file: 
/etc/ssl/certs/ca-certificates.crt (77)

It looks like gdal is looking for the certificates in a place that does 
not exist on these systems.
Is this possibly because I built GDAL under Linux Mint (Ubuntu) and now 
want to run it on a "completely different" system?

I have been able to solve the problem using a symbolic link to the correct 
certificates, but I would still like to know what the problem is.

Michael




Von:    "Michael Otto via gdal-dev" <gdal-dev at lists.osgeo.org>
An:     "Robert Coup" <robert.coup at koordinates.com>
Kopie:  gdal-dev at lists.osgeo.org, "gdal-dev" 
<gdal-dev-bounces at lists.osgeo.org>
Datum:  27.02.2024 14:58
Betreff:        [gdal-dev] Antwort: Antwort: Re: Segmentation fault (core 
dumped) in gdal_translate & ogrinfo & ogr2ogr
Gesendet von:   "gdal-dev" <gdal-dev-bounces at lists.osgeo.org>



Hello Robert,

I'm moving on.

I solved the problem with the missing certificates as follows.

$ apt update
$ apt upgrade

$ rm -f /etc/ssl/certs/ca-bundle.crt
$ apt reinstall ca-certificates
$ update-ca-certificates 

Now it also works under Ubuntu 20.04 ;o).

And the test continues.

Michael




Von:        "Michael Otto via gdal-dev" <gdal-dev at lists.osgeo.org>
An:        "Robert Coup" <robert.coup at koordinates.com>
Kopie:        gdal-dev at lists.osgeo.org
Datum:        27.02.2024 14:02
Betreff:        [gdal-dev] Antwort: Re: Segmentation fault (core dumped) 
in gdal_translate & ogrinfo & ogr2ogr
Gesendet von:        "gdal-dev" <gdal-dev-bounces at lists.osgeo.org>



Hello Robert,

I have now been able to find the error myself.

I forgot to set the proxy in the Docker container. After I added it, it 
also worked under Fedora.

Now I'm stuck under Ubuntu 20.04. There comes the next error :o( :

ERROR 1: error setting certificate file: 
/etc/ssl/certs/ca-certificates.crt
ERROR 1: Error returned by server : error setting certificate file: 
/etc/ssl/certs/ca-certificates.crt (77)
ogrinfo failed - unable to open 'WFS:https://........'.

Michael

PS:
I built Gdal under Linux Mint 21.3 (Virginia).
The host system for the Docker containers is Ubuntu 22.04.3 LTS (Jammy 
Jellyfish).




Von:        "Robert Coup" <robert.coup at koordinates.com>
An:        "Michael Otto" <michael.otto at data-experts.de>
Kopie:        gdal-dev at lists.osgeo.org
Datum:        27.02.2024 13:14
Betreff:        Re: [gdal-dev] Segmentation fault (core dumped) in 
gdal_translate & ogrinfo & ogr2ogr



Hi Michael,

On Tue, 27 Feb 2024 at 11:40, Michael Otto via gdal-dev <
gdal-dev at lists.osgeo.org> wrote:

with a lot of effort and support from this group I created a first static 
version of GDAL (incl. the apps) under Linux x64 using vcpkg.

Yay

For testing I copied the built apps and the data files to different target 
platforms and set the environment variables accordingly.
In a current Linux Mint VM and in an Alpine Linux 3.13 Docker container, 
the command line calls worked perfectly.

What system did you build gdal on/under?

Under a Fedora Linux 39 Docker container (docker pull fedora, ...) an 
error occurs when executing ogrinfo, ogr2ogr and gdal_translate (the other 
tools were not tested):

What's the host OS?


>> Segmentation fault (core dumped)

Does anyone have an idea or know what the problem is?

What does a backtrace from gdb produce?

$ gdb --args ogrinfo 
... loading stuff
(gdb) run
...
Program received signal SIGSEGV, Segmentation fault.
0x12c0ffee in _a_function ()
(gdb) thread apply all backtrace
... the backtrace ...
(gdb) quit

Use the gdal tools from the installed/{platform}/tools/gdal/debug/vcpkg 
build folder, they're more likely to produce readable traces.

Rob :)


_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev

_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org
https://lists.osgeo.org/mailman/listinfo/gdal-dev



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240228/5e1c99ef/attachment.htm>

From robert.coup at koordinates.com  Wed Feb 28 03:56:42 2024
From: robert.coup at koordinates.com (Robert Coup)
Date: Wed, 28 Feb 2024 11:56:42 +0000
Subject: [gdal-dev] Antwort: Antwort: Re: Segmentation fault (core
 dumped) in gdal_translate & ogrinfo & ogr2ogr
In-Reply-To: <OF079B5D43.01223A5F-ONC1258AD1.0034C814-C1258AD1.00362C49@data-experts.de>
References: <OF42961102.2BD1B79F-ONC1258AD0.00396C01-C1258AD0.004026FC@data-experts.de>
 <CAFLLRpJcKmc7mVyMnx5vb3DbE9b73PCmtGqecaTJZ9BHcgKzjw@mail.gmail.com>
 <OF951CDF5A.1C53ECC0-ONC1258AD0.0046E5F7-C1258AD0.0047918D@data-experts.de>
 <OFBB9BA553.E3CA8300-ONC1258AD0.004A0EB0-C1258AD0.004CC68A@data-experts.de>
 <OF079B5D43.01223A5F-ONC1258AD1.0034C814-C1258AD1.00362C49@data-experts.de>
Message-ID: <CAFLLRpL_62QmxdWgg6QyPePqmGTzvUMsTXwu2QkKqB7AOPZsMw@mail.gmail.com>

Hi,

On Wed, 28 Feb 2024 at 09:51, Michael Otto <michael.otto at data-experts.de>
wrote:

> Under all distributions there were problems with the certificates when
> using ogrinfo.
>
> ERROR 1: error setting certificate file: /etc/ssl/certs/ca-certificates.crt
> ERROR 1: Error returned by server : error setting certificate file:
> /etc/ssl/certs/ca-certificates.crt (77)
>
> It looks like gdal is looking for the certificates in a place that does
> not exist on these systems.
> Is this possibly because I built GDAL under Linux Mint (Ubuntu) and now
> want to run it on a "completely different" system?


Yes. Portability isn't just code. :-)

It's Curl (and OpenSSL), not GDAL. Curl has a set of build-time options,
and also some runtime options ($CURL_CA_BUNDLE) wrt locating the CA
certificate bundle.

You could ship your own CA certificate bundle and set CURL_CA_BUNDLE like
you set the GDAL_DATA path, or set it per-system, or compile curl to look
in a particular place by default.

Rob :)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20240228/6641e38c/attachment-0001.htm>

From even.rouault at spatialys.com  Wed Feb 28 05:41:57 2024
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 28 Feb 2024 14:41:57 +0100
Subject: [gdal-dev] OpenJPEG 2.5.2 released
Message-ID: <b6da6a58-099a-47fd-bb96-153f4320d2a9@spatialys.com>

Hi,

OpenJPEG 2.5.2 is released: 
https://github.com/uclouvain/openjpeg/releases/tag/v2.5.2

This is a bugfix-only release correcting an issue of 2.5.1 (openjpeg.h 
no longer including opj_config.h), as detailed in the Changelog hereunder.

More info:
News: https://github.com/uclouvain/openjpeg/blob/v2.5.2/NEWS.md
Changelog: https://github.com/uclouvain/openjpeg/blob/v2.5.2/CHANGELOG.md
Full Changelog: 
https://github.com/uclouvain/openjpeg/compare/v2.5.0...v2.5.2

Enjoy,

Even

-- 
http://www.spatialys.com
My software is free, but my time generally not.


