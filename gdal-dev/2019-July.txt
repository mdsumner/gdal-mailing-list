From cesarengenheiro1 at hotmail.com  Mon Jul  1 01:56:49 2019
From: cesarengenheiro1 at hotmail.com (Cesar Francisco de Paula)
Date: Mon, 1 Jul 2019 08:56:49 +0000
Subject: [gdal-dev] Extracting Z coordinate from DEM - Python
Message-ID: <MN2PR18MB27652D839C7538C16F8D71C686F90@MN2PR18MB2765.namprd18.prod.outlook.com>

Hi!!!



Im writing an algorithm in Python to extract Z coordinate of an DEM for a pair of X,Y coordinates. Im using GDAL. The algorithm works correctly by extracting the Z coordinate from the DEM.

Z = 1872 limiar = 0.00001
COORD_X = []
COORD_Y = []
for i in range(size):
print()
print()
print()
X = Xcp + (Z - Zcp) * (((m11 * xf[i]) + (m21 * yf[i]) - (m31 * focal)) / ((m13 * xf[i]) + (m23 * yf[i]) - (m33 * focal)))

Y = Ycp + (Z - Zcp) * (((m12 * xf[i]) + (m22 * yf[i]) - (m32 * focal)) / ((m13 * xf[i]) + (m23 * yf[i]) - (m33 * focal)))

rasterx = int((X - gt[0]) / gt[1])
rastery = int((Y - gt[3]) / gt[5])
Z_dem = float(layer.GetRasterBand(1).ReadAsArray(rasterx, rastery, 1, 1))
a = abs(Z_dem - Z)

Until this part of the algorithm everything works properly. In sequence I need to enter a condition to compare the result of the variable "a" with variable "limiar" and when I enter the conditional in the algorithm and try to execute, the python returns an error in line referring to "Z_dem".

    if (a < limiar):
    COORD_X.append(X)
    COORD_Y.append(Y)
    else:
    Z = Z_dem

Error on Python:

File "C:/Users/cesar/OneDrive/Projeto_RGB/Monorestituicao_v01.py", line 106, in Z_dem = float(layer.GetRasterBand(1).ReadAsArray(rasterx, rastery, 1, 1)) TypeError: float() argument must be a string or a number, not 'NoneType'


I don't understand this error because the value on "Z_dem" is a float and not "NoneType".


Can someone assist please?

Kind Regards.

César de Paula





















Enviado do Outlook<http://aka.ms/weboutlook>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190701/a8dbe0c9/attachment-0001.html>

From caboe at sdfe.dk  Mon Jul  1 02:15:35 2019
From: caboe at sdfe.dk (=?utf-8?B?Q2FzcGVyIELDuHJnZXNlbg==?=)
Date: Mon, 1 Jul 2019 09:15:35 +0000
Subject: [gdal-dev] UnionCascaded operation failed
In-Reply-To: <CAJKO1Yv_XAZnTOXocPH=i6J-xA0fpvyS5eWHpjs=g5ougZAMpA@mail.gmail.com>
References: <CAJKO1YswCy=j7RFiP2cfRyeL+_N=pSary1SZC24k=Si_XoJDfQ@mail.gmail.com>
 <800A1C4B99390947B3BAA86C02CBDB26180908FB@S000014.PROD.SITAD.DK>
 <CAJKO1Ys1FFH93A+hs5z5d3hadsXao2RuGpHNWgN4w5+UGxi=Ag@mail.gmail.com>
 <CAJKO1Yv_XAZnTOXocPH=i6J-xA0fpvyS5eWHpjs=g5ougZAMpA@mail.gmail.com>
Message-ID: <800A1C4B99390947B3BAA86C02CBDB2618091AB6@S000014.PROD.SITAD.DK>

Hi Ahmet

I haven’t visited C++ and ogr for quite some time, but I think you should define and initialize polyCollect like this:

OGRMultiPolygon *polyCollect = new OGRMultiPolygon();

This type should implement the UnionCascaded() method.

Maybe other users on the list can chime in?

/Casper

From: Ahmet Temiz <ahmettemiz88 at gmail.com>
Sent: 1. juli 2019 09:04
To: Casper Børgesen <caboe at sdfe.dk>
Subject: Re: [gdal-dev] UnionCascaded operation failed

Hi,

It is geometry list indeed as:
 std::vector<OGRPolygon * > polyCollect ;

I converted it to OGRMultiPolygon
But
 OGRGeometry *result=polyCollect.UnionCascaded();  // ???
still failed


On Mon, Jul 1, 2019 at 8:55 AM Ahmet Temiz <ahmettemiz88 at gmail.com<mailto:ahmettemiz88 at gmail.com>> wrote:
Ok, thanks.

On Mon, Jul 1, 2019 at 8:39 AM Casper Børgesen <caboe at sdfe.dk<mailto:caboe at sdfe.dk>> wrote:
A very quick guess would be that you have changed the polyCollect type from a geometry type to a list of geometries. I don’t think the list of geometries has a UnionCascaded method. I would probably go for a polyCollect geometry type of MultiPolygon instead of the list/vector, that way you should be able to run the UnionCascaded method.

/Casper

From: gdal-dev <gdal-dev-bounces at lists.osgeo.org<mailto:gdal-dev-bounces at lists.osgeo.org>> On Behalf Of Ahmet Temiz
Sent: 29. juni 2019 19:47
To: gdal-dev <gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>>
Subject: [gdal-dev] UnionCascaded operation failed

Hi,

Using C++ I try to buffers from LineStrings,Then I want to union the
resulting polygons with UnionCascaded.
But at UnionCascaded operation failed with:
"error: ‘class std::vector<OGRPolygon*>’ has no member named ‘UnionCascaded’
     OGRGeometry *result=polyCollect.UnionCascaded();
"
Can you tell me what I am doing wrong?

here is the related code fragment:

    std::vector<OGRPolygon * > polyCollect ;
    //OGRGeometryCollection *polyCollect ;

    while( (poFeature = poLayer->GetNextFeature()) != NULL )
    {

        OGRGeometry *poGeometry = poFeature->GetGeometryRef();

        if( poGeometry != NULL
                && wkbFlatten(poGeometry->getGeometryType()) == wkbLineString )
        {
            OGRLineString *poLine = (OGRLineString *) poGeometry;
   //
            OGRGeometry *bufGeometry = poLine->Buffer(100,30);
   OGRPolygon *bufPoly=  static_cast<OGRPolygon *> (bufGeometry) ;
            printf( "%s \n", bufPoly->getGeometryName());

   //polyCollect->addGeometryDirectly (bufPoly );
            polyCollect.push_back(bufPoly );
        }
        else
        {
            printf( "no point geometry\n" );
        }

        OGRFeature::DestroyFeature( poFeature );
    }

    OGRGeometry *result=polyCollect.UnionCascaded();

--
Ahmet Temiz
Jeoloji Müh.
Afet ve Acil Durum Yönetimi Başkanlığı
Bilgi İşlem  Dairesi Başkanlığı-CBS Grubu


________________________

Ahmet Temiz
Geological Eng.
Information Systems - GIS Group
Disaster and Emergency Management
of Presidency


--
Ahmet Temiz
Jeoloji Müh.
Afet ve Acil Durum Yönetimi Başkanlığı
Bilgi İşlem  Dairesi Başkanlığı-CBS Grubu


________________________

Ahmet Temiz
Geological Eng.
Information Systems - GIS Group
Disaster and Emergency Management
of Presidency


--
Ahmet Temiz
Jeoloji Müh.
Afet ve Acil Durum Yönetimi Başkanlığı
Bilgi İşlem  Dairesi Başkanlığı-CBS Grubu


________________________

Ahmet Temiz
Geological Eng.
Information Systems - GIS Group
Disaster and Emergency Management
of Presidency
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190701/68f3393d/attachment.html>

From ivan.lucena at outlook.com  Mon Jul  1 05:27:12 2019
From: ivan.lucena at outlook.com (Ivan Lucena)
Date: Mon, 1 Jul 2019 12:27:12 +0000
Subject: [gdal-dev] Extracting Z coordinate from DEM - Python
In-Reply-To: <MN2PR18MB27652D839C7538C16F8D71C686F90@MN2PR18MB2765.namprd18.prod.outlook.com>
References: <MN2PR18MB27652D839C7538C16F8D71C686F90@MN2PR18MB2765.namprd18.prod.outlook.com>
Message-ID: <BN6PR2201MB12494B188D072AC8BAD248C6F2F90@BN6PR2201MB1249.namprd22.prod.outlook.com>

César,

The error message you posted indicated that the function float() received a NoneType argument and you have a call to ReadAsArray inside float(), so I guess that ReadAsArray has failed without an exception. Maybe you tried to read from an area outside the image.

You might want to call gdal.UseException() at the beginning of you code to get the GDAL exceptions to work. That should crash your code before calling float() but with some kind of error message. See more on this wiki page:

https://trac.osgeo.org/gdal/wiki/PythonGotchas

Cheers,

Ivan




________________________________
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Cesar Francisco de Paula <cesarengenheiro1 at hotmail.com>
Sent: Monday, July 1, 2019 4:56 AM
To: gdal-dev at lists.osgeo.org
Subject: [gdal-dev] Extracting Z coordinate from DEM - Python

Hi!!!



Im writing an algorithm in Python to extract Z coordinate of an DEM for a pair of X,Y coordinates. Im using GDAL. The algorithm works correctly by extracting the Z coordinate from the DEM.

Z = 1872 limiar = 0.00001
COORD_X = []
COORD_Y = []
for i in range(size):
print()
print()
print()
X = Xcp + (Z - Zcp) * (((m11 * xf[i]) + (m21 * yf[i]) - (m31 * focal)) / ((m13 * xf[i]) + (m23 * yf[i]) - (m33 * focal)))

Y = Ycp + (Z - Zcp) * (((m12 * xf[i]) + (m22 * yf[i]) - (m32 * focal)) / ((m13 * xf[i]) + (m23 * yf[i]) - (m33 * focal)))

rasterx = int((X - gt[0]) / gt[1])
rastery = int((Y - gt[3]) / gt[5])
Z_dem = float(layer.GetRasterBand(1).ReadAsArray(rasterx, rastery, 1, 1))
a = abs(Z_dem - Z)

Until this part of the algorithm everything works properly. In sequence I need to enter a condition to compare the result of the variable "a" with variable "limiar" and when I enter the conditional in the algorithm and try to execute, the python returns an error in line referring to "Z_dem".

    if (a < limiar):
    COORD_X.append(X)
    COORD_Y.append(Y)
    else:
    Z = Z_dem

Error on Python:

File "C:/Users/cesar/OneDrive/Projeto_RGB/Monorestituicao_v01.py", line 106, in Z_dem = float(layer.GetRasterBand(1).ReadAsArray(rasterx, rastery, 1, 1)) TypeError: float() argument must be a string or a number, not 'NoneType'


I don't understand this error because the value on "Z_dem" is a float and not "NoneType".


Can someone assist please?

Kind Regards.

César de Paula





















Enviado do Outlook<http://aka.ms/weboutlook>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190701/71047138/attachment-0001.html>

From TomW at msc.qld.gov.au  Mon Jul  1 18:54:41 2019
From: TomW at msc.qld.gov.au (Wardrop)
Date: Mon, 1 Jul 2019 18:54:41 -0700 (MST)
Subject: [gdal-dev] Connecting to MSSQL from linux using OGR?
Message-ID: <1562032481815-0.post@n6.nabble.com>

Hi All,

I'm trying to connect a MSSQL database using ogrinfo and ogr2ogr, but am not
having any success. Most of the examples I see online assume you're
connecting from a Windows. I'm trying to connect from OpenSUSE. Here's what
I've been trying:

ogrinfo
"MSSQL:server=sql12.msc.local\MSSQLSERVER;database=GIS;UID=sa;PWD=<blanked>;"

That results in:

FAILURE:
Unable to open datasource
`MSSQL:server=sql12.msc.local\MSSQLSERVER;database=GIS;UID=sa;PWD=<blanked>;'
with the following drivers.
  -> JP2ECW
  -> OCI
  -> SOSI
  -> ...

I've tried specifying various "drivers" by appending for example
";driver=FreeTDS". The error is always the same, and returns instantly. It's
like the connection string isn't even making it to the MSSQLSpatial OGR
driver. Is this even meant to work on linux? I'm at a complete loss.





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From TomW at msc.qld.gov.au  Mon Jul  1 19:03:38 2019
From: TomW at msc.qld.gov.au (Tom Wardrop)
Date: Tue, 2 Jul 2019 02:03:38 +0000
Subject: [gdal-dev] Connecting to MSSQL from linux using OGR?
In-Reply-To: <002401d5307a$128a3b10$379eb130$@frogmouth.net>
References: <1562032481815-0.post@n6.nabble.com>
 <002401d5307a$128a3b10$379eb130$@frogmouth.net>
Message-ID: <9AEC656D12E120409D4F1138358D4A93B0477128@MAIL01.msc.local>

Hey Brad,

Yeah it lists "MSSQLSpatial -vector- (rw+): Microsoft SQL Server Spatial Database" in the output.

Tom


________________________________

Mareeba Shire Council Disclaimer

This message and any attachments may contain privileged and confidential information intended only for the use of the intended addressee(s). Any unauthorised use of this material is prohibited. If you received this message in error please notify the sender immediately, delete the message and destroy any printed or electronic copies. Opinions expressed in this e-mail are those of the sender and do not necessarily represent the views of the Mareeba Shire Council. Council does not accept any responsibility for the loss or damage that may result from reliance on, or the use of, any information contained in this e-mail or attachments.

We recommend that you scan this e-mail and any attachments for viruses before opening. This Council does not accept liability for any loss or damage incurred either directly or indirectly from opening this e-mail or any attachments to it.

From bradh at frogmouth.net  Mon Jul  1 19:01:32 2019
From: bradh at frogmouth.net (Brad Hards)
Date: Tue, 2 Jul 2019 12:01:32 +1000
Subject: [gdal-dev] Connecting to MSSQL from linux using OGR?
In-Reply-To: <1562032481815-0.post@n6.nabble.com>
References: <1562032481815-0.post@n6.nabble.com>
Message-ID: <002401d5307a$128a3b10$379eb130$@frogmouth.net>

Does your ogr actually support MSSQL driver? What does ogrinfo --formats show?

Brad



From jmckenna at gatewaygeomatics.com  Tue Jul  2 03:51:52 2019
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Tue, 2 Jul 2019 07:51:52 -0300
Subject: [gdal-dev] Connecting to MSSQL from linux using OGR?
In-Reply-To: <1562032481815-0.post@n6.nabble.com>
References: <1562032481815-0.post@n6.nabble.com>
Message-ID: <078f7202-1740-66a0-e002-758351860b6b@gatewaygeomatics.com>

Years ago I used FreeTDS library, but today the recommended way to 
connect is through the Microsoft ODBC library 
(https://docs.microsoft.com/en-us/sql/connect/odbc/linux-mac/installing-the-microsoft-odbc-driver-for-sql-server?view=sql-server-20170). 
  There was a recent discussion here on your same topic 
http://osgeo-org.1560.x6.nabble.com/gdal-dev-connect-mssql-from-linux-td5363547.html

-jeff



-- 
Jeff McKenna
MapServer Consulting and Training Services
https://gatewaygeomatics.com/



On 2019-07-01 10:54 PM, Wardrop wrote:
> Hi All,
> 
> I'm trying to connect a MSSQL database using ogrinfo and ogr2ogr, but am not
> having any success. Most of the examples I see online assume you're
> connecting from a Windows. I'm trying to connect from OpenSUSE. Here's what
> I've been trying:
> 
> ogrinfo
> "MSSQL:server=sql12.msc.local\MSSQLSERVER;database=GIS;UID=sa;PWD=<blanked>;"
> 
> That results in:
> 
> FAILURE:
> Unable to open datasource
> `MSSQL:server=sql12.msc.local\MSSQLSERVER;database=GIS;UID=sa;PWD=<blanked>;'
> with the following drivers.
>    -> JP2ECW
>    -> OCI
>    -> SOSI
>    -> ...
> 
> I've tried specifying various "drivers" by appending for example
> ";driver=FreeTDS". The error is always the same, and returns instantly. It's
> like the connection string isn't even making it to the MSSQLSpatial OGR
> driver. Is this even meant to work on linux? I'm at a complete loss.
> 
> 

From even.rouault at spatialys.com  Wed Jul  3 02:15:57 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 03 Jul 2019 11:15:57 +0200
Subject: [gdal-dev] Motions: promote GDAL 2.4.2 RC1 and GDAL 3.0.1 RC1 to
	final
Message-ID: <2561453.4Z3NASSlXS@even-i700>

Hi,

Motion 1: promote GDAL 2.4.2 RC1 to final
Motion 2: promote GDAL 3.0.1 RC1 to final

~~~~~

My votes:
Motion 1: +1
Motion 2: +1

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jmckenna at gatewaygeomatics.com  Wed Jul  3 04:15:37 2019
From: jmckenna at gatewaygeomatics.com (Jeff McKenna)
Date: Wed, 3 Jul 2019 08:15:37 -0300
Subject: [gdal-dev] Motions: promote GDAL 2.4.2 RC1 and GDAL 3.0.1 RC1
 to final
In-Reply-To: <2561453.4Z3NASSlXS@even-i700>
References: <2561453.4Z3NASSlXS@even-i700>
Message-ID: <1c1c0626-e089-6ff2-0b99-e58aece95b73@gatewaygeomatics.com>

On 2019-07-03 6:15 AM, Even Rouault wrote:
> Hi,
> 
> Motion 1: promote GDAL 2.4.2 RC1 to final
> Motion 2: promote GDAL 3.0.1 RC1 to final
> 


Motion 1: +1
Motion 2: +1


-jeff




From szekerest at gmail.com  Wed Jul  3 04:19:56 2019
From: szekerest at gmail.com (Tamas Szekeres)
Date: Wed, 3 Jul 2019 13:19:56 +0200
Subject: [gdal-dev] Motions: promote GDAL 2.4.2 RC1 and GDAL 3.0.1 RC1
	to final
In-Reply-To: <2561453.4Z3NASSlXS@even-i700>
References: <2561453.4Z3NASSlXS@even-i700>
Message-ID: <CACALY+SA5M61pCCLS+QnzwbzGQthoNd5JSSPBrm7hjHXnt4F1w@mail.gmail.com>

+1 for both.

Best regards,

Tamas


Even Rouault <even.rouault at spatialys.com> ezt írta (időpont: 2019. júl. 3.,
Sze, 11:16):

> Hi,
>
> Motion 1: promote GDAL 2.4.2 RC1 to final
> Motion 2: promote GDAL 3.0.1 RC1 to final
>
> ~~~~~
>
> My votes:
> Motion 1: +1
> Motion 2: +1
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190703/6a5103ca/attachment.html>

From howard at hobu.co  Wed Jul  3 11:16:01 2019
From: howard at hobu.co (Howard Butler)
Date: Wed, 3 Jul 2019 13:16:01 -0500
Subject: [gdal-dev] Motions: promote GDAL 2.4.2 RC1 and GDAL 3.0.1 RC1
 to final
In-Reply-To: <2561453.4Z3NASSlXS@even-i700>
References: <2561453.4Z3NASSlXS@even-i700>
Message-ID: <408234CC-C0A6-4084-A368-605B5F4E8630@hobu.co>



> On Jul 3, 2019, at 4:15 AM, Even Rouault <even.rouault at spatialys.com> wrote:
> 
> Motion 1: promote GDAL 2.4.2 RC1 to final

+1

> Motion 2: promote GDAL 3.0.1 RC1 to final

+1



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190703/ce6f6f72/attachment.html>

From dmorissette at mapgears.com  Wed Jul  3 11:25:13 2019
From: dmorissette at mapgears.com (Daniel Morissette)
Date: Wed, 3 Jul 2019 14:25:13 -0400
Subject: [gdal-dev] Motions: promote GDAL 2.4.2 RC1 and GDAL 3.0.1 RC1
 to final
In-Reply-To: <2561453.4Z3NASSlXS@even-i700>
References: <2561453.4Z3NASSlXS@even-i700>
Message-ID: <0775ff4e-a35a-9d51-cc3c-4aefa27a9a34@mapgears.com>

+1 to both.

Daniel

On 2019-07-03 05:15, Even Rouault wrote:
> Hi,
> 
> Motion 1: promote GDAL 2.4.2 RC1 to final
> Motion 2: promote GDAL 3.0.1 RC1 to final
> 
> ~~~~~
> 
> My votes:
> Motion 1: +1
> Motion 2: +1
> 
> Even
> 


-- 
Daniel Morissette
Mapgears Inc
T: +1 418-696-5056 #201

From jukka.rahkonen at maanmittauslaitos.fi  Wed Jul  3 13:34:38 2019
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Wed, 3 Jul 2019 13:34:38 -0700 (MST)
Subject: [gdal-dev] Motions: promote GDAL 2.4.2 RC1 and GDAL 3.0.1 RC1
 to final
In-Reply-To: <2561453.4Z3NASSlXS@even-i700>
References: <2561453.4Z3NASSlXS@even-i700>
Message-ID: <1562186078098-0.post@n6.nabble.com>

+1 for both

-Jukka Rahkonen-


Even Rouault-2 wrote
> Hi,
> 
> Motion 1: promote GDAL 2.4.2 RC1 to final
> Motion 2: promote GDAL 3.0.1 RC1 to final
> 
> ~~~~~
> 
> My votes:
> Motion 1: +1
> Motion 2: +1
> 
> Even





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From norman.barker at gmail.com  Wed Jul  3 13:57:11 2019
From: norman.barker at gmail.com (Norman Barker)
Date: Wed, 3 Jul 2019 15:57:11 -0500
Subject: [gdal-dev] Motions: promote GDAL 2.4.2 RC1 and GDAL 3.0.1 RC1
	to final
In-Reply-To: <2561453.4Z3NASSlXS@even-i700>
References: <2561453.4Z3NASSlXS@even-i700>
Message-ID: <CAN_Dn-HEcvA=m_jOw1+H2U-X6fkjE_LEqYV83o=M73UsYNywrg@mail.gmail.com>

My votes:
Motion 1: +1
Motion 2: +1

Norman

On Wed, Jul 3, 2019 at 4:16 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> Motion 1: promote GDAL 2.4.2 RC1 to final
> Motion 2: promote GDAL 3.0.1 RC1 to final
>
> ~~~~~
>
> My votes:
> Motion 1: +1
> Motion 2: +1
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190703/72eec1ff/attachment.html>

From tergenekonlu at yahoo.com  Thu Jul  4 08:24:26 2019
From: tergenekonlu at yahoo.com (tolga ergenekonlu)
Date: Thu, 4 Jul 2019 15:24:26 +0000 (UTC)
Subject: [gdal-dev] Ogr.Open Returns Null
References: <1426712144.2846697.1562253866750.ref@mail.yahoo.com>
Message-ID: <1426712144.2846697.1562253866750@mail.yahoo.com>


Hi,
I am using Visual Studio 2010 and developing a C# project. I have downloaded gdal-202-1600-x64-core.msi and gdal-202-1600-x64-filgdb.msi from the following website:
    "GISInternals Support Site
I have installed those two installations. They are installed at "C:\Program Files\GDAL".
I prepared a very small C# Project. I added the files "gdal_csharp.dll", "ogr_csharp.dll" and "osr_csharp.dll" as reference. And I copied all files and folders in "C:\Program Files\GDAL" folder to "bin\x64\debug" folder.
The code is as follows:
Ogr.RegisterAll();string sourceFile = "gltp:/vrf:D:/v0eur_5-xx/noamer/lib_116";DataSource dataSource = Ogr.Open(sourceFile, 0);
The directory is a VMAP file. Unfortunately datasource is null after execution of last line. However I had used the same line of code with Visual Studio 2005 by using "FWTools" files instead of the two installations I mentioned above and it works. ("datasource" is  not null.)
Can you help me about this subject?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190704/0e583099/attachment.html>

From Tim.Martin at os.uk  Fri Jul  5 00:04:57 2019
From: Tim.Martin at os.uk (Tim Martin)
Date: Fri, 5 Jul 2019 07:04:57 +0000
Subject: [gdal-dev] Full Driver list for using in building from source
Message-ID: <LO2P123MB244596AE15EB33F227BE4DFF85F50@LO2P123MB2445.GBRP123.PROD.OUTLOOK.COM>

Hi List

Hopefully this is the right place to post this query and not as a GitHub issue. I also raised the question on GIS Stack Exchange but haven't got a correct answer.

I am trying to create an AWS Lambda layer with GDAL with only a few drivers and so have been using the amazonlinx-gdal Dockerfile created by RemotePixel (https://github.com/RemotePixel/amazonlinux-gdal) as a starting point and I then also saw in GDAL 3 that you can use --disable-all-optional-drivers which is brilliant. However when I run ogrinfo -formats the list still contains MapInfo and TopoJson which are not listed as the ones you cannot disable (generic geojson kml mem mitab vrt)

As there is difference between the drive name eg PostgreSQL and what you use in ./configure eg -without-pg is there a definitive list of the driver names and then the correct names used in the build list?

I think a list like this would be very helpful to a lot of people if one doesn't exist.

Thanks for your help

Tim






This email is only intended for the person to whom it is addressed and may contain confidential information. If you have received this email in error, please notify the sender and delete this email which must not be copied, distributed or disclosed to any other person.

Unless stated otherwise, the contents of this email are personal to the writer and do not represent the official view of Ordnance Survey. Nor can any contract be formed on Ordnance Survey's behalf via email. We reserve the right to monitor emails and attachments without prior notice.

Thank you for your cooperation.

Ordnance Survey Limited (Company Registration number 09121572)
Registered Office: Explorer House
Adanac Drive
Southampton SO16 0AS
Tel: 03456 050505
http://www.os.uk
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190705/8692b4bb/attachment.html>

From even.rouault at spatialys.com  Fri Jul  5 01:19:04 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 05 Jul 2019 10:19:04 +0200
Subject: [gdal-dev] Full Driver list for using in building from source
In-Reply-To: <LO2P123MB244596AE15EB33F227BE4DFF85F50@LO2P123MB2445.GBRP123.PROD.OUTLOOK.COM>
References: <LO2P123MB244596AE15EB33F227BE4DFF85F50@LO2P123MB2445.GBRP123.PROD.OUTLOOK.COM>
Message-ID: <29481424.xd53Q4JxsT@even-i700>

On vendredi 5 juillet 2019 07:04:57 CEST Tim Martin wrote:
> Hi List
> 
> Hopefully this is the right place to post this query and not as a GitHub
> issue. I also raised the question on GIS Stack Exchange but haven't got a
> correct answer.
> 
> I am trying to create an AWS Lambda layer with GDAL with only a few drivers
> and so have been using the amazonlinx-gdal Dockerfile created by
> RemotePixel (https://github.com/RemotePixel/amazonlinux-gdal) as a starting
> point and I then also saw in GDAL 3 that you can use
> --disable-all-optional-drivers which is brilliant. However when I run
> ogrinfo -formats the list still contains MapInfo and TopoJson which are not
> listed as the ones you cannot disable (generic geojson kml mem mitab vrt)

Yes there are a few drivers you can't disable because they are used by 
functions from the core, or utilities, etc. TopoJson remains because it is 
somewhat intermixed with the Geojson one which is required. It could certainly 
be cut off if you badly needed it, but would require makefile hand-editing.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From breuil at craig.fr  Fri Jul  5 01:12:41 2019
From: breuil at craig.fr (Landry Breuil)
Date: Fri, 5 Jul 2019 10:12:41 +0200
Subject: [gdal-dev] setting a spatial filter on a postgis layer gives wrong
	results
Message-ID: <fdb9a8f3-1439-751a-ef1a-8d3d32e58d84@craig.fr>

Hi,

initially saw this with gdal 2.2.3 on debian, and confirmed the 
behaviour is the same with gdal 3.0 on openbsd.

I'm doing a spatial join between an union of geometries filtered from a 
geopackage and a tileindex layer stored in postgis, and the spatial 
filter set on the postgis layer behaves weird, the provided result is as 
if the bbox of the spatial filter/geometry was used, instead of the 
filter itself.

applying the exact same filter to a copy of the postgis layer stored in 
memory gives correct results.

below my testing code:

from osgeo import gdal
from osgeo import ogr

dbhandle = gdal.OpenEx("PG: host=localhost dbname=gisdata-local 
user=postgis", gdal.OF_VERBOSE_ERROR, allowed_drivers = ['PostgreSQL'])
gpkg = gdal.OpenEx('/tmp/dbdemogeor.gpkg')
communes = gpkg.GetLayerByName('adminexpress_201806_commune')
assert (dbhandle is not None)
layer = dbhandle.GetLayer('rtge.ortho')
print("{} tiles total, {} communes".format(layer.GetFeatureCount(), 
communes.GetFeatureCount()))

outdriver=ogr.GetDriverByName('MEMORY')
source=outdriver.CreateDataSource('memData')
tmp=outdriver.Open('memData',1)
source.CopyLayer(layer, 'out')
layer2 = source.GetLayer('out')

communes.SetAttributeFilter("insee_dep='63'")

multi  = ogr.Geometry(ogr.wkbMultiPolygon)
# compute the multigeometry for all the comms in the area list
for feature in communes:
     g = feature.GetGeometryRef()
     for i in range(0, g.GetGeometryCount()):
         multi.AddGeometry(g.GetGeometryRef(i))
communes.ResetReading()
union = multi.UnionCascaded()
# filter tileindex on a 100m bufferized union of the comms
layer.SetSpatialFilter(union.Buffer(100))

print("{} tiles are inside the geomunion for {} comms ({} 
surf)".format(layer.GetFeatureCount(), communes.GetFeatureCount(), 
union.GetArea()))

print("{} tiles in memory layer".format(layer2.GetFeatureCount()))
layer2.SetSpatialFilter(union.Buffer(100))
print("{} tiles in memory layer after 
filtering".format(layer2.GetFeatureCount()))


And the resulting output:
405557 tiles total, 4092 communes
131055 tiles are inside the geomunion for 467 comms (8001479208.5 surf)
405557 tiles in memory layer
82868 tiles in memory layer after filtering

is my code wrong, or the handling of spatial filters for postgis layers 
should be done in a different way, ie directly using postgis methods 
instead of trying to use gdal APIs?
-- 
Landry Breuil
Administrateur de données du CRAIG

----------------------------------------------------------------------------
Centre Régional Auvergne-Rhône-Alpes de l'Information Géographique
Bât. du CRRI - Campus des Cézeaux
7 avenue Blaise Pascal - CS 60026
63178 Aubière

https://www.craig.fr - @GipCraig
----------------------------------------------------------------------------
Support utilisateurs (tous les jours ouvrés de 8H30 à 12H30) : 04 73 405 405

From even.rouault at spatialys.com  Fri Jul  5 01:33:26 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 05 Jul 2019 10:33:26 +0200
Subject: [gdal-dev] setting a spatial filter on a postgis layer gives
	wrong results
In-Reply-To: <fdb9a8f3-1439-751a-ef1a-8d3d32e58d84@craig.fr>
References: <fdb9a8f3-1439-751a-ef1a-8d3d32e58d84@craig.fr>
Message-ID: <1572377.tcnBks39iH@even-i700>

On vendredi 5 juillet 2019 10:12:41 CEST Landry Breuil wrote:
> Hi,
> 
> initially saw this with gdal 2.2.3 on debian, and confirmed the
> behaviour is the same with gdal 3.0 on openbsd.
> 
> I'm doing a spatial join between an union of geometries filtered from a
> geopackage and a tileindex layer stored in postgis, and the spatial
> filter set on the postgis layer behaves weird, the provided result is as
> if the bbox of the spatial filter/geometry was used, instead of the
> filter itself.

This indeed exactly this. The PG driver implements spatial filtering only 
based on the envelope of the filter geometry, whereas the MEM driver uses the 
full geometry

Quoting
https://gdal.org/api/
ogrlayer_cpp.html#_CPPv4N8OGRLayer16SetSpatialFilterEP11OGRGeometry
"""
Currently this test is may be inaccurately implemented, but it is guaranteed 
that all features whose envelope (as returned by OGRGeometry::getEnvelope()) 
overlaps the envelope of the spatial filter will be returned. This can result 
in more shapes being returned that should strictly be the case.
"""

I guess the PG driver should be fixed. This is probably just an historical 
artifact.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From Tim.Martin at os.uk  Fri Jul  5 01:58:45 2019
From: Tim.Martin at os.uk (Tim Martin)
Date: Fri, 5 Jul 2019 08:58:45 +0000
Subject: [gdal-dev] Full Driver list for using in building from source
In-Reply-To: <29481424.xd53Q4JxsT@even-i700>
References: <LO2P123MB244596AE15EB33F227BE4DFF85F50@LO2P123MB2445.GBRP123.PROD.OUTLOOK.COM>
 <29481424.xd53Q4JxsT@even-i700>
Message-ID: <LO2P123MB2445D2A14A14B3622480CEF785F50@LO2P123MB2445.GBRP123.PROD.OUTLOOK.COM>

Thanks Even

I am not opposed to having drivers enabled. I just wanted to make sure I had a list of ones that I could use to flick on and off during the build phase.

So I will use the list here - https://trac.osgeo.org/gdal/wiki/BuildingOnUnixWithMinimizedDrivers and the --disable-all-optional-drivers and customise as much as I need.

Cannot wait to use the COG driver in 3.1!!!

Thanks for your help




-----Original Message-----
From: Even Rouault <even.rouault at spatialys.com>
Sent: 05 July 2019 09:19
To: gdal-dev at lists.osgeo.org
Cc: Tim Martin <Tim.Martin at os.uk>
Subject: Re: [gdal-dev] Full Driver list for using in building from source

External Email: Take care with attachments & links.


On vendredi 5 juillet 2019 07:04:57 CEST Tim Martin wrote:
> Hi List
>
> Hopefully this is the right place to post this query and not as a
> GitHub issue. I also raised the question on GIS Stack Exchange but
> haven't got a correct answer.
>
> I am trying to create an AWS Lambda layer with GDAL with only a few
> drivers and so have been using the amazonlinx-gdal Dockerfile created
> by RemotePixel
> (https://eur01.safelinks.protection.outlook.com/?url=https%3A%2F%2Fgit
> hub.com%2FRemotePixel%2Famazonlinux-gdal&amp;data=02%7C01%7CTim.Martin
> %40os.uk%7C2c10f2cb11d3422abc3408d7012172c1%7C7988742dc5434b9a87a910a7
> b354d289%7C0%7C1%7C636979115486553317&amp;sdata=X6qkUnVGyeR572MliR0jCo
> vPr4rY3fbDjAyjEAb2e%2Fs%3D&amp;reserved=0) as a starting point and I
> then also saw in GDAL 3 that you can use
> --disable-all-optional-drivers which is brilliant. However when I run
> ogrinfo -formats the list still contains MapInfo and TopoJson which
> are not listed as the ones you cannot disable (generic geojson kml mem
> mitab vrt)

Yes there are a few drivers you can't disable because they are used by functions from the core, or utilities, etc. TopoJson remains because it is somewhat intermixed with the Geojson one which is required. It could certainly be cut off if you badly needed it, but would require makefile hand-editing.

Even

--
Spatialys - Geospatial professional services
https://eur01.safelinks.protection.outlook.com/?url=http%3A%2F%2Fwww.spatialys.com&amp;data=02%7C01%7CTim.Martin%40os.uk%7C2c10f2cb11d3422abc3408d7012172c1%7C7988742dc5434b9a87a910a7b354d289%7C0%7C1%7C636979115486563315&amp;sdata=p9MyShgIucC47JEflfYO8Sf2NNcOdH9y6xZOzycuzWc%3D&amp;reserved=0


This email is only intended for the person to whom it is addressed and may contain confidential information. If you have received this email in error, please notify the sender and delete this email which must not be copied, distributed or disclosed to any other person.

Unless stated otherwise, the contents of this email are personal to the writer and do not represent the official view of Ordnance Survey. Nor can any contract be formed on Ordnance Survey's behalf via email. We reserve the right to monitor emails and attachments without prior notice.

Thank you for your cooperation.

Ordnance Survey Limited (Company Registration number 09121572)
Registered Office: Explorer House
Adanac Drive
Southampton SO16 0AS
Tel: 03456 050505
http://www.os.uk

From even.rouault at spatialys.com  Fri Jul  5 02:16:17 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 05 Jul 2019 11:16:17 +0200
Subject: [gdal-dev] Motions: promote GDAL 2.4.2 RC1 and GDAL 3.0.1 RC1
	to final
In-Reply-To: <2561453.4Z3NASSlXS@even-i700>
References: <2561453.4Z3NASSlXS@even-i700>
Message-ID: <13953057.C8lpocrrba@even-i700>

On mercredi 3 juillet 2019 11:15:57 CEST Even Rouault wrote:
> Hi,
> 
> Motion 1: promote GDAL 2.4.2 RC1 to final
> Motion 2: promote GDAL 3.0.1 RC1 to final
> 
> ~~~~~
> 

I declare those 2 motions passed with +1 from PSC members: TamasS, HowardB, 
DanielM, JukkaR, NormanB and myself.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From jukka.rahkonen at maanmittauslaitos.fi  Fri Jul  5 02:17:17 2019
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Fri, 5 Jul 2019 02:17:17 -0700 (MST)
Subject: [gdal-dev] setting a spatial filter on a postgis layer gives
	wrong results
In-Reply-To: <1572377.tcnBks39iH@even-i700>
References: <fdb9a8f3-1439-751a-ef1a-8d3d32e58d84@craig.fr>
 <1572377.tcnBks39iH@even-i700>
Message-ID: <1562318237780-0.post@n6.nabble.com>

Hi,

It should be already possible to make accurate filtering from PostGIS by
executing SQL with ST_Intersects.

-Jukka Rahkonen-


Even Rouault-2 wrote
> On vendredi 5 juillet 2019 10:12:41 CEST Landry Breuil wrote:
>> Hi,
>> 
>> initially saw this with gdal 2.2.3 on debian, and confirmed the
>> behaviour is the same with gdal 3.0 on openbsd.
>> 
>> I'm doing a spatial join between an union of geometries filtered from a
>> geopackage and a tileindex layer stored in postgis, and the spatial
>> filter set on the postgis layer behaves weird, the provided result is as
>> if the bbox of the spatial filter/geometry was used, instead of the
>> filter itself.
> 
> This indeed exactly this. The PG driver implements spatial filtering only 
> based on the envelope of the filter geometry, whereas the MEM driver uses
> the 
> full geometry
> 
> Quoting
> https://gdal.org/api/
> ogrlayer_cpp.html#_CPPv4N8OGRLayer16SetSpatialFilterEP11OGRGeometry
> """
> Currently this test is may be inaccurately implemented, but it is
> guaranteed 
> that all features whose envelope (as returned by
> OGRGeometry::getEnvelope()) 
> overlaps the envelope of the spatial filter will be returned. This can
> result 
> in more shapes being returned that should strictly be the case.
> """
> 
> I guess the PG driver should be fixed. This is probably just an historical 
> artifact.
> 
> Even
> 
> -- 
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list

> gdal-dev at .osgeo

> https://lists.osgeo.org/mailman/listinfo/gdal-dev





--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Fri Jul  5 02:36:55 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 05 Jul 2019 11:36:55 +0200
Subject: [gdal-dev] GDAL/OGR 2.4.2 is released
Message-ID: <4115154.Fam88xk42f@even-i700>

Hi,

On behalf of the GDAL/OGR development team, I am pleased to announce the 
release of the GDAL/OGR 2.4.2 bug fix version. This adds 69 bug fixes on top 
of 2.4.1.

Consult the release notes for the list of issues addressed :
  https://trac.osgeo.org/gdal/wiki/Release/2.4.2-News

The sources are available at:

    http://download.osgeo.org/gdal/2.4.2/gdal-2.4.2.tar.xz
    http://download.osgeo.org/gdal/2.4.2/gdal-2.4.2.tar.gz
    http://download.osgeo.org/gdal/2.4.2/gdal242.zip
    http://download.osgeo.org/gdal/2.4.2/gdal-grass-2.4.2.tar.gz

Best regards,

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Fri Jul  5 02:37:00 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 05 Jul 2019 11:37:00 +0200
Subject: [gdal-dev] GDAL/OGR 3.0.1 is released
Message-ID: <8015682.v8qn1InO7V@even-i700>

Hi,

On behalf of the GDAL/OGR development team, I am pleased to announce the 
release of the GDAL/OGR 3.0.1 bug fix version. This adds 55 bug fixes on top 
of 3.0.0

Consult the release notes for the list of issues addressed :
  https://trac.osgeo.org/gdal/wiki/Release/3.0.1-News

The sources are available at:

    http://download.osgeo.org/gdal/3.0.1/gdal-3.0.1.tar.xz
    http://download.osgeo.org/gdal/3.0.1/gdal-3.0.1.tar.gz
    http://download.osgeo.org/gdal/3.0.1/gdal301.zip
    http://download.osgeo.org/gdal/3.0.1/gdal-grass-3.0.1.tar.gz

Best regards,

Even
-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From tor21sor at protonmail.com  Sun Jul  7 01:34:03 2019
From: tor21sor at protonmail.com (tor21sor at protonmail.com)
Date: Sun, 07 Jul 2019 08:34:03 +0000
Subject: [gdal-dev] Could not write Japanese characters in Shapefiles
Message-ID: <zta6gqoTskZcGPy23Wt8N2Lnihxprv3405s0jAdnpfTaP2BReK9fYALm4eRumwr3tUMoVQ1ZQCDS6E7b2rHyc3GvIqC8NkrVgy6J-CfbM4k=@protonmail.com>

Hi,

Great to find an awesome geospatial library!

I could read the field names of a shapefile in Japanese characters by applying the following setting in Python 3 program.
os.environ['SHAPE_ENCODING'] = "Shift_JIS"

fieldname = in_feature.GetField('Name')

However, I could not write the fieldnames in Japanese characters.
I tried as follows:

out_layer.CreateField(ogr.FieldDefn('Name', ogr.OFTString))
out_feature = ogr.Feature(out_layer.GetLayerDefn())

out_feature.SetField('Name', fieldname)
out_layer.CreateFeature(out_feature)

Japanese characters lost while reading the files wriiten with the above procedure.

I hope someone can assist me in this matter.
Thanks you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190707/2139e303/attachment.html>

From idan at miara.com  Sun Jul  7 02:13:04 2019
From: idan at miara.com (Idan Miara)
Date: Sun, 7 Jul 2019 12:13:04 +0300
Subject: [gdal-dev] warp/trsnalte a specific src_ovr without alpha band
Message-ID: <CAEDrt38b3Xg9t+Y-DmQ=XwNCDtKsd_1k9e3ZG1Ehyj+UQf6JJg@mail.gmail.com>

Hi,

I have a RGBA raster with overviews, I'd like to cut an extent from a
specific overview into a new YCbCr JPEG raster.
I want to drop the alpha band (I don't need it and it is not supported in
YCbCr).

I couldn't find a way to do it because:
1. with gdal_translate I could choose bands (RGB) but I couldn't given a
src_ovr,
2. with gdalwarp - I could choose a src_ovr but not to drop the alpha band.

Kind regards,
Idan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190707/f7e8de11/attachment.html>

From even.rouault at spatialys.com  Sun Jul  7 02:29:27 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 07 Jul 2019 11:29:27 +0200
Subject: [gdal-dev] Could not write Japanese characters in Shapefiles
In-Reply-To: <zta6gqoTskZcGPy23Wt8N2Lnihxprv3405s0jAdnpfTaP2BReK9fYALm4eRumwr3tUMoVQ1ZQCDS6E7b2rHyc3GvIqC8NkrVgy6J-CfbM4k=@protonmail.com>
References: <zta6gqoTskZcGPy23Wt8N2Lnihxprv3405s0jAdnpfTaP2BReK9fYALm4eRumwr3tUMoVQ1ZQCDS6E7b2rHyc3GvIqC8NkrVgy6J-CfbM4k=@protonmail.com>
Message-ID: <1617932.MRCoNu85DK@even-i700>

On dimanche 7 juillet 2019 08:34:03 CEST tor21sor at protonmail.com wrote:
> Hi,
> 
> Great to find an awesome geospatial library!
> 
> I could read the field names of a shapefile in Japanese characters by
> applying the following setting in Python 3 program.
> os.environ['SHAPE_ENCODING'] = "Shift_JIS"

For writing, this needs to be defined as the layer creation option ENCODING of 
CreateLayer()

lyr = ds.CreateLayer(layer_name, geom_type, srs, options = ["ENCODING=SJIS"])

This will write a .cpg file with "SJIS" inside.

Or "ENCODING=LDID/19". The later will not write any .cpg file at all.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Sun Jul  7 02:37:53 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Sun, 07 Jul 2019 11:37:53 +0200
Subject: [gdal-dev] warp/trsnalte a specific src_ovr without alpha band
In-Reply-To: <CAEDrt38b3Xg9t+Y-DmQ=XwNCDtKsd_1k9e3ZG1Ehyj+UQf6JJg@mail.gmail.com>
References: <CAEDrt38b3Xg9t+Y-DmQ=XwNCDtKsd_1k9e3ZG1Ehyj+UQf6JJg@mail.gmail.com>
Message-ID: <4041235.QoMW1GZrsF@even-i700>

On dimanche 7 juillet 2019 12:13:04 CEST Idan Miara wrote:
> Hi,
> 
> I have a RGBA raster with overviews, I'd like to cut an extent from a
> specific overview into a new YCbCr JPEG raster.
> I want to drop the alpha band (I don't need it and it is not supported in
> YCbCr).
> 
> I couldn't find a way to do it because:
> 1. with gdal_translate I could choose bands (RGB) but I couldn't given a
> src_ovr,

You can do it in 2 steps. Note the size of the overview you are interested in. 
Imagine that in.tif has dimensions 21x13 and an overview of 11x7

Do:
gdal_translate in.tif ovr.vrt -outsize 11 7 -of VRT -b 1 -b 2 -b 3
gdal_translate ovr.vrt extract.tif [-srcwin | -projwin] -co COMPRESS=JPEG -co 
PHOTOMETRIC=YCBCR

~~~

Or you can do it in one step by using the generic OVERVIEW_LEVEL open option.
See the papszOpenOptions of
https://gdal.org/api/raster_c_api.html#_CPPv410GDALOpenExPKcjPPCKcPPCKcPPCKc

If the overview level you're interested in is the first one (index 0), then

gdal_translate in.tif extract.tif  -b 1 -b 2 -b 3 [-srcwin | -projwin] -co 
COMPRESS=JPEG -co PHOTOMETRIC=YCBCR -oo OVERVIEW_LEVEL=0

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From andrew at aitchison.me.uk  Sun Jul  7 08:33:36 2019
From: andrew at aitchison.me.uk (Andrew C Aitchison)
Date: Sun, 7 Jul 2019 16:33:36 +0100 (BST)
Subject: [gdal-dev] Making a uniform collection from images with and without
	palettes
Message-ID: <alpine.DEB.2.21.1907071630480.16612@warden.aitchison.me.uk>


I have a large collection (millions) of .png files (with .wld files) some
8bit/color RGB, others with 1,2,4 or 8bit colormaps, and some grayscale.
Since .vrt files cannot have different colormaps I'd like to convert them
into something uniform (probably 8bit/color RGB).

gdal_translate -expand is not valid with 8-bit/color files.
Is there any way of converting the files to something which can be used
in a .vrt, without knowing how many bands, and hence which arguments to 
apply, to each file ?

Thanks,

-- 
Andrew C. Aitchison        Kendal, UK        andrew at aitchison.me.uk



From jukka.rahkonen at maanmittauslaitos.fi  Sun Jul  7 12:17:05 2019
From: jukka.rahkonen at maanmittauslaitos.fi (jratike80)
Date: Sun, 7 Jul 2019 12:17:05 -0700 (MST)
Subject: [gdal-dev] Making a uniform collection from images with and
 without palettes
In-Reply-To: <alpine.DEB.2.21.1907071630480.16612@warden.aitchison.me.uk>
References: <alpine.DEB.2.21.1907071630480.16612@warden.aitchison.me.uk>
Message-ID: <1562527025288-0.post@n6.nabble.com>

Hi,

I myself would consider reading the source files with Mapserver and
tileindex. It should work automatically as you wish. You can then read data
from the WMS service in some uniform format. If you do not know Mapserver
yet it might take a moment to learn how to do it but it is possible that
some kind soul can help you with it.

Are all your .png files in the same coordinate system?

-Jukka Rahkonen-i



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From tergenekonlu at yahoo.com  Mon Jul  8 00:02:30 2019
From: tergenekonlu at yahoo.com (tolga ergenekonlu)
Date: Mon, 8 Jul 2019 07:02:30 +0000 (UTC)
Subject: [gdal-dev] Ogr.Open Returns Null
In-Reply-To: <1426712144.2846697.1562253866750@mail.yahoo.com>
References: <1426712144.2846697.1562253866750.ref@mail.yahoo.com>
 <1426712144.2846697.1562253866750@mail.yahoo.com>
Message-ID: <566148098.4033902.1562569350056@mail.yahoo.com>

 
Hello,
Still I cannot resolve the issue. Could you help me about the problem I have?    On Thursday, July 4, 2019, 06:24:26 PM GMT+3, tolga ergenekonlu <tergenekonlu at yahoo.com> wrote:  
 
 
Hi,
I am using Visual Studio 2010 and developing a C# project. I have downloaded gdal-202-1600-x64-core.msi and gdal-202-1600-x64-filgdb.msi from the following website:
    "GISInternals Support Site
I have installed those two installations. They are installed at "C:\Program Files\GDAL".
I prepared a very small C# Project. I added the files "gdal_csharp.dll", "ogr_csharp.dll" and "osr_csharp.dll" as reference. And I copied all files and folders in "C:\Program Files\GDAL" folder to "bin\x64\debug" folder.
The code is as follows:
Ogr.RegisterAll();string sourceFile = "gltp:/vrf:D:/v0eur_5-xx/noamer/lib_116";DataSource dataSource = Ogr.Open(sourceFile, 0);
The directory is a VMAP file. Unfortunately datasource is null after execution of last line. However I had used the same line of code with Visual Studio 2005 by using "FWTools" files instead of the two installations I mentioned above and it works. ("datasource" is  not null.)
Can you help me about this subject?  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190708/3e46c31f/attachment.html>

From sebastien.guimmara at airbus.com  Mon Jul  8 03:35:12 2019
From: sebastien.guimmara at airbus.com (=?iso-8859-1?Q?GUIMMARA=2C_S=E9bastien?=)
Date: Mon, 8 Jul 2019 10:35:12 +0000
Subject: [gdal-dev] gdalwarp: different results between 2.3.0 and 2.4.0
Message-ID: <06a126a94f6b447bb81819ab7ef641e5@CD1-4BDAG06-P04.cdmail.common.airbusds.corp>

I have a small GRIB file whose coordinate system is GRIB-specific, and it spans the whole world, from longitude 0 to 360. I would like to read this raster from an EPSG:4326 perspective, so I'm using gdalwarp to warp it to a VRT :

gdalwarp  -t_srs EPSG:4326 -of VRT input.grib output.vrt

When I inspect the VRT using GDAL 2.4.0 (the one shipped with QGIS 3.4) I notice that the geotransform is correct. When imported in QGIS, it correctly spans the world from longitude -180 to 180.

However, the same VRT generated with GDAL 2.3.0 gives a completely different geotransform. Actually it seems that the original geotransform was not modified at all, and I cannot correctly import it in QGIS, since it spans from 0 to 360, and thus is not aligned properly with other layers in the EPSG:4326 SRS (which span from -180 to 180)

Were there any modification to gdalwarp from 2.3.0 to 2.4.0 ? different default options ?

Thanks,
Sébastien

The information in this e-mail is confidential. The contents may not be disclosed or used by anyone other than the addressee. Access to this e-mail by anyone else is unauthorised.
If you are not the intended recipient, please notify Airbus immediately and delete this e-mail.
Airbus cannot accept any responsibility for the accuracy or completeness of this e-mail as it has been sent over public networks. If you have any concerns over the content of this message or its Accuracy or Integrity, please contact Airbus immediately.
All outgoing e-mails from Airbus are checked using regularly updated virus scanning software but you should take whatever measures you deem to be appropriate to ensure that this message and any attachments are virus free.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190708/0430a770/attachment.html>

From choskey at agiledragonconsulting.com  Mon Jul  8 19:35:26 2019
From: choskey at agiledragonconsulting.com (Cindy Hoskey)
Date: Mon, 8 Jul 2019 22:35:26 -0400
Subject: [gdal-dev] ogr2ogr not creating feature ID
Message-ID: <CALayMQ8HzKxgLyv9Sn97tRAGo7iLiz3G-+TZCga+6pYTBNswow@mail.gmail.com>

Hi, I'm new to gdal so please forgive me if this is covered elsewhere.
I've looked and can't seem to find any answer, including looking in Github
to see if this is listed as an issue.

I'm creating a geojson sequence file (with a newline chracter) using
node.js on a Windows 10 machine.  When I run the folowing command I would
expect that there would be an ID at the end of each feature but there is
not.

ogr2ogr -f GeoJSONseq -lco ID_FIELD="ZCTA5CE10" -lco ID_TYPE=String -sql
"SELECT ZCTA5CE10 as zip, INTPTLAT10 as lat, INTPTLON10 as lon FROM
tl_2018_us_zcta510" tl_2018_us_zcta510geojsonseq.geojson
tl_2018_us_zcta510.shp


I've tried a few variants (without -lco ID_Type=String, without the
double-quotes around the name of the ID_FIELD column) and none seem to
work.  What I'm getting looks like this example:

{ "type": "Feature", "properties": { "zip": "43463", "lat": "+41.5086650",
"lon": "-083.5080344" }, "geometry": { "type": "Polygon", "coordinates": [
[ [ -83.509096, 41.508401 ], [ -83.508555, 41.508162 ], [ -83.508223,
41.508021 ], [ -83.507674, 41.50777 ], [ -83.507465, 41.507665 ], [
-83.507435, 41.507659 ], [ -83.50741, 41.507659 ], [ -83.507335, 41.507675
], [ -83.507296, 41.507702 ], [ -83.507263, 41.507733 ], [ -83.507244,
41.50776 ], [ -83.507232, 41.507795 ], [ -83.507247, 41.507878 ], [
-83.507412, 41.508499 ], [ -83.507534, 41.508952 ], [ -83.507569, 41.509078
], [ -83.507752, 41.50974 ], [ -83.507841, 41.510002 ], [ -83.508447,
41.509233 ], [ -83.509096, 41.508401 ] ] ] } }

What I was expecting would be something like the following:

{ "type": "Feature", "properties": { "zip": "43463", "lat": "+41.5086650",
"lon": "-083.5080344" }, "geometry": { "type": "Polygon", "coordinates": [
[ [ -83.509096, 41.508401 ], [ -83.508555, 41.508162 ], [ -83.508223,
41.508021 ], [ -83.507674, 41.50777 ], [ -83.507465, 41.507665 ], [
-83.507435, 41.507659 ], [ -83.50741, 41.507659 ], [ -83.507335, 41.507675
], [ -83.507296, 41.507702 ], [ -83.507263, 41.507733 ], [ -83.507244,
41.50776 ], [ -83.507232, 41.507795 ], [ -83.507247, 41.507878 ], [
-83.507412, 41.508499 ], [ -83.507534, 41.508952 ], [ -83.507569, 41.509078
], [ -83.507752, 41.50974 ], [ -83.507841, 41.510002 ], [ -83.508447,
41.509233 ], [ -83.509096, 41.508401 ] ] ] } ,"id":"43463"}

Is this a bug or is my syntax incorrect?

 - Cindy


[image: logo] <https://agiledragonconsulting.com/> Cindy Hoskey
President • Agile Dragon Consulting LLC
mobile: 631-333-1312
email: choskey at agiledragonconsulting.com
agiledragonconsulting.com
[image: banner] <https://agiledragonconsulting.com/>
The content of this email is confidential and intended for the recipient
specified in message only. It is strictly forbidden to share any part of
this message with any third party, without a written consent of the sender.
If you received this message by mistake, please reply to this message and
follow with its deletion, so that we can ensure such a mistake does not
occur in the future.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190708/788e18e3/attachment.html>

From tergenekonlu at yahoo.com  Tue Jul  9 04:57:26 2019
From: tergenekonlu at yahoo.com (tolga ergenekonlu)
Date: Tue, 9 Jul 2019 11:57:26 +0000 (UTC)
Subject: [gdal-dev] GDAL & OGDI
References: <1802882259.160169.1562673446281.ref@mail.yahoo.com>
Message-ID: <1802882259.160169.1562673446281@mail.yahoo.com>


Hi,
I want to built gdal2.2.4 and ogdi 3.1.6 together. I am using Visual Studio 2010. I copied both of those directories in D:\folder. I execute the following command in folder "D:\gdal-2.2.4" where gdal is copied:
   
   -  nmake /f makefile.vc 

But the build gets error. The nmake.opt file and the error I get are attached. Can you help me about how to build GDAL with OGDI?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190709/5e16e370/attachment-0001.html>
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: Error Msg.txt
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190709/5e16e370/attachment-0001.txt>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: nmake.opt
Type: application/octet-stream
Size: 33703 bytes
Desc: not available
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190709/5e16e370/attachment-0001.obj>

From ahmettemiz88 at gmail.com  Wed Jul 10 01:25:07 2019
From: ahmettemiz88 at gmail.com (Ahmet Temiz)
Date: Wed, 10 Jul 2019 11:25:07 +0300
Subject: [gdal-dev] create a polygon from 4 point coordinates in C++
Message-ID: <CAJKO1Yun-T9w9XYExYf82sufp6p75jM_XE_rSBLGsCin-9wbyQ@mail.gmail.com>

Hi,
How can I create a polygon from 4 point coordinates in C++ ?
regards

-- 
Ahmet Temiz
Jeoloji Müh.
Afet ve Acil Durum Yönetimi Başkanlığı
Bilgi İşlem  Dairesi Başkanlığı-CBS Grubu


________________________

Ahmet Temiz
Geological Eng.
Information Systems - GIS Group
Disaster and Emergency Management
of Presidency
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190710/05470d0a/attachment.html>

From mateusz at loskot.net  Wed Jul 10 01:56:07 2019
From: mateusz at loskot.net (Mateusz Loskot)
Date: Wed, 10 Jul 2019 09:56:07 +0100
Subject: [gdal-dev] create a polygon from 4 point coordinates in C++
In-Reply-To: <CAJKO1Yun-T9w9XYExYf82sufp6p75jM_XE_rSBLGsCin-9wbyQ@mail.gmail.com>
References: <CAJKO1Yun-T9w9XYExYf82sufp6p75jM_XE_rSBLGsCin-9wbyQ@mail.gmail.com>
Message-ID: <CABUeae-0vYNb4ZP1EtoQ-JhQdp6bWTAC8Oy1cJNxQS1cQBgFYQ@mail.gmail.com>

Hi,
If you read this test for OGR features written in C++,
you'll see or easily figure it out how to create geometries

https://github.com/OSGeo/gdal/blob/master/autotest/cpp/test_ogr.cpp


Mateusz Loskot, mateusz at loskot.net
(Sent from mobile, may suffer from top-posting)

On Wed, 10 Jul 2019, 09:25 Ahmet Temiz, <ahmettemiz88 at gmail.com> wrote:

> Hi,
> How can I create a polygon from 4 point coordinates in C++ ?
> regards
>
> --
> Ahmet Temiz
> Jeoloji Müh.
> Afet ve Acil Durum Yönetimi Başkanlığı
> Bilgi İşlem  Dairesi Başkanlığı-CBS Grubu
>
>
> ________________________
>
> Ahmet Temiz
> Geological Eng.
> Information Systems - GIS Group
> Disaster and Emergency Management
> of Presidency
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190710/33ce72d6/attachment.html>

From mikeflan at att.net  Wed Jul 10 02:24:38 2019
From: mikeflan at att.net (Mike Flannigan)
Date: Wed, 10 Jul 2019 04:24:38 -0500
Subject: [gdal-dev] ogr2ogr not creating feature ID
In-Reply-To: <mailman.39007.1562673451.17185.gdal-dev@lists.osgeo.org>
References: <mailman.39007.1562673451.17185.gdal-dev@lists.osgeo.org>
Message-ID: <2bdee7ed-1934-144c-10b9-49f869c4a05e@att.net>


I don't know about node.js, but my home grown
geoj's look like this:

{ "type": "Feature", "properties": { "id": 2, "name": "Boxley AR to 
Halltown MO2" }, "geometry": { "type": "LineString", "coordinates": [ [ 
-93.40203, 35.97839 ],  [ -93.4031, 35.97831 ],  [ -93.40372, 35.97807 
],  [ -93.40444, 35.97744 ],  [ -93.40544, 35.97578 ],  [ -93.40589, 
35.97552 ],  [ -93.40636, 35.97549 ],  [ -93.407, 35.97576 ],  [ 
-93.6255, 37.18735 ] ] } },

So I'm thinking the id needs to be first and
I guess node.js is doing it right.


Mike


On 7/9/2019 6:57 AM, gdal-dev-request at lists.osgeo.org wrote:
> Hi, I'm new to gdal so please forgive me if this is covered elsewhere.
> I've looked and can't seem to find any answer, including looking in Github
> to see if this is listed as an issue.
>
> I'm creating a geojson sequence file (with a newline chracter) using
> node.js on a Windows 10 machine.  When I run the folowing command I would
> expect that there would be an ID at the end of each feature but there is
> not.
>
> ogr2ogr -f GeoJSONseq -lco ID_FIELD="ZCTA5CE10" -lco ID_TYPE=String -sql
> "SELECT ZCTA5CE10 as zip, INTPTLAT10 as lat, INTPTLON10 as lon FROM
> tl_2018_us_zcta510" tl_2018_us_zcta510geojsonseq.geojson
> tl_2018_us_zcta510.shp
>
>
> I've tried a few variants (without -lco ID_Type=String, without the
> double-quotes around the name of the ID_FIELD column) and none seem to
> work.  What I'm getting looks like this example:
>
> { "type": "Feature", "properties": { "zip": "43463", "lat": "+41.5086650",
> "lon": "-083.5080344" }, "geometry": { "type": "Polygon", "coordinates": [
> [ [ -83.509096, 41.508401 ], [ -83.508555, 41.508162 ], [ -83.508223,
> 41.508021 ], [ -83.507674, 41.50777 ], [ -83.507465, 41.507665 ], [
> -83.507435, 41.507659 ], [ -83.50741, 41.507659 ], [ -83.507335, 41.507675
> ], [ -83.507296, 41.507702 ], [ -83.507263, 41.507733 ], [ -83.507244,
> 41.50776 ], [ -83.507232, 41.507795 ], [ -83.507247, 41.507878 ], [
> -83.507412, 41.508499 ], [ -83.507534, 41.508952 ], [ -83.507569, 41.509078
> ], [ -83.507752, 41.50974 ], [ -83.507841, 41.510002 ], [ -83.508447,
> 41.509233 ], [ -83.509096, 41.508401 ] ] ] } }
>
> What I was expecting would be something like the following:
>
> { "type": "Feature", "properties": { "zip": "43463", "lat": "+41.5086650",
> "lon": "-083.5080344" }, "geometry": { "type": "Polygon", "coordinates": [
> [ [ -83.509096, 41.508401 ], [ -83.508555, 41.508162 ], [ -83.508223,
> 41.508021 ], [ -83.507674, 41.50777 ], [ -83.507465, 41.507665 ], [
> -83.507435, 41.507659 ], [ -83.50741, 41.507659 ], [ -83.507335, 41.507675
> ], [ -83.507296, 41.507702 ], [ -83.507263, 41.507733 ], [ -83.507244,
> 41.50776 ], [ -83.507232, 41.507795 ], [ -83.507247, 41.507878 ], [
> -83.507412, 41.508499 ], [ -83.507534, 41.508952 ], [ -83.507569, 41.509078
> ], [ -83.507752, 41.50974 ], [ -83.507841, 41.510002 ], [ -83.508447,
> 41.509233 ], [ -83.509096, 41.508401 ] ] ] } ,"id":"43463"}
>
> Is this a bug or is my syntax incorrect?
>
>   - Cindy



From bontepaarden at gmail.com  Mon Jul 15 02:17:56 2019
From: bontepaarden at gmail.com (Paul Meems)
Date: Mon, 15 Jul 2019 11:17:56 +0200
Subject: [gdal-dev] 'HOST_FILLORDER': macro redefinition
Message-ID: <CAHNf2YQ_0ymhLHXP=n1aT9wEGi9U+eOXcW1zNs4Skmtz+1LNYw@mail.gmail.com>

Hi List,

We use GDAL with MapWinGIS, a C++ ActiveX control.
We use the binaries, libs and header files from GisInternals.com

We're currently in the process of getting rid of the last compiler warnings.
One of them is 'HOST_FILLORDER': macro redefinition

Our Map_Core.cpp includes tiff.h, which includes tiffconf.h, which defines
HOST_FILLORDER as
#define HOST_FILLORDER FILLORDER_MSB2LSB

Map_Core.cpp then also includes geotiff.h, which includes geo_config.h,
which includes cpl_config.h, which unfortunately redefines HOST_FILLORDER
in the opposite order
#define HOST_FILLORDER FILLORDER_LSB2MSB

If it were redefining to the same value, that would be one thing, but since
it is redefining to another value, it makes you wonder 1) why is it coming
in differently, and 2) which value should it be?

A simple redefinition, with the same value, wouldn’t bother us as much and
would be easier to deal with. But with this, we will have to figure out
which value it should be, and why do the includes we’re using result in
conflicting definitions?

Should we not include both tiff.h and geotiff.h in the same file?

How are other developers dealing with this?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190715/729ef384/attachment.html>

From chiara.marmo at u-psud.fr  Mon Jul 15 02:20:19 2019
From: chiara.marmo at u-psud.fr (Chiara Marmo)
Date: Mon, 15 Jul 2019 09:20:19 +0000 (GMT)
Subject: [gdal-dev] GDAL linked against CFITSIO on debian/ubuntu
In-Reply-To: <d1637caa-28db-2dc1-4910-a05368bc3dcc@xs4all.nl>
References: <341525187.19321965.1560438331822.JavaMail.zimbra@u-psud.fr>
 <d1637caa-28db-2dc1-4910-a05368bc3dcc@xs4all.nl>
Message-ID: <463989018.5084021.1563182419964.JavaMail.zimbra@u-psud.fr>

Hello Sebastiaan,

me again about GDAL and CFITSIO. :)

> 
> gdal (1.4.1-5) unstable; urgency=low
> 
>   * libcfitsio3 library is now GPL on Debian, so disabled due to
>     incompatibility with GDAL copyright.
>     (closes: #422537)
> 
> The linked bugreport has more backgrounds:
> 
> https://bugs.debian.org/422537

If I understand correctly, this bug is pretty old.
I have checked the CFITSIO ChangeLog [1] and I'm under the impression that, starting from CFITSIO 3.26 this issue is no longer there:

"
   - replaced all the source code in CFITSIO that was distributed under the
     GNU General Public License with freely available code.  In particular,
     the  gzip file compression and uncompression code was replaced by the
     zlib compression library.  Thus, beginning with this version 3.26 of CFITSIO,
     other software applications may freely use CFITSIO without necessarily
     incurring any GNU licensing requirement.  See the License.txt file for
     the CFITSIO licensing requirements.
"

The Buster version of CFITSIO is 3.45. I've contacted the CFITSIO people for clarifications.

Do you mind if I open a new issue on the Debian bug tracker (if relevant) after their answer?

Thanks for reading.
 
Best regards,
Chiara

[1] https://heasarc.gsfc.nasa.gov/FTP/software/fitsio/c/docs/changes.txt

--- 
Chiara Marmo
Ingénieur de Recherche GEOPS - Paris Sud-11
Bât 509
Tel: +33 (0)1 69 15 49 03

From even.rouault at spatialys.com  Mon Jul 15 03:23:01 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 15 Jul 2019 12:23:01 +0200
Subject: [gdal-dev] 'HOST_FILLORDER': macro redefinition
In-Reply-To: <CAHNf2YQ_0ymhLHXP=n1aT9wEGi9U+eOXcW1zNs4Skmtz+1LNYw@mail.gmail.com>
References: <CAHNf2YQ_0ymhLHXP=n1aT9wEGi9U+eOXcW1zNs4Skmtz+1LNYw@mail.gmail.com>
Message-ID: <3705363.eos7rZdcOy@even-i700>

> If it were redefining to the same value, that would be one thing, but since
> it is redefining to another value, it makes you wonder 1) why is it coming
> in differently, and 2) which value should it be?

Paul, overall this doesn't seem critical as the only real use of 
HOST_FILLORDER in all GDAL, libtiff and libgeotiff code bases in in libtiff 
TIFFOpen() function when the esoteric 'H' open flag is used, and that one is 
likely rarely used (not used by GDAL typically). So you could just #undef 
HOST_FILLORDER between the 2 #include to silence the warning.

Tamas, how is tiffconf.h in gisinternals produced, which has this unexpected 
#define HOST_FILLORDER FILLORDER_MSB2LSB (should be LSB2MSB for Intel 
platforms) ? Is this the result of cmake ? I guess so, as it doesn't seem to 
be in sync with the tiffconf.vc.h that is also provided and used by nmake 
builds. That would mean that there's an issue in the CMake configuration step 
with VS builds:
https://gitlab.com/libtiff/libtiff/blob/master/CMakeLists.txt#L394

Actually, I just found a CI with CMake + Windows at
https://ci.appveyor.com/project/rleigh-codelibre/libtiff-didfs/builds/
25846668/job/ory5w098j8wcij9x
where I can see:

[00:02:58] -- CMAKE_HOST_SYSTEM_PROCESSOR set to AMD64
[00:02:58] -- HOST_FILLORDER set to FILLORDER_MSB2LSB

So this seems to be a case sensitivity issue when comparing AMD64 vs amd64.
I've just submitted
https://gitlab.com/libtiff/libtiff/merge_requests/87
to fix this.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From alberto.monescillo at deimos-space.com  Mon Jul 15 04:41:25 2019
From: alberto.monescillo at deimos-space.com (Alberto Monescillo)
Date: Mon, 15 Jul 2019 13:41:25 +0200
Subject: [gdal-dev] GDAL and Kakadu library - Problem with float images
Message-ID: <CAOLy1puhtScmks8R9Ut8N4SB3zowvejvfBuFqAifOBc1B-Lsfw@mail.gmail.com>

Hi all,

I am trying to use gdal with kakadu library to write JPEG2000 images.
I need to write the output images as float images (GDT_Float32), but I am
not able.
I have tried different options, but the image is always generated as Byte
type.

I have reviewed the file 'jp2kakdataset.cpp', and in principle everything
seems to be correct according to kakadu documentation.

Is there anyone who knows how to do it?

I am using the CreateCopy method from the GDALDataset object previously
created.

Thanks in advance.

Regards,
  Alberto.

-- 




*Este mensaje va dirigido exclusivamente a
la(s) persona(s) indicada(s) 
y puede contener información/documentación
confidencial de carácter legal o 
personal del Grupo Deimos. La transmisión
errónea del presente mensaje en 
ningún momento supone renuncia a su
confidencialidad. Si el lector del 
mensaje no es el destinatario indicado
cualquier copia o distribución de 
esta comunicación queda estrictamente
prohibida. En este caso, rogamos que 
nos lo notifiquen inmediatamente por
teléfono y que remitan el mensaje 
original a la dirección de correo electrónico
indicada más arriba.*



*En 
cumplimiento de
lo dispuesto en el Reglamento 2016/679, del Parlamento 
Europeo y del Consejo y/o
en cualquier otra ley o normativa aplicable en 
materia de protección de datos
personales, le informamos que los datos 
personales serán tratados con la debida
confidencialidad y las medidas de 
seguridad exigidas de acuerdo con
nuestra **Política de Privacidad 
<http://www.elecnor-deimos.com/es/politica-de-privacidad/>**.*



 




*This message
is exclusively addressed to the mentioned person(s) and it

may contain confidential, proprietary or legally privileged

information/documentation of Deimos Group. No confidentiality or privilege 
is
waived or lost by any mistransmission. If the reader of this message is 
not the
intended recipient then any distribution or copying of this 
communication is
strictly prohibited. In this case please notify us 
immediately by telephone and
mail the original message to us at the address 
noted above.*



*In compliance with
the provisions of the Regulation (EU) 
2016/679 of the European
Parliament and of the Council and/or any other 
legislation and regulation
that may be applicable on the protection of 
personal data, we
hereby inform you that the personal data will be treated 
with the due
confidentiality and security measures required in accordance 
with our** **Privacy
Policy 
<http://www.elecnor-deimos.com/privacy-policy/>**.*

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190715/95e96149/attachment.html>

From even.rouault at spatialys.com  Mon Jul 15 04:56:01 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 15 Jul 2019 13:56:01 +0200
Subject: [gdal-dev] GDAL and Kakadu library - Problem with float images
In-Reply-To: <CAOLy1puhtScmks8R9Ut8N4SB3zowvejvfBuFqAifOBc1B-Lsfw@mail.gmail.com>
References: <CAOLy1puhtScmks8R9Ut8N4SB3zowvejvfBuFqAifOBc1B-Lsfw@mail.gmail.com>
Message-ID: <2039443.Gyk2Gzx8eY@even-i700>

On lundi 15 juillet 2019 13:41:25 CEST Alberto Monescillo wrote:
> Hi all,
> 
> I am trying to use gdal with kakadu library to write JPEG2000 images.
> I need to write the output images as float images (GDT_Float32), but I am
> not able.
> I have tried different options, but the image is always generated as Byte
> type.

The JPEG2000 baseline standard only supports integer images... So your best 
option is to apply a scale / offset to convert your floating point values to 
integer ones.

The JP2LURA driver ( https://gdal.org/drivers/raster/jp2lura.html ) has an 
experimental & non-standard feature to support Float32 values. See the 
SPLIT_IEEE754=YES creation option. Could potentially be transposed to other 
JPEG2000 capable drivers (provided they support 23 bit channels).

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From sebastic at xs4all.nl  Mon Jul 15 07:33:50 2019
From: sebastic at xs4all.nl (Sebastiaan Couwenberg)
Date: Mon, 15 Jul 2019 16:33:50 +0200
Subject: [gdal-dev] GDAL linked against CFITSIO on debian/ubuntu
In-Reply-To: <463989018.5084021.1563182419964.JavaMail.zimbra@u-psud.fr>
References: <341525187.19321965.1560438331822.JavaMail.zimbra@u-psud.fr>
 <d1637caa-28db-2dc1-4910-a05368bc3dcc@xs4all.nl>
 <463989018.5084021.1563182419964.JavaMail.zimbra@u-psud.fr>
Message-ID: <9b160ca8-1a3e-7cbe-692b-9baa88f505de@xs4all.nl>

On 7/15/19 11:20 AM, Chiara Marmo wrote:
> Do you mind if I open a new issue on the Debian bug tracker (if relevant) after their answer?

No. If there is user demand to support CFITSIO in the gdal package an
wishlist bugreport is a good way to express that.

Kind Regards,

Bas

-- 
 GPG Key ID: 4096R/6750F10AE88D4AF1
Fingerprint: 8182 DE41 7056 408D 6146  50D1 6750 F10A E88D 4AF1

From andrew.bell.ia at gmail.com  Mon Jul 15 08:33:40 2019
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Mon, 15 Jul 2019 11:33:40 -0400
Subject: [gdal-dev] 2.4 problem with OGRCoordinateTransformation?
Message-ID: <CACJ51z0GrJWBNE0ho5_AXBYx6JWDiAdzf_THewcTX1SQmTBu+Q@mail.gmail.com>

I'm seeing an issue with OGRCoordinateTransformation where the first point
passed to the transform is handled properly, but the second one is not.
I'm just seeing this on version 2.4.  Earlier versions are OK, as is 3.0
with identical code.  I don't know where the old tickets are, so I'm
wondering if anyone was aware of an issue that might have been fixed after
2.4.

Thanks,

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190715/0af00ed5/attachment.html>

From even.rouault at spatialys.com  Mon Jul 15 08:41:07 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 15 Jul 2019 17:41:07 +0200
Subject: [gdal-dev] 2.4 problem with OGRCoordinateTransformation?
In-Reply-To: <CACJ51z0GrJWBNE0ho5_AXBYx6JWDiAdzf_THewcTX1SQmTBu+Q@mail.gmail.com>
References: <CACJ51z0GrJWBNE0ho5_AXBYx6JWDiAdzf_THewcTX1SQmTBu+Q@mail.gmail.com>
Message-ID: <32570814.GvdIpuAy8x@even-i700>

On lundi 15 juillet 2019 11:33:40 CEST Andrew Bell wrote:
> I'm seeing an issue with OGRCoordinateTransformation where the first point
> passed to the transform is handled properly, but the second one is not.
> I'm just seeing this on version 2.4.  Earlier versions are OK, as is 3.0
> with identical code.  I don't know where the old tickets are, so I'm
> wondering if anyone was aware of an issue that might have been fixed after
> 2.4.

Andrew,

Are you really sure about that ? I can't see related differences in
ogr/ogrct.cpp between 2.3 and 2.4 that would have that effect.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From andrew.bell.ia at gmail.com  Mon Jul 15 08:45:00 2019
From: andrew.bell.ia at gmail.com (Andrew Bell)
Date: Mon, 15 Jul 2019 11:45:00 -0400
Subject: [gdal-dev] 2.4 problem with OGRCoordinateTransformation?
In-Reply-To: <32570814.GvdIpuAy8x@even-i700>
References: <CACJ51z0GrJWBNE0ho5_AXBYx6JWDiAdzf_THewcTX1SQmTBu+Q@mail.gmail.com>
 <32570814.GvdIpuAy8x@even-i700>
Message-ID: <CACJ51z371e035wBKJvKgEsU7wsaMJP8vE8eR8bgeeXv1tFJk7Q@mail.gmail.com>

On Mon, Jul 15, 2019 at 11:41 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> On lundi 15 juillet 2019 11:33:40 CEST Andrew Bell wrote:
> > I'm seeing an issue with OGRCoordinateTransformation where the first
> point
> > passed to the transform is handled properly, but the second one is not.
> > I'm just seeing this on version 2.4.  Earlier versions are OK, as is 3.0
> > with identical code.  I don't know where the old tickets are, so I'm
> > wondering if anyone was aware of an issue that might have been fixed
> after
> > 2.4.
>
> Andrew,
>
> Are you really sure about that ? I can't see related differences in
> ogr/ogrct.cpp between 2.3 and 2.4 that would have that effect.
>

I only know what's happening.  I was just trying to check if anyone
remembered an issue.  I'll trace things through.

Thanks,

-- 
Andrew Bell
andrew.bell.ia at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190715/5f71772e/attachment.html>

From adrianaparra at nevada.unr.edu  Mon Jul 15 09:20:03 2019
From: adrianaparra at nevada.unr.edu (Adriana Parra)
Date: Mon, 15 Jul 2019 09:20:03 -0700
Subject: [gdal-dev] Help with band pixel functions
In-Reply-To: <CAL=hy7+KFA6ebGVmkjdqEcKOVTeZGhpWO9ziaAs1QY=YdLK=vQ@mail.gmail.com>
References: <CAL=hy7+KFA6ebGVmkjdqEcKOVTeZGhpWO9ziaAs1QY=YdLK=vQ@mail.gmail.com>
Message-ID: <CAL=hy7LD46BM+Br+03Xms3iW_HAzi+yyjR+r8PqYSBKbbnSZ8w@mail.gmail.com>

Hello Steven,

Thank you for your reply. I should have mentioned that my ultimate goal is
to mosaic more than two images, so I don't know if the workflow that you
suggest would work in that case. I did use your suggestion of masking
values, and changed the VRT python function to this:

import numpy as np

def average(in_ar, out_ar, xoff, yoff, xsize, ysize,
raster_xsize,raster_ysize, buf_radius, gt, **kwargs):
    x = np.ma.masked_greater(in_ar, 100)
    np.mean(x, axis = 0,out = out_ar, dtype = 'uint8')


That worked, but now I have a new issue. I want to try a maximum function
instead of mean to evaluate if the resulting mosaic would look seamless, I
tried this:

import numpy as np

def average(in_ar, out_ar, xoff, yoff, xsize, ysize,
raster_xsize,raster_ysize, buf_radius, gt, **kwargs):
    x = np.ma.masked_greater(in_ar, 100)
    out_ar[:] = np.ma.max(x, axis = 0, fill_value=0)

The max function works fine in areas where there is data, but for some
reason, areas of overlapping NA values result in a pixel value of 63. I
tried setting the fill value of the masked areas to zero but that didn't
work. I appreciate any suggestions.

Kind regards,

Adriana.

On Mon, Jun 24, 2019 at 7:38 PM Adriana Parra <adrianaparra at nevada.unr.edu>
wrote:

> Hello,
>
> I have been trying to mosaic two images that partially overlap using band
> pixel functions in Python. My images contain unsigned integers (uint8) and
> the no data value is 255. I considered using the nanmean function so that I
> would get average values in overlapping areas of the two images and
> maintain the original value of the non-overlapping areas, but for some
> reason the NAN values are being interpreted as zero, resulting in half of
> the original value in non-overlapping areas.  I would really appreciate any
> feedback. I am using GDAL 3.1.0 and python 3.6. Bellow is the code I used
> and I am sending attached the input files.
> gdalbuildvrt  mosaic1.vrt -input_file_list  input_files.txt -srcnodata
> "255"
>
>  import numpy as np
> def average(in_ar, out_ar, xoff, yoff, xsize, ysize,
> raster_xsize,raster_ysize, buf_radius, gt, **kwargs):
>     np.round_(np.clip(np.nanmean(in_ar, axis = 0, dtype = 'uint8'),0,255),
>               out = out_ar)
>
> gdal_translate --config GDAL_VRT_ENABLE_PYTHON YES mosaic1.vrt mosaic1.tif
>
>  Mosaic1.jpeg
> <https://drive.google.com/a/nevada.unr.edu/file/d/1YgugcVnU6d5BmPYkYcotqBi3fFQcPpY8/view?usp=drive_web>
>  raw_files.jpeg
> <https://drive.google.com/a/nevada.unr.edu/file/d/1SQoH58V3MGtP-oXYnPYsf66snFOsWagC/view?usp=drive_web>
>  test_files.7z
> <https://drive.google.com/a/nevada.unr.edu/file/d/14No5nblxhNKeOU8k86Gfan7utYIUSqRU/view?usp=drive_web>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190715/86b646df/attachment.html>

From bontepaarden at gmail.com  Tue Jul 16 01:55:10 2019
From: bontepaarden at gmail.com (Paul Meems)
Date: Tue, 16 Jul 2019 10:55:10 +0200
Subject: [gdal-dev] 'HOST_FILLORDER': macro redefinition
In-Reply-To: <3705363.eos7rZdcOy@even-i700>
References: <CAHNf2YQ_0ymhLHXP=n1aT9wEGi9U+eOXcW1zNs4Skmtz+1LNYw@mail.gmail.com>
 <3705363.eos7rZdcOy@even-i700>
Message-ID: <CAHNf2YQjvcwKjrBEpju0vT0LLkAae_sm6jaxdAeUyBz+zveY0g@mail.gmail.com>

Thanks Even for the clarification.
We'll add the #undef.

Regards,

Paul


Op ma 15 jul. 2019 om 12:24 schreef Even Rouault <even.rouault at spatialys.com
>:

> > If it were redefining to the same value, that would be one thing, but
> since
> > it is redefining to another value, it makes you wonder 1) why is it
> coming
> > in differently, and 2) which value should it be?
>
> Paul, overall this doesn't seem critical as the only real use of
> HOST_FILLORDER in all GDAL, libtiff and libgeotiff code bases in in
> libtiff
> TIFFOpen() function when the esoteric 'H' open flag is used, and that one
> is
> likely rarely used (not used by GDAL typically). So you could just #undef
> HOST_FILLORDER between the 2 #include to silence the warning.
>
> Tamas, how is tiffconf.h in gisinternals produced, which has this
> unexpected
> #define HOST_FILLORDER FILLORDER_MSB2LSB (should be LSB2MSB for Intel
> platforms) ? Is this the result of cmake ? I guess so, as it doesn't seem
> to
> be in sync with the tiffconf.vc.h that is also provided and used by nmake
> builds. That would mean that there's an issue in the CMake configuration
> step
> with VS builds:
> https://gitlab.com/libtiff/libtiff/blob/master/CMakeLists.txt#L394
>
> Actually, I just found a CI with CMake + Windows at
> https://ci.appveyor.com/project/rleigh-codelibre/libtiff-didfs/builds/
> 25846668/job/ory5w098j8wcij9x
> <https://ci.appveyor.com/project/rleigh-codelibre/libtiff-didfs/builds/25846668/job/ory5w098j8wcij9x>
> where I can see:
>
> [00:02:58] -- CMAKE_HOST_SYSTEM_PROCESSOR set to AMD64
> [00:02:58] -- HOST_FILLORDER set to FILLORDER_MSB2LSB
>
> So this seems to be a case sensitivity issue when comparing AMD64 vs amd64.
> I've just submitted
> https://gitlab.com/libtiff/libtiff/merge_requests/87
> to fix this.
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190716/33347ff1/attachment.html>

From even.rouault at spatialys.com  Tue Jul 16 06:58:21 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 16 Jul 2019 15:58:21 +0200
Subject: [gdal-dev] RFC 75: Multidimensional arrays
In-Reply-To: <1607841.VsNMmxJ7cT@even-i700>
References: <1607841.VsNMmxJ7cT@even-i700>
Message-ID: <2063702.OmSmfgzPlj@even-i700>

Hi,

I've updated the RFC text at
https://github.com/OSGeo/gdal/pull/1580
Can be viewed at
https://github.com/rouault/gdal/blob/rfc75_text/gdal/doc/source/development/rfc/rfc75_multidimensional_arrays.rst

It is consistent with the initial implementation which is now available at
https://github.com/OSGeo/gdal/pull/1704 and includes C, C++
and Python API, core additions, changes in MEM, VRT and netCDF drivers,
and addition of gdalmdiminfo and gdalmdimtranslate utilities.
What is remaining is read-only support in HDF4, HDF5 and GRIB drivers.

I intend to submit the RFC to vote before the end of this week.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From bryantcurto at gmail.com  Tue Jul 16 07:32:30 2019
From: bryantcurto at gmail.com (Bryant)
Date: Tue, 16 Jul 2019 07:32:30 -0700 (MST)
Subject: [gdal-dev] gdalwarp - Erroneous Outputs
In-Reply-To: <1554738949004-0.post@n6.nabble.com>
References: <1554738949004-0.post@n6.nabble.com>
Message-ID: <1563287550409-0.post@n6.nabble.com>

bump



--
Sent from: http://osgeo-org.1560.x6.nabble.com/GDAL-Dev-f3742093.html

From even.rouault at spatialys.com  Tue Jul 16 07:42:41 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Tue, 16 Jul 2019 16:42:41 +0200
Subject: [gdal-dev] gdalwarp - Erroneous Outputs
In-Reply-To: <1554738949004-0.post@n6.nabble.com>
References: <1554738949004-0.post@n6.nabble.com>
Message-ID: <7519846.DzsT7hfrlr@even-i700>

On lundi 8 avril 2019 08:55:49 CEST Bryant wrote:
> Hello!
> 
> I've been trying to use /gdalbuildvrt/ and /gdalwarp/ to merge, project, and
> crop a set of overlapping images with a new resolution.
> 
> However, I've been running into an issue where the edges of the resulting
> image have nondeterministic, erroneous values (ie. very large and small
> values) and values in regions that I would expect only NoDataValues. The
> images are Float32, 1 banded, and have nodata =
> -340282346638528859811704183484516925440.

That's likely a precision issue in how you specify the nodata value or how it 
is serialized in the VRT. There have been fixes in that area (thinking to
https://github.com/OSGeo/gdal/issues/1071 ), but this is always fragile.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From caboe at sdfe.dk  Wed Jul 17 00:04:08 2019
From: caboe at sdfe.dk (=?iso-8859-1?Q?Casper_B=F8rgesen?=)
Date: Wed, 17 Jul 2019 07:04:08 +0000
Subject: [gdal-dev] Error when trying to create layer in FileGDB
Message-ID: <83b9b013d25d4a819946c900e0ee9eca@sdfe.dk>

Hi all,

I am trying to create a layer in an existing feature dataset in an existing File Geodatabase (FileGDB, not Open) using python and GDAL/OGR from OSGeo.

The layout of the FileGDB is:

MyData.gdb
     Data
          Polygon

The following is my code attempt:

>>> from osgeo import ogr
>>> ds = ogr.Open('MyData.gdb', 1)
>>> l = ds.CreateLayer('Line', None, ogr.wkbLineString, options=['FEATURE_DATASET=Data'])
ERROR 1: Failed at creating table for \Data\Line (Invalid spatial reference.)

Yes I didn't provide a spatial reference, but if None is invalid I might as well pick one used by an existing layer inside the feature dataset:

>>> l2 = ds.GetLayerByIndex(0)
>>> p2 = l2.GetSpatialRef()
>>> l2.GetName()
'Polygon'
>>> l = ds.CreateLayer('Line', p2, ogr.wkbLineString, options=['FEATURE_DATASET=Data'])
ERROR 1: Failed at creating table for \Data\Line (Invalid spatial reference.)

In both cases I get the same error, is this to be expected?

Regards, Casper

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190717/6c559aab/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: MyData.gdb.zip
Type: application/x-zip-compressed
Size: 24526 bytes
Desc: MyData.gdb.zip
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190717/6c559aab/attachment-0001.bin>

From even.rouault at spatialys.com  Wed Jul 17 01:51:12 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 17 Jul 2019 10:51:12 +0200
Subject: [gdal-dev] Error when trying to create layer in FileGDB
In-Reply-To: <83b9b013d25d4a819946c900e0ee9eca@sdfe.dk>
References: <83b9b013d25d4a819946c900e0ee9eca@sdfe.dk>
Message-ID: <1686872.W0DZdvQUPB@even-i700>

Casper,

I can reproduce. I tried a few things (including adding at hand definitions 
for MOrigin, MScale, MPrecision and LatestWKID that appear in the XML 
definition of the existing layer & feature dataset), but without success. It 
appears this is specific to creating the layer with FEATURE_DATASET=Data. 
Without that, it works. And there must be something specific to the SRS of the 
Data FeatureDataset too, because we have a test in the autotest suite that 
works:

    srs = osr.SpatialReference()
    srs.SetFromUserInput("WGS84")

    ds = ogrtest.fgdb_drv.CreateDataSource('tmp/test.gdb')
    ds.CreateLayer('layer1', srs=srs, geom_type=ogr.wkbPoint, 
options=['FEATURE_DATASET=featuredataset'])
    ds.CreateLayer('layer2', srs=srs, geom_type=ogr.wkbPoint, 
options=['FEATURE_DATASET=featuredataset'])
    ds = None

The joys of working with closed source software...

Even

> Hi all,
> 
> I am trying to create a layer in an existing feature dataset in an existing
> File Geodatabase (FileGDB, not Open) using python and GDAL/OGR from OSGeo.
> 
> The layout of the FileGDB is:
> 
> MyData.gdb
>      Data
>           Polygon
> 
> The following is my code attempt:
> >>> from osgeo import ogr
> >>> ds = ogr.Open('MyData.gdb', 1)
> >>> l = ds.CreateLayer('Line', None, ogr.wkbLineString,
> >>> options=['FEATURE_DATASET=Data'])
> ERROR 1: Failed at creating table for \Data\Line (Invalid spatial
> reference.)
> Yes I didn't provide a spatial reference, but if None is invalid I might as 
well pick one used by an existing layer inside the feature dataset:
> >>> l2 = ds.GetLayerByIndex(0)
> >>> p2 = l2.GetSpatialRef()
> >>> l2.GetName()
> 
> 'Polygon'
> 
> >>> l = ds.CreateLayer('Line', p2, ogr.wkbLineString,
> >>> options=['FEATURE_DATASET=Data'])
> ERROR 1: Failed at creating table for \Data\Line (Invalid spatial
> reference.)
> 
> In both cases I get the same error, is this to be expected?
> 
> Regards, Casper


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From caboe at sdfe.dk  Wed Jul 17 04:22:30 2019
From: caboe at sdfe.dk (=?iso-8859-1?Q?Casper_B=F8rgesen?=)
Date: Wed, 17 Jul 2019 11:22:30 +0000
Subject: [gdal-dev] Error when trying to create layer in FileGDB
In-Reply-To: <1686872.W0DZdvQUPB@even-i700>
References: <83b9b013d25d4a819946c900e0ee9eca@sdfe.dk>
 <1686872.W0DZdvQUPB@even-i700>
Message-ID: <34cea39fdbb9465d827fe2b588331e9b@sdfe.dk>

Hi Even,

Thanks for checking it out. I have a hard time seeing the joys of closed source software, but I continue to be tied to it and all its frustrations.

There definitely is something going on with the SRS even though OGR reports it as being the same:

>>> l2 = ds.GetLayerByIndex(0)
>>> p2 = l2.GetSpatialRef()
>>> p = srs.SpatialReference()
>>> p.ImportFromEPSG(25832)
>>> p.IsSame(p2)
1

If have done a little digging in ArcCatalog and it also complains about invalid spatial reference when I try to move the "Polygon" feature class to a feature dataset created by OGR with the above "p" SRS. I can't see the differences in ArcCatalog regarding the SRS but the domains are different. But again it is closed source so precisely where the difference is between the two, it won't tell me.

Thanks again!

Regards, Casper

 
-----Original Message-----
From: Even Rouault <even.rouault at spatialys.com> 
Sent: 17. juli 2019 10:51
To: gdal-dev at lists.osgeo.org
Cc: Casper Børgesen <caboe at sdfe.dk>
Subject: Re: [gdal-dev] Error when trying to create layer in FileGDB

Casper,

I can reproduce. I tried a few things (including adding at hand definitions 
for MOrigin, MScale, MPrecision and LatestWKID that appear in the XML 
definition of the existing layer & feature dataset), but without success. It 
appears this is specific to creating the layer with FEATURE_DATASET=Data. 
Without that, it works. And there must be something specific to the SRS of the 
Data FeatureDataset too, because we have a test in the autotest suite that 
works:

    srs = osr.SpatialReference()
    srs.SetFromUserInput("WGS84")

    ds = ogrtest.fgdb_drv.CreateDataSource('tmp/test.gdb')
    ds.CreateLayer('layer1', srs=srs, geom_type=ogr.wkbPoint, 
options=['FEATURE_DATASET=featuredataset'])
    ds.CreateLayer('layer2', srs=srs, geom_type=ogr.wkbPoint, 
options=['FEATURE_DATASET=featuredataset'])
    ds = None

The joys of working with closed source software...

Even

> Hi all,
> 
> I am trying to create a layer in an existing feature dataset in an existing
> File Geodatabase (FileGDB, not Open) using python and GDAL/OGR from OSGeo.
> 
> The layout of the FileGDB is:
> 
> MyData.gdb
>      Data
>           Polygon
> 
> The following is my code attempt:
> >>> from osgeo import ogr
> >>> ds = ogr.Open('MyData.gdb', 1)
> >>> l = ds.CreateLayer('Line', None, ogr.wkbLineString,
> >>> options=['FEATURE_DATASET=Data'])
> ERROR 1: Failed at creating table for \Data\Line (Invalid spatial
> reference.)
> Yes I didn't provide a spatial reference, but if None is invalid I might as 
well pick one used by an existing layer inside the feature dataset:
> >>> l2 = ds.GetLayerByIndex(0)
> >>> p2 = l2.GetSpatialRef()
> >>> l2.GetName()
> 
> 'Polygon'
> 
> >>> l = ds.CreateLayer('Line', p2, ogr.wkbLineString,
> >>> options=['FEATURE_DATASET=Data'])
> ERROR 1: Failed at creating table for \Data\Line (Invalid spatial
> reference.)
> 
> In both cases I get the same error, is this to be expected?
> 
> Regards, Casper


-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From dirk.vdb at gmail.com  Wed Jul 17 05:52:55 2019
From: dirk.vdb at gmail.com (Dirk Vanden Boer)
Date: Wed, 17 Jul 2019 14:52:55 +0200
Subject: [gdal-dev] OSRSetPROJSearchPaths in multithreaded application
Message-ID: <CADuK5a2gsn7=62LhvLAan6zEVq86MyiU343zet8TA4-TxY5-+g@mail.gmail.com>

After migrating to gdal 3 I'm having problems performing coordinate
transformations in a multi-threaded application.

My proj.db is in a nonstandard location so I call the
OSRSetPROJSearchPaths once on the main thread before the call to
GDALAllRegister()

I can do coordinate transformations on my main thread, but on worker
threads I get the proj error "Cannot find proj.db".

Calling OSRSetPROJSearchPaths in each worker thread does not seem to
work either.

What is the correct way to get coordinate transformations working on
all my threads?

Kind regards,
Dirk

From even.rouault at spatialys.com  Wed Jul 17 06:14:15 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 17 Jul 2019 15:14:15 +0200
Subject: [gdal-dev] OSRSetPROJSearchPaths in multithreaded application
In-Reply-To: <CADuK5a2gsn7=62LhvLAan6zEVq86MyiU343zet8TA4-TxY5-+g@mail.gmail.com>
References: <CADuK5a2gsn7=62LhvLAan6zEVq86MyiU343zet8TA4-TxY5-+g@mail.gmail.com>
Message-ID: <1649689.ijBBJRvSoZ@even-i700>

On mercredi 17 juillet 2019 14:52:55 CEST Dirk Vanden Boer wrote:
> After migrating to gdal 3 I'm having problems performing coordinate
> transformations in a multi-threaded application.
> 
> My proj.db is in a nonstandard location so I call the
> OSRSetPROJSearchPaths once on the main thread before the call to
> GDALAllRegister()
> 
> I can do coordinate transformations on my main thread, but on worker
> threads I get the proj error "Cannot find proj.db".

Hum, this is supposed to work. I've just enhanced the following test to check that and it works:

https://github.com/OSGeo/gdal/blob/master/autotest/cpp/test_osr_set_proj_search_paths.cpp

> 
> Calling OSRSetPROJSearchPaths in each worker thread does not seem to
> work either.

You don't even need that. There's logic to handle that automagically.

To debug this, you could set a breakpoint to OSRGetProjTLSContext() and see if
it calls proj_context_set_search_paths() at least once per thread.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From Tim.Martin at os.uk  Wed Jul 17 07:28:03 2019
From: Tim.Martin at os.uk (Tim Martin)
Date: Wed, 17 Jul 2019 14:28:03 +0000
Subject: [gdal-dev] ogrinfo json output
Message-ID: <LO2P123MB2445F66D2E37BD751EC80EBA85C90@LO2P123MB2445.GBRP123.PROD.OUTLOOK.COM>

Hi

Looking at gdalinfo there is a parameter to get json output (https://gdal.org/programs/gdalinfo.html#cmdoption-gdalinfo-json) and reading this https://trac.osgeo.org/gdal/wiki/rfc44_gdalinfoxml it was proposed that this would be implemented to ogrinfo as well. Looking at the docs I do not see a mention of that parameter for ogrinfo?

Is this possible somehow?

Or do I need to manually parse the STDOUT and STDERR?

Thanks

Tim


This email is only intended for the person to whom it is addressed and may contain confidential information. If you have received this email in error, please notify the sender and delete this email which must not be copied, distributed or disclosed to any other person.

Unless stated otherwise, the contents of this email are personal to the writer and do not represent the official view of Ordnance Survey. Nor can any contract be formed on Ordnance Survey's behalf via email. We reserve the right to monitor emails and attachments without prior notice.

Thank you for your cooperation.

Ordnance Survey Limited (Company Registration number 09121572)
Registered Office: Explorer House
Adanac Drive
Southampton SO16 0AS
Tel: 03456 050505
http://www.os.uk
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190717/ed21618e/attachment.html>

From dirk.vdb at gmail.com  Wed Jul 17 08:01:45 2019
From: dirk.vdb at gmail.com (Dirk Vanden Boer)
Date: Wed, 17 Jul 2019 17:01:45 +0200
Subject: [gdal-dev] OSRSetPROJSearchPaths in multithreaded application
In-Reply-To: <1649689.ijBBJRvSoZ@even-i700>
References: <CADuK5a2gsn7=62LhvLAan6zEVq86MyiU343zet8TA4-TxY5-+g@mail.gmail.com>
 <1649689.ijBBJRvSoZ@even-i700>
Message-ID: <CADuK5a0cne36E=SM6UPRxMwOJrthzouT0L88dL4TAG=YATSdHQ@mail.gmail.com>

On Wed, Jul 17, 2019 at 3:14 PM Even Rouault <even.rouault at spatialys.com> wrote:
>
> On mercredi 17 juillet 2019 14:52:55 CEST Dirk Vanden Boer wrote:
> > After migrating to gdal 3 I'm having problems performing coordinate
> > transformations in a multi-threaded application.
> >
> > My proj.db is in a nonstandard location so I call the
> > OSRSetPROJSearchPaths once on the main thread before the call to
> > GDALAllRegister()
> >
> > I can do coordinate transformations on my main thread, but on worker
> > threads I get the proj error "Cannot find proj.db".
>
> Hum, this is supposed to work. I've just enhanced the following test to check that and it works:
>
> https://github.com/OSGeo/gdal/blob/master/autotest/cpp/test_osr_set_proj_search_paths.cpp
>
> >
> > Calling OSRSetPROJSearchPaths in each worker thread does not seem to
> > work either.
>
> You don't even need that. There's logic to handle that automagically.
>
> To debug this, you could set a breakpoint to OSRGetProjTLSContext() and see if
> it calls proj_context_set_search_paths() at least once per thread.

I did some more investigation, and it seems like the threading is
indeed not the issue.
The issue seems to be that the geotiff library also creates proj
contexts and these contexts do not have
the search paths that are passed to the OSRGetProjTLSContext call.

Callstack:
  bregilab.exe!osgeo::proj::io::DatabaseContext::Private::open(const
std::basic_string<char,std::char_traits<char>,std::allocator<char> > &
databasePath, projCtx_t * ctx) Line 578 C++
  bregilab.exe!osgeo::proj::io::DatabaseContext::create(const
std::basic_string<char,std::char_traits<char>,std::allocator<char> > &
databasePath, const
std::vector<std::basic_string<char,std::char_traits<char>,std::allocator<char>
>,std::allocator<std::basic_string<char,std::char_traits<char>,std::allocator<char>
> > > & auxiliaryDatabasePaths, projCtx_t * ctx) Line 888 C++
  bregilab.exe!projCppContext::projCppContext(projCtx_t * ctx, const
char * dbPath, const char * const * auxDbPaths) Line 174 C++
  bregilab.exe!getDBcontext(projCtx_t * ctx) Line 118 C++
  bregilab.exe!proj_create_from_database(projCtx_t * ctx, const char *
auth_name, const char * code, PJ_CATEGORY category, int
usePROJAlternativeGridNames, const char * const * options) Line 521
C++
  bregilab.exe!GTIFGetPCSInfoEx(projCtx_t * ctx, int nPCSCode, char *
* ppszEPSGName, short * pnProjOp, short * pnUOMLengthCode, short *
pnGeogCS) Line 165 C
> bregilab.exe!GTIFGetPCSInfo(int nPCSCode, char * * ppszEPSGName, short * pnProjOp, short * pnUOMLengthCode, short * pnGeogCS) Line 273 C
  bregilab.exe!GTIFGetOGISDefn(gtiff * hGTIF, GTIFDefn * psDefn) Line 506 C++
  bregilab.exe!GTiffDataset::LookForProjection() Line 12649 C++
  bregilab.exe!GTiffDataset::GetSpatialRef() Line 18067 C++
  bregilab.exe!GDALPamDataset::CloneInfo(GDALDataset * poSrcDS, int
nCloneFlags) Line 963 C++
  bregilab.exe!GTiffDataset::CreateCopy(const char * pszFilename,
GDALDataset * poSrcDS, int bStrict, char * * papszOptions,
int(*)(double, const char *, void *) pfnProgress, void *
pProgressData) Line 17513 C++
  bregilab.exe!GDALDriver::CreateCopy(const char * pszFilename,
GDALDataset * poSrcDS, int bStrict, char * * papszOptions,
int(*)(double, const char *, void *) pfnProgress, void *
pProgressData) Line 937 C++
  bregilab.exe!inf::gdal::RasterDriver::create_dataset_copy(const
inf::gdal::RasterDataSet & reference, const std::filesystem::path &
filename, gsl::span<std::basic_string<char,std::char_traits<char>,std::allocator<char>
> const ,-1> driverOptions) Line 497 C++
  ...
  Application code stripped

From even.rouault at spatialys.com  Wed Jul 17 08:57:27 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 17 Jul 2019 17:57:27 +0200
Subject: [gdal-dev] OSRSetPROJSearchPaths in multithreaded application
In-Reply-To: <CADuK5a0cne36E=SM6UPRxMwOJrthzouT0L88dL4TAG=YATSdHQ@mail.gmail.com>
References: <CADuK5a2gsn7=62LhvLAan6zEVq86MyiU343zet8TA4-TxY5-+g@mail.gmail.com>
 <1649689.ijBBJRvSoZ@even-i700>
 <CADuK5a0cne36E=SM6UPRxMwOJrthzouT0L88dL4TAG=YATSdHQ@mail.gmail.com>
Message-ID: <2018701.Ae6B88yUKQ@even-i700>

> I did some more investigation, and it seems like the threading is
> indeed not the issue.
> The issue seems to be that the geotiff library also creates proj
> contexts and these contexts do not have
> the search paths that are passed to the OSRGetProjTLSContext call.

Should be fixed per
https://github.com/OSGeo/gdal/commit/48793b5613cf1bf789125516ba845947dc63098f
in master
and
https://github.com/OSGeo/gdal/commit/ffb0ad0c862cf4ef5d6907d1d83cc76fcf8c305b
in 3.0 branch

This requires GDAL to be built against its internal libgeotiff, or using 
latest (= a few minutes ago) libgeotiff from OSGeo/libgeotiff HEAD.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From dirk.vdb at gmail.com  Wed Jul 17 10:27:14 2019
From: dirk.vdb at gmail.com (Dirk Vanden Boer)
Date: Wed, 17 Jul 2019 19:27:14 +0200
Subject: [gdal-dev] OSRSetPROJSearchPaths in multithreaded application
In-Reply-To: <2018701.Ae6B88yUKQ@even-i700>
References: <CADuK5a2gsn7=62LhvLAan6zEVq86MyiU343zet8TA4-TxY5-+g@mail.gmail.com>
 <1649689.ijBBJRvSoZ@even-i700>
 <CADuK5a0cne36E=SM6UPRxMwOJrthzouT0L88dL4TAG=YATSdHQ@mail.gmail.com>
 <2018701.Ae6B88yUKQ@even-i700>
Message-ID: <CADuK5a1j34J4AQE4yoMCXj6XisbRL3LAOSfjRHFbhyxEQHkqJw@mail.gmail.com>

Op wo 17 jul. 2019 om 17:57 schreef Even Rouault <even.rouault at spatialys.com
>

> > I did some more investigation, and it seems like the threading is
> > indeed not the issue.
> > The issue seems to be that the geotiff library also creates proj
> > contexts and these contexts do not have
> > the search paths that are passed to the OSRGetProjTLSContext call.
>
> Should be fixed per
>
> https://github.com/OSGeo/gdal/commit/48793b5613cf1bf789125516ba845947dc63098f
> in master
> and
>
> https://github.com/OSGeo/gdal/commit/ffb0ad0c862cf4ef5d6907d1d83cc76fcf8c305b
> in 3.0 branch
>

Great, thanks for the quick response and fixes!

>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190717/60e0db42/attachment.html>

From even.rouault at spatialys.com  Thu Jul 18 02:37:08 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 18 Jul 2019 11:37:08 +0200
Subject: [gdal-dev] Motion: adopt RFC 75: Multidimensional array
Message-ID: <2401956.U8z5d6L4Wr@even-i700>

Hi,

I motion to adopt RFC 75: Multidimensional array

        https://github.com/OSGeo/gdal/pull/1580

-----------

Starting with my +1

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From epiciskandar at gmail.com  Thu Jul 18 05:45:42 2019
From: epiciskandar at gmail.com (beng in)
Date: Thu, 18 Jul 2019 20:45:42 +0800
Subject: [gdal-dev] failed using with GPKG driver
Message-ID: <CACKQaoB4+-CWtPJYpv9J2_Jo5cTcKa52tPu_7VMY-VhoXK=P-g@mail.gmail.com>

Hi, I compiled GDAL 2.3.3 under Windows/MSVC_VER=1910 with nmake.opt almost
unchaned, everything looks fine, the gdal.dll and bunch of exe files
succeesfully generated.
but when I tried to use gdal such like:

(c++)
GDALAllRegister();
auto ds(GDALDataset::Open("filepath/to/a/.gpkg",
GDAL_OF_VECTOR|GDAL_OF_VERBOSE_ERROR, nullptr,....))

it failed, ds is NULL. with error msg, gdal told that the file not
recognized as a supported file format.
and then I tried run "ogrinfo.exe --formats", cannot found GPKG/GEOPKG.
so, am I wrong in any step with compile or misuse? thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190718/541a3450/attachment.html>

From even.rouault at spatialys.com  Thu Jul 18 05:50:01 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 18 Jul 2019 14:50:01 +0200
Subject: [gdal-dev] failed using with GPKG driver
In-Reply-To: <CACKQaoB4+-CWtPJYpv9J2_Jo5cTcKa52tPu_7VMY-VhoXK=P-g@mail.gmail.com>
References: <CACKQaoB4+-CWtPJYpv9J2_Jo5cTcKa52tPu_7VMY-VhoXK=P-g@mail.gmail.com>
Message-ID: <9962850.V0hkyuXYUt@even-i700>

On jeudi 18 juillet 2019 20:45:42 CEST beng in wrote:
> Hi, I compiled GDAL 2.3.3 under Windows/MSVC_VER=1910 with nmake.opt almost
> unchaned, everything looks fine, the gdal.dll and bunch of exe files
> succeesfully generated.
> but when I tried to use gdal such like:
> 
> (c++)
> GDALAllRegister();
> auto ds(GDALDataset::Open("filepath/to/a/.gpkg",
> GDAL_OF_VECTOR|GDAL_OF_VERBOSE_ERROR, nullptr,....))
> 
> it failed, ds is NULL. with error msg, gdal told that the file not
> recognized as a supported file format.
> and then I tried run "ogrinfo.exe --formats", cannot found GPKG/GEOPKG.
> so, am I wrong in any step with compile or misuse? thanks.

you need to add at least the SQLite3 dependency at build time. See
https://github.com/OSGeo/gdal/blob/master/appveyor.yml#L98
for a build recipee based on the SDK available at
http://gisinternals.com/sdk.php

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From sean at mapbox.com  Thu Jul 18 08:20:13 2019
From: sean at mapbox.com (Sean Gillies)
Date: Thu, 18 Jul 2019 09:20:13 -0600
Subject: [gdal-dev] RFC 75: Multidimensional arrays
In-Reply-To: <2063702.OmSmfgzPlj@even-i700>
References: <1607841.VsNMmxJ7cT@even-i700> <2063702.OmSmfgzPlj@even-i700>
Message-ID: <CADPhZXzBaPxSC_z=1gaMuK7JsWCk3_iX0oP2nVHzv_aVZJEqKg@mail.gmail.com>

Hi Even,

GDAL will already read and write multidimensional arrays
using GDALDatasetRasterIO, yes? Arrays of a single type per dimension, but
that's conventional for N-D array implementations like Numpy. Perhaps the
RFC and feature would be better named "hierarchical data"?


On Tue, Jul 16, 2019 at 7:58 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> I've updated the RFC text at
> https://github.com/OSGeo/gdal/pull/1580
> Can be viewed at
>
> https://github.com/rouault/gdal/blob/rfc75_text/gdal/doc/source/development/rfc/rfc75_multidimensional_arrays.rst
>
> It is consistent with the initial implementation which is now available at
> https://github.com/OSGeo/gdal/pull/1704 and includes C, C++
> and Python API, core additions, changes in MEM, VRT and netCDF drivers,
> and addition of gdalmdiminfo and gdalmdimtranslate utilities.
> What is remaining is read-only support in HDF4, HDF5 and GRIB drivers.
>
> I intend to submit the RFC to vote before the end of this week.
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev



-- 
Sean Gillies
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190718/79cc5194/attachment.html>

From norman.barker at gmail.com  Thu Jul 18 08:27:53 2019
From: norman.barker at gmail.com (Norman Barker)
Date: Thu, 18 Jul 2019 10:27:53 -0500
Subject: [gdal-dev] Motion: adopt RFC 75: Multidimensional array
In-Reply-To: <2401956.U8z5d6L4Wr@even-i700>
References: <2401956.U8z5d6L4Wr@even-i700>
Message-ID: <CAN_Dn-HNDDvXLwE2s7LPnGyRXjDe6DYmvkb4=eM1QdMZ0vYcXQ@mail.gmail.com>

Even,

I am in favour of the work on multi-dimensional arrays. There are two open
PRs https://github.com/rouault/gdal/pulls with changes to the text. Though
I and my employer would like TileDB included in the list of formats (though
happy to wait until I have added the code to support this) the issues
around dimension ordering and defining NULL are two things I would like to
discuss.

I am +1 for the PR

Norman

On Thu, Jul 18, 2019 at 4:37 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> I motion to adopt RFC 75: Multidimensional array
>
>         https://github.com/OSGeo/gdal/pull/1580
>
> -----------
>
> Starting with my +1
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190718/300c0bc5/attachment.html>

From even.rouault at spatialys.com  Thu Jul 18 08:35:15 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 18 Jul 2019 17:35:15 +0200
Subject: [gdal-dev] RFC 75: Multidimensional arrays
In-Reply-To: <CADPhZXzBaPxSC_z=1gaMuK7JsWCk3_iX0oP2nVHzv_aVZJEqKg@mail.gmail.com>
References: <1607841.VsNMmxJ7cT@even-i700> <2063702.OmSmfgzPlj@even-i700>
 <CADPhZXzBaPxSC_z=1gaMuK7JsWCk3_iX0oP2nVHzv_aVZJEqKg@mail.gmail.com>
Message-ID: <4241573.yoXWktf1Un@even-i700>

On jeudi 18 juillet 2019 09:20:13 CEST Sean Gillies wrote:
> Hi Even,
> 
> GDAL will already read and write multidimensional arrays
> using GDALDatasetRasterIO, yes? 

No, that's a separate API. There's a bridge between both with the
GDALRasterBand::AsMDArray() and GDALMDArray::AsClassicDataset() methods.
The gdalmdimtranslate utility can also bridge between the 2 worlds. That is if 
you export a 4D array as a GeoTIFF, it will use  
GDALMDArray::AsClassicDataset() and will expose the non-XY dimensions as many 
bnds as needed.

> Arrays of a single type per dimension, but
> that's conventional for N-D array implementations like Numpy.

Not sure to understand the above. The data type is the same for a given array. 
Yes, ala NumPy.

> Perhaps the
> RFC and feature would be better named "hierarchical data"?

This is both actually: hierarchial data + multidimensional arrays.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From even.rouault at spatialys.com  Thu Jul 18 08:48:56 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 18 Jul 2019 17:48:56 +0200
Subject: [gdal-dev] Motion: adopt RFC 75: Multidimensional array
In-Reply-To: <CAN_Dn-HNDDvXLwE2s7LPnGyRXjDe6DYmvkb4=eM1QdMZ0vYcXQ@mail.gmail.com>
References: <2401956.U8z5d6L4Wr@even-i700>
 <CAN_Dn-HNDDvXLwE2s7LPnGyRXjDe6DYmvkb4=eM1QdMZ0vYcXQ@mail.gmail.com>
Message-ID: <2862796.1sHKWOxIRJ@even-i700>

Hi,

> 
> I am in favour of the work on multi-dimensional arrays. There are two open
> PRs https://github.com/rouault/gdal/pulls with changes to the text. 

Oh I didn't see them before. I've merged the first one from Edzer. Answering 
yours now:

> Though
> I and my employer would like TileDB included in the list of formats (though
> happy to wait until I have added the code to support this) 

I'd prefer to limit the scope of the RFC to the drivers I'll take care of. 
Other contributors are welcome to implement it for their own drivers of 
interest once this has landed into master.

> the issues
> around dimension ordering

https://github.com/rouault/gdal/blob/rfc75/gdal/doc/source/user/
multidim_raster_data_model.rst mentions

"""Most drivers use the row-major convention for dimensions: that is, when 
considering that the array elemnts are stored consecutively in memory, the 
first dimension is the slowest varying one (in a 2D image, the row), and the 
last dimension the fastest varying one (in a 2D image, the colum). That 
convention is the default convention used for NumPy arrays, the MEM driver and 
the HDF5 and netCDF APIs. The GDAL API is mostly agnostic about that 
convention, except when passing a NULL array as the stride parameter for the 
:cpp:func:`GDALAbstractMDArray::Read` and 
:cpp:func:`GDALAbstractMDArray::Write` methods. You can refer to NumPy 
documentation about multidimensional array indeing order issues:
https://docs.scipy.org/doc/numpy/reference/internals.html#multidimensional-array-indexing-order-issues """

Does that answer your concern / question ?

> and defining NULL are two things I would like to
> discuss.

Yes, nodata support is there. Mentionned in
https://github.com/rouault/gdal/blob/rfc75/gdal/doc/source/user/
multidim_raster_data_model.rst#multidimensional-array

and in the C++ API:
https://github.com/rouault/gdal/blob/rfc75/gdal/gcore/gdal_priv.h#L2257

so 2 virtual methods that can be implemented by drivers:
const void* GetRawNoDataValue() const;
bool SetRawNoDataValue(const void* pRawNoData);

and 2 helpers that get/set as double for the common cases.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From norman.barker at gmail.com  Thu Jul 18 09:34:54 2019
From: norman.barker at gmail.com (Norman Barker)
Date: Thu, 18 Jul 2019 11:34:54 -0500
Subject: [gdal-dev] Motion: adopt RFC 75: Multidimensional array
In-Reply-To: <2862796.1sHKWOxIRJ@even-i700>
References: <2401956.U8z5d6L4Wr@even-i700>
 <CAN_Dn-HNDDvXLwE2s7LPnGyRXjDe6DYmvkb4=eM1QdMZ0vYcXQ@mail.gmail.com>
 <2862796.1sHKWOxIRJ@even-i700>
Message-ID: <CAN_Dn-GpN4Fi9MwvQUoAwd3LZ3XGSZYMuKQbsNKY3dL1eChing@mail.gmail.com>

Hi Even,

thanks for the clarification around indexing and nodata. This works great
and when I have availability and your changes last in master I will upgrade
the tiledb driver.

+1 from me.

Norman

On Thu, Jul 18, 2019 at 10:48 AM Even Rouault <even.rouault at spatialys.com>
wrote:

> Hi,
>
> >
> > I am in favour of the work on multi-dimensional arrays. There are two
> open
> > PRs https://github.com/rouault/gdal/pulls with changes to the text.
>
> Oh I didn't see them before. I've merged the first one from Edzer.
> Answering
> yours now:
>
> > Though
> > I and my employer would like TileDB included in the list of formats
> (though
> > happy to wait until I have added the code to support this)
>
> I'd prefer to limit the scope of the RFC to the drivers I'll take care of.
> Other contributors are welcome to implement it for their own drivers of
> interest once this has landed into master.
>
> > the issues
> > around dimension ordering
>
> https://github.com/rouault/gdal/blob/rfc75/gdal/doc/source/user/
> multidim_raster_data_model.rst mentions
>
> """Most drivers use the row-major convention for dimensions: that is, when
> considering that the array elemnts are stored consecutively in memory, the
> first dimension is the slowest varying one (in a 2D image, the row), and
> the
> last dimension the fastest varying one (in a 2D image, the colum). That
> convention is the default convention used for NumPy arrays, the MEM driver
> and
> the HDF5 and netCDF APIs. The GDAL API is mostly agnostic about that
> convention, except when passing a NULL array as the stride parameter for
> the
> :cpp:func:`GDALAbstractMDArray::Read` and
> :cpp:func:`GDALAbstractMDArray::Write` methods. You can refer to NumPy
> documentation about multidimensional array indeing order issues:
>
> https://docs.scipy.org/doc/numpy/reference/internals.html#multidimensional-array-indexing-order-issues
> """
>
> Does that answer your concern / question ?
>
> > and defining NULL are two things I would like to
> > discuss.
>
> Yes, nodata support is there. Mentionned in
> https://github.com/rouault/gdal/blob/rfc75/gdal/doc/source/user/
> multidim_raster_data_model.rst#multidimensional-array
>
> and in the C++ API:
> https://github.com/rouault/gdal/blob/rfc75/gdal/gcore/gdal_priv.h#L2257
>
> so 2 virtual methods that can be implemented by drivers:
> const void* GetRawNoDataValue() const;
> bool SetRawNoDataValue(const void* pRawNoData);
>
> and 2 helpers that get/set as double for the common cases.
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190718/164c84b5/attachment-0001.html>

From howard at hobu.co  Fri Jul 19 11:40:45 2019
From: howard at hobu.co (Howard Butler)
Date: Fri, 19 Jul 2019 13:40:45 -0500
Subject: [gdal-dev] Motion: adopt RFC 75: Multidimensional array
In-Reply-To: <CAN_Dn-GpN4Fi9MwvQUoAwd3LZ3XGSZYMuKQbsNKY3dL1eChing@mail.gmail.com>
References: <2401956.U8z5d6L4Wr@even-i700>
 <CAN_Dn-HNDDvXLwE2s7LPnGyRXjDe6DYmvkb4=eM1QdMZ0vYcXQ@mail.gmail.com>
 <2862796.1sHKWOxIRJ@even-i700>
 <CAN_Dn-GpN4Fi9MwvQUoAwd3LZ3XGSZYMuKQbsNKY3dL1eChing@mail.gmail.com>
Message-ID: <BB316DA5-FBB4-45F0-B92B-14FCFE42B697@hobu.co>

+1 Howard

> On Jul 18, 2019, at 11:34 AM, Norman Barker <norman.barker at gmail.com> wrote:
> 
> Hi Even,
> 
> thanks for the clarification around indexing and nodata. This works great and when I have availability and your changes last in master I will upgrade the tiledb driver.
> 
> +1 from me.
> 
> Norman
> 
> On Thu, Jul 18, 2019 at 10:48 AM Even Rouault <even.rouault at spatialys.com <mailto:even.rouault at spatialys.com>> wrote:
> Hi,
> 
> > 
> > I am in favour of the work on multi-dimensional arrays. There are two open
> > PRs https://github.com/rouault/gdal/pulls <https://github.com/rouault/gdal/pulls> with changes to the text. 
> 
> Oh I didn't see them before. I've merged the first one from Edzer. Answering 
> yours now:
> 
> > Though
> > I and my employer would like TileDB included in the list of formats (though
> > happy to wait until I have added the code to support this) 
> 
> I'd prefer to limit the scope of the RFC to the drivers I'll take care of. 
> Other contributors are welcome to implement it for their own drivers of 
> interest once this has landed into master.
> 
> > the issues
> > around dimension ordering
> 
> https://github.com/rouault/gdal/blob/rfc75/gdal/doc/source/user/ <https://github.com/rouault/gdal/blob/rfc75/gdal/doc/source/user/>
> multidim_raster_data_model.rst mentions
> 
> """Most drivers use the row-major convention for dimensions: that is, when 
> considering that the array elemnts are stored consecutively in memory, the 
> first dimension is the slowest varying one (in a 2D image, the row), and the 
> last dimension the fastest varying one (in a 2D image, the colum). That 
> convention is the default convention used for NumPy arrays, the MEM driver and 
> the HDF5 and netCDF APIs. The GDAL API is mostly agnostic about that 
> convention, except when passing a NULL array as the stride parameter for the 
> :cpp:func:`GDALAbstractMDArray::Read` and 
> :cpp:func:`GDALAbstractMDArray::Write` methods. You can refer to NumPy 
> documentation about multidimensional array indeing order issues:
> https://docs.scipy.org/doc/numpy/reference/internals.html#multidimensional-array-indexing-order-issues <https://docs.scipy.org/doc/numpy/reference/internals.html#multidimensional-array-indexing-order-issues> """
> 
> Does that answer your concern / question ?
> 
> > and defining NULL are two things I would like to
> > discuss.
> 
> Yes, nodata support is there. Mentionned in
> https://github.com/rouault/gdal/blob/rfc75/gdal/doc/source/user/ <https://github.com/rouault/gdal/blob/rfc75/gdal/doc/source/user/>
> multidim_raster_data_model.rst#multidimensional-array
> 
> and in the C++ API:
> https://github.com/rouault/gdal/blob/rfc75/gdal/gcore/gdal_priv.h#L2257 <https://github.com/rouault/gdal/blob/rfc75/gdal/gcore/gdal_priv.h#L2257>
> 
> so 2 virtual methods that can be implemented by drivers:
> const void* GetRawNoDataValue() const;
> bool SetRawNoDataValue(const void* pRawNoData);
> 
> and 2 helpers that get/set as double for the common cases.
> 
> Even
> 
> -- 
> Spatialys - Geospatial professional services
> http://www.spatialys.com <http://www.spatialys.com/>
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190719/cf38f83f/attachment.html>

From even.rouault at spatialys.com  Mon Jul 22 08:10:11 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Mon, 22 Jul 2019 17:10:11 +0200
Subject: [gdal-dev] Motion: adopt RFC 75: Multidimensional array
In-Reply-To: <2401956.U8z5d6L4Wr@even-i700>
References: <2401956.U8z5d6L4Wr@even-i700>
Message-ID: <5928058.43Lh7l8Wlu@even-i700>

On jeudi 18 juillet 2019 11:37:08 CEST Even Rouault wrote:
> Hi,
> 
> I motion to adopt RFC 75: Multidimensional array
> 
>         https://github.com/OSGeo/gdal/pull/1580
> 
> -----------

I declare this motion passed with +1 from PSC members NormanB, HowardB and 
myself.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From ivan.lucena at outlook.com  Wed Jul 24 06:18:57 2019
From: ivan.lucena at outlook.com (Ivan Lucena)
Date: Wed, 24 Jul 2019 13:18:57 +0000
Subject: [gdal-dev] Python RasterizeLayer and gdal_rasterize
Message-ID: <BN6PR2201MB1249F5D87828B190D45329FAF2C60@BN6PR2201MB1249.namprd22.prod.outlook.com>

Hi there,

I am having a problem with gdal.RasterizeLayer() in Python. I look at the documentation and code example in forums and tutorial but I can't find a solution to my problem.

My code is supposed to loops thru a shape files, with countries for example, and create a boolean image of each country but the images always come as all black pixels. It should use GDAL and OGR memory drivers but in order to debug the issue, I am saving one GEOJSON and one GTIFF file for each country.

What is most intriguing is that I can run gdal_rasterize with any of the countries pairs of file and it works as expected. I open it on QGIS and it all looks perfectly georeferenced too. The resolution is coming from another remote sensing image that I am using as reference. And again, everything works fine with the gdal_rasterize command, so it should be right.

Here is my code:

        geom_ds = ogr.GetDriverByName('GEOJSON').CreateDataSource('E:\TMP\MEMORY_%s.JSON' % name)
        geom_lyr = geom_ds.CreateLayer('MEMORY_LAYER', geom_type=ogr.wkbPolygon, srs=ref_srs)​
        geom_feat = ogr.Feature(geom_lyr.GetLayerDefn())​
        geom_feat.SetGeometry(geom)​
        geom_lyr.CreateFeature(geom_feat)​

        mem_ds = gdal.GetDriverByName('GTIFF').Create('E:\TMP\MEMORY_%s.TIF' % name, xcount, ycount, 1, gdal.GDT_Byte)​
        mem_ds.SetGeoTransform((​xmin, xResolut, 0,​ ymax, 0, yResolut,​))​
        mem_ds.SetProjection(ref_ds.GetProjectionRef())​
        mem_ds.FlushCache()​
   ​
        err = gdal.RasterizeLayer(mem_ds, [1], geom_lyr, burn_values=[1])​
        if err != 0:​
            print(err)​

Here is the command line:

(base) E:\TMP>gdal_rasterize MEMORY_Peru.JSON" "MEMORY_Peru.TIF" -burn 1

I am using GDAL 2.3.3 and Python 3.7.3 installed by Anaconda3 (64-bit). The function gdal.UseExceptions() was called but there is nothing been reported.

I might be asking too much, but if someone had the same experience and have found a solution and want to share, that would be awesome. Or maybe there is an obvious error on my code that you can point out. I tried several things like flushing and closing and re-opening the files,  to make sure that the data is ready for the functions, but nothing really helped.

One other thing is, once I got it to work, I am thinking that I don't need to prepare the little geometry file if I could call gdal.rasterizelayer() the original shape with a *query* for each country at the time. That should be more efficient, I guess.

Thank you for your attention and have a nice day everybody,

Ivan





-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190724/583db5b2/attachment.html>

From kai.muehlbauer at uni-bonn.de  Wed Jul 24 06:46:15 2019
From: kai.muehlbauer at uni-bonn.de (Kai Muehlbauer)
Date: Wed, 24 Jul 2019 15:46:15 +0200
Subject: [gdal-dev] Python RasterizeLayer and gdal_rasterize
In-Reply-To: <BN6PR2201MB1249F5D87828B190D45329FAF2C60@BN6PR2201MB1249.namprd22.prod.outlook.com>
References: <BN6PR2201MB1249F5D87828B190D45329FAF2C60@BN6PR2201MB1249.namprd22.prod.outlook.com>
Message-ID: <53a0472d-118c-cad0-c397-25b804606dbb@uni-bonn.de>

Hi Ivan,

I'm doing something similar in my application.

I remember that there were some issues with all black images, but I do
not recall the details. One thing, though, from comparing your snipped
with my code, I'm explicitely flushing the rasterband of the target dataset:

band = mem_ds.GetRasterBand(1)
band.FlushCache()

before doing the rasterization. There are other minor differences. If
you want to have a look into the code I can provide the github links.

Cheers,
Kai

Am 24.07.19 um 15:18 schrieb Ivan Lucena:
> Hi there,
> 
> I am having a problem with gdal.RasterizeLayer() in Python. I look at
> the documentation and code example in forums and tutorial but I can't
> find a solution to my problem.
> 
> My code is supposed to loops thru a shape files, with countries for
> example, and create a boolean image of each country but the images
> always come as all black pixels. Itshould use GDAL and OGR memory
> drivers but in order to debug the issue, I am saving one GEOJSON and one
> GTIFF file for each country.
> 
> What is most intriguing is that I can run gdal_rasterize with any of the
> countries pairs of file and it works as expected. I open it on QGIS and
> it all looks perfectly georeferenced too. The resolution is coming from
> another remote sensing image that I am using as reference. And again,
> everything works fine with the gdal_rasterize command, so it should be
> right.
> 
> Here is my code:
> 
>         geom_ds =
> ogr.GetDriverByName('GEOJSON').CreateDataSource('E:\TMP\MEMORY_%s.JSON'
> % name)
>         geom_lyr = geom_ds.CreateLayer('MEMORY_LAYER',
> geom_type=ogr.wkbPolygon, srs=ref_srs)​
>         geom_feat = ogr.Feature(geom_lyr.GetLayerDefn())​
>         geom_feat.SetGeometry(geom)​
>        geom_lyr.CreateFeature(geom_feat)​
> 
>         mem_ds =
> gdal.GetDriverByName('GTIFF').Create('E:\TMP\MEMORY_%s.TIF' % name,
> xcount, ycount, 1, gdal.GDT_Byte)​
>         mem_ds.SetGeoTransform((​xmin, xResolut, 0,​ ymax, 0, yResolut,​))​
>         mem_ds.SetProjection(ref_ds.GetProjectionRef())​
>         mem_ds.FlushCache()​
>    ​
>         err = gdal.RasterizeLayer(mem_ds, [1], geom_lyr, burn_values=[1])​
>         if err != 0:​
>             print(err)​
> 
> Here is the command line:
> 
>     (base) E:\TMP>gdal_rasterize MEMORY_Peru.JSON" "MEMORY_Peru.TIF" -burn 1
> 
> 
> I am using GDAL 2.3.3 and Python 3.7.3 installed by Anaconda3 (64-bit).
> The function gdal.UseExceptions() was called but there is nothing been
> reported.
> 
> I might be asking too much, but if someone had the same experience and
> have found a solution and want to share, that would be awesome. Or maybe
> there is an obvious error on my code that you can point out. I tried
> several things like flushing and closing and re-opening the files,  to
> make sure that the data is ready for the functions, but nothing really
> helped.
> 
> One other thing is, once I got it to work, I am thinking that I don't
> need to prepare the little geometry file if I could call
> gdal.rasterizelayer() the original shape with a *query* for each country
> at the time. That should be more efficient, I guess.
> 
> Thank you for your attention and have a nice day everybody,
> 
> Ivan
> 
> 
> 
> 
> 
> 
> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
> 

-- 
Kai Muehlbauer
Institute for Geosciences and Meteorology University of Bonn
Auf dem Huegel 20       | +49 228 739083
D-53121 Bonn            | kai.muehlbauer at uni-bonn.de

From even.rouault at spatialys.com  Wed Jul 24 07:57:53 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 24 Jul 2019 16:57:53 +0200
Subject: [gdal-dev] Python RasterizeLayer and gdal_rasterize
In-Reply-To: <BN6PR2201MB1249F5D87828B190D45329FAF2C60@BN6PR2201MB1249.namprd22.prod.outlook.com>
References: <BN6PR2201MB1249F5D87828B190D45329FAF2C60@BN6PR2201MB1249.namprd22.prod.outlook.com>
Message-ID: <6603615.oSoERWfJL7@even-i700>

Ivan,

what comes to mind is a SRS mismatch issue. From what I can see 
gdal.RasterizeLayer() takes a pfnTransformer / pTransformArg for that, but I'm 
not sure if they are probably mapped to SWIG to something practical.

You might try instead with the gdal.Rasterize() "utility as a C function" that 
is higher level and should take care of that automagically

usage examples in autotest/utilities/test_gdal_rasterize_lib.py

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From ivan.lucena at outlook.com  Wed Jul 24 12:38:34 2019
From: ivan.lucena at outlook.com (Ivan Lucena)
Date: Wed, 24 Jul 2019 19:38:34 +0000
Subject: [gdal-dev] Python RasterizeLayer and gdal_rasterize
In-Reply-To: <6603615.oSoERWfJL7@even-i700>
References: <BN6PR2201MB1249F5D87828B190D45329FAF2C60@BN6PR2201MB1249.namprd22.prod.outlook.com>,
 <6603615.oSoERWfJL7@even-i700>
Message-ID: <BN6PR2201MB1249A4CC3097B1DECE838FD7F2C60@BN6PR2201MB1249.namprd22.prod.outlook.com>

Even, Kai,

Thank you both for your reply.

Adding a band.FlushCache() did not fixed the problem but it was a good point anyway. Thanks Kai.

I tried to use the gdal.Rasterize() instead of gdal.RasterizeLayer() without success. There example on autotest varies quit a bit and I could not match one that works.

The geojson and geotiff files have the exactly same SRS (EPSG:4326) and they overlap perfectly fine on QGIS. But it seems like the issue might be related to SRS anyway.

Running the script from the Spyder IDE I was missing a warning message that now I can see by running "python script.py" on command line:

Warning 1: Failed to fetch spatial reference on layer MEMORY_LAYER to build transformer, assuming matching coordinate systems.

If I understood what Even said, I could fix that issue before calling gdal.RasterizeLayer() or use gdal.Rasterize() with the a transformation operation to fix the problem.

I am going to work on that. Thank you again so very much,

Ivan



________________________________
From: Even Rouault <even.rouault at spatialys.com>
Sent: Wednesday, July 24, 2019 10:57 AM
To: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Cc: Ivan Lucena <ivan.lucena at outlook.com>
Subject: Re: [gdal-dev] Python RasterizeLayer and gdal_rasterize

Ivan,

what comes to mind is a SRS mismatch issue. From what I can see
gdal.RasterizeLayer() takes a pfnTransformer / pTransformArg for that, but I'm
not sure if they are probably mapped to SWIG to something practical.

You might try instead with the gdal.Rasterize() "utility as a C function" that
is higher level and should take care of that automagically

usage examples in autotest/utilities/test_gdal_rasterize_lib.py

Even

--
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190724/e9527409/attachment.html>

From kai.muehlbauer at uni-bonn.de  Wed Jul 24 13:05:05 2019
From: kai.muehlbauer at uni-bonn.de (=?ISO-8859-1?Q?Kai_M=FChlbauer?=)
Date: Wed, 24 Jul 2019 22:05:05 +0200
Subject: [gdal-dev] Python RasterizeLayer and gdal_rasterize
In-Reply-To: <BN6PR2201MB1249A4CC3097B1DECE838FD7F2C60@BN6PR2201MB1249.namprd22.prod.outlook.com>
References: <BN6PR2201MB1249F5D87828B190D45329FAF2C60@BN6PR2201MB1249.namprd22.prod.outlook.com>,
 <6603615.oSoERWfJL7@even-i700>
 <BN6PR2201MB1249A4CC3097B1DECE838FD7F2C60@BN6PR2201MB1249.namprd22.prod.outlook.com>
Message-ID: <CF1275D1-B676-4532-B527-12948F2FBE76@uni-bonn.de>

Hi Ivan,

For my application I also had to set the geotransform of the output raster. Just in case you might find it useful, here is the link to my dump_raster function.

https://github.com/wradlib/wradlib/blob/81e41376088c0ad5551c7b7b7eca4423d79b89ec/wradlib/zonalstats.py#L298

HTH,
Kai 

Am 24. Juli 2019 21:38:34 MESZ schrieb Ivan Lucena <ivan.lucena at outlook.com>:
>Even, Kai,
>
>Thank you both for your reply.
>
>Adding a band.FlushCache() did not fixed the problem but it was a good
>point anyway. Thanks Kai.
>
>I tried to use the gdal.Rasterize() instead of gdal.RasterizeLayer()
>without success. There example on autotest varies quit a bit and I
>could not match one that works.
>
>The geojson and geotiff files have the exactly same SRS (EPSG:4326) and
>they overlap perfectly fine on QGIS. But it seems like the issue might
>be related to SRS anyway.
>
>Running the script from the Spyder IDE I was missing a warning message
>that now I can see by running "python script.py" on command line:
>
>Warning 1: Failed to fetch spatial reference on layer MEMORY_LAYER to
>build transformer, assuming matching coordinate systems.
>
>If I understood what Even said, I could fix that issue before calling
>gdal.RasterizeLayer() or use gdal.Rasterize() with the a transformation
>operation to fix the problem.
>
>I am going to work on that. Thank you again so very much,
>
>Ivan
>
>
>
>________________________________
>From: Even Rouault <even.rouault at spatialys.com>
>Sent: Wednesday, July 24, 2019 10:57 AM
>To: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
>Cc: Ivan Lucena <ivan.lucena at outlook.com>
>Subject: Re: [gdal-dev] Python RasterizeLayer and gdal_rasterize
>
>Ivan,
>
>what comes to mind is a SRS mismatch issue. From what I can see
>gdal.RasterizeLayer() takes a pfnTransformer / pTransformArg for that,
>but I'm
>not sure if they are probably mapped to SWIG to something practical.
>
>You might try instead with the gdal.Rasterize() "utility as a C
>function" that
>is higher level and should take care of that automagically
>
>usage examples in autotest/utilities/test_gdal_rasterize_lib.py
>
>Even
>
>--
>Spatialys - Geospatial professional services
>http://www.spatialys.com

-- 
Diese Nachricht wurde von meinem Android-Gerät mit K-9 Mail gesendet.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190724/99264b79/attachment.html>

From mwtoews at gmail.com  Wed Jul 24 13:40:44 2019
From: mwtoews at gmail.com (Mike Taves)
Date: Thu, 25 Jul 2019 08:40:44 +1200
Subject: [gdal-dev] Python RasterizeLayer and gdal_rasterize
In-Reply-To: <BN6PR2201MB1249F5D87828B190D45329FAF2C60@BN6PR2201MB1249.namprd22.prod.outlook.com>
References: <BN6PR2201MB1249F5D87828B190D45329FAF2C60@BN6PR2201MB1249.namprd22.prod.outlook.com>
Message-ID: <CAM2FmMojG0DA5hFZH9jpSfzNU6=92y4afua2wgrKpX761AikFQ@mail.gmail.com>

On Thu, 25 Jul 2019 at 01:19, Ivan Lucena <ivan.lucena at outlook.com> wrote:
>         mem_ds.SetGeoTransform((xmin, xResolut, 0, ymax, 0, yResolut,))

Check your value for yResolut, as it should be negative. In my
experience, a raster full of zeros is when the geometry is outside the
raster window, so be sure to manually check the raster and vector
geometries in (e.g.) QGIS. Lastly, to properly close the file, you
only need to dereference the object:

mem_ds = None

From ivan.lucena at outlook.com  Wed Jul 24 15:19:28 2019
From: ivan.lucena at outlook.com (Ivan Lucena)
Date: Wed, 24 Jul 2019 22:19:28 +0000
Subject: [gdal-dev] Python RasterizeLayer and gdal_rasterize
In-Reply-To: <CAM2FmMojG0DA5hFZH9jpSfzNU6=92y4afua2wgrKpX761AikFQ@mail.gmail.com>
References: <BN6PR2201MB1249F5D87828B190D45329FAF2C60@BN6PR2201MB1249.namprd22.prod.outlook.com>,
 <CAM2FmMojG0DA5hFZH9jpSfzNU6=92y4afua2wgrKpX761AikFQ@mail.gmail.com>
Message-ID: <BN6PR2201MB12491B517A9241D52C2B2350F2C60@BN6PR2201MB1249.namprd22.prod.outlook.com>

Thanks Mike,

I found the problem.

When I call CreateLayer() I am passing the SRS but if I try to print it just before calling RasterizeLayer(), it is not there.

I tried to call FlushCache() and SyncToDisk() but the only thing that solve the problem is to close the dataset and open it again.

        geom_ds = ogr.GetDriverByName('GEOJSON').CreateDataSource('E:\TMP\MEMORY_%s.JSON' % name)
        geom_lyr = geom_ds.CreateLayer('MEMORY_LAYER', geom_type=ogr.wkbPolygon, srs=ref_srs)​
        geom_feat = ogr.Feature(geom_lyr.GetLayerDefn())​
        geom_feat.SetGeometry(geom)​
        geom_lyr.CreateFeature(geom_feat)​

        geom_ds.FlushCache() # That doesn't
        geom_ds.SyncToDisk()​ # help

        mem_ds = gdal.GetDriverByName('GTIFF').Create('E:\TMP\MEMORY_%s.TIF' % name, xcount, ycount, 1, gdal.GDT_Byte)​
        mem_ds.SetGeoTransform((​xmin, xResolut, 0,​ ymax, 0, yResolut,​))​
        mem_ds.SetProjection(ref_ds.GetProjectionRef())​
        mem_ds.FlushCache()​
   ​
        print(geom_lyr.GetSpatialRef()) # None!!

        # That's the solution: close and open the dataset again
        geom_ds = None
        geom_ds = ogr.Open('E:\TMP\MEMORY_%s_GEOM.JSON' % name)​
        geom_lyr = geom_ds.GetLayerByName('MEMORY_LAYER')
        # todo: how can I do that in memory?

        print(geom_lyr.GetSpatialRef()) # Good!!

        err = gdal.RasterizeLayer(mem_ds, [1], geom_lyr, burn_values=[1])​
        if err != 0:​
            print(err)

Even, does it look like a bug to you? A GEOJSON driver bug maybe. I probably did something like that once in a raster driver, wait for the closing of the file to update the SRS.

Thanks,

Ivan



________________________________
From: Mike Taves <mwtoews at gmail.com>
Sent: Wednesday, July 24, 2019 4:40 PM
To: Ivan Lucena <ivan.lucena at outlook.com>
Cc: gdal-dev at lists.osgeo.org <gdal-dev at lists.osgeo.org>
Subject: Re: [gdal-dev] Python RasterizeLayer and gdal_rasterize

On Thu, 25 Jul 2019 at 01:19, Ivan Lucena <ivan.lucena at outlook.com> wrote:
>         mem_ds.SetGeoTransform((xmin, xResolut, 0, ymax, 0, yResolut,))

Check your value for yResolut, as it should be negative. In my
experience, a raster full of zeros is when the geometry is outside the
raster window, so be sure to manually check the raster and vector
geometries in (e.g.) QGIS. Lastly, to properly close the file, you
only need to dereference the object:

mem_ds = None
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190724/9b7d6027/attachment-0001.html>

From kusala9 at googlemail.com  Thu Jul 25 03:29:40 2019
From: kusala9 at googlemail.com (kusala nine)
Date: Thu, 25 Jul 2019 11:29:40 +0100
Subject: [gdal-dev] GMLAS driver - identification of geometry columns.
Message-ID: <CAOn9mqfpPoeZFcMe_hfChj6UQ1rBGvcrSRPqfCnMtEWuS_hy4w@mail.gmail.com>

Hi everyone,

I'm using the GMLAS driver in connection with the OGCs pilot project on
maritime limits and boundaries. The first part of the project is the
creation of an application schema and we're using the IHO S-100 profile of
GML. What I've noticed is that the GMLAS driver won't recognise geometry
columns unless they're in the GML namespace. Because we're using a profile
of gml I want to use s100:PontPropertyType (which is essentially the same
as gml:PointPropertyType but oginfo and the gdal tools (including QGIS and
the GMLAS plugin) won't identify the element as geometry.

snippet from the gmlas driver is below which makes it clear that you must
have a gml namespace for an element to be identified as geometry. I've
built a version of GDAL2.4.2 which takes out the namespace constraint and
that seems to do what I wanrt (i.e s100:PointPropertyType elements are
identified as ogr geometry types).

so.... question - has this come up before? Is there a configuration way
round it? Is it a bug or should we think again in the IHO about how our GML
profile works??? Grateful for any advice...

cheers,

Jonathan
OGC Marine Domain Working Group co-chair

            else if( IsGMLNamespace(transcode(poTypeDef->getNamespace())) &&
                   (eGeomType = GetOGRGeometryType(poTypeDef)) != wkbNone )
            {
                GMLASField oField;
                oField.SetName( osPrefixedEltName );
                oField.SetMinOccurs( nMinOccurs );
                oField.SetMaxOccurs( nMaxOccurs );
                oField.SetType( GMLAS_FT_GEOMETRY, szFAKEXS_GEOMETRY );
                if( nMaxOccurs > 1 || nMaxOccurs == MAXOCCURS_UNLIMITED )
                {
                    // Repeated geometry property can happen in some schemas
                    // like
inspire.ec.europa.eu/schemas/ge_gp/4.0/GeophysicsCore.xsd
                    // or
http://ngwd-bdnes.cits.nrcan.gc.ca/service/gwml/schemas/2.1/gwml2-flow.xsd
                    oField.SetGeomType( wkbUnknown );
                    oField.SetArray( true );
                }
                else
                    oField.SetGeomType( eGeomType );
                oField.SetXPath( osElementXPath );
                oField.SetDocumentation( GetAnnotationDoc( poElt ) );

                oClass.AddField( oField );
            }
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190725/5b6900dc/attachment.html>

From even.rouault at spatialys.com  Thu Jul 25 08:27:02 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 25 Jul 2019 17:27:02 +0200
Subject: [gdal-dev] GMLAS driver - identification of geometry columns.
In-Reply-To: <CAOn9mqfpPoeZFcMe_hfChj6UQ1rBGvcrSRPqfCnMtEWuS_hy4w@mail.gmail.com>
References: <CAOn9mqfpPoeZFcMe_hfChj6UQ1rBGvcrSRPqfCnMtEWuS_hy4w@mail.gmail.com>
Message-ID: <25645008.JYHbbXRS6R@even-i700>

Jonathan,

Identification of geometries could probably be improved in the driver (was 
mostly tested / developed for Inspire data models, and in my memories of the 
ones that were tested, plain GML geometries were used). That said, if your 
s100:PointPropertyType is just a plain gml:PointPropertyType, I'd suggest to 
opt for simplicity and use the GML namespace. It will make it obvious to 
everybody: humans and software having to deal with it.

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From hyoklee at hdfgroup.org  Thu Jul 25 12:12:02 2019
From: hyoklee at hdfgroup.org (Joe Lee)
Date: Thu, 25 Jul 2019 19:12:02 +0000
Subject: [gdal-dev] Motion: adopt RFC 75: Multidimensional array
In-Reply-To: <5928058.43Lh7l8Wlu@even-i700>
References: <2401956.U8z5d6L4Wr@even-i700> <5928058.43Lh7l8Wlu@even-i700>
Message-ID: <CADeM3-xGjyMbsFZJG45wU_kEpnSQ71d3rge7s7mabXPeaYT=NQ@mail.gmail.com>

I'm glad that this motion has passed!

I got one question after reviewing Even's latest code and RFC.

Does it consider a case that subsets 1d dataset from 2d dataset [1]?
The organization of MOP02J (1-D SWATH) and its shape is like below:

dset[2][n_points]
lat[n_points]
lon[n_points]

I wish I could be able to extract 1D from 2D using dset[n_points][0] and
make a GeoTIFF grid from the scattered dset/lat/lon using a tool like [2] or
gdalwarp with 3 VRTs that correspond to 1D lat/lon/dset.

To help you understand the case better,
the equivalent Python code is available in [3].

If this workflow can be already done,
can anyone give me a series of commands to be executed?

Best regards,

[1] http://hdfeos.org/zoo/LaRC/MOP02J-20131129-L2V17.8.3.he5.py.png
[2] https://gdal.org/programs/gdal_grid.html
[3] http://hdfeos.org/zoo/LaRC/MOP02J-20131129-L2V17.8.3.he5.py


On Mon, Jul 22, 2019 at 10:10 AM Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>> wrote:
On jeudi 18 juillet 2019 11:37:08 CEST Even Rouault wrote:
> Hi,
>
> I motion to adopt RFC 75: Multidimensional array
>
>         https://github.com/OSGeo/gdal/pull/1580
>
> -----------

I declare this motion passed with +1 from PSC members NormanB, HowardB and
myself.

Even

--
Spatialys - Geospatial professional services
http://www.spatialys.com
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190725/9a795293/attachment.html>

From even.rouault at spatialys.com  Thu Jul 25 12:39:39 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Thu, 25 Jul 2019 21:39:39 +0200
Subject: [gdal-dev] Motion: adopt RFC 75: Multidimensional array
In-Reply-To: <CADeM3-xGjyMbsFZJG45wU_kEpnSQ71d3rge7s7mabXPeaYT=NQ@mail.gmail.com>
References: <2401956.U8z5d6L4Wr@even-i700> <5928058.43Lh7l8Wlu@even-i700>
 <CADeM3-xGjyMbsFZJG45wU_kEpnSQ71d3rge7s7mabXPeaYT=NQ@mail.gmail.com>
Message-ID: <4591298.qHLcOBPqo8@even-i700>

On jeudi 25 juillet 2019 19:12:02 CEST Joe Lee wrote:
> I'm glad that this motion has passed!
> 
> I got one question after reviewing Even's latest code and RFC.
> 
> Does it consider a case that subsets 1d dataset from 2d dataset [1]?
> The organization of MOP02J (1-D SWATH) and its shape is like below:
> 
> dset[2][n_points]
> lat[n_points]
> lon[n_points]
> 
> I wish I could be able to extract 1D from 2D using dset[n_points][0] and
> make a GeoTIFF grid from the scattered dset/lat/lon using a tool like [2]
> or
 gdalwarp with 3 VRTs that correspond to 1D lat/lon/dset.
> 
> To help you understand the case better,
> the equivalent Python code is available in [3].
> 
> If this workflow can be already done,
> can anyone give me a series of commands to be executed?

As far as I understand your need, this could probably be done with a gdalmdimtranslate invokation
(or possibly several ones and assemble manually a VRT)

https://gdal.org/programs/gdalmdimtranslate.html#gdalmdimtranslate

to extract 1D from 2D, you would do something like

gdalmdimtranslate in out -array name=dset,view=[:,0]

The view argument can be used to use numpy-style indexing & slicing:
https://gdal.org/api/gdalmdarray_cpp.html#_CPPv4NK11GDALMDArray7GetViewERKNSt6stringE 

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From hyoklee at hdfgroup.org  Thu Jul 25 12:57:44 2019
From: hyoklee at hdfgroup.org (Joe Lee)
Date: Thu, 25 Jul 2019 19:57:44 +0000
Subject: [gdal-dev] Motion: adopt RFC 75: Multidimensional array
In-Reply-To: <4591298.qHLcOBPqo8@even-i700>
References: <2401956.U8z5d6L4Wr@even-i700> <5928058.43Lh7l8Wlu@even-i700>
 <CADeM3-xGjyMbsFZJG45wU_kEpnSQ71d3rge7s7mabXPeaYT=NQ@mail.gmail.com>
 <4591298.qHLcOBPqo8@even-i700>
Message-ID: <58FFF989-1E3A-463C-A028-D60AE88ACD3D@hdfgroup.org>

Thanks, Even for the quick answer!

I tried it but I get "ERROR 6":

[nene:gdal/gdal/apps] hyoklee%  ./gdalmdimtranslate -array name='/HDFEOS/SWATHS/MOP02/Data Fields/RetrievedSurfaceTemperature',view=\[:,0\]  ~/NASAHDF/MOP02J-20131129-L2V17.8.3.he5  test.tif
ERROR 6: Unsupported number of dimensions


﻿On 7/25/19, 2:39 PM, "Even Rouault" <even.rouault at spatialys.com> wrote:

    On jeudi 25 juillet 2019 19:12:02 CEST Joe Lee wrote:
    > I'm glad that this motion has passed!
    > 
    > I got one question after reviewing Even's latest code and RFC.
    > 
    > Does it consider a case that subsets 1d dataset from 2d dataset [1]?
    > The organization of MOP02J (1-D SWATH) and its shape is like below:
    > 
    > dset[2][n_points]
    > lat[n_points]
    > lon[n_points]
    > 
    > I wish I could be able to extract 1D from 2D using dset[n_points][0] and
    > make a GeoTIFF grid from the scattered dset/lat/lon using a tool like [2]
    > or
     gdalwarp with 3 VRTs that correspond to 1D lat/lon/dset.
    > 
    > To help you understand the case better,
    > the equivalent Python code is available in [3].
    > 
    > If this workflow can be already done,
    > can anyone give me a series of commands to be executed?
    
    As far as I understand your need, this could probably be done with a gdalmdimtranslate invokation
    (or possibly several ones and assemble manually a VRT)
    
    https://gdal.org/programs/gdalmdimtranslate.html#gdalmdimtranslate
    
    to extract 1D from 2D, you would do something like
    
    gdalmdimtranslate in out -array name=dset,view=[:,0]
    
    The view argument can be used to use numpy-style indexing & slicing:
    https://gdal.org/api/gdalmdarray_cpp.html#_CPPv4NK11GDALMDArray7GetViewERKNSt6stringE 
    
    Even
    
    -- 
    Spatialys - Geospatial professional services
    http://www.spatialys.com
    


From kusala9 at googlemail.com  Thu Jul 25 23:45:17 2019
From: kusala9 at googlemail.com (kusala nine)
Date: Fri, 26 Jul 2019 07:45:17 +0100
Subject: [gdal-dev] GMLAS driver - identification of geometry columns.
In-Reply-To: <25645008.JYHbbXRS6R@even-i700>
References: <CAOn9mqfpPoeZFcMe_hfChj6UQ1rBGvcrSRPqfCnMtEWuS_hy4w@mail.gmail.com>
 <25645008.JYHbbXRS6R@even-i700>
Message-ID: <CAOn9mqdzJk5oYEzpOp5z5-zcpg3VTuEboHWTs0_B9thG0sbdbw@mail.gmail.com>

hi Even, thanks for the quick reply - seems to make sense and chimes with
what we've found - certainly in the short term I think we can use
gml:PointProperty to get us where we want to go.... The Marine S-100 model
adds an association to an information type into the geometry primitive by
extension - not a mechanism we're actualyl using in the Application Schema
we're creating right now but conceivably it could be a sticking point for
both marine users within the S-100 GML Profile and possibly other users
where a profile of GML is constructuced which is then used to create
multiple sub-products (not sure if INSPIRE ever went down this route tho).
So... alternatives could be to allow the gml namespace to be aliased by a
configuraiton optjon in gmlasconf.xml or to identify gml:[primitive] or any
extension of those primitves as geometry to the identified OGRFeature -
that's more structural though and would need the applciation schema driver
to look at the derivation of each of the elements in the schema....
thoughts? I'll also check with the S-100 folks in charge of the S-100 PArt
10b where the profile is and see if we can come up with an agreed proposal
at least....

cheers,

JP

On Thu, 25 Jul 2019 at 16:27, Even Rouault <even.rouault at spatialys.com>
wrote:

> Jonathan,
>
> Identification of geometries could probably be improved in the driver (was
> mostly tested / developed for Inspire data models, and in my memories of
> the
> ones that were tested, plain GML geometries were used). That said, if your
> s100:PointPropertyType is just a plain gml:PointPropertyType, I'd suggest
> to
> opt for simplicity and use the GML namespace. It will make it obvious to
> everybody: humans and software having to deal with it.
>
> Even
>
> --
> Spatialys - Geospatial professional services
> http://www.spatialys.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190726/28c63598/attachment-0001.html>

From even.rouault at spatialys.com  Fri Jul 26 07:34:52 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Fri, 26 Jul 2019 16:34:52 +0200
Subject: [gdal-dev] Motion: adopt RFC 75: Multidimensional array
In-Reply-To: <58FFF989-1E3A-463C-A028-D60AE88ACD3D@hdfgroup.org>
References: <2401956.U8z5d6L4Wr@even-i700> <4591298.qHLcOBPqo8@even-i700>
 <58FFF989-1E3A-463C-A028-D60AE88ACD3D@hdfgroup.org>
Message-ID: <2792692.0Z41QLn89u@even-i700>

On jeudi 25 juillet 2019 19:57:44 CEST Joe Lee wrote:
> Unsupported number of dimensions

Ah ok, when exporting to GeoTIFF or a "classic" 2D driver, the 
multidimensional-to-classic bridge currently checks that the array is a 2D 
one. Here you reduced it to a 1D-slice, hence it rejects it. The bridge could 
probably be made a bit more flexible by accepting 1D arrays as well. If you 
export to netCDF, this should work fine though (as this won't go through the 
bridge, but use directly multidimensional netCDF output capabilities)

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From hyoklee at hdfgroup.org  Tue Jul 30 10:17:22 2019
From: hyoklee at hdfgroup.org (Joe Lee)
Date: Tue, 30 Jul 2019 17:17:22 +0000
Subject: [gdal-dev] Motion: adopt RFC 75: Multidimensional array
In-Reply-To: <2792692.0Z41QLn89u@even-i700>
References: <2401956.U8z5d6L4Wr@even-i700> <4591298.qHLcOBPqo8@even-i700>
 <58FFF989-1E3A-463C-A028-D60AE88ACD3D@hdfgroup.org>
 <2792692.0Z41QLn89u@even-i700>
Message-ID: <CADeM3-zoM=23DkDo2+xnR5z5+LuN2T1UWM5ONmVddRVQ+GxZjQ@mail.gmail.com>


Hi, Even!

  1-D dataset handling in the new HDF5 multi-dimension code is fantastic!
  I could convert 1-d swath into GeoTIFF using the new Python HDF5 multidimensional API.
  Please see python code at the bottom of email.

  However, I can't run it as an AWS lambda function.
  The below is the error message:


'NoneType' object has no attribute 'GetRootGroup': AttributeError
Traceback (most recent call last):
File "/var/task/lambda.py", line 42, in handler
rg = ds.GetRootGroup()
AttributeError: 'NoneType' object has no attribute 'GetRootGroup'


  The same code worked fine under AWS lambda Docker before it is deployed.
  I even tested the Python code on Google Colab and could access data on S3 using vsis3.
  Thus, I am quite puzzled.
   Has anyone successfully tested with HDF5 multidimensional with AWS Lambda?


    # Open dataset using vsis3 interface. fname is obtained from S3 bucket trigger.
    path = '/vsis3/sdt-data/' + fname
    ds = gdal.OpenEx(path, gdal.OF_MULTIDIM_RASTER)
    rg = ds.GetRootGroup()
    hg = rg.OpenGroup('HDFEOS')
    sg = hg.OpenGroup('SWATHS')
    mg = sg.OpenGroup('MOP02')
    gg = mg.OpenGroup('Geolocation Fields')
    dg = mg.OpenGroup('Data Fields')

    ar_lat = gg.OpenMDArray('Latitude')
    lat_data = ar_lat.Read(buffer_datatype = gdal.ExtendedDataType.Create(gdal.GDT_Float32))
    lats = np.frombuffer(lat_data, dtype=np.float32)
        ...

On Fri, Jul 26, 2019 at 9:34 AM Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>> wrote:
On jeudi 25 juillet 2019 19:57:44 CEST Joe Lee wrote:
> Unsupported number of dimensions

Ah ok, when exporting to GeoTIFF or a "classic" 2D driver, the
multidimensional-to-classic bridge currently checks that the array is a 2D
one. Here you reduced it to a 1D-slice, hence it rejects it. The bridge could
probably be made a bit more flexible by accepting 1D arrays as well. If you
export to netCDF, this should work fine though (as this won't go through the
bridge, but use directly multidimensional netCDF output capabilities)

Even

--
Spatialys - Geospatial professional services
http://www.spatialys.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190730/3d9bf27b/attachment.html>

From hyoklee at hdfgroup.org  Tue Jul 30 11:10:15 2019
From: hyoklee at hdfgroup.org (Joe Lee)
Date: Tue, 30 Jul 2019 18:10:15 +0000
Subject: [gdal-dev] Motion: adopt RFC 75: Multidimensional array
In-Reply-To: <CADeM3-zoM=23DkDo2+xnR5z5+LuN2T1UWM5ONmVddRVQ+GxZjQ@mail.gmail.com>
References: <2401956.U8z5d6L4Wr@even-i700> <4591298.qHLcOBPqo8@even-i700>
 <58FFF989-1E3A-463C-A028-D60AE88ACD3D@hdfgroup.org>
 <2792692.0Z41QLn89u@even-i700>
 <CADeM3-zoM=23DkDo2+xnR5z5+LuN2T1UWM5ONmVddRVQ+GxZjQ@mail.gmail.com>
Message-ID: <CADeM3-yLpwgaUiwSD0s+-677wkHWod8Uq2QOBxhDjUpX_XpHSg@mail.gmail.com>


I found the error. It was my token key in gdal.SetConfigOption().
GDAL Multidimensional support is quite amazing and works well with AWS Lambda & HDF5 data on S3!

I can't wait to see HDF4 multidimensional support.

Thank you, GDAL development team for the new driver!


On Tue, Jul 30, 2019 at 12:17 PM Joe Lee <hyoklee at hdfgroup.org<mailto:hyoklee at hdfgroup.org>> wrote:

Hi, Even!

  1-D dataset handling in the new HDF5 multi-dimension code is fantastic!
  I could convert 1-d swath into GeoTIFF using the new Python HDF5 multidimensional API.
  Please see python code at the bottom of email.

  However, I can't run it as an AWS lambda function.
  The below is the error message:


'NoneType' object has no attribute 'GetRootGroup': AttributeError
Traceback (most recent call last):
File "/var/task/lambda.py", line 42, in handler
rg = ds.GetRootGroup()
AttributeError: 'NoneType' object has no attribute 'GetRootGroup'


  The same code worked fine under AWS lambda Docker before it is deployed.
  I even tested the Python code on Google Colab and could access data on S3 using vsis3.
  Thus, I am quite puzzled.
   Has anyone successfully tested with HDF5 multidimensional with AWS Lambda?


    # Open dataset using vsis3 interface. fname is obtained from S3 bucket trigger.
    path = '/vsis3/sdt-data/' + fname
    ds = gdal.OpenEx(path, gdal.OF_MULTIDIM_RASTER)
    rg = ds.GetRootGroup()
    hg = rg.OpenGroup('HDFEOS')
    sg = hg.OpenGroup('SWATHS')
    mg = sg.OpenGroup('MOP02')
    gg = mg.OpenGroup('Geolocation Fields')
    dg = mg.OpenGroup('Data Fields')

    ar_lat = gg.OpenMDArray('Latitude')
    lat_data = ar_lat.Read(buffer_datatype = gdal.ExtendedDataType.Create(gdal.GDT_Float32))
    lats = np.frombuffer(lat_data, dtype=np.float32)
        ...

On Fri, Jul 26, 2019 at 9:34 AM Even Rouault <even.rouault at spatialys.com<mailto:even.rouault at spatialys.com>> wrote:
On jeudi 25 juillet 2019 19:57:44 CEST Joe Lee wrote:
> Unsupported number of dimensions

Ah ok, when exporting to GeoTIFF or a "classic" 2D driver, the
multidimensional-to-classic bridge currently checks that the array is a 2D
one. Here you reduced it to a 1D-slice, hence it rejects it. The bridge could
probably be made a bit more flexible by accepting 1D arrays as well. If you
export to netCDF, this should work fine though (as this won't go through the
bridge, but use directly multidimensional netCDF output capabilities)

Even

--
Spatialys - Geospatial professional services
http://www.spatialys.com
_______________________________________________
gdal-dev mailing list
gdal-dev at lists.osgeo.org<mailto:gdal-dev at lists.osgeo.org>
https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190730/0bf5993e/attachment-0001.html>

From ivan.lucena at outlook.com  Tue Jul 30 14:48:45 2019
From: ivan.lucena at outlook.com (Ivan Lucena)
Date: Tue, 30 Jul 2019 21:48:45 +0000
Subject: [gdal-dev] NetCDF driver getting wrong values if compared to HDF5
Message-ID: <BN6PR2201MB12495D698DC131D37D9F45B8F2DC0@BN6PR2201MB1249.namprd22.prod.outlook.com>

Hi,

I am struggling with an issue with the NetCDF file with dealing with data from ESA Copernicus, Proba-V 1KM Level 3.

If I read the data using the HDF5 driver I lose the georeferenced but the values seems to more aceturate, since the pixels values over the ocean are supposed t be flagged as 254. See the Python printout:

from osgeo import gdal
import numpy​
​
ds = gdal.Open('HDF5:"c_gls_NDVI_201907110000_GLOBE_PROBAV_V2.2.1.nc"://NDVI')​
bd = ds.GetRasterBand(1)​
ar = bd.ReadAsArray(25109,9083,10,10)​
print(ar)​
ds = None​
​[[254 254 254 254 254 254 254 254 254 254]
 [254 254 254 254 254 254 254 254 254 254]​
 [254 254 254 254 254 254 254 254 254 254]​
 [254 254 254 254 254 254 254 254 254 254]​
 [254 254 254 254 254 254 254 254 254 254]​
 [254 254 254 254 254 254 254 254 254 254]​
 [254 254 254 254 254 254 254 254 254 254]​
 [254 254 254 254 254 254 254 254 254 254]​
 [254 254 254 254 254 254 254 254 254 254]​
 [254 254 254 254 254 254 254 254 254 254]]​

ds = gdal.Open('NETCDF:"c_gls_NDVI_201907110000_GLOBE_PROBAV_V2.2.1.nc":NDVI')​
bd = ds.GetRasterBand(1)​
ar = bd.ReadAsArray(25109,9083,10,10)​
print(ar)​
ds = None​
[[255 255 255 255 255 255 255 255 255 255]​
 [255 255 255 255 255 255 255 255 255 255]​
 [255 255 255 255 255 255 255 255 255 255]​
 [255 255 255 255 255 255 255 255 255 255]​
 [255 255 255 255 255 255 255 255 255 255]​
 [255 255 255 255 255 255 255 255 255 255]​
 [255 255 255 255 255 255 255 255 255 255]​
 [255 255 255 255 255 255 255 255 255 255]​
 [255 255 255 255 255 255 255 255 255 255]​
 [255 255 255 255 255 255 255 255 255 255]]​

By looking at the gdalinfo information it clear that netCDF gathers more information, like I said, georeferenced but both drivers are not capable to show the list of flagged values on the NDVI dataset:

$ gdalinfo HDF5:"c_gls_NDVI_201907110000_GLOBE_PROBAV_V2.2.1.nc"://NDVI
Driver: HDF5Image/HDF5 Dataset
. . .
    NDVI_flag_meanings=Missing cloud snow sea background
    NDVI_flag_values=√ⁿ²■

$ gdalinfo NETCDF:"c_gls_NDVI_201907110000_GLOBE_PROBAV_V2.2.1.nc":NDVI
Warning 1: NetCDF driver detected file type=5, but libnetcdf detected type=3
Warning 1: Unsupported netCDF datatype (7), treat as Float32.​
Driver: netCDF/Network Common Data Format
. . .
  NDVI#flag_meanings=Missing cloud snow sea background
  NDVI#flag_values={}

There is this warning but that doesn't seems to be affecting the pixels values on the land.

Does anybody has a clue on what is going on here?

Thanks,

Ivan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190730/90653faf/attachment.html>

From ahmettemiz88 at gmail.com  Wed Jul 31 03:56:03 2019
From: ahmettemiz88 at gmail.com (Ahmet Temiz)
Date: Wed, 31 Jul 2019 13:56:03 +0300
Subject: [gdal-dev] from projection coordinates to pixel coords
Message-ID: <CAJKO1YuNXpunwUEgXn0_qNb2UZSxdyh+ygFx1ioXM53r8D4KSA@mail.gmail.com>

Hi,

How can we transform from projection coordinates to pixel coords with gdal
c++ ?

regards

-- 
Ahmet Temiz
Jeoloji Müh.
Afet ve Acil Durum Yönetimi Başkanlığı
Bilgi İşlem  Dairesi Başkanlığı-CBS Grubu


________________________

Ahmet Temiz
Geological Eng.
Information Systems - GIS Group
Disaster and Emergency Management
of Presidency
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190731/7bcdcc28/attachment-0001.html>

From ivan.lucena at outlook.com  Wed Jul 31 06:41:21 2019
From: ivan.lucena at outlook.com (Ivan Lucena)
Date: Wed, 31 Jul 2019 13:41:21 +0000
Subject: [gdal-dev] from projection coordinates to pixel coords
In-Reply-To: <CAJKO1YuNXpunwUEgXn0_qNb2UZSxdyh+ygFx1ioXM53r8D4KSA@mail.gmail.com>
References: <CAJKO1YuNXpunwUEgXn0_qNb2UZSxdyh+ygFx1ioXM53r8D4KSA@mail.gmail.com>
Message-ID: <BN6PR2201MB1249E19733972D1E1A459327F2DF0@BN6PR2201MB1249.namprd22.prod.outlook.com>

Hi Ahmet,

I would suggest for your to look into the raster tutorial page and search for all the occurrences of "adfGeoTransform" and read the comments and code related to that.

https://gdal.org/tutorials/raster_api_tut.html

Another good source code to take a look is the gdal_translate_lib.cpp code where you can search for the same variable name and see how the parameters "-srcwin" and "-srcproj" are handled on that. That is what you need, right?

https://github.com/OSGeo/gdal/blob/master/gdal/apps/gdal_translate_lib.cpp

Of course you can also check the GDAL API documentation:

https://gdal.org/api/gdaldataset_cpp.html

Best regards,

Ivan


________________________________
From: gdal-dev <gdal-dev-bounces at lists.osgeo.org> on behalf of Ahmet Temiz <ahmettemiz88 at gmail.com>
Sent: Wednesday, July 31, 2019 6:56 AM
To: gdal-dev <gdal-dev at lists.osgeo.org>
Subject: [gdal-dev] from projection coordinates to pixel coords

Hi,

How can we transform from projection coordinates to pixel coords with gdal c++ ?

regards

--
Ahmet Temiz
Jeoloji Müh.
Afet ve Acil Durum Yönetimi Başkanlığı
Bilgi İşlem  Dairesi Başkanlığı-CBS Grubu


________________________

Ahmet Temiz
Geological Eng.
Information Systems - GIS Group
Disaster and Emergency Management
of Presidency
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190731/8fc0a1e3/attachment.html>

From matt.amato at gmail.com  Wed Jul 31 08:00:26 2019
From: matt.amato at gmail.com (Matthew Amato)
Date: Wed, 31 Jul 2019 11:00:26 -0400
Subject: [gdal-dev] OSRSetPROJSearchPaths in multithreaded application
In-Reply-To: <CADuK5a1j34J4AQE4yoMCXj6XisbRL3LAOSfjRHFbhyxEQHkqJw@mail.gmail.com>
References: <CADuK5a2gsn7=62LhvLAan6zEVq86MyiU343zet8TA4-TxY5-+g@mail.gmail.com>
 <1649689.ijBBJRvSoZ@even-i700>
 <CADuK5a0cne36E=SM6UPRxMwOJrthzouT0L88dL4TAG=YATSdHQ@mail.gmail.com>
 <2018701.Ae6B88yUKQ@even-i700>
 <CADuK5a1j34J4AQE4yoMCXj6XisbRL3LAOSfjRHFbhyxEQHkqJw@mail.gmail.com>
Message-ID: <CAO7bkPw=D78B6yOUq+MSBzP=KNwvvupZSgyTGuaDxyE-HWyFxg@mail.gmail.com>

I apologize for resurrecting this thread, but we are running into the same
problem, even after updating the the head of the "release/3.0" branch which
contains Even's fix.

Previously, we would set PROJ_LIB as an environment variable but after
upgrading to 3.x/6.x we now receive thousands of "proj.db not found"
errors. After checking out the above branch, I removed the environment
variable and call OSRSetPROJSearchPaths before calling GDALAllRegister at
the start of my main thread but the problem remains.

What's odd is that it only happens if we use a lot of threads, which makes
me think there may still be a race condition somewhere in GDAL?

If I change my code to be single-threaded, the problem goes away completely.

And advice you could offer would be much appreciated.

Thanks!

On Wed, Jul 17, 2019 at 1:27 PM Dirk Vanden Boer <dirk.vdb at gmail.com> wrote:

>
>
> Op wo 17 jul. 2019 om 17:57 schreef Even Rouault <
> even.rouault at spatialys.com>
>
>> > I did some more investigation, and it seems like the threading is
>> > indeed not the issue.
>> > The issue seems to be that the geotiff library also creates proj
>> > contexts and these contexts do not have
>> > the search paths that are passed to the OSRGetProjTLSContext call.
>>
>> Should be fixed per
>>
>> https://github.com/OSGeo/gdal/commit/48793b5613cf1bf789125516ba845947dc63098f
>> in master
>> and
>>
>> https://github.com/OSGeo/gdal/commit/ffb0ad0c862cf4ef5d6907d1d83cc76fcf8c305b
>> in 3.0 branch
>>
>
> Great, thanks for the quick response and fixes!
>
>>
>> _______________________________________________
> gdal-dev mailing list
> gdal-dev at lists.osgeo.org
> https://lists.osgeo.org/mailman/listinfo/gdal-dev
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190731/e9eafbaf/attachment.html>

From even.rouault at spatialys.com  Wed Jul 31 08:19:29 2019
From: even.rouault at spatialys.com (Even Rouault)
Date: Wed, 31 Jul 2019 17:19:29 +0200
Subject: [gdal-dev] NetCDF driver getting wrong values if compared to
	HDF5
In-Reply-To: <BN6PR2201MB12495D698DC131D37D9F45B8F2DC0@BN6PR2201MB1249.namprd22.prod.outlook.com>
References: <BN6PR2201MB12495D698DC131D37D9F45B8F2DC0@BN6PR2201MB1249.namprd22.prod.outlook.com>
Message-ID: <4022720.JtuchN86Q1@even-i700>

On mardi 30 juillet 2019 21:48:45 CEST Ivan Lucena wrote:
> Unsupported netCDF datatype (7), treat as Float32.​

Given that

#define NC_UBYTE        7       /**< unsigned 1 byte int */

and 

https://github.com/OSGeo/gdal/blob/master/gdal/frmts/netcdf/netcdfdataset.cpp#L357

it seems you would have a GDAL build against a netCDF build without NC4 support.

That said, even with that, I would have expected the ubyte to float32 conversion to be lossless.

but according to 
https://www.unidata.ucar.edu/software/netcdf/docs/group__variables.html#ga0ab808702d73b7f52be14b1e54473902
"""
The nc_get_vara() function will read a variable of any type, including user defined type.
For this function, the type of the data in memory must match the type of the variable - no data conversion is done.
"""

So you could get pretty much garbage.

Solution: build GDAL against a netCDF build that has NC4 support

Even

-- 
Spatialys - Geospatial professional services
http://www.spatialys.com

From ahmettemiz88 at gmail.com  Wed Jul 31 10:57:01 2019
From: ahmettemiz88 at gmail.com (Ahmet Temiz)
Date: Wed, 31 Jul 2019 20:57:01 +0300
Subject: [gdal-dev] =?utf-8?q?=28no_subject=29?=
Message-ID: <CAJKO1Yv_q3tNg=N0J7Bng7F1LFzU=JXFt6tbG_4Cw5ZPWCmVVw@mail.gmail.com>

Hi,

I need example c++ code for raster masking and clipping.
Do you have any?

Regards
-- 
Ahmet Temiz
Jeoloji Müh.
Afet ve Acil Durum Yönetimi Başkanlığı
Bilgi İşlem  Dairesi Başkanlığı-CBS Grubu


________________________

Ahmet Temiz
Geological Eng.
Information Systems - GIS Group
Disaster and Emergency Management
of Presidency
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.osgeo.org/pipermail/gdal-dev/attachments/20190731/725ba47d/attachment.html>

